<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ═══ PRIMARY SEO ═══ -->
<title>Reaction Time Test, Typing Speed, CPS Test & Brain Games | Reflex Lab</title>
<meta name="description" content="Free online reaction time test, typing speed test (WPM), click speed test (CPS), number memory test, clicker tycoon game and more. No download — instant results in your browser.">
<meta name="keywords" content="reaction time test, typing speed test, WPM test, click speed test, CPS test, clicker tycoon, idle clicker game, jitter click test, spacebar speed test, stimulation clicker, snake game online, dinosaur game, coreball game, number memory test, online brain games, free reflex test, ms reaction time, words per minute free">
<link rel="canonical" href="https://reactionspeedtest.com/">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<link rel="alternate" href="https://reactionspeedtest.com/reaction-time-test">
<link rel="alternate" href="https://reactionspeedtest.com/clicker-tycoon">
<link rel="alternate" href="https://reactionspeedtest.com/click-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/jitter-click-test">
<link rel="alternate" href="https://reactionspeedtest.com/spacebar-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/stimulation-clicker">
<link rel="alternate" href="https://reactionspeedtest.com/typing-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/dinosaur-game">
<link rel="alternate" href="https://reactionspeedtest.com/coreball-game">
<link rel="alternate" href="https://reactionspeedtest.com/number-memory-test">
<link rel="alternate" href="https://reactionspeedtest.com/snake-game">
<meta name="theme-color" content="#06060e">
<meta name="author" content="Reflex Lab">

<!-- ═══ OPEN GRAPH / SOCIAL ═══ -->
<meta property="og:type" content="website">
<meta property="og:title" content="Reflex Lab — Reaction Time Test, Typing Speed, CPS & Brain Games">
<meta property="og:description" content="Free browser games and skill tests: reaction time (ms), typing speed (WPM), click speed (CPS), Clicker Tycoon idle game, memory test, Dino game, Snake and more. No signup required.">
<meta property="og:url" content="https://reactionspeedtest.com/">
<meta property="og:image" content="https://reactionspeedtest.com/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Reflex Lab">

<!-- ═══ TWITTER CARD ═══ -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Reflex Lab — Free Reaction, Typing, CPS & Brain Tests">
<meta name="twitter:description" content="Test your reaction time, typing speed, click speed and play Clicker Tycoon — all free in your browser. Instant results, no download.">
<meta name="twitter:image" content="https://reactionspeedtest.com/og-image.png">

<!-- ═══ FAVICON (inline SVG, no server needed) ═══ -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%2306060e'/><text y='24' x='4' font-size='22'>⚡</text></svg>">

<!-- ═══ STRUCTURED DATA (JSON-LD) ═══ -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": "https://reactionspeedtest.com/#org",
  "name": "Reflex Lab",
  "url": "https://reactionspeedtest.com/",
  "logo": {
    "@type": "ImageObject",
    "url": "https://reactionspeedtest.com/og-image.png",
    "width": 1200,
    "height": 630
  },
  "sameAs": ["https://reactionspeedtest.com/"]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": "https://reactionspeedtest.com/#website",
  "name": "Reflex Lab — Reaction Time, Typing Speed, CPS & Brain Games",
  "url": "https://reactionspeedtest.com/",
  "description": "Free online skill tests and games: reaction time, typing speed (WPM), click speed (CPS), Clicker Tycoon, number memory, Dino game, Snake, Coreball and more.",
  "publisher": { "@id": "https://reactionspeedtest.com/#org" }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "@id": "https://reactionspeedtest.com/#webapp",
  "name": "Reflex Lab — Free Browser Games & Skill Tests",
  "url": "https://reactionspeedtest.com/",
  "description": "Free browser-based skill tests and games: reaction time (ms), click speed (CPS), typing speed (WPM), Clicker Tycoon idle game, jitter click, spacebar speed, number memory, Snake, Dino and Coreball.",
  "applicationCategory": "GameApplication",
  "operatingSystem": "Windows, macOS, Linux, Android, iOS",
  "browserRequirements": "Requires JavaScript",
  "offers": {
    "@type": "Offer",
    "price": 0,
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock",
    "url": "https://reactionspeedtest.com/"
  },
  "featureList": [
    "Reaction Time Test",
    "Clicker Tycoon Idle Game",
    "Typing Speed Test (WPM)",
    "Click Speed Test (CPS)",
    "Stimulation Clicker Aim Training",
    "Jitter Click Test",
    "Spacebar Speed Test",
    "Number Memory Test",
    "Snake Game",
    "Dinosaur Game",
    "Coreball Game",
    "Prestige & Upgrade System",
    "8 Time Durations (1s–100s)"
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": 4.8,
    "ratingCount": 2347,
    "bestRating": 5,
    "worstRating": 1
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    { "@type": "Question", "name": "What is a good reaction time?", "acceptedAnswer": { "@type": "Answer", "text": "Average human reaction time is 200–250ms. Pro gamers achieve 150–190ms. Below 150ms is elite level seen only in esports professionals." } },
    { "@type": "Question", "name": "What is a good CPS (clicks per second)?", "acceptedAnswer": { "@type": "Answer", "text": "6–7 CPS is average. Above 10 CPS is good. Above 14 CPS requires jitter or butterfly clicking. Pro Minecraft PvP players sustain 8–12 CPS." } },
    { "@type": "Question", "name": "What is the world record CPS?", "acceptedAnswer": { "@type": "Answer", "text": "Regular clicking: 14.1 CPS (Dylan Allred, 2020). Butterfly clicking: 25.5 CPS (Nestor, 2022). Drag clicking is excluded from official records." } },
    { "@type": "Question", "name": "What is average typing speed in WPM?", "acceptedAnswer": { "@type": "Answer", "text": "The global average is 40–50 WPM. Office professionals average 55–70 WPM. The world record is 212 WPM held by Barbara Blackburn." } },
    { "@type": "Question", "name": "How many digits can the average person memorize?", "acceptedAnswer": { "@type": "Answer", "text": "Most adults hold 5–7 digits in working memory. This is Miller's Law — the magical number 7 plus or minus 2. Techniques like chunking can extend this to 10+ digits." } },
    { "@type": "Question", "name": "What is a good spacebar speed?", "acceptedAnswer": { "@type": "Answer", "text": "6–8 presses per second is average. Above 10 HPS is exceptional and typically requires a mechanical keyboard with linear switches." } },
    { "@type": "Question", "name": "What is jitter clicking?", "acceptedAnswer": { "@type": "Answer", "text": "Jitter clicking involves tensing forearm and wrist muscles to create rapid vibrations translating into 10–14 CPS. It is commonly used in Minecraft PvP and carries injury risk with prolonged use." } },
    { "@type": "Question", "name": "How do you get a high score in the Dinosaur game?", "acceptedAnswer": { "@type": "Answer", "text": "Jump earlier than feels natural — the dinosaur needs 200ms to reach full jump height. Duck under pterodactyls instead of jumping. Recalibrate your timing every 100 points as the game speeds up." } },
    { "@type": "Question", "name": "What is a good Coreball score?", "acceptedAnswer": { "@type": "Answer", "text": "10+ points is good. 20+ is excellent. 30+ is elite. The key is finding the rotation rhythm and shooting into the largest gap, not just reacting to any open space." } },
    { "@type": "Question", "name": "Does the stimulation clicker help with FPS aim?", "acceptedAnswer": { "@type": "Answer", "text": "Yes. Hard mode targets (38px, 0.5s lifetime) are comparable to Aimlabs Gridshot difficulty. Regular practice improves flick-shot accuracy in CS2, Valorant, and Fortnite." } },
    { "@type": "Question", "name": "What is Clicker Tycoon?", "acceptedAnswer": { "@type": "Answer", "text": "Clicker Tycoon is a free idle clicker game on Reflex Lab. Click to earn coins, buy upgrades (cursors, miners, factories, banks, labs and more), build a city, and prestige for a permanent 2× income multiplier. Your progress is saved automatically." } }
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://reactionspeedtest.com/" }
  ]
}
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5019628877403001" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ════════════════════════════════════════════════
   TOKENS
════════════════════════════════════════════════ */
:root {
  --bg:       #06060e;
  --surf:     #0d0d1a;
  --surf2:    #111122;
  --border:   #1c1c30;
  --border2:  #252540;
  --accent:   #00f5a0;
  --red:      #ff2d55;
  --yellow:   #ffe000;
  --purple:   #7b61ff;
  --orange:   #ff6b00;
  --text:     #ffffff;
  --muted:    #b0b0d0;
  --muted2:   #8080b0;
  --row1-h:   52px;
  --row2-h:   44px;
  --header-h: 96px; /* row1 + row2 */
}

/* ════════════════════════════════════════════════
   RESET & BASE
════════════════════════════════════════════════ */
*,*::before,*::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg); color: var(--text);
  min-height: 100vh; overflow-x: hidden;
}

/* Subtle ambient glow */
body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 70% 35% at 50% 0%, rgba(0,245,160,0.05) 0%, transparent 60%),
    radial-gradient(ellipse 40% 30% at 85% 90%, rgba(255,45,85,0.04) 0%, transparent 60%);
}

/* ════════════════════════════════════════════════
   HEADER — two fixed rows spanning full width
════════════════════════════════════════════════ */
.header {
  position: fixed; top:0; left:0; right:0; z-index:200;
  display: flex; flex-direction: column;
  background: rgba(6,6,14,0.96);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
}

/* ─── ROW 1: logo + test type tabs + lang ─── */
.row1 {
  height: var(--row1-h);
  display: flex; align-items: center;
  border-bottom: 1px solid var(--border2);
  gap: 0;
  padding: 0 10px 0 0;
}
.row1::-webkit-scrollbar { display: none; }

.logo { display: none; }

.home-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 12px; border-radius: 8px; margin: 0 8px 0 10px;
  background: var(--surf2); border: 1px solid var(--border);
  color: #c0c0e0; font-size: 0.72rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  text-decoration: none; white-space: nowrap; flex-shrink: 0;
  transition: border-color 0.15s, color 0.15s;
}
.home-btn:hover { border-color: var(--accent); color: var(--accent); }

/* Test type tabs */
.tabs {
  display: flex; align-items: center;
  flex: 1; overflow-x: auto; scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  padding: 0 6px;
  gap: 5px;
  overflow-y: hidden;
}
.tabs::-webkit-scrollbar { display: none; }

.tab {
  display: flex; align-items: center; gap: 5px;
  padding: 6px 13px; cursor: pointer;
  font-size: 0.68rem; font-weight: 700; letter-spacing: 0.07em; text-transform: uppercase;
  color: #ffffff; white-space: nowrap; flex-shrink: 0;
  background: var(--surf);
  border: 1px solid var(--border);
  border-radius: 4px;
  transition: color 0.15s, border-color 0.2s, background 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}
.tab::after {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(circle at center, rgba(0,245,160,0.15) 0%, transparent 70%);
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}
.tab:hover {
  color: #ffffff;
  border-color: rgba(0,245,160,0.55);
  background: rgba(0,245,160,0.08);
  box-shadow: 0 0 14px rgba(0,245,160,0.22), inset 0 0 8px rgba(0,245,160,0.05);
}
.tab:hover::after { opacity: 1; }
.tab.active {
  color: #00f5a0;
  border-color: rgba(0,245,160,0.65);
  background: rgba(0,245,160,0.11);
  box-shadow: 0 0 16px rgba(0,245,160,0.25);
}
.tab.active::after { opacity: 0.6; }
.tab .ticon { font-size: 0.9rem; }

/* Language */
.lang {
  display: flex; align-items: center;
  padding: 0 16px; gap: 4px;
  flex-shrink: 0; margin-left: auto;
  border-left: 1px solid var(--border2);
}
.lbtn {
  padding: 4px 10px; border: 1px solid var(--border2); border-radius: 6px;
  font-size: 0.55rem; font-weight: 700; letter-spacing: 0.1em;
  cursor: pointer; background: none; color: var(--muted); transition: all 0.15s;
}
.lbtn.active { background: var(--accent); border-color: var(--accent); color: #000; }

/* ─── ROW 2: time selector + mode (hidden for reaction/stim) ─── */
.row2 {
  height: var(--row2-h);
  display: flex; align-items: center;
  padding: 0 16px; gap: 6px;
  overflow-x: auto; scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}
.row2::-webkit-scrollbar { display: none; }
.row2.hidden { display: none; }

.row2-label {
  font-size: 0.5rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); flex-shrink: 0; padding-right: 6px;
  border-right: 1px solid var(--border2); margin-right: 2px;
}
.row2-sep { width: 1px; height: 22px; background: var(--border2); flex-shrink: 0; margin: 0 6px; }

.tbtn {
  flex-shrink: 0; padding: 5px 14px;
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 8px; cursor: pointer;
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.05em;
  color: var(--muted); white-space: nowrap;
  transition: all 0.14s;
}
.tbtn:hover { border-color: rgba(0,245,160,0.4); color: var(--text); }
.tbtn.active { background: var(--accent); border-color: var(--accent); color: #000; }

.mbtn {
  flex-shrink: 0; display: flex; align-items: center; gap: 5px;
  padding: 5px 14px; background: var(--surf); border: 1px solid var(--border);
  border-radius: 8px; cursor: pointer;
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.05em;
  color: var(--muted); white-space: nowrap; transition: all 0.14s;
}
.mbtn:hover { border-color: rgba(123,97,255,0.4); color: var(--text); }
.mbtn.active { background: var(--purple); border-color: var(--purple); color: #fff; }

/* ════════════════════════════════════════════════
   MAIN WRAPPER
════════════════════════════════════════════════ */
.wrap {
  padding-top: var(--header-h);
  min-height: 100vh;
  position: relative; z-index: 1;
}

/* ════════════════════════════════════════════════
   GAME ZONE — full viewport width, generous height
════════════════════════════════════════════════ */
.game-zone {
  width: 100%; padding: 28px 24px 0;
  display: flex; flex-direction: column; gap: 18px;
}

/* Page title row */
.gtitle-row { display: flex; align-items: baseline; gap: 14px; flex-wrap: wrap; }
.gtitle {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(2rem, 5vw, 3.2rem);
  letter-spacing: 0.1em; line-height: 1;
  background: linear-gradient(135deg, var(--accent), var(--yellow));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.gtitle.red { background: linear-gradient(135deg, var(--red), var(--orange)); -webkit-background-clip: text; background-clip: text; }
.gsub {
  font-size: 0.58rem; letter-spacing: 0.22em; text-transform: uppercase; color: var(--muted);
}

/* Stats bar — always 4 cards, full width */
.stats-bar {
  display: grid; grid-template-columns: repeat(4,1fr); gap: 10px;
}
@media(max-width:480px) { .stats-bar { grid-template-columns: repeat(2,1fr); } }

.scard {
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 12px; padding: 12px 14px; text-align: center;
  transition: border-color 0.3s;
}
.scard.hi1 { border-color: var(--accent); }
.scard.hi2 { border-color: var(--yellow); }
.scard.hi3 { border-color: var(--purple); }
.scard.hi4 { border-color: var(--red); }
.slbl { font-size: 0.48rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 5px; }
.sval {
  font-family: 'Bebas Neue', sans-serif; font-size: clamp(1.6rem, 4vw, 2.2rem);
  letter-spacing: 0.04em; color: var(--accent); line-height: 1;
}
.sval.yellow { color: var(--yellow); }
.sval.purple { color: var(--purple); }
.sval.red    { color: var(--red); }
.sval.muted  { color: var(--muted); }

/* ─── CLICK ARENA ─── */
.click-arena {
  width: 100%; max-width: 680px; align-self: center;
  height: clamp(300px, 45vh, 520px);
  background: var(--surf);
  border: 2px solid var(--border);
  border-radius: 20px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 14px;
  cursor: pointer; position: relative; overflow: hidden;
  transition: background 0.2s, border-color 0.2s, transform 0.07s;
  user-select: none; touch-action: manipulation;
}
.click-arena:active { transform: scale(0.995); }

/* Grid texture */
.click-arena::before {
  content:''; position:absolute; inset:0; pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px);
}

.click-arena.idle    { background: #090914; }
.click-arena.running { background: #040f0a; border-color: rgba(0,245,160,0.4); }
.click-arena.done    { background: #0f0f04; border-color: rgba(255,224,0,0.4); }

.big-cps {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(5rem, 18vw, 11rem);
  letter-spacing: 0.03em; line-height: 1;
  color: var(--accent); transition: color 0.2s;
  pointer-events: none; position: relative; z-index: 1;
}
.click-arena.done    .big-cps { color: var(--yellow); }

/* When result overlay shows, fade the background CPS number so it doesn't bleed through */
.result-overlay.show ~ * { opacity: 0.08; }
.result-overlay.show + .arena-label { opacity: 0.06; }

/* Explicit fade for big-cps when overlay active — target via sibling */
.click-arena:has(.result-overlay.show) .big-cps { opacity: 0.06; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .arena-label { opacity: 0.04; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .prog { opacity: 0.04; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .combo-badge { display: none; }

.arena-label {
  font-size: 0.65rem; letter-spacing: 0.25em; text-transform: uppercase;
  color: var(--muted); text-align: center; pointer-events: none;
  position: relative; z-index: 1;
}

/* Progress bar */
.prog {
  width: 70%; max-width: 500px; height: 5px;
  background: var(--border); border-radius: 3px; overflow: hidden;
  position: relative; z-index: 1;
}
.prog-fill {
  height: 100%; background: var(--accent); border-radius: 3px;
  transition: width 0.1s linear;
}
.click-arena.done .prog-fill { background: var(--yellow); }

/* Result overlay */
.result-overlay {
  display: none; position: absolute; inset: 0; z-index: 10;
  background: rgba(6,6,14,0.92); border-radius: 18px;
  flex-direction: column; align-items: center; justify-content: center; gap: 8px;
  text-align: center; padding: 20px;
}
.result-overlay.show { display: flex; animation: popIn 0.22s ease; }
@keyframes popIn { from{opacity:0;transform:scale(0.94)} to{opacity:1;transform:scale(1)} }

.r-label  { font-size: 0.58rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--muted); width:100%; text-align:center; }
.r-score  { font-family: 'Bebas Neue', sans-serif; font-size: clamp(4rem,15vw,9rem); line-height: 1; width:100%; text-align:center; display:block; }
.r-unit   { font-size: 0.58rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); width:100%; text-align:center; }
.r-rank   { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.15em; padding: 6px 22px; border-radius: 30px; text-align:center; }
.r-retry  {
  margin-top: 8px; padding: 12px 36px;
  background: var(--accent); color: #000; border: none; border-radius: 12px;
  font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.15em;
  cursor: pointer; transition: all 0.2s;
}
.r-retry:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,245,160,0.35); }

/* Challenge mode */
.click-arena.challenge-active { border-color: var(--red) !important; animation: challengePulse 0.4s infinite; }
@keyframes challengePulse { 0%,100%{box-shadow:0 0 0 0 rgba(255,45,85,0.3)} 50%{box-shadow:0 0 0 20px rgba(255,45,85,0)} }
.ch-target {
  position:absolute; border-radius:50%; cursor:pointer; pointer-events:auto; z-index:5;
  display:flex; align-items:center; justify-content:center;
  font-size:0.5rem; font-weight:700; color:#fff; letter-spacing:0.05em;
  animation: chTargetIn 0.15s ease;
  transition: transform 0.06s, opacity 0.06s;
}
.ch-target:hover { transform: scale(1.1); }
@keyframes chTargetIn { from{opacity:0;transform:scale(0.4)} to{opacity:1;transform:scale(1)} }
.ch-shrink-ring {
  position:absolute; inset:-4px; border-radius:50%;
  border:2px solid rgba(255,45,85,0.6);
  animation: shrink linear forwards;
}
@keyframes shrink { from{transform:scale(1);opacity:1} to{transform:scale(0.1);opacity:0} }
.combo-badge {
  position:absolute; top:10px; right:12px; z-index:6;
  font-family:'Bebas Neue',sans-serif; font-size:1rem; letter-spacing:0.1em;
  color:var(--red); background:rgba(255,45,85,0.12); border:1px solid rgba(255,45,85,0.3);
  padding:4px 10px; border-radius:8px; pointer-events:none;
  display:none;
}
.combo-badge.show { display:block; }
.space-key {
  width: 100%; max-width: 600px; height: 72px;
  background: var(--surf2); border: 2px solid var(--border);
  border-bottom: 6px solid var(--border2); border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.68rem; letter-spacing: 0.35em; text-transform: uppercase;
  color: var(--muted); cursor: pointer; user-select: none; touch-action: manipulation;
  transition: all 0.07s;
}
.space-key:active, .space-key.down {
  border-bottom-width: 2px; transform: translateY(4px);
  border-color: var(--purple); color: var(--purple);
}

/* ─── REACTION ARENA ─── */
.reaction-arena {
  width: 100%; max-width: 680px; align-self: center;
  height: clamp(300px, 45vh, 520px);
  border-radius: 20px; overflow: hidden;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 12px;
  cursor: pointer; position: relative;
  border: 2px solid var(--border);
  transition: background 0.18s, border-color 0.18s, transform 0.07s;
  user-select: none; touch-action: manipulation;
}
.reaction-arena::before {
  content:''; position:absolute; inset:0; pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px);
}
.reaction-arena:active { transform: scale(0.995); }
.reaction-arena.s-wait  { background: #08080f; }
.reaction-arena.s-ready { background: #0f0209; border-color: rgba(255,45,85,0.5); animation: pRed 0.7s infinite; }
.reaction-arena.s-go    { background: #01100a; border-color: rgba(0,245,160,0.7); animation: pGreen 0.4s 1; }
.reaction-arena.s-early { background: #100500; border-color: rgba(255,107,0,0.6); }
.reaction-arena.s-done  { background: var(--surf); border-color: rgba(0,245,160,0.4); }
@keyframes pRed   { 0%,100%{box-shadow:0 0 0 0 rgba(255,45,85,0.2)} 50%{box-shadow:0 0 0 30px rgba(255,45,85,0)} }
@keyframes pGreen { 0%{box-shadow:0 0 0 0 rgba(0,245,160,0.5)} 100%{box-shadow:0 0 0 60px rgba(0,245,160,0)} }
.arena-icon { font-size: 3.5rem; position: relative; z-index:1; pointer-events: none; }
.arena-text {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(2.2rem,8vw,4rem);
  letter-spacing: 0.1em; text-align: center; line-height: 1;
  position: relative; z-index:1; pointer-events: none; padding: 0 20px;
}
.arena-sub {
  font-size: 0.6rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); text-align: center;
  position: relative; z-index:1; pointer-events: none;
}
.ms-big { font-family:'Bebas Neue',sans-serif; font-size:clamp(4rem,15vw,8rem); line-height:1; color:var(--accent); }
.ms-unit{ font-size:0.62rem; letter-spacing:0.3em; color:var(--muted); text-transform:uppercase; }
.rat-pill{ font-size:0.68rem; letter-spacing:0.15em; text-transform:uppercase; padding:5px 16px; border-radius:20px; margin-top:4px; }

/* Rounds dots */
.dots-row { display:flex; gap:8px; width:100%; }
.dot { flex:1; height:6px; border-radius:3px; background:var(--border); transition:background 0.3s; }
.dot.done    { background:var(--accent); }
.dot.fail    { background:var(--red); }
.dot.current { background:var(--muted); animation:blink 0.9s ease-in-out infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

.hist-row { display:flex; gap:6px; flex-wrap:wrap; min-height:26px; }
.hchip { background:var(--surf); border:1px solid var(--border); border-radius:7px; padding:3px 9px; font-size:0.6rem; color:var(--muted); }
.hchip.best{ border-color:var(--accent); color:var(--accent); }
.hchip.fail{ border-color:var(--red); color:var(--red); }

.gameover {
  width:100%; background:var(--surf); border:1px solid var(--border);
  border-radius:18px; padding:24px 20px; text-align:center;
  display:none; flex-direction:column; align-items:center; gap:16px;
  animation:slideUp 0.35s ease;
}
.gameover.show{ display:flex; }
@keyframes slideUp{ from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
.go-title{ font-family:'Bebas Neue',sans-serif; font-size:2.2rem; letter-spacing:0.1em; color:var(--yellow); }
.go-stats{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; width:100%; }
.go-stat{ background:var(--bg); border-radius:10px; padding:10px 8px; }
.go-slbl{ font-size:0.48rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--muted); margin-bottom:4px; }
.go-sval{ font-family:'Bebas Neue',sans-serif; font-size:1.5rem; color:var(--accent); }
.go-sval.bad{ color:var(--red); }
.replay-btn{
  width:100%; padding:16px; background:var(--accent); color:#000; border:none;
  border-radius:13px; font-family:'Bebas Neue',sans-serif; font-size:1.3rem;
  letter-spacing:0.15em; cursor:pointer; transition:all 0.2s;
}
.replay-btn:hover{ transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,245,160,0.3); }

/* ─── STIMULATION ARENA ─── */
.stim-arena {
  width: 100%;
  height: clamp(340px, 50vh, 560px);
  background: #08060f;
  border: 2px solid var(--border);
  border-radius: 20px;
  position: relative; overflow: hidden;
  cursor: crosshair;
}
.stim-idle {
  position:absolute; inset:0; display:flex;
  flex-direction:column; align-items:center; justify-content:center; gap:16px; z-index:5;
}
.stim-idle-title {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(2rem,6vw,3.5rem); letter-spacing:0.1em;
  background:linear-gradient(135deg,var(--red),var(--orange));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.stim-idle-sub { font-size:0.62rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--muted); }
.diff-row { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.diff-btn {
  padding:9px 22px; border-radius:10px; cursor:pointer;
  font-family:'JetBrains Mono',monospace; font-size:0.62rem; font-weight:700; letter-spacing:0.1em;
  transition:all 0.15s; background:none; border:2px solid transparent;
}
.diff-btn.easy   { border-color:var(--accent); color:var(--accent); background:rgba(0,245,160,0.08); }
.diff-btn.medium { border-color:var(--yellow); color:var(--yellow); background:rgba(255,224,0,0.08); }
.diff-btn.hard   { border-color:var(--red);    color:var(--red);    background:rgba(255,45,85,0.1); }
.diff-btn.selected { color:#000; }
.diff-btn.easy.selected   { background:var(--accent); }
.diff-btn.medium.selected { background:var(--yellow); }
.diff-btn.hard.selected   { background:var(--red); }
.stim-start-btn {
  padding:12px 36px; border-radius:12px;
  background:var(--red); color:#fff; border:none; cursor:pointer;
  font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:0.15em;
  transition:all 0.2s;
}
.stim-start-btn:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(255,45,85,0.35); }

/* Target circles */
.stim-target {
  position:absolute; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  cursor:crosshair; pointer-events:auto; z-index:4;
  animation: targetIn 0.12s ease;
  transition: transform 0.06s;
}
.stim-target:hover { transform:scale(1.06); }
@keyframes targetIn{ from{opacity:0;transform:scale(0.5)} to{opacity:1;transform:scale(1)} }
.target-ring {
  position:absolute; inset:0; border-radius:50%;
  animation: ringPulse 0.8s ease-in-out infinite;
}
@keyframes ringPulse{
  0%,100%{transform:scale(1);opacity:0.6}
  50%{transform:scale(1.12);opacity:0.3}
}

/* Countdown inside arena */
.stim-countdown {
  position:absolute; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center; pointer-events:none; z-index:3;
}
.stim-count-num {
  font-family:'Bebas Neue',sans-serif; font-size:clamp(3rem,10vw,6rem);
  letter-spacing:0.1em; color:var(--red); opacity:0;
  animation:countAnim 1s ease-in-out;
}
@keyframes countAnim{ 0%{opacity:1;transform:scale(1.3)} 70%{opacity:1} 100%{opacity:0;transform:scale(0.8)} }

/* Stim result */
.stim-result {
  display:none; position:absolute; inset:0; z-index:20;
  background:rgba(6,6,14,0.92); border-radius:18px;
  flex-direction:column; align-items:center; justify-content:center; gap:10px;
}
.stim-result.show{ display:flex; animation:popIn 0.25s ease; }
.stim-r-score{ font-family:'Bebas Neue',sans-serif; font-size:clamp(5rem,16vw,9rem); line-height:1; }
.stim-r-rank { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:0.15em; }
.stim-replay{ margin-top:6px; padding:12px 36px; background:var(--red); color:#fff; border:none; border-radius:12px; font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:0.15em; cursor:pointer; transition:all 0.2s; }
.stim-replay:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(255,45,85,0.4); }

/* Miss flash */
.miss-flash {
  position:absolute; pointer-events:none; z-index:6;
  width:60px; height:60px; margin:-30px;
  border-radius:50%; background:rgba(255,45,85,0.4);
  animation: missAnim 0.4s ease forwards;
}
@keyframes missAnim{ 0%{opacity:1;transform:scale(0.8)} 100%{opacity:0;transform:scale(2)} }

/* Hit popup */
.hit-popup {
  position:absolute; pointer-events:none; z-index:7;
  font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:0.1em;
  animation:hitAnim 0.5s ease forwards;
}
@keyframes hitAnim{ 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-40px)} }

/* ════════════════════════════════════════════════
   INFO SECTION
════════════════════════════════════════════════ */
.info-wrap {
  width: 100%; margin: 48px auto 0;
  padding: 0 24px 80px;
  display: flex; flex-direction: column; gap: 28px;
}
.sec-divider {
  display:flex; align-items:center; gap:14px;
  font-family:'Bebas Neue',sans-serif; font-size:1.1rem; letter-spacing:0.2em; color:var(--muted);
}
.sec-divider::before,.sec-divider::after { content:''; flex:1; height:1px; background:var(--border); }

.icard {
  background:var(--surf); border:1px solid var(--border); border-radius:16px;
  padding:26px 22px; display:flex; flex-direction:column; gap:16px;
}
.icard-title { font-family:'Bebas Neue',sans-serif; font-size:clamp(1.3rem,4vw,1.8rem); letter-spacing:0.1em; color:var(--accent); }
.ibody { font-size:0.78rem; line-height:1.9; color:#c8c8e8; }
.ibody strong { color:#ffffff; }

/* Rank table */
.rtable { width:100%; border-collapse:collapse; }
.rtable th { font-size:0.5rem; letter-spacing:0.18em; text-transform:uppercase; color:var(--muted); padding:8px 12px; text-align:left; border-bottom:1px solid var(--border); }
.rtable td { padding:12px 12px; font-size:0.63rem; border-bottom:1px solid rgba(28,28,48,0.7); vertical-align:middle; }
.rtable tr:last-child td { border-bottom:none; }
.rbadge { display:inline-flex; align-items:center; gap:8px; font-weight:700; font-size:0.66rem; }
.rdot   { width:10px; height:10px; border-radius:50%; flex-shrink:0; }

/* Technique grid */
.tech-grid { display:flex; flex-direction:column; gap:12px; }
.tcard { background:var(--bg); border:1px solid var(--border); border-radius:14px; padding:16px 16px; display:flex; flex-direction:column; gap:8px; }
.thead-row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.tname { font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:0.08em; color:var(--text); }
.tbadge { font-size:0.5rem; letter-spacing:0.15em; text-transform:uppercase; padding:3px 10px; border-radius:20px; }
.tbadge.g { background:rgba(0,245,160,0.1); border:1px solid rgba(0,245,160,0.3); color:var(--accent); }
.tbadge.y { background:rgba(255,224,0,0.1); border:1px solid rgba(255,224,0,0.3); color:var(--yellow); }
.tbadge.r { background:rgba(255,45,85,0.1); border:1px solid rgba(255,45,85,0.3); color:var(--red); }
.tbadge.p { background:rgba(123,97,255,0.1); border:1px solid rgba(123,97,255,0.3); color:var(--purple); }
.tbody-t { font-size:0.75rem; line-height:1.8; color:#c8c8e8; }
.tbody-t strong { color:var(--text); }

/* Factors */
.fgrid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:400px){ .fgrid{ grid-template-columns:1fr; } }
.fitem { background:var(--bg); border:1px solid var(--border); border-radius:12px; padding:14px 12px; }
.ficon { font-size:1.4rem; margin-bottom:6px; }
.fname { font-size:0.6rem; letter-spacing:0.1em; text-transform:uppercase; color:var(--text); margin-bottom:4px; }
.fdesc { font-size:0.58rem; line-height:1.6; color:var(--muted); }

/* Exercise list */
.exlist { display:flex; flex-direction:column; gap:10px; }
.exitem { display:flex; align-items:flex-start; gap:12px; background:var(--bg); border-radius:10px; padding:13px 14px; }
.exnum  { font-family:'Bebas Neue',sans-serif; font-size:1.2rem; color:var(--accent); min-width:26px; flex-shrink:0; line-height:1; }
.extxt  { font-size:0.63rem; line-height:1.68; color:var(--muted); }
.extxt strong { color:var(--text); }

/* Records */
.rgrid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
@media(min-width:600px){ .rgrid{ grid-template-columns:repeat(4,1fr); } }
.ritem { background:var(--bg); border:1px solid var(--border); border-radius:12px; padding:14px 10px; text-align:center; }
.rval  { font-family:'Bebas Neue',sans-serif; font-size:1.9rem; letter-spacing:0.05em; line-height:1; margin-bottom:4px; }
.rlbl  { font-size:0.49rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--muted); }
.rholder{ font-size:0.57rem; color:var(--text); margin-top:5px; }

/* Compare table */
.ctable { width:100%; border-collapse:collapse; font-size:0.6rem; }
.ctable th { text-align:center; padding:8px 6px; font-size:0.48rem; letter-spacing:0.14em; text-transform:uppercase; color:var(--muted); border-bottom:1px solid var(--border); }
.ctable td { text-align:center; padding:9px 6px; border-bottom:1px solid rgba(28,28,48,0.5); color:var(--muted); }
.ctable tr:last-child td { border-bottom:none; }
.ctable td:first-child { text-align:left; color:var(--text); font-weight:700; }
.yes { color:var(--accent); } .no { color:var(--red); } .mid { color:var(--yellow); }

/* Chart */
.chart-wrap { width:100%; overflow-x:auto; }
.chart-ttl  { font-size:0.55rem; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); margin-bottom:12px; }
svg.rchart  { width:100%; height:auto; display:block; min-width:280px; }

/* Speedometer legend */
.slegend { display:flex; flex-wrap:wrap; gap:8px 16px; justify-content:center; margin-top:8px; }
.sleg-item { display:flex; align-items:center; gap:5px; font-size:0.54rem; letter-spacing:0.07em; text-transform:uppercase; }
.sleg-dot  { width:8px; height:8px; border-radius:50%; flex-shrink:0; }

/* Tips */
.tips { display:flex; flex-wrap:wrap; gap:8px; }
.tip  { background:rgba(0,245,160,0.07); border:1px solid rgba(0,245,160,0.2); border-radius:20px; padding:6px 13px; font-size:0.57rem; letter-spacing:0.07em; color:var(--accent); }

/* FAQ */
.faq-list { display:flex; flex-direction:column; gap:8px; }
.faq-item { background:var(--bg); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
.faq-q {
  width:100%; background:none; border:none; text-align:left;
  padding:14px 16px; cursor:pointer; display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-family:'JetBrains Mono',monospace; font-size:0.61rem; font-weight:700; letter-spacing:0.03em; line-height:1.4;
  color:var(--text); transition:color 0.2s;
}
.faq-q:hover { color:var(--accent); }
.faq-arrow { font-size:0.62rem; color:var(--muted); flex-shrink:0; transition:transform 0.25s; }
.faq-item.open .faq-arrow { transform:rotate(180deg); color:var(--accent); }
.faq-a { max-height:0; overflow:hidden; transition:max-height 0.3s ease; font-size:0.62rem; line-height:1.82; color:var(--muted); padding:0 16px; }
.faq-item.open .faq-a { max-height:600px; padding:0 16px 14px; }
.faq-a strong { color:var(--text); }

/* Footer */
.sfooter { width:100%; text-align:center; padding:28px 0 12px; font-size:0.53rem; letter-spacing:0.07em; color:var(--muted); line-height:1.9; border-top:1px solid var(--border); margin-top:10px; }
.sfooter strong { color:var(--text); }

/* ════════════════════════════════════════════════
   RESPONSIVE / MOBILE
════════════════════════════════════════════════ */

/* Tablet */
@media(max-width:768px){
  .game-zone { padding:16px 14px 0; gap:12px; }
  .info-wrap  { padding:0 14px 60px; gap:20px; }
  .gtitle { font-size:clamp(1.6rem,6vw,2.4rem); }
  .icard  { padding:18px 16px; }
  .go-stats { grid-template-columns:1fr 1fr 1fr; }
}

/* Mobile */
@media(max-width:520px){
  /* ── HEADER ── */
  :root {
    --row1-h: 48px;
    --row2-h: 40px;
    --header-h: 88px;
  }
  .tab  {
    padding:0 12px;
    font-size:0.65rem;
    min-width:80px;
    white-space:nowrap;
  }
  .tab .ticon { font-size:0.85rem; }

  /* Duration buttons smaller */
  .tbtn { padding:4px 10px; font-size:0.55rem; }
  .mbtn { padding:4px 10px; font-size:0.55rem; }
  .row2 { padding:0 10px; gap:4px; }
  .row2-label { font-size:0.45rem; padding-right:4px; }

  /* ── GAME AREAS ── */
  .game-zone { padding:12px 10px 0; gap:10px; }

  .click-arena {
    height: clamp(200px, 38vh, 340px);
    max-width: 100%;
  }
  .reaction-arena {
    height: clamp(240px, 38vh, 380px);
    max-width: 100%;
  }
  .stim-arena {
    height: clamp(260px, 44vh, 400px);
  }
  .big-cps { font-size:clamp(4rem,20vw,8rem); }
  .arena-icon { font-size:2.5rem; }
  .arena-text { font-size:clamp(1.8rem,7vw,3rem); }

  /* Stats bar: 2 cols on phone */
  .stats-bar { grid-template-columns:1fr 1fr; gap:8px; }
  .scard { padding:10px 8px; }
  .sval  { font-size:clamp(1.4rem,6vw,1.9rem); }
  .slbl  { font-size:0.42rem; }

  /* Title row */
  .gtitle-row { gap:8px; }
  .gtitle { font-size:clamp(1.5rem,7vw,2.2rem); }
  .gsub   { font-size:0.5rem; letter-spacing:0.12em; }

  /* Space key smaller on phone */
  .space-key { height:56px; font-size:0.58rem; }

  /* Reaction gameover */
  .go-stats { grid-template-columns:1fr 1fr 1fr; gap:8px; }
  .go-sval  { font-size:1.2rem; }
  .go-slbl  { font-size:0.42rem; }

  /* Result overlay score */
  .r-score { font-size:clamp(3.5rem,18vw,7rem); }
  .r-rank  { font-size:1.1rem; }

  /* Stim idle */
  .stim-idle-title { font-size:clamp(1.5rem,6vw,2.5rem); }
  .diff-btn { padding:7px 16px; font-size:0.58rem; }

  /* Info section */
  .info-wrap { padding:0 10px 50px; gap:16px; }
  .icard     { padding:14px 12px; }
  .icard-title { font-size:clamp(0.95rem,4vw,1.2rem); }
  .ibody     { font-size:0.63rem; line-height:1.75; }

  /* Tables scroll */
  .rtable, .ctable { font-size:0.55rem; }
  .rtable th, .rtable td { padding:8px 6px; }

  /* Factors grid: 1 col */
  .fgrid { grid-template-columns:1fr; }

  /* Records grid: 2 col */
  .rgrid { grid-template-columns:1fr 1fr; }

  /* Tips */
  .tip { font-size:0.52rem; padding:5px 10px; }

  /* FAQ */
  .faq-q { font-size:0.56rem; padding:12px 12px; }
  .faq-a { font-size:0.58rem; }

  /* Footer */
  .sfooter { font-size:0.48rem; padding:20px 0 10px; }
}

/* Very small phones */
@media(max-width:360px){
  .tab  { padding:0 8px; font-size:0.5rem; min-width:65px; }
  .click-arena, .reaction-arena { height:clamp(170px,35vh,280px); }
  .stim-arena { height:clamp(220px,42vh,340px); }
}

/* ══════════════════════════════════════════
   CLICKER TYCOON STYLES  v5
══════════════════════════════════════════ */

/* Panel override — needs more width */
.ct-panel { max-width:1100px !important; width:100% !important; align-self:center; align-items:center !important; margin:0 auto; }

/* Title row */
.ct-titlerow {
  display:flex; align-items:flex-start; justify-content:space-between;
  width:100%; gap:12px; flex-wrap:wrap;
}
.ct-gtitle {
  background:linear-gradient(135deg,#ffe000,#ff6b00) !important;
  -webkit-background-clip:text !important;
  -webkit-text-fill-color:transparent !important;
  background-clip:text !important;
}

/* Sound toggle button */
.ct-sound-btn {
  padding:7px 14px; border-radius:10px; border:1px solid #2a2a4a;
  background:#0d0d1a; color:#8080b0; font-size:0.72rem; font-weight:700;
  letter-spacing:0.08em; cursor:pointer; white-space:nowrap;
  transition:all 0.2s; flex-shrink:0; margin-top:4px;
}
.ct-sound-btn:hover { border-color:#4a4a8a; color:#c0c0e0; }
.ct-sound-btn.on  { border-color:#00f5a040; color:#00f5a0; }
.ct-sound-btn.off { border-color:#ff4a4a30; color:#ff7070; }

/* Stats */
.ct-stats {
  display:flex; flex-wrap:wrap; gap:8px; width:100%;
}
.ct-stat {
  flex:1; min-width:100px;
  background:#0a0a18; border:1px solid #181828;
  border-radius:12px; padding:10px 14px; text-align:center;
}
.ct-stat-lbl {
  font-size:0.58rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#505080; margin-bottom:4px;
}
.ct-stat-val {
  font-family:'Bebas Neue',sans-serif;
  font-size:1.55rem; letter-spacing:0.05em; color:#fff; line-height:1;
}
.ct-gold   { color:#ffd600; }
.ct-green  { color:#00f5a0; }
.ct-purple { color:#a78bfa; }

/* 3-column main layout */
.ct-main {
  display:grid;
  grid-template-columns:220px 1fr 260px;
  gap:14px; width:100%;
  align-items:start;
}

.ct-col { display:flex; flex-direction:column; gap:10px; }

/* ── LEFT COL ── */
.ct-coin-wrap {
  position:relative; align-self:center;
  width:min(190px,100%); height:min(190px,42vw);
}
#ctParticleCanvas {
  position:absolute; inset:0; width:100%; height:100%;
  pointer-events:none; border-radius:50%;
}
.ct-coin {
  position:relative; z-index:1;
  width:100%; height:100%;
  border-radius:50%; cursor:pointer;
  border:none; background:none; padding:0; display:block;
  filter:drop-shadow(0 0 22px rgba(255,210,0,0.55));
  transition:transform 0.08s, filter 0.08s;
  -webkit-tap-highlight-color:transparent;
  user-select:none; -webkit-user-select:none;
}
.ct-coin:hover { filter:drop-shadow(0 0 36px rgba(255,210,0,0.9)); }
.ct-coin.pressed {
  transform:scale(0.88);
  filter:drop-shadow(0 0 10px rgba(255,210,0,0.25));
}
.ct-coin svg { width:100%; height:100%; display:block; }

#ctFloatLayer { position:absolute; inset:0; pointer-events:none; overflow:visible; z-index:10; }
.ct-float {
  position:absolute; left:50%; top:20%;
  font-family:'Bebas Neue',sans-serif;
  font-size:1.4rem; font-weight:700; letter-spacing:0.06em;
  color:#ffd600; pointer-events:none;
  text-shadow:0 2px 12px rgba(255,200,0,0.9);
  animation:ctFloatUp 0.95s ease-out forwards;
  white-space:nowrap; z-index:20;
}
@keyframes ctFloatUp {
  0%   { opacity:1; transform:translateX(-50%) translateY(0) scale(1.1); }
  55%  { opacity:1; transform:translateX(-50%) translateY(-55px) scale(1.18); }
  100% { opacity:0; transform:translateX(-50%) translateY(-95px) scale(0.7); }
}

.ct-click-info {
  display:flex; justify-content:space-between;
  font-size:0.74rem; color:#7070a0; font-weight:600;
}
.ct-click-info b { color:#ddd; }

.ct-progress-wrap { display:flex; flex-direction:column; gap:5px; }
.ct-progress-label { display:flex; justify-content:space-between; font-size:0.64rem; font-weight:600; }
.ct-progress-bg {
  height:7px; background:#0a0a18;
  border:1px solid #181828; border-radius:100px; overflow:hidden;
}
.ct-progress-fill {
  height:100%; border-radius:100px;
  background:linear-gradient(90deg,#7b61ff,#c4b5fd);
  transition:width 0.35s ease;
  box-shadow:0 0 6px rgba(123,97,255,0.7);
}

.ct-prestige-btn {
  width:100%; padding:11px; border-radius:12px;
  border:1.5px solid #7b61ff;
  background:linear-gradient(135deg,rgba(123,97,255,0.18),rgba(167,139,250,0.08));
  color:#c4b5fd; font-size:0.8rem; font-weight:700;
  letter-spacing:0.05em; cursor:pointer; transition:all 0.2s;
  text-transform:uppercase; outline:none;
  animation:ctPrestigePulse 1.8s ease-in-out infinite;
}
.ct-prestige-btn:hover {
  background:rgba(123,97,255,0.3);
  box-shadow:0 0 22px rgba(123,97,255,0.6);
}
@keyframes ctPrestigePulse {
  0%,100% { box-shadow:0 0 6px rgba(123,97,255,0.3); }
  50%      { box-shadow:0 0 18px rgba(123,97,255,0.7),0 0 40px rgba(123,97,255,0.2); }
}

.ct-auto-box {
  background:#0a0a18; border:1px solid #181828;
  border-radius:12px; padding:12px 14px;
}
.ct-auto-title {
  font-size:0.58rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#404060; margin-bottom:8px;
}
.ct-auto-list { display:flex; flex-direction:column; gap:5px; }
.ct-auto-row {
  display:flex; justify-content:space-between; align-items:center;
  font-size:0.76rem; color:#9090b8;
}
.ct-auto-row b { color:#00f5a0; font-weight:700; font-size:0.8rem; }

/* ── MID COL — World Canvas ── */
.ct-col-mid { align-self:stretch; }
.ct-world-label {
  font-size:0.58rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#404060; text-align:center;
  margin-bottom:4px;
}
.ct-world-canvas {
  width:100%; flex:1;
  border-radius:16px;
  border:1px solid #181828;
  background:#06060f;
  display:block;
  min-height:360px;
}

/* ── RIGHT COL — Shop ── */
.ct-shop-header {
  font-size:0.65rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#505080; padding:2px 0;
}
.ct-shop-list {
  display:flex; flex-direction:column; gap:6px;
  overflow-y:auto; max-height:520px;
  scrollbar-width:thin; scrollbar-color:#181828 transparent;
}
.ct-upg {
  display:flex; align-items:center; gap:10px;
  background:#0a0a18; border:1.5px solid #181828;
  border-radius:12px; padding:10px 12px;
  cursor:pointer; text-align:left; width:100%;
  transition:border-color 0.15s, background 0.15s, transform 0.08s;
  position:relative; overflow:hidden; outline:none;
}
.ct-upg.can-afford {
  border-color:rgba(255,214,0,0.3);
  background:rgba(255,214,0,0.035);
}
.ct-upg.can-afford:hover {
  border-color:rgba(255,214,0,0.65);
  background:rgba(255,214,0,0.07);
  transform:translateX(3px);
}
.ct-upg:active { transform:scale(0.97) !important; }
.ct-upg.can-afford::after {
  content:''; position:absolute; top:0; left:-100%; width:55%; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,214,0,0.05),transparent);
  animation:ctShimmer 3s ease-in-out infinite;
}
@keyframes ctShimmer { 0%{left:-100%} 60%,100%{left:160%} }

.ct-upg-icon {
  width:40px; height:40px; flex-shrink:0;
  background:#0d0d20; border:1px solid #222240;
  border-radius:10px; display:flex; align-items:center;
  justify-content:center; font-size:1.4rem;
}
.ct-upg-body { flex:1; min-width:0; }
.ct-upg-cost { text-align:right; flex-shrink:0; min-width:56px; }

/* Milestones */
.ct-milestones-wrap {
  width:100%;
  background:#0a0a18; border:1px solid #181828;
  border-radius:14px; padding:14px 16px;
}
.ct-milestones-title {
  font-size:0.62rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#404060; margin-bottom:10px;
}
.ct-milestones-grid { display:flex; flex-wrap:wrap; gap:6px; }
.ct-badge {
  display:inline-flex; align-items:center; gap:5px;
  padding:6px 12px; border-radius:100px; font-size:0.72rem; font-weight:700;
  border:1px solid #181828; color:#303050; transition:all 0.3s;
}
.ct-badge.earned {
  border-color:#ffd60035;
  background:rgba(255,214,0,0.07);
  color:#ffe066;
  box-shadow:0 0 8px rgba(255,214,0,0.18);
}
@keyframes ctPop {
  0%{transform:scale(0.4);opacity:0} 70%{transform:scale(1.2);opacity:1} 100%{transform:scale(1)}
}
.ct-pop { animation:ctPop 0.4s ease-out forwards; }

/* Responsive */
@media(max-width:800px){
  .ct-main { grid-template-columns:1fr 1fr; }
  .ct-col-mid { grid-column:1/-1; order:-1; }
  .ct-world-canvas { min-height:240px; }
}
@media(max-width:520px){
  .ct-main { grid-template-columns:1fr; }
  .ct-coin-wrap { width:min(160px,55vw); height:min(160px,55vw); }
  .ct-stat-val { font-size:1.2rem; }
}
.ct-stats {
  display:flex; flex-wrap:wrap; gap:8px;
  width:100%; max-width:760px; align-self:center;
}
.ct-stat {
  flex:1; min-width:110px;
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:12px; padding:10px 14px;
  text-align:center;
}
.ct-stat-lbl {
  font-size:0.6rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#606090; margin-bottom:4px;
}
.ct-stat-val {
  font-family:'Bebas Neue',sans-serif;
  font-size:1.5rem; letter-spacing:0.06em; color:#fff;
  line-height:1;
}
.ct-gold   { color:#ffd600; }
.ct-green  { color:#00f5a0; }
.ct-purple { color:#a78bfa; }

.ct-layout {
  display:grid; grid-template-columns:1fr 1.15fr;
  gap:14px; width:100%; max-width:760px; align-self:center;
}

/* LEFT */
.ct-left { display:flex; flex-direction:column; gap:10px; }

.ct-coin-wrap {
  position:relative; align-self:center;
  width:min(200px, 55vw); height:min(200px, 55vw);
}
#ctParticleCanvas {
  position:absolute; inset:0;
  width:100%; height:100%;
  pointer-events:none; border-radius:50%;
}
.ct-coin {
  position:relative; z-index:1;
  width:100%; height:100%;
  border-radius:50%; cursor:pointer;
  border:none; background:none; padding:0;
  display:block;
  filter:drop-shadow(0 0 20px rgba(255,210,0,0.5));
  transition:transform 0.08s, filter 0.08s;
  -webkit-tap-highlight-color:transparent;
  user-select:none; -webkit-user-select:none;
}
.ct-coin:hover {
  filter:drop-shadow(0 0 32px rgba(255,210,0,0.8));
}
.ct-coin.pressed {
  transform:scale(0.91);
  filter:drop-shadow(0 0 12px rgba(255,210,0,0.3));
}
.ct-coin svg { width:100%; height:100%; display:block; }

#ctFloatLayer { position:absolute; inset:0; pointer-events:none; overflow:visible; }
.ct-float {
  position:absolute; left:50%; top:30%;
  font-family:'Bebas Neue',sans-serif;
  font-size:1.3rem; font-weight:700; letter-spacing:0.08em;
  color:#ffd600; pointer-events:none;
  text-shadow:0 0 8px rgba(255,210,0,0.8);
  animation:ctFloatUp 0.9s ease-out forwards;
  transform:translateX(-50%);
  white-space:nowrap;
}
@keyframes ctFloatUp {
  0%   { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
  60%  { opacity:1; transform:translateX(-50%) translateY(-52px) scale(1.15); }
  100% { opacity:0; transform:translateX(-50%) translateY(-90px) scale(0.8); }
}

.ct-click-info {
  display:flex; justify-content:space-between;
  font-size:0.72rem; color:#888; padding:0 2px;
}
.ct-click-info b { font-weight:700; }

.ct-progress-wrap { display:flex; flex-direction:column; gap:5px; }
.ct-progress-label {
  display:flex; justify-content:space-between;
  font-size:0.65rem; color:#666; font-weight:600;
}
.ct-progress-bg {
  height:8px; background:#111122;
  border:1px solid #1c1c30; border-radius:100px; overflow:hidden;
}
.ct-progress-fill {
  height:100%; border-radius:100px;
  background:linear-gradient(90deg, #7b61ff, #a78bfa);
  transition:width 0.3s ease;
  box-shadow:0 0 8px rgba(123,97,255,0.6);
}

.ct-prestige-btn {
  width:100%; padding:12px; border-radius:12px;
  border:1.5px solid #7b61ff;
  background:linear-gradient(135deg,rgba(123,97,255,0.15),rgba(167,139,250,0.1));
  color:#c4b5fd; font-size:0.8rem; font-weight:700;
  letter-spacing:0.06em; cursor:pointer;
  transition:all 0.2s; text-transform:uppercase;
  animation:ctPrestigePulse 2s ease-in-out infinite;
  outline:none;
}
.ct-prestige-btn:hover {
  background:rgba(123,97,255,0.3);
  box-shadow:0 0 20px rgba(123,97,255,0.5);
}
@keyframes ctPrestigePulse {
  0%,100% { box-shadow:0 0 8px rgba(123,97,255,0.3); }
  50%      { box-shadow:0 0 20px rgba(123,97,255,0.7); }
}

.ct-auto-box {
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:12px; padding:12px 14px;
  flex:1;
}
.ct-auto-title {
  font-size:0.62rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#505080; margin-bottom:8px;
}
.ct-auto-list {
  display:flex; flex-direction:column; gap:5px;
  font-size:0.76rem; color:#9090b8;
}
.ct-auto-row {
  display:flex; justify-content:space-between; align-items:center;
}
.ct-auto-row b { color:#00f5a0; font-weight:700; }

/* RIGHT — shop */
.ct-right { display:flex; flex-direction:column; gap:8px; }
.ct-shop-header {
  font-size:0.65rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#505080; padding:2px 0;
}
.ct-shop-list {
  display:flex; flex-direction:column; gap:6px;
  overflow-y:auto; max-height:500px;
  scrollbar-width:thin; scrollbar-color:#1c1c30 transparent;
}

/* Individual upgrade card */
.ct-upg {
  display:flex; align-items:center; gap:10px;
  background:#0d0d1a; border:1.5px solid #1c1c30;
  border-radius:12px; padding:10px 12px;
  cursor:pointer; text-align:left; width:100%;
  transition:border-color 0.15s, background 0.15s, transform 0.08s;
  position:relative; overflow:hidden;
  outline:none;
}
.ct-upg:focus { outline:none; }
.ct-upg.can-afford {
  border-color:rgba(255,214,0,0.35);
  background:rgba(255,214,0,0.04);
}
.ct-upg.can-afford:hover {
  border-color:rgba(255,214,0,0.7);
  background:rgba(255,214,0,0.08);
  transform:translateX(2px);
}
.ct-upg:active { transform:scale(0.97); }
.ct-upg.locked { opacity:0.35; cursor:not-allowed; }

.ct-upg-icon {
  width:38px; height:38px; flex-shrink:0;
  background:#111130; border:1px solid #252545;
  border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.3rem;
}
.ct-upg-body { flex:1; min-width:0; }
.ct-upg-name {
  font-size:0.82rem; font-weight:700; color:#e0e0f8;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  margin-bottom:2px;
}
.ct-upg-desc { font-size:0.62rem; color:#555580; line-height:1.3; }
.ct-upg-owned {
  font-size:0.65rem; color:#00f5a0; font-weight:700;
  margin-top:2px;
}
.ct-upg-cost {
  text-align:right; flex-shrink:0; min-width:52px;
}
.ct-upg-cost-val {
  font-family:'Bebas Neue',sans-serif;
  font-size:1rem; letter-spacing:0.06em;
  color:#ffd600;
}
.ct-upg-cost-val.cant { color:#404060; }
.ct-upg-cps {
  font-size:0.58rem; color:#555580;
}
/* shimmer on affordable upgrades */
.ct-upg.can-afford::after {
  content:'';
  position:absolute; top:0; left:-100%; width:60%; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,214,0,0.06),transparent);
  animation:ctShimmer 2.5s ease-in-out infinite;
}
@keyframes ctShimmer {
  0%   { left:-100%; }
  60%,100% { left:150%; }
}

/* MILESTONES */
.ct-milestones-wrap {
  width:100%; max-width:760px; align-self:center;
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:14px; padding:14px 16px;
}
.ct-milestones-title {
  font-size:0.65rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#505080; margin-bottom:10px;
}
.ct-milestones-grid {
  display:flex; flex-wrap:wrap; gap:6px;
}
.ct-badge {
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 12px; border-radius:100px;
  font-size:0.72rem; font-weight:700;
  border:1px solid #1c1c30; color:#404060;
  transition:all 0.3s;
}
.ct-badge.earned {
  border-color:#ffd60040;
  background:rgba(255,214,0,0.08);
  color:#ffe066;
  box-shadow:0 0 8px rgba(255,214,0,0.2);
}
.ct-badge .ct-badge-icon { font-size:0.9rem; }

/* NEW UNLOCK POP */
@keyframes ctUnlockPop {
  0%  { transform:scale(0.5); opacity:0; }
  70% { transform:scale(1.15); opacity:1; }
  100%{ transform:scale(1); opacity:1; }
}
.ct-badge.just-earned { animation:ctUnlockPop 0.4s ease-out forwards; }

/* RESPONSIVE */
@media(max-width:600px){
  .ct-layout { grid-template-columns:1fr; }
  .ct-coin-wrap { width:min(170px,50vw); height:min(170px,50vw); }
  .ct-shop-list { max-height:280px; }
  .ct-stat-val { font-size:1.2rem; }
}
</style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════
     FIXED HEADER
═══════════════════════════════════════════════════ -->
<div class="header">

  <!-- ROW 1: tabs + controls -->
  <div class="row1">
    <a class="home-btn" href="/" aria-label="Back to homepage">⚡ Home</a>

    <!-- Left scroll arrow -->
    <button id="tabScrollLeft" onclick="scrollTabs(-1)" aria-label="Scroll left" style="
      flex-shrink:0; border:none; cursor:pointer;
      color:#ffffff; font-size:1.2rem; padding:0 10px; height:100%;
      display:flex; align-items:center; z-index:2;
      background:linear-gradient(to right, rgba(6,6,14,0.95) 60%, transparent);
      transition:color 0.15s;
    ">‹</button>

    <div class="tabs" id="tabsContainer" role="tablist">
      <button class="tab active" data-panel="reaction" onclick="switchPanel('reaction')" role="tab">
        <span class="ticon">⚡</span> Reaction
      </button>
      <button class="tab" data-panel="stimulation" onclick="switchPanel('stimulation')" role="tab">
        <span class="ticon">🎯</span> Stimulation
      </button>
      <button class="tab" data-panel="clicker" onclick="switchPanel('clicker')" role="tab">
        <span class="ticon">💰</span> Clicker
      </button>
      <button class="tab" data-panel="cps" onclick="switchPanel('cps')" role="tab">
        <span class="ticon">🔥</span> Click Speed
      </button>
      <button class="tab" data-panel="jitter" onclick="switchPanel('jitter')" role="tab">
        <span class="ticon">🖱</span> Jitter Click
      </button>
      <button class="tab" data-panel="spacebar" onclick="switchPanel('spacebar')" role="tab">
        <span class="ticon">⌨️</span> Spacebar
      </button>
      <button class="tab" data-panel="dino" onclick="switchPanel('dino')" role="tab">
        <span class="ticon">🦕</span> Dino Game
      </button>
      <button class="tab" data-panel="typing" onclick="switchPanel('typing')" role="tab">
        <span class="ticon">📝</span> Typing Test
      </button>
      <button class="tab" data-panel="coreball" onclick="switchPanel('coreball')" role="tab">
        <span class="ticon">🎮</span> Coreball
      </button>
      <button class="tab" data-panel="memory" onclick="switchPanel('memory')" role="tab">
        <span class="ticon">🧠</span> Memory
      </button>
      <button class="tab" data-panel="snake" onclick="switchPanel('snake')" role="tab">
        <span class="ticon">🐍</span> Snake
      </button>
    </div>

    <!-- Right scroll arrow -->
    <button id="tabScrollRight" onclick="scrollTabs(1)" aria-label="Scroll right" style="
      flex-shrink:0; border:none; cursor:pointer;
      color:#ffffff; font-size:1.2rem; padding:0 10px; height:100%;
      display:flex; align-items:center; z-index:2;
      background:linear-gradient(to left, rgba(6,6,14,0.95) 60%, transparent);
      transition:color 0.15s;
    ">›</button>

    <div class="lang" style="border-left:1px solid var(--border2); padding:0 10px; gap:4px; flex-shrink:0;">
      <button class="lbtn" id="soundToggle" onclick="toggleSound()" title="Toggle Sound" style="font-size:0.8rem;padding:4px 8px;">🔊</button>
      <button class="lbtn" id="statsBtn" onclick="showStatsModal()" title="My Stats" style="font-size:0.6rem;padding:4px 8px;letter-spacing:0.04em;">📊</button>
    </div>
  </div>

  <!-- ROW 2: time selector + challenge mode (hidden for reaction & stimulation) -->
  <div class="row2" id="row2">
    <span class="row2-label">Duration</span>

    <button class="tbtn" data-s="1"   onclick="setDuration(1)">1s</button>
    <button class="tbtn" data-s="2"   onclick="setDuration(2)">2s</button>
    <button class="tbtn active" data-s="5"   onclick="setDuration(5)">5s</button>
    <button class="tbtn" data-s="10"  onclick="setDuration(10)">10s</button>
    <button class="tbtn" data-s="15"  onclick="setDuration(15)">15s</button>
    <button class="tbtn" data-s="30"  onclick="setDuration(30)">30s</button>
    <button class="tbtn" data-s="60"  onclick="setDuration(60)">60s</button>
    <button class="tbtn" data-s="100" onclick="setDuration(100)">100s</button>

    <div class="row2-sep"></div>
    <span class="row2-label">Mode</span>
    <button class="mbtn active" id="modeNormal" onclick="setClickMode('normal')">🖱 Normal</button>
    <button class="mbtn"        id="modeChallenge" onclick="setClickMode('challenge')">⚡ Challenge</button>
  </div>

</div>

<!-- ═══════════════════════════════════════════════════
     MAIN
═══════════════════════════════════════════════════ -->
<div class="wrap">

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: CLICK SPEED (shared with jitter & kohi)
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-cps" class="game-zone">

    <div class="gtitle-row">
      <h1 class="gtitle" id="cpsH1">Click Speed Test</h1>
      <span class="gsub" id="cpsSub">5 seconds — click as fast as you can</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">CPS</div><div class="sval" id="cStat">0</div></div>
      <div class="scard"><div class="slbl">Clicks</div><div class="sval muted" id="cClicks">0</div></div>
      <div class="scard hi2"><div class="slbl">Best CPS</div><div class="sval yellow" id="cBest">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="cTime">5.0</div></div>
    </div>

    <div class="click-arena idle" id="clickArena" tabindex="0" role="button" aria-label="Click area to start">

      <div class="combo-badge" id="comboBadge">COMBO: 0</div>
      <div class="big-cps" id="bigCPS">0</div>
      <div class="arena-label" id="cLabel">Click Here to Start</div>
      <div class="prog" id="cProg" style="display:none">
        <div class="prog-fill" id="cProgFill" style="width:100%"></div>
      </div>

      <!-- Result overlay -->
      <div class="result-overlay" id="cResult">
        <div class="r-label">Your Score</div>
        <div class="r-score" id="rScore">0</div>
        <div class="r-unit">Clicks Per Second</div>
        <div class="r-rank" id="rRank"></div>
        <div id="cNewRecord" style="display:none;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.18em;color:var(--yellow);background:rgba(255,224,0,0.12);border:1px solid rgba(255,224,0,0.4);border-radius:20px;padding:4px 18px;">🏆 NEW RECORD!</div>
        <button class="r-retry" onclick="resetCPS()">↺ Try Again</button>
      </div>

    </div>

    <!-- Challenge mode tip -->
    <div id="challengeTip" style="display:none; font-size:0.6rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--red); text-align:center; padding:4px 0">
      ⚡ CHALLENGE MODE — targets appear, click them!
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: SPACEBAR
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-spacebar" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,var(--purple),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Spacebar Speed Test</h1>
      <span class="gsub" id="sSub">5 seconds — press spacebar as fast as you can</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Press/sec</div><div class="sval" id="sCPS">0</div></div>
      <div class="scard"><div class="slbl">Total Presses</div><div class="sval muted" id="sClicks">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="sBest">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="sTime">5.0</div></div>
    </div>

    <div class="space-key" id="spaceKey" tabindex="0" role="button">SPACEBAR</div>

    <div class="click-arena idle" id="spaceArena" tabindex="0" role="button" style="min-height:260px">
      <div class="big-cps" id="sBig" style="color:var(--purple)">0</div>
      <div class="arena-label" id="sLabel">Press Space Key or Tap Above to Start</div>
      <div class="prog" id="sProg" style="display:none">
        <div class="prog-fill" id="sProgFill" style="width:100%;background:var(--purple)"></div>
      </div>
      <div class="result-overlay" id="sResult">
        <div class="r-label">Your Score</div>
        <div class="r-score" id="srScore" style="color:var(--purple)">0</div>
        <div class="r-unit">Presses Per Second</div>
        <button class="r-retry" style="background:var(--purple);color:#fff" onclick="resetSpace()">↺ Try Again</button>
      </div>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: REACTION
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-reaction" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle">Reaction Speed Test</h1>
      <span class="gsub">5 rounds — tap when the arena turns green</span>
    </div>

    <div class="stats-bar">
      <div class="scard"><div class="slbl" id="lScore">Score</div><div class="sval" id="rDisp">0</div></div>
      <div class="scard hi1"><div class="slbl" id="lBest">Best</div><div class="sval" id="rBest">---</div></div>
      <div class="scard"><div class="slbl" id="lAvg">Average</div><div class="sval yellow" id="rAvg">---</div></div>
      <div class="scard hi3"><div class="slbl" id="lRound">Round</div><div class="sval purple" id="rRound">0/5</div></div>
    </div>

    <div class="reaction-arena s-wait" id="reactArena">
      <div class="arena-icon" id="rIcon">⚡</div>
      <div class="arena-text" id="rText">Tap to Start</div>
      <div class="arena-sub"  id="rSub">Test your reaction speed</div>
    </div>

    <div>
      <div class="slbl" style="margin-bottom:8px" id="lDots">Round Progress</div>
      <div class="dots-row" id="rdots">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div class="dot"></div><div class="dot"></div>
      </div>
    </div>

    <div class="hist-row" id="hist"></div>

    <div class="gameover" id="gover">
      <div class="go-title" id="goTitle">🏆 GAME OVER</div>
      <div class="go-stats">
        <div class="go-stat"><div class="go-slbl" id="goLB">Fastest</div><div class="go-sval" id="goBest">---</div></div>
        <div class="go-stat"><div class="go-slbl" id="goLA">Average</div><div class="go-sval" id="goAvg">---</div></div>
        <div class="go-stat"><div class="go-slbl" id="goLS">Score</div><div class="go-sval" id="goScore">0</div></div>
      </div>
      <button class="replay-btn" id="replayBtn">↺ Play Again</button>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: STIMULATION CLICKER
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-stimulation" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle red">Stimulation Clicker</h1>
      <span class="gsub">Click the targets before they disappear</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi4"><div class="slbl">Score</div><div class="sval red" id="stScore">0</div></div>
      <div class="scard"><div class="slbl">Targets Hit</div><div class="sval" id="stHits">0</div></div>
      <div class="scard hi2"><div class="slbl">Accuracy</div><div class="sval yellow" id="stAcc">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="stTime">30.0</div></div>
    </div>

    <div class="stim-arena" id="stimArena">

      <!-- Idle / config screen -->
      <div class="stim-idle" id="stimIdle">
        <div style="font-size:3rem">🎯</div>
        <div class="stim-idle-title">Stimulation Clicker</div>
        <div class="stim-idle-sub">Choose difficulty and start</div>
        <div class="diff-row">
          <button class="diff-btn easy"   id="dbEasy"   onclick="setStimDiff('easy')">🟢 EASY</button>
          <button class="diff-btn medium selected" id="dbMedium" onclick="setStimDiff('medium')">🟡 MEDIUM</button>
          <button class="diff-btn hard"   id="dbHard"   onclick="setStimDiff('hard')">🔴 HARD</button>
        </div>
        <button class="stim-start-btn" onclick="startStim()">▶ START</button>
      </div>

      <!-- Result overlay -->
      <div class="stim-result" id="stimResult">
        <div class="r-label" style="color:var(--muted)">Final Score</div>
        <div class="stim-r-score" id="stFinalScore"></div>
        <div class="r-label" style="color:var(--muted)">Accuracy: <span id="stFinalAcc"></span></div>
        <div class="stim-r-rank" id="stFinalRank"></div>
        <button class="stim-replay" onclick="resetStim()">↺ Play Again</button>
      </div>

    </div>

    <!-- Difficulty guide -->
    <div class="icard" style="padding:16px 18px">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🟢</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">EASY</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">80px targets · 1.2s lifetime · Perfect for beginners</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🟡</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--yellow);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">MEDIUM</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">55px targets · 0.8s lifetime · Standard challenge</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🔴</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--red);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">HARD</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">38px targets · 0.5s lifetime · Elite aim required</div>
        </div>
      </div>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: TYPING TEST
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-typing" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#00b4d8,#00f5a0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Typing Speed Test</h1>
      <span class="gsub">Type the words as fast as you can — WPM &amp; accuracy</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">WPM</div><div class="sval" id="tWpm" style="color:#00b4d8">0</div></div>
      <div class="scard"><div class="slbl">Accuracy</div><div class="sval muted" id="tAcc">—</div></div>
      <div class="scard hi2"><div class="slbl">Correct</div><div class="sval yellow" id="tCorrect">0</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="tTime">60</div></div>
    </div>

    <!-- Word display -->
    <div id="typingBox" style="
      width:100%;max-width:680px;align-self:center;
      background:#090914;border:2px solid var(--border);border-radius:20px;
      padding:28px 24px;display:flex;flex-direction:column;gap:16px;position:relative;
    ">
      <div id="tWords" style="
        font-family:'JetBrains Mono',monospace;font-size:clamp(0.9rem,2.5vw,1.1rem);
        line-height:2.2;letter-spacing:0.03em;
        display:flex;flex-wrap:wrap;gap:6px;
        max-height:120px;overflow:hidden;
        pointer-events:none;user-select:none;
      "></div>
      <input id="tInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
        placeholder="Click here and start typing..."
        style="
          width:100%;background:var(--surf2);border:1.5px solid var(--border2);
          border-radius:10px;padding:12px 16px;
          font-family:'JetBrains Mono',monospace;font-size:0.85rem;
          color:var(--text);outline:none;transition:border-color 0.2s;
        "
      >
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px">
        <div style="display:flex;gap:8px">
          <button onclick="setTypingDuration(30)" id="td30" class="tbtn" style="font-size:0.6rem">30s</button>
          <button onclick="setTypingDuration(60)" id="td60" class="tbtn active" style="font-size:0.6rem">60s</button>
          <button onclick="setTypingDuration(120)" id="td120" class="tbtn" style="font-size:0.6rem">120s</button>
        </div>
        <button onclick="resetTyping()" style="
          padding:8px 20px;background:var(--surf);border:1px solid var(--border2);
          border-radius:8px;color:var(--muted);cursor:pointer;
          font-family:'JetBrains Mono',monospace;font-size:0.6rem;font-weight:700;
          transition:all 0.15s;
        ">↺ Restart</button>
      </div>
      <!-- Result overlay -->
      <div id="tResult" style="
        display:none;position:absolute;inset:0;z-index:10;border-radius:18px;
        background:rgba(6,6,14,0.93);flex-direction:column;
        align-items:center;justify-content:center;gap:10px;text-align:center;padding:20px;
      ">
        <div style="font-size:0.58rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--muted)">Your Speed</div>
        <div id="tFinalWpm" style="font-family:'Bebas Neue',sans-serif;font-size:clamp(4rem,15vw,8rem);line-height:1;color:#00b4d8"></div>
        <div style="font-size:0.58rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">Words Per Minute</div>
        <div id="tFinalAcc" style="font-size:0.7rem;color:var(--accent);letter-spacing:0.1em"></div>
        <button onclick="resetTyping()" style="
          margin-top:8px;padding:12px 36px;background:#00b4d8;color:#000;
          border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;
          font-size:1.1rem;letter-spacing:0.15em;cursor:pointer;transition:all 0.2s;
        ">↺ Try Again</button>
      </div>
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: COREBALL
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-coreball" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#ff6b00,#ffe000);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Coreball Game</h1>
      <span class="gsub">Shoot balls into the spinning core — don't hit existing balls</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi4"><div class="slbl">Score</div><div class="sval red" id="cbScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="cbBest">0</div></div>
      <div class="scard"><div class="slbl">Level</div><div class="sval muted" id="cbLevel">1</div></div>
      <div class="scard hi3"><div class="slbl">Balls Left</div><div class="sval purple" id="cbBalls">10</div></div>
    </div>

    <div style="width:100%;max-width:480px;align-self:center;display:flex;flex-direction:column;gap:12px">
      <canvas id="coreCanvas" width="480" height="480" style="
        width:100%;border-radius:20px;
        background:#06060e;border:2px solid var(--border);
        cursor:pointer;touch-action:none;display:block;
      "></canvas>
      <div id="cbMsg" style="text-align:center;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.15em;color:var(--muted)">
        TAP TO SHOOT
      </div>
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: NUMBER MEMORY
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-memory" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#7b61ff,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Number Memory</h1>
      <span class="gsub">Memorize the number — how many digits can you remember?</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi3"><div class="slbl">Level</div><div class="sval purple" id="memLevel">1</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="memBest">—</div></div>
      <div class="scard"><div class="slbl">Digits</div><div class="sval muted" id="memDigits">1</div></div>
      <div class="scard hi1"><div class="slbl">Lives</div><div class="sval" id="memLives">❤️❤️❤️</div></div>
    </div>

    <div style="width:100%;max-width:520px;align-self:center;display:flex;flex-direction:column;gap:16px;align-items:center">

      <!-- Number display box -->
      <div id="memDisplay" style="
        width:100%;min-height:140px;
        background:#090914;border:2px solid var(--border);border-radius:20px;
        display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;
        padding:24px;position:relative;overflow:hidden;
      ">
        <div id="memNumber" style="
          font-family:'Bebas Neue',sans-serif;
          font-size:clamp(2.5rem,10vw,5rem);
          letter-spacing:0.18em;color:#ffffff;
          transition:opacity 0.3s;text-align:center;word-break:break-all;
        "></div>
        <div id="memMsg" style="font-size:0.75rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">PRESS START</div>
        <!-- Progress bar for memorize time -->
        <div id="memBar" style="position:absolute;bottom:0;left:0;height:4px;background:var(--purple);width:100%;transition:width linear;"></div>
      </div>

      <!-- Input area -->
      <div id="memInputArea" style="width:100%;display:flex;flex-direction:column;gap:10px;align-items:center;display:none">
        <div style="font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">Type the number you saw</div>
        <input id="memInput" type="number" inputmode="numeric" pattern="[0-9]*"
          style="
            width:100%;background:var(--surf2);border:2px solid var(--purple);
            border-radius:12px;padding:14px 18px;text-align:center;
            font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:0.2em;
            color:#ffffff;outline:none;
          "
          placeholder="?"
        >
        <button id="memSubmit" onclick="memCheck()" style="
          width:100%;padding:14px;background:var(--purple);color:#fff;
          border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;
          font-size:1.2rem;letter-spacing:0.2em;cursor:pointer;transition:opacity 0.2s;
        ">SUBMIT</button>
      </div>

      <!-- Start / next button -->
      <button id="memStartBtn" onclick="memStart()" style="
        padding:14px 48px;background:var(--purple);color:#fff;
        border:none;border-radius:14px;font-family:'Bebas Neue',sans-serif;
        font-size:1.3rem;letter-spacing:0.2em;cursor:pointer;transition:all 0.2s;
      ">START</button>

    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: DINO GAME
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-dino" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#666,#ccc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Dinosaur Game</h1>
      <span class="gsub">Press Space or tap to jump — avoid cacti and pterodactyls</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Score</div><div class="sval" id="dinoScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="dinoBest">0</div></div>
      <div class="scard"><div class="slbl">Speed</div><div class="sval muted" id="dinoSpeed">1x</div></div>
      <div class="scard hi3"><div class="slbl">Status</div><div class="sval purple" id="dinoStatus">Ready</div></div>
    </div>
    <canvas id="dinoCanvas" width="800" height="280" style="
      width:100%;max-width:800px;align-self:center;
      border-radius:16px;background:#111118;border:2px solid var(--border);
      cursor:pointer;display:block;touch-action:none;
    "></canvas>
    <div style="text-align:center;font-size:0.58rem;letter-spacing:0.15em;color:var(--muted);text-transform:uppercase">
      Space / Tap = Jump &nbsp;·&nbsp; ↓ / Swipe Down = Duck
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: SNAKE GAME
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-snake" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#00f5a0,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Snake</h1>
      <span class="gsub">Arrow keys or swipe — eat food, don't hit yourself</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Score</div><div class="sval" id="snakeScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="snakeBest">0</div></div>
      <div class="scard"><div class="slbl">Length</div><div class="sval muted" id="snakeLen">3</div></div>
      <div class="scard hi3"><div class="slbl">Status</div><div class="sval purple" id="snakeStatus">Ready</div></div>
    </div>
    <canvas id="snakeCanvas" width="400" height="400" style="
      width:100%;max-width:420px;align-self:center;
      border-radius:16px;background:#0a0a14;border:2px solid var(--border);
      display:block;touch-action:none;cursor:pointer;
    "></canvas>
    <div style="text-align:center;font-size:0.58rem;letter-spacing:0.15em;color:var(--muted);text-transform:uppercase">
      Arrow Keys / WASD &nbsp;·&nbsp; Tap Canvas to Start &nbsp;·&nbsp; Swipe to Turn
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: CLICKER TYCOON
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-clicker" class="game-zone ct-panel" style="display:none">

    <!-- TITLE ROW with sound toggle -->
    <div class="ct-titlerow">
      <div>
        <h1 class="gtitle ct-gtitle">💰 Clicker Tycoon</h1>
        <span class="gsub">Click to earn · buy upgrades · prestige for ×2</span>
      </div>
      <button id="ctSoundBtn" class="ct-sound-btn" tabindex="-1" title="Toggle click sound">🔊 Sound ON</button>
    </div>

    <!-- STATS BAR -->
    <div class="ct-stats">
      <div class="ct-stat">
        <div class="ct-stat-lbl">💰 COINS</div>
        <div class="ct-stat-val" id="ctCoins">0</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">⚡ PER CLICK</div>
        <div class="ct-stat-val ct-gold" id="ctPerClick">1</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">🏭 PER SEC</div>
        <div class="ct-stat-val ct-green" id="ctPerSec">0</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">⭐ PRESTIGE</div>
        <div class="ct-stat-val ct-purple" id="ctPrestige">×1</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">🏆 TOTAL EARNED</div>
        <div class="ct-stat-val" id="ctTotal">0</div>
      </div>
    </div>

    <!-- 3-COLUMN MAIN LAYOUT -->
    <div class="ct-main">

      <!-- COL 1: Coin click -->
      <div class="ct-col ct-col-left">
        <div class="ct-coin-wrap" id="ctCoinWrap">
          <canvas id="ctParticleCanvas"></canvas>
          <div id="ctCoinBtn" class="ct-coin" tabindex="-1">
            <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <radialGradient id="cg1" cx="38%" cy="35%" r="65%">
                  <stop offset="0%"   stop-color="#fff9c4"/>
                  <stop offset="35%"  stop-color="#ffd600"/>
                  <stop offset="70%"  stop-color="#ff9800"/>
                  <stop offset="100%" stop-color="#bf6000"/>
                </radialGradient>
                <filter id="coinGlow">
                  <feGaussianBlur stdDeviation="3" result="blur"/>
                  <feComposite in="SourceGraphic" in2="blur" operator="over"/>
                </filter>
              </defs>
              <circle cx="60" cy="60" r="57" fill="url(#cg1)" stroke="#b8860b" stroke-width="2.5"/>
              <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,255,180,0.25)" stroke-width="1.5"/>
              <circle cx="60" cy="60" r="42" fill="none" stroke="rgba(255,255,180,0.12)" stroke-width="1"/>
              <text x="60" y="80" text-anchor="middle" font-family="Georgia,serif"
                    font-size="54" font-weight="bold" fill="#7a4000">$</text>
              <ellipse cx="40" cy="36" rx="13" ry="7" fill="rgba(255,255,255,0.28)" transform="rotate(-30 40 36)"/>
            </svg>
          </div>
          <div id="ctFloatLayer" style="position:absolute;inset:0;pointer-events:none;overflow:visible"></div>
        </div>

        <div class="ct-click-info">
          <span>Clicks: <b id="ctClicks">0</b></span>
          <span><b id="ctClicksPerSec" style="color:#ffd600">0</b> CPS</span>
        </div>

        <!-- Prestige progress -->
        <div class="ct-progress-wrap">
          <div class="ct-progress-label">
            <span style="color:#7070a0">Next prestige</span>
            <span id="ctPrestigeGoal" style="color:#555">100K needed</span>
          </div>
          <div class="ct-progress-bg">
            <div id="ctProgressBar" class="ct-progress-fill" style="width:0%"></div>
          </div>
        </div>

        <button id="ctPrestigeBtn" class="ct-prestige-btn" tabindex="-1" style="display:none">
          ⭐ PRESTIGE — Reset &amp; Get ×2 Forever
        </button>

        <!-- Passive list -->
        <div class="ct-auto-box">
          <div class="ct-auto-title">⚙️ Passive Income</div>
          <div id="ctAutoList" class="ct-auto-list">
            <span style="color:#444;font-size:0.78rem">Buy upgrades to earn passively</span>
          </div>
        </div>
      </div>

      <!-- COL 2: Animated world scene -->
      <div class="ct-col ct-col-mid">
        <div class="ct-world-label">YOUR EMPIRE</div>
        <canvas id="ctWorldCanvas" class="ct-world-canvas"></canvas>
      </div>

      <!-- COL 3: Shop -->
      <div class="ct-col ct-col-right">
        <div class="ct-shop-header">🛒 UPGRADES</div>
        <div id="ctUpgradeList" class="ct-shop-list"></div>
      </div>

    </div><!-- /ct-main -->

    <!-- MILESTONES -->
    <div class="ct-milestones-wrap">
      <div class="ct-milestones-title">🏆 Achievements</div>
      <div id="ctMilestones" class="ct-milestones-grid"></div>
    </div>

  </div><!-- /panel-clicker -->

  <!-- ═══════════════════════════════════════════════════
       INFO CONTENT SECTION
  ═══════════════════════════════════════════════════ -->
  <div class="info-wrap" id="infoWrap">

    <!-- ═══ INFO: REACTION ═══ -->
    <div class="info-section" data-info="reaction">
    <div class="sec-divider">ABOUT REACTION TIME TEST</div>
    <article class="icard">
      <h2 class="icard-title">⚡ What Is a Reaction Time Test?</h2>
      <p class="ibody">A <strong>reaction time test</strong> measures how quickly you respond to a visual stimulus — from when your eyes detect a signal to when your hand clicks. Results are in <strong>milliseconds (ms)</strong>. Average human reaction time is <strong>200–250ms</strong>, while elite gamers achieve <strong>150–200ms</strong>.<br><br>Our free online test runs <strong>5 rounds</strong>, gives ratings from <em>Slow</em> to <em>Legendary</em>, and shows your best, average, and score. No download needed — works on any browser.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Reaction Time Rating Chart</h2>
      <table class="rtable"><thead><tr><th>Time</th><th>Rating</th><th>Who?</th></tr></thead><tbody>
        <tr><td style="color:var(--yellow)">Under 150ms</td><td style="color:var(--yellow)">⚡ Legendary</td><td style="color:#c8c8e8">Pro esports athletes</td></tr>
        <tr><td style="color:var(--accent)">150–200ms</td><td style="color:var(--accent)">🔥 Perfect</td><td style="color:#c8c8e8">Top competitive gamers</td></tr>
        <tr><td style="color:var(--accent)">200–250ms</td><td style="color:var(--accent)">✅ Great</td><td style="color:#c8c8e8">Above average, serious player</td></tr>
        <tr><td style="color:var(--purple)">250–320ms</td><td style="color:var(--purple)">👍 Good</td><td style="color:#c8c8e8">Casual gamer, average adult</td></tr>
        <tr><td style="color:#c8c8e8">320–400ms</td><td style="color:#c8c8e8">😐 Average</td><td style="color:#c8c8e8">Most non-gamers</td></tr>
        <tr><td style="color:var(--red)">400ms+</td><td style="color:var(--red)">🐢 Slow</td><td style="color:#c8c8e8">Tired, distracted or first try</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 How to Improve Reaction Time</h2>
      <p class="ibody"><strong>Sleep:</strong> Even 1 hour less sleep adds 50ms+ to reaction time.<br><strong>Practice:</strong> Daily reaction tests build neural pathways over 2–4 weeks.<br><strong>Gaming:</strong> Fast-paced FPS games (CS2, Valorant) measurably improve reaction speed.<br><strong>Caffeine:</strong> 100–200mg reduces reaction time by 10–30ms temporarily.<br><strong>Monitor:</strong> A 144Hz+ monitor with low latency reduces visual delay significantly.</p>
    </article>
    <div class="sec-divider">FAQ — REACTION TIME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Average: <strong>200–250ms</strong>. Excellent: under <strong>200ms</strong>. Elite (pro gamers): under <strong>150ms</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">Why does my reaction time vary? <span class="faq-arrow">▼</span></button><div class="faq-a">Reaction time varies with <strong>fatigue, focus, and anticipation</strong>. Multiple rounds average out variance — 5 rounds gives a reliable score.</div></div>
      <div class="faq-item"><button class="faq-q">Does gaming improve reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. Action games improve <strong>visual processing speed</strong>. Studies show gamers react 50–100ms faster than non-gamers on average.</div></div>
      <div class="faq-item"><button class="faq-q">What is the fastest human reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">The world record visual reaction time is approximately <strong>100ms</strong>. For sprinters, the minimum legal reaction time in the 100m dash is 100ms.</div></div>
      <div class="faq-item"><button class="faq-q">Do monitors affect reaction time results? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. Results include ~5–15ms mouse latency and ~1–8ms monitor delay. A <strong>144Hz+ monitor</strong> reduces display lag significantly. Your true neural reaction is slightly faster than the number shown.</div></div>
      <div class="faq-item"><button class="faq-q">How can I get a lower reaction time score? <span class="faq-arrow">▼</span></button><div class="faq-a">Be well-rested, stay focused, and practice daily. Avoid anticipating the signal — early clicks are counted as failed rounds. Use a gaming mouse and high-refresh monitor for best results.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: STIMULATION ═══ -->
    <div class="info-section" data-info="stimulation" style="display:none">
    <div class="sec-divider">ABOUT STIMULATION CLICKER</div>
    <article class="icard">
      <h2 class="icard-title">🎯 What Is the Stimulation Clicker?</h2>
      <p class="ibody">The <strong>Stimulation Clicker</strong> is an aim training game where colorful targets appear at random positions and you must click them before they disappear. It combines <strong>clicking speed</strong> with <strong>spatial precision</strong> — the same skill set required in FPS games like CS2, Valorant, and Fortnite.<br><br>It is directly inspired by professional aim trainers like <strong>Aimlabs</strong> and <strong>KovaaK's</strong>, designed to build mouse accuracy under time pressure.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 Difficulty Levels</h2>
      <table class="rtable"><thead><tr><th>Level</th><th>Target Size</th><th>Lifetime</th><th>Best For</th></tr></thead><tbody>
        <tr><td style="color:var(--accent)">🟢 Easy</td><td style="color:#c8c8e8">80px</td><td style="color:#c8c8e8">1.2 seconds</td><td style="color:#c8c8e8">Beginners, warm-up</td></tr>
        <tr><td style="color:var(--yellow)">🟡 Medium</td><td style="color:#c8c8e8">55px</td><td style="color:#c8c8e8">0.8 seconds</td><td style="color:#c8c8e8">Standard aim training</td></tr>
        <tr><td style="color:var(--red)">🔴 Hard</td><td style="color:#c8c8e8">38px</td><td style="color:#c8c8e8">0.5 seconds</td><td style="color:#c8c8e8">Elite aim, comparable to Aimlabs Gridshot</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 How to Score Higher on Stimulation Clicker</h2>
      <p class="ibody"><strong>Predict, don't react:</strong> As targets appear, move your cursor toward the next likely zone rather than reacting to each target after it spawns. Targets appear randomly but your anticipation cuts reaction time in half.<br><br><strong>Stay centered:</strong> Keep your cursor near the center of the screen so you have equal range of motion in all directions. Edge-hugging leaves you slow on the opposite side.<br><br><strong>Use Hard mode to train:</strong> Hard mode's 38px targets and 0.5s lifetime mirrors professional aim trainer difficulty. Two weeks of daily Hard mode sessions measurably improves your flick-shot accuracy in CS2 and Valorant.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 Stimulation Clicker vs. Aimlabs vs. KovaaK's</h2>
      <p class="ibody">Professional aim trainers like Aimlabs and KovaaK's are the gold standard for FPS training — but they require downloads and setup. Stimulation Clicker fills the gap as a <strong>zero-install, browser-based alternative</strong> for quick warm-ups.<br><br>Hard mode is comparable to Aimlabs' Gridshot scenario in target size and time pressure. For a 5-minute pre-game warm-up, it's highly effective. For serious competitive training, dedicated aim trainers offer more scenario variety and tracking analytics.</p>
    </article>
    <div class="sec-divider">FAQ — STIMULATION CLICKER</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Does stimulation clicker help in real games? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. The mechanics directly mirror FPS target acquisition. <strong>Hard mode</strong> is comparable to professional aim trainer scenarios. Regular practice improves flick-shot accuracy in CS2 and Valorant.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good stimulation clicker score? <span class="faq-arrow">▼</span></button><div class="faq-a">On Medium: <strong>1500+ points</strong> is average, <strong>3500+</strong> is skilled, <strong>6000+</strong> is elite. On Hard: above <strong>3500</strong> indicates pro-level aim. Scores improve significantly after 1–2 weeks of daily practice.</div></div>
      <div class="faq-item"><button class="faq-q">How long should I train with Stimulation Clicker? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>15–20 minutes daily</strong> is optimal. More than 30 minutes causes fatigue that reduces accuracy and trains bad habits. Consistent daily sessions beat long occasional sessions.</div></div>
      <div class="faq-item"><button class="faq-q">What mouse sensitivity should I use? <span class="faq-arrow">▼</span></button><div class="faq-a">Use your in-game sensitivity. Training at a different sensitivity than you play at won't transfer to real games. If you're unsure, <strong>400 DPI × 2.0 in-game sens</strong> (800 effective DPI) is the most common pro player setting.</div></div>
      <div class="faq-item"><button class="faq-q">Is stimulation clicker good for Fortnite aim? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — the random target placement and short target lifetime closely mimics Fortnite's close-range build-fight scenarios. Medium difficulty is well-suited for Fortnite training. Hard mode is more relevant for CS2 and Valorant's smaller hitboxes.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: CPS / JITTER ═══ -->
    <div class="info-section" data-info="cps" style="display:none">
    <div class="sec-divider">ABOUT CLICK SPEED TEST</div>
    <article class="icard">
      <h2 class="icard-title">🖱️ What Is a CPS Test?</h2>
      <p class="ibody">A <strong>Click Speed Test</strong> (CPS Test) measures how many times you can click per second. It's the core benchmark for competitive gaming, especially <strong>Minecraft PvP</strong>, where raw clicking speed gives a combat advantage. Our free CPS test offers <strong>8 time durations</strong> (1s to 100s) and includes Normal and Challenge modes.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 CPS Ranking Table</h2>
      <table class="rtable"><thead><tr><th>Rank</th><th>CPS</th><th>Level</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">🐢 Turtle</td><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">Beginner</td></tr>
        <tr><td style="color:var(--purple)">🐇 Normal</td><td style="color:var(--purple)">5–7</td><td style="color:var(--purple)">Average</td></tr>
        <tr><td style="color:var(--accent)">⚡ Fast</td><td style="color:var(--accent)">8–10</td><td style="color:var(--accent)">Good</td></tr>
        <tr><td style="color:var(--yellow)">🐆 Cheetah</td><td style="color:var(--yellow)">11–14</td><td style="color:var(--yellow)">Pro</td></tr>
        <tr><td style="color:var(--red)">⚡ God Mode</td><td style="color:var(--red)">15+</td><td style="color:var(--red)">Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">🖱 Clicking Techniques</h2>
      <div class="tech-grid">
        <div class="tcard"><div class="thead-row"><span class="tname">Regular Clicking</span><span class="tbadge p">3–9 CPS</span></div><p class="tbody-t">Standard one-finger method. Best aim accuracy. Sustainable for all durations including 100s.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Jitter Clicking</span><span class="tbadge g">10–14 CPS</span></div><p class="tbody-t">Tense forearm and wrist to create rapid vibrations. Learnable with practice. Risk of wrist strain — take breaks every 15 min.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Butterfly Clicking</span><span class="tbadge y">15–25 CPS</span></div><p class="tbody-t">Two fingers alternate on the same button. World record: <strong>25.5 CPS (Nestor, 2022)</strong>. Often banned in competitive servers.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Drag Clicking</span><span class="tbadge r">30–100+ CPS</span></div><p class="tbody-t">Drag finger across button creating friction micro-clicks. Universally banned in competitive play.</p></div>
      </div>
    </article>
    <article class="icard">
      <h2 class="icard-title">⚡ How to Increase Your CPS</h2>
      <p class="ibody"><strong>Warm up first:</strong> Shake out your wrist and do 10–15 seconds of slow clicking before going for a record. Cold muscles click slower.<br><br><strong>Use your index finger only</strong> for regular clicking — it's the fastest single-finger technique for sustained CPS over 5+ seconds.<br><br><strong>Relax your grip:</strong> A tight grip on the mouse increases fatigue and lowers CPS. Hold firmly but not tensely.<br><br><strong>Shorter duration = higher peak CPS.</strong> Your 1-second score will always be higher than your 10-second score. Use shorter tests to benchmark raw speed, longer tests for stamina.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🖱️ Best Mouse Settings for CPS</h2>
      <p class="ibody"><strong>Polling rate: 1000Hz</strong> — registers up to 1000 clicks per second.<br><strong>Debounce time: 4–8ms</strong> — lower is better. Some mice like Logitech G Pro have configurable debounce.<br><strong>Switch type:</strong> Optical switches (Razer, SteelSeries) have near-zero debounce and register faster than mechanical switches.<br><br>Technique accounts for 90% of your CPS score. Hardware is the last 10%.</p>
    </article>
    <div class="sec-divider">FAQ — CLICK SPEED</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good CPS score? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>6–7 CPS</strong> is average for most adults. Above <strong>10 CPS</strong> is good and requires intentional technique. Above <strong>14 CPS</strong> requires jitter or butterfly clicking. Pro Minecraft PvP players typically sustain 8–12 CPS.</div></div>
      <div class="faq-item"><button class="faq-q">What is the world record CPS? <span class="faq-arrow">▼</span></button><div class="faq-a">Regular clicking: <strong>14.1 CPS (Dylan Allred, 2020)</strong>. Jitter: approximately <strong>16–17 CPS</strong>. Butterfly clicking: <strong>25.5 CPS (Nestor, 2022)</strong>. Drag clicking is excluded from most records as it uses friction rather than actual clicks.</div></div>
      <div class="faq-item"><button class="faq-q">Is jitter clicking harmful to your health? <span class="faq-arrow">▼</span></button><div class="faq-a">Extended jitter clicking can cause <strong>wrist strain, tendinitis, and carpal tunnel syndrome</strong>. Take breaks every 10–15 minutes. Stop immediately if you feel pain or numbness. Regular clicking technique carries minimal risk.</div></div>
      <div class="faq-item"><button class="faq-q">Does a gaming mouse improve CPS? <span class="faq-arrow">▼</span></button><div class="faq-a">Marginally. A gaming mouse with <strong>1000Hz polling rate</strong> and low debounce registers clicks more reliably. Most players gain 0.5–2 CPS from upgrading. Optical switches respond fastest. Technique matters far more than hardware.</div></div>
      <div class="faq-item"><button class="faq-q">What is jitter clicking? <span class="faq-arrow">▼</span></button><div class="faq-a">Jitter clicking involves tensing your forearm and wrist muscles to create rapid vibrations, translating into 10–14 CPS. It requires practice and carries injury risk with overuse. Commonly used in Minecraft PvP and legal in most servers.</div></div>
      <div class="faq-item"><button class="faq-q">What is butterfly clicking? <span class="faq-arrow">▼</span></button><div class="faq-a">Butterfly clicking uses <strong>two fingers alternating</strong> on the same mouse button to achieve 15–25+ CPS. Often banned in competitive Minecraft servers. Requires a mouse that registers both finger inputs without debounce filtering.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: SPACEBAR ═══ -->
    <div class="info-section" data-info="spacebar" style="display:none">
    <div class="sec-divider">ABOUT SPACEBAR TEST</div>
    <article class="icard">
      <h2 class="icard-title">⌨️ What Is the Spacebar Speed Test?</h2>
      <p class="ibody">The <strong>Spacebar Speed Test</strong> measures how many times per second you can press the spacebar. It's popular among <strong>rhythm game players</strong> (osu!, Beat Saber) and keyboard enthusiasts. Unlike mouse clicking, spacebar speed depends heavily on keyboard switch type and finger placement technique.<br><br>Our test supports 8 durations (1s–100s) and counts only new presses — holding down the spacebar does not register multiple presses.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ Spacebar Speed Rankings</h2>
      <table class="rtable"><thead><tr><th>Presses/sec</th><th>Rating</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">🐢 Slow</td></tr>
        <tr><td style="color:var(--purple)">5–7</td><td style="color:var(--purple)">👍 Average</td></tr>
        <tr><td style="color:var(--accent)">8–10</td><td style="color:var(--accent)">⚡ Fast</td></tr>
        <tr><td style="color:var(--yellow)">11+</td><td style="color:var(--yellow)">🏆 Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ How to Press Spacebar Faster</h2>
      <p class="ibody"><strong>Use your thumb's pad, not the tip:</strong> The fleshy pad of your thumb covers more key surface and rebounds faster than the tip. Plant your thumb flat and lift with wrist momentum rather than pure finger movement.<br><br><strong>Don't bottom out:</strong> Pressing the spacebar all the way down wastes time on return travel. Press just past actuation point and let the switch spring push your thumb back up.<br><br><strong>Keyboard matters here more than in typing:</strong> A mechanical keyboard with <strong>linear switches (Red, Speed Silver)</strong> has shorter travel distance and lower actuation force, directly improving spacebar speed by 10–20%.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Spacebar Speed World Records</h2>
      <p class="ibody">The verified spacebar speed record stands at approximately <strong>14–16 presses per second</strong> for a 10-second test using standard technique. Some claims of 20+ HPS exist but are typically achieved with modified technique or disputed timing.<br><br>For rhythm games like <strong>osu!</strong>, players regularly sustain 10–12 HPS for multiple seconds during streams (rapid consecutive notes). This makes osu! players among the fastest spacebar pressers in the world.</p>
    </article>
    <div class="sec-divider">FAQ — SPACEBAR</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>6–8 presses per second</strong> is average. Above <strong>10 HPS</strong> is exceptional and typically requires a mechanical keyboard with linear switches. Rhythm game players (osu!, Beat Saber) regularly achieve 10–12 HPS.</div></div>
      <div class="faq-item"><button class="faq-q">Does keyboard type affect spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, significantly. <strong>Linear mechanical switches</strong> (Red, Speed Silver) allow faster actuation than membrane keyboards. Switch actuation force and travel distance directly impact maximum speed. Speed Silver switches have the shortest travel at 1.2mm.</div></div>
      <div class="faq-item"><button class="faq-q">Why doesn't holding spacebar count? <span class="faq-arrow">▼</span></button><div class="faq-a">Browsers fire repeated keydown events when a key is held. We filter these with <code>e.repeat</code> detection — only actual new presses count, making the test accurate and fair across all keyboards and browsers.</div></div>
      <div class="faq-item"><button class="faq-q">What games use spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Rhythm games like <strong>osu!</strong> require rapid spacebar inputs during stream sections. Some Minecraft mechanics (horse jumping, fishing) benefit from spacebar timing. It's also used in parkour games and various browser-based games.</div></div>
      <div class="faq-item"><button class="faq-q">Can I train spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. 5–10 minutes of daily spacebar testing builds the specific motor pattern for rapid thumb actuation. Most users improve by 1–3 HPS within two weeks of consistent practice. Combining this with a linear mechanical keyboard gives the fastest results.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: TYPING ═══ -->
    <div class="info-section" data-info="typing" style="display:none">
    <div class="sec-divider">ABOUT TYPING SPEED TEST</div>
    <article class="icard">
      <h2 class="icard-title">📝 What Is a Typing Speed Test (WPM)?</h2>
      <p class="ibody">A <strong>Typing Speed Test</strong> measures your typing speed in <strong>WPM (Words Per Minute)</strong> and accuracy. The standard WPM formula counts each 5 characters as one "word." Our test uses real English words, tracks correct/incorrect entries, and gives live WPM feedback.<br><br>Choose <strong>30s, 60s, or 120s</strong> modes. Average typing speed is <strong>40–50 WPM</strong>. Professional typists reach 70–100+ WPM.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ WPM Rankings</h2>
      <table class="rtable"><thead><tr><th>WPM</th><th>Level</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">Under 30</td><td style="color:#b0b0d0">🐢 Beginner</td></tr>
        <tr><td style="color:var(--purple)">30–50</td><td style="color:var(--purple)">👍 Average</td></tr>
        <tr><td style="color:var(--accent)">50–70</td><td style="color:var(--accent)">⚡ Good</td></tr>
        <tr><td style="color:var(--yellow)">70–100</td><td style="color:var(--yellow)">🏆 Fast</td></tr>
        <tr><td style="color:var(--red)">100+</td><td style="color:var(--red)">⚡ Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ How to Type Faster: A Practical Guide</h2>
      <p class="ibody"><strong>1. Learn touch typing first.</strong> If you're still hunting for keys, that's the only thing that matters. Touch typing (all 10 fingers, never looking down) unlocks 60+ WPM as a baseline. Resources like Keybr.com or TypingClub teach it in 2–4 weeks of daily 15-minute sessions.<br><br><strong>2. Accuracy before speed.</strong> Correcting typos costs more time than typing slowly. Aim for 98%+ accuracy and your speed will naturally increase. Turn off autocorrect during practice so mistakes register.<br><br><strong>3. Common words are your shortcut.</strong> The 100 most common English words account for 50% of all text. Mastering their muscle memory patterns alone takes you from 30 to 55 WPM.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Typing Speed by Profession</h2>
      <table class="rtable"><thead><tr><th>Profession</th><th>Avg WPM</th><th>Notes</th></tr></thead><tbody>
        <tr><td style="color:#c8c8e8">Average adult</td><td style="color:var(--accent)">41 WPM</td><td style="color:#b0b0d0">2-finger or partial touch typing</td></tr>
        <tr><td style="color:#c8c8e8">Office worker</td><td style="color:var(--accent)">55–70 WPM</td><td style="color:#b0b0d0">Daily keyboard use</td></tr>
        <tr><td style="color:#c8c8e8">Professional typist</td><td style="color:var(--yellow)">70–100 WPM</td><td style="color:#b0b0d0">Touch typing mastered</td></tr>
        <tr><td style="color:#c8c8e8">Developer / writer</td><td style="color:var(--yellow)">60–90 WPM</td><td style="color:#b0b0d0">High accuracy requirement</td></tr>
        <tr><td style="color:#c8c8e8">Stenographer</td><td style="color:var(--red)">200–300 WPM</td><td style="color:#b0b0d0">Specialized chorded keyboard</td></tr>
        <tr><td style="color:#c8c8e8">World record</td><td style="color:var(--red)">212 WPM</td><td style="color:#b0b0d0">Barbara Blackburn, 2005</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — TYPING TEST</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is average typing speed? <span class="faq-arrow">▼</span></button><div class="faq-a">The global average is <strong>40–50 WPM</strong>. Office professionals average 55–70 WPM. Professional typists and stenographers reach 100–200+ WPM. The world record is 212 WPM held by Barbara Blackburn.</div></div>
      <div class="faq-item"><button class="faq-q">How is WPM calculated? <span class="faq-arrow">▼</span></button><div class="faq-a">The standard formula counts every <strong>5 characters as one "word"</strong> — including spaces and punctuation. This makes WPM scores comparable regardless of word length. Gross WPM counts all keystrokes; net WPM subtracts errors.</div></div>
      <div class="faq-item"><button class="faq-q">How can I type faster? <span class="faq-arrow">▼</span></button><div class="faq-a">Learn <strong>touch typing</strong> (all 10 fingers without looking). Practice 15–30 minutes daily. Focus on accuracy first — speed follows naturally. Target 98%+ accuracy before pushing for higher WPM. Sites like Keybr.com are excellent companions.</div></div>
      <div class="faq-item"><button class="faq-q">Does keyboard type affect typing speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, but technique matters far more. <strong>Mechanical keyboards</strong> with tactile feedback (Cherry MX Brown, Blue) help accuracy. Low-profile laptop keys cause more errors for some typists. Switching keyboards typically changes your WPM by ±5–10%.</div></div>
      <div class="faq-item"><button class="faq-q">What WPM do I need for a job? <span class="faq-arrow">▼</span></button><div class="faq-a">Most office jobs require <strong>40–60 WPM</strong>. Data entry positions typically require 60–80 WPM. Legal transcription and medical typing require 70–90 WPM with near-perfect accuracy. Stenographers need 200+ WPM with a specialized machine.</div></div>
      <div class="faq-item"><button class="faq-q">Is 100 WPM good? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — <strong>100 WPM puts you in the top 5%</strong> of typists worldwide. At this speed, typing is rarely a bottleneck for any professional task. Writers and developers at 100 WPM can focus entirely on thought rather than mechanics.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: COREBALL ═══ -->
    <div class="info-section" data-info="coreball" style="display:none">
    <div class="sec-divider">ABOUT COREBALL GAME</div>
    <article class="icard">
      <h2 class="icard-title">🎮 How to Play Coreball</h2>
      <p class="ibody">In <strong>Coreball</strong>, a central core spins continuously. You shoot balls from the bottom — each ball sticks to the core when it lands. The challenge: <strong>don't let your ball hit an existing ball</strong> already stuck on the core. As you score more, the core spins faster, increasing difficulty.<br><br>Tap or click to shoot. You start with 10 balls. Plan your shots carefully — timing is everything.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎯 Coreball Tips</h2>
      <p class="ibody"><strong>Watch the gaps:</strong> Focus on the spaces between stuck balls, not the balls themselves.<br><strong>Rhythm shooting:</strong> Find the rotation rhythm and shoot in sync.<br><strong>Don't rush:</strong> You have 10 balls — patience beats panic.<br><strong>Higher levels:</strong> Speed increases every 10 points. Adjust your timing accordingly.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎯 Advanced Coreball Strategy</h2>
      <p class="ibody"><strong>Find the rhythm, then shoot in sync.</strong> The core rotates at a constant speed. Count the rotation mentally ("1-2-3-shoot") until the pattern becomes automatic. Rhythm shooters consistently outperform reactive shooters.<br><br><strong>Target the largest gap, not the next one.</strong> As more balls accumulate on the core, look for the two largest adjacent gaps. Aim for the center of that gap — it gives you the most margin for error.<br><br><strong>Danger balls demand respect.</strong> Red danger balls move faster and reduce your margin. When a danger ball is on the core, slow down and wait for it to rotate to a safe position before shooting.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Coreball Score Guide</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Level</th><th>Skill</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–9</td><td style="color:#b0b0d0">Level 1</td><td style="color:#c8c8e8">Learning the timing</td></tr>
        <tr><td style="color:var(--accent)">10–19</td><td style="color:var(--accent)">Level 2</td><td style="color:#c8c8e8">Consistent timing, above average</td></tr>
        <tr><td style="color:var(--yellow)">20–29</td><td style="color:var(--yellow)">Level 3</td><td style="color:#c8c8e8">Good rhythm, handles speed increase</td></tr>
        <tr><td style="color:var(--red)">30+</td><td style="color:var(--red)">Level 4+</td><td style="color:#c8c8e8">Elite — very few players reach this</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — COREBALL</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the Coreball game? <span class="faq-arrow">▼</span></button><div class="faq-a">Coreball is a precision timing game where you shoot balls onto a spinning core without hitting existing ones. It tests <strong>timing, patience, and spatial awareness</strong>. The core spins faster with each level, increasing difficulty progressively.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good Coreball score? <span class="faq-arrow">▼</span></button><div class="faq-a">Scoring <strong>10+ points</strong> without a miss is good. Above <strong>20</strong> is excellent. Above <strong>30</strong> is elite-level and requires mastery of the rhythm pattern at high rotation speeds.</div></div>
      <div class="faq-item"><button class="faq-q">Why do I keep losing on Coreball? <span class="faq-arrow">▼</span></button><div class="faq-a">The most common mistake is reacting to the gap you see <em>now</em> rather than where the gap will be when your ball arrives. The ball takes ~0.3 seconds to reach the core — aim slightly ahead of the gap you want.</div></div>
      <div class="faq-item"><button class="faq-q">What does the red ball do in Coreball? <span class="faq-arrow">▼</span></button><div class="faq-a">Red "danger balls" are pre-placed on the core and spin with it. They narrow the available gaps significantly. Always locate all danger balls before shooting to avoid unexpected collisions.</div></div>
      <div class="faq-item"><button class="faq-q">Does Coreball have an end? <span class="faq-arrow">▼</span></button><div class="faq-a">No — Coreball is an endless survival game. It gets progressively harder as rotation speed increases with each level. The challenge is surviving as long as possible, not reaching a final stage.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: DINO ═══ -->
    <div class="info-section" data-info="dino" style="display:none">
    <div class="sec-divider">ABOUT DINOSAUR GAME</div>
    <article class="icard">
      <h2 class="icard-title">🦕 How to Play the Dinosaur Game</h2>
      <p class="ibody">The <strong>Dinosaur Game</strong> (also known as the Chrome Dino or T-Rex Runner) is a classic endless runner. Press <strong>Space or tap</strong> to jump over cacti and duck under pterodactyls. The game speeds up over time — how far can you run?<br><br>This tests your <strong>reaction time and rhythm</strong> under escalating pressure, making it a fun complement to the reaction time test.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🦕 How to Get a High Score in the Dinosaur Game</h2>
      <p class="ibody"><strong>Jump earlier than feels natural.</strong> The cactus looks far away, but the dinosaur needs ~200ms to reach jump height. At high speeds, late jumpers always fail. Train yourself to jump when the obstacle is still about 1 character-width away.<br><br><strong>Duck under pterodactyls, don't jump.</strong> Many players instinctively jump at flying enemies, which often leads to mid-air collisions. Swipe down or press the down arrow to duck — it's faster and safer.<br><br><strong>The game speeds up every 100 points.</strong> Your mental model needs to constantly recalibrate. After each 100-point milestone, consciously reset your "jump early" threshold.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Dinosaur Game Score Milestones</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Rating</th><th>Speed</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">0–500</td><td style="color:#b0b0d0">🐣 Beginner</td><td style="color:#c8c8e8">Manageable, single cacti</td></tr>
        <tr><td style="color:var(--accent)">500–1000</td><td style="color:var(--accent)">✅ Getting there</td><td style="color:#c8c8e8">Cactus clusters appear</td></tr>
        <tr><td style="color:var(--yellow)">1000–5000</td><td style="color:var(--yellow)">⚡ Above average</td><td style="color:#c8c8e8">Pterodactyls + night mode</td></tr>
        <tr><td style="color:var(--red)">5000–10000</td><td style="color:var(--red)">🏆 Expert</td><td style="color:#c8c8e8">Maximum speed approaches</td></tr>
        <tr><td style="color:var(--red)">99999</td><td style="color:var(--red)">⚡ Legendary</td><td style="color:#c8c8e8">Score resets to 0 (rare)</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — DINO GAME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the Chrome Dinosaur game? <span class="faq-arrow">▼</span></button><div class="faq-a">Originally created by Google in 2014, the <strong>T-Rex Runner</strong> appears in Chrome when you have no internet connection. It's now one of the most played browser games in the world, with an estimated <strong>270 million plays per month</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good Dino game score? <span class="faq-arrow">▼</span></button><div class="faq-a">Reaching <strong>500 points</strong> is good for beginners. <strong>1000+</strong> is above average. Expert players regularly score <strong>5000–10000+</strong>. The theoretical maximum score before the counter resets is <strong>99999</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">How do you duck in the Dinosaur game? <span class="faq-arrow">▼</span></button><div class="faq-a">Press the <strong>down arrow key</strong> on desktop or <strong>swipe down</strong> on mobile. Ducking is essential for avoiding low-flying pterodactyls. Holding down will keep you crouched until you release — useful for pterodactyls that hover at jump height.</div></div>
      <div class="faq-item"><button class="faq-q">Does the Dino game ever end? <span class="faq-arrow">▼</span></button><div class="faq-a">Technically no — the game is endless. The score counter resets to 00000 after reaching <strong>99999</strong>. In practice, game speed increases until human reaction time becomes insufficient at extreme scores, making it a practical limit.</div></div>
      <div class="faq-item"><button class="faq-q">Why does the screen go dark in the Dino game? <span class="faq-arrow">▼</span></button><div class="faq-a">The game alternates between day and night mode as your score increases. <strong>Night mode</strong> inverts colors (dark background, white obstacles) to increase difficulty. It's a visual challenge layer added to the original game.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: NUMBER MEMORY ═══ -->
    <div class="info-section" data-info="memory" style="display:none">
    <div class="sec-divider">ABOUT NUMBER MEMORY TEST</div>
    <article class="icard">
      <h2 class="icard-title">🧠 What Is the Number Memory Test?</h2>
      <p class="ibody">The <strong>Number Memory Test</strong> challenges you to memorize increasingly long sequences of digits. Each level adds one more digit — starting at 1, going up as far as your working memory allows. You have <strong>3 lives</strong>; a wrong answer costs one life and drops you back a level. The number is shown briefly, then hidden — you must type it from memory.<br><br>This test directly measures your <strong>working memory capacity</strong>, one of the most researched cognitive abilities. It's used in IQ tests, psychology research, and neurological assessments worldwide.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Number Memory Score Rankings</h2>
      <table class="rtable"><thead><tr><th>Digits</th><th>Level</th><th>Population</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">🐢 Below Average</td><td style="color:#c8c8e8">Bottom 25%</td></tr>
        <tr><td style="color:var(--purple)">5–6</td><td style="color:var(--purple)">👍 Average</td><td style="color:#c8c8e8">Most adults: 5–7 digits</td></tr>
        <tr><td style="color:var(--accent)">7–8</td><td style="color:var(--accent)">⚡ Good</td><td style="color:#c8c8e8">Top 30% — strong working memory</td></tr>
        <tr><td style="color:var(--yellow)">9–10</td><td style="color:var(--yellow)">🏆 Excellent</td><td style="color:#c8c8e8">Top 10% — gifted memory</td></tr>
        <tr><td style="color:var(--red)">11+</td><td style="color:var(--red)">🧠 Exceptional</td><td style="color:#c8c8e8">Top 1% — memory athlete level</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Tips to Improve Number Memory</h2>
      <p class="ibody"><strong>Chunking:</strong> Group digits into pairs or triples (e.g. 3-8-4-7-2 → 38, 47, 2). This is how phone numbers are remembered.<br><strong>Rhythm:</strong> Say the number aloud with a rhythm or melody — music memory is stronger than verbal memory.<br><strong>Visualization:</strong> Associate digits with images or locations (memory palace technique).<br><strong>Practice:</strong> Daily training measurably expands working memory span within 2–4 weeks.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🧠 Science Behind Working Memory</h2>
      <p class="ibody">Working memory is the brain's "mental whiteboard" — the system that temporarily holds and manipulates information. It's governed primarily by the <strong>prefrontal cortex</strong> and is one of the strongest predictors of academic and professional performance.<br><br>Psychologist George Miller's 1956 paper "The Magical Number Seven, Plus or Minus Two" established that humans can hold <strong>7±2 chunks</strong> of information in working memory. Modern research has revised this slightly downward to <strong>4±1 chunks</strong> when rehearsal is prevented — but chunking (grouping digits) effectively expands usable capacity back to 7+.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Memory Techniques That Actually Work</h2>
      <p class="ibody"><strong>Chunking:</strong> Group digits into 2–3 digit pairs. "8-3-7-4-1-9" becomes "83 · 74 · 19" — three items instead of six. This alone can add 3–4 digits to your memory span.<br><br><strong>Verbal rhythm:</strong> Say the number out loud (or mentally) with a musical rhythm. Melody-based memory is significantly more durable than silent reading. Phone numbers stuck in your head prove this works.<br><br><strong>The Major System:</strong> Convert digits to consonant sounds, build words, then create vivid mental images. 7 = K/G, 3 = M, 5 = L. With practice, this lets memory athletes remember 50+ random digits.</p>
    </article>
    <div class="sec-divider">FAQ — NUMBER MEMORY</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the average number memory span? <span class="faq-arrow">▼</span></button><div class="faq-a">The average adult holds <strong>5–7 digits</strong> in working memory — the reason phone numbers were originally 7 digits long. George Miller called this "The Magical Number Seven, Plus or Minus Two" in his landmark 1956 paper.</div></div>
      <div class="faq-item"><button class="faq-q">What is the world record for number memory? <span class="faq-arrow">▼</span></button><div class="faq-a">Memory athletes using the <strong>memory palace technique</strong> can memorize hundreds of random digits. The world record for memorizing pi is over 70,000 digits (Rajveer Meena, 2015). For random digit sequences, competitive memorizers achieve 50–100+ digits.</div></div>
      <div class="faq-item"><button class="faq-q">Does number memory relate to IQ? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — working memory capacity is <strong>moderately correlated with fluid intelligence</strong> (r ≈ 0.5). Digit span tasks are included in WAIS and WISC intelligence tests. However, memory techniques can substantially increase your score independently of IQ.</div></div>
      <div class="faq-item"><button class="faq-q">Why does the number disappear so fast? <span class="faq-arrow">▼</span></button><div class="faq-a">Display time scales with digit count (~800ms per digit). At higher levels you get more total time. The challenge is transferring what you see into <strong>short-term verbal memory</strong> before it fades — this is precisely what the test measures.</div></div>
      <div class="faq-item"><button class="faq-q">Can working memory be improved? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, through technique and practice. <strong>Chunking, verbal rehearsal, and visualization</strong> reliably expand your effective memory span. Daily memory testing for 2–4 weeks produces measurable improvements. Aerobic exercise and adequate sleep also improve working memory performance.</div></div>
      <div class="faq-item"><button class="faq-q">Is a memory span of 10 digits good? <span class="faq-arrow">▼</span></button><div class="faq-a">Excellent — a 10-digit span puts you in the <strong>top 10%</strong> of the population. Above 11 digits is memory-athlete territory (top 1%). Most untrained adults score 5–7 digits on their first attempt.</div></div>
    </div></article>
    </div>

    <div class="info-section" data-info="snake" style="display:none">
    <div class="sec-divider">ABOUT SNAKE GAME</div>
    <article class="icard">
      <h2 class="icard-title">🐍 What Is Snake? How to Play</h2>
      <p class="ibody">Snake is one of the most iconic games ever made — a simple concept with infinite replayability. You control a snake that grows longer every time it eats food. The challenge: avoid hitting the walls or your own body, which ends the game instantly.<br><br>Use <strong>Arrow Keys</strong> or <strong>WASD</strong> on keyboard to change direction. On mobile, <strong>swipe</strong> in any direction. Tap or press any arrow key to start. Each apple you eat adds 10 points and makes the snake one cell longer. The game speeds up gradually as your score climbs — plan your path ahead to survive.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Snake Score Rankings</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Level</th><th>Who?</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">0–40</td><td style="color:#b0b0d0">🐣 Beginner</td><td style="color:#c8c8e8">First-time players</td></tr>
        <tr><td style="color:var(--blue)">50–100</td><td style="color:var(--blue)">🐍 Casual</td><td style="color:#c8c8e8">Getting comfortable</td></tr>
        <tr><td style="color:var(--accent)">110–200</td><td style="color:var(--accent)">⚡ Skilled</td><td style="color:#c8c8e8">Good spatial awareness</td></tr>
        <tr><td style="color:var(--yellow)">210–350</td><td style="color:var(--yellow)">🔥 Expert</td><td style="color:#c8c8e8">Top 15% of players</td></tr>
        <tr><td style="color:var(--red)">360+</td><td style="color:var(--red)">👑 Master</td><td style="color:#c8c8e8">Near-perfect routing</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Snake Strategy Tips</h2>
      <p class="ibody"><strong>Hug the walls early:</strong> In the first 30 seconds, move along the edges. This keeps the center open and gives you more room to maneuver as your body grows.<br><br><strong>Think in loops:</strong> Plan an S-shaped or U-shaped path that covers the whole board systematically. This avoids dead ends.<br><br><strong>Don't rush to food:</strong> A longer path to the apple is always better than a short path that boxes you in. Survival beats score optimization at first.<br><br><strong>Watch your tail:</strong> Remember your tail is moving too — a cell your body occupies now will be free in a few steps. Advanced players use this to thread through tight gaps.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 History of Snake</h2>
      <p class="ibody">Snake was originally created in <strong>1976</strong> as an arcade game called <em>Blockade</em> by Gremlin Industries. The modern Snake phenomenon exploded in <strong>1998</strong> when Nokia pre-installed it on the <strong>Nokia 6110</strong>, making it the first game hundreds of millions of people played on a mobile device.<br><br>The game trained an entire generation's reflexes and spatial reasoning. Its simple grid-based movement, clear failure state, and addictive "just one more try" loop make it a timeless design masterpiece. Our version adds smooth 60fps animation via interpolation between game ticks, wall boundaries, and difficulty scaling.</p>
    </article>
    <div class="sec-divider">FAQ — SNAKE GAME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Does the snake wrap around walls? <span class="faq-arrow">▼</span></button><div class="faq-a">No — in this version, hitting any wall <strong>ends the game instantly</strong>. The glowing green border is your reminder of the danger zone. This makes the game more challenging and rewards careful long-term planning.</div></div>
      <div class="faq-item"><button class="faq-q">How fast does the snake get? <span class="faq-arrow">▼</span></button><div class="faq-a">The snake starts at one move every <strong>200ms</strong> and speeds up by 2ms per apple eaten. At maximum speed (80ms/move) the snake moves 12× per second. Even at max speed, smooth 60fps interpolation keeps movement fluid.</div></div>
      <div class="faq-item"><button class="faq-q">What is the maximum possible score? <span class="faq-arrow">▼</span></button><div class="faq-a">The board is 20×20 = 400 cells. The snake starts with 3 segments, so the theoretical maximum is eating <strong>397 apples</strong> for a score of <strong>3,970 points</strong>. Achieving this requires perfect routing of the entire board — an extremely rare feat.</div></div>
      <div class="faq-item"><button class="faq-q">Can I play Snake on mobile? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — swipe left, right, up, or down on the canvas to control direction. Tap the canvas once to start the game. The game is fully touch-optimized with swipe detection.</div></div>
      <div class="faq-item"><button class="faq-q">Why does Snake train reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Snake improves <strong>anticipatory reaction time</strong> — the ability to plan and execute decisions before a crisis arrives. Unlike pure reflex tests, Snake develops spatial working memory, decision-making under time pressure, and long-term trajectory planning.</div></div>
      <div class="faq-item"><button class="faq-q">What keyboard keys control the snake? <span class="faq-arrow">▼</span></button><div class="faq-a">You can use <strong>Arrow Keys</strong> (↑ ↓ ← →) or <strong>WASD</strong>. Both work identically. You cannot reverse direction 180° — pressing the opposite direction of travel is ignored to prevent instant self-collision.</div></div>
    </div></article>
    </div><!-- /snake info-section -->

    <!-- ═══ INFO: CLICKER TYCOON ═══ -->
    <div class="info-section" data-info="clicker" style="display:none">
    <div class="sec-divider">ABOUT CLICKER TYCOON</div>
    <article class="icard">
      <h2 class="icard-title">💰 What Is Clicker Tycoon?</h2>
      <p class="ibody">Clicker Tycoon is an <strong>idle incremental game</strong> built directly into your browser — no download, no sign-up. Click the big coin button to earn coins, then spend them on upgrades that generate income automatically. The core loop: <em>click → earn → buy → earn more passively → prestige → multiply everything</em>.<br><br>Your progress is <strong>automatically saved</strong> to your browser — close the tab and come back later. Your passive income keeps rolling while you're away.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏭 Upgrades &amp; Passive Income</h2>
      <table class="rtable"><thead><tr><th>Upgrade</th><th>Base Cost</th><th>Income/s</th></tr></thead><tbody>
        <tr><td>🖱️ Auto Cursor</td><td style="color:#c8c8e8">10 coins</td><td style="color:var(--accent)">0.1/s</td></tr>
        <tr><td>👶 Intern</td><td style="color:#c8c8e8">80 coins</td><td style="color:var(--accent)">0.5/s</td></tr>
        <tr><td>⛏️ Coin Miner</td><td style="color:#c8c8e8">300 coins</td><td style="color:var(--accent)">2/s</td></tr>
        <tr><td>🏭 Factory</td><td style="color:#c8c8e8">1,200 coins</td><td style="color:var(--accent)">8/s</td></tr>
        <tr><td>🏦 Bank</td><td style="color:#c8c8e8">5,000 coins</td><td style="color:var(--accent)">25/s</td></tr>
        <tr><td>🔬 Research Lab</td><td style="color:#c8c8e8">20,000 coins</td><td style="color:var(--accent)">80/s</td></tr>
        <tr><td>🚀 Space Launch</td><td style="color:#c8c8e8">80,000 coins</td><td style="color:var(--accent)">250/s</td></tr>
        <tr><td>🤖 AI Algorithm</td><td style="color:#c8c8e8">300,000 coins</td><td style="color:var(--accent)">800/s</td></tr>
        <tr><td>🌀 Coin Portal</td><td style="color:#c8c8e8">1,000,000 coins</td><td style="color:var(--accent)">2,500/s</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⭐ Prestige System</h2>
      <p class="ibody">Once you've earned <strong>100,000 coins</strong> total, the Prestige button appears. Prestiging <strong>resets your coins and upgrades</strong> but grants a permanent <strong>×2 income multiplier</strong> on everything — clicks and passive income.<br><br>Each subsequent prestige requires 10× more total earnings: 100K → 1M → 10M → 100M. After 10 prestiges, your multiplier reaches <strong>×1,024</strong>. The loop becomes exponentially more satisfying each cycle.</p>
    </article>
    <div class="sec-divider">FAQ — CLICKER TYCOON</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Is my progress saved? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — your coins, upgrades, prestige level, and milestones are automatically saved to your browser's <strong>localStorage</strong> every 10 seconds. Close the tab and return anytime — your progress will be there.</div></div>
      <div class="faq-item"><button class="faq-q">Does passive income run while I'm away? <span class="faq-arrow">▼</span></button><div class="faq-a">Passive income runs <strong>only while the tab is open</strong>. The game doesn't run in the background when closed. Plan your session around when you'll check back — or leave it running while you play other games on the site.</div></div>
      <div class="faq-item"><button class="faq-q">When should I prestige? <span class="faq-arrow">▼</span></button><div class="faq-a">Prestige as soon as the button appears (100K total earned). The ×2 multiplier on everything makes your next run dramatically faster. Don't wait to "max out" — early prestige snowballs faster.</div></div>
      <div class="faq-item"><button class="faq-q">What's the best upgrade strategy? <span class="faq-arrow">▼</span></button><div class="faq-a">Early game: stack Auto Cursors and Interns until you can afford Miners. Mid game: prioritize Factories and Banks for high passive income. Late game: Research Labs and above give the best coins-per-coin return. Buy in bulk when you can afford 10+ of the same upgrade.</div></div>
    </div></article>
    </div>

    <footer class="sfooter">
      <div style="margin-bottom:10px">
        <span style="color:var(--yellow);font-size:0.9rem;letter-spacing:2px">★★★★★</span>
        <span style="color:var(--text);font-size:0.58rem;margin-left:6px">4.8/5 — 2,347 ratings</span>
      </div>
      <p style="margin-bottom:6px;font-size:0.5rem">
        Platform: <span>Windows, macOS, Linux, Android, iOS</span> &nbsp;·&nbsp;
        Category: <span>Game Application</span> &nbsp;·&nbsp;
        Price: <span>Free</span> &nbsp;·&nbsp;
        Rated: <span>4.8 / 5</span> by <span>2,347</span> users
      </p>
      <p>© <span id="footYear">2026</span> Reaction Speed Test — Free Online Brain &amp; Reflex Tests</p>
      <p style="margin-top:6px">Test your <strong>reaction time</strong>, <strong>number memory</strong>, <strong>typing speed</strong>, <strong>click speed (CPS)</strong>, and more — free, no download, works on any device.</p>
      <p style="margin-top:6px;font-size:0.48rem">Keywords: reaction time test · number memory test · typing speed test · click speed test · CPS test · dino game · coreball · jitter click · spacebar test · stimulation clicker · snake game online · snake game free · working memory test · brain test online</p>
    </footer>

  </div>
</div><!-- /wrap -->

<script>
'use strict';

/* ═══════════════════════════════════════════
   STATE
═══════════════════════════════════════════ */
let curPanel    = 'cps';
let curDuration = 5;
let clickMode   = 'normal';
let stimDiff    = 'medium';

/* ═══════════════════════════════════════════
   HEADER / PANEL SWITCHING
═══════════════════════════════════════════ */
/* ═══════════════════════════════════════════
   ROUTER — URL-based navigation + SEO meta
═══════════════════════════════════════════ */
const ROUTES = {
  'reaction':    {
    path: '/reaction-time-test',
    title: 'Reaction Time Test — Measure Your Reflexes in Milliseconds | Reflex Lab',
    desc:  'Free online reaction time test. Measure how fast you respond to visual stimuli in milliseconds. 5 rounds, automatic scoring, performance ratings. Average human reaction time is 200–250ms — how do you compare?',
    h1:    'Reaction Time Test'
  },
  'stimulation': {
    path: '/stimulation-clicker',
    title: 'Stimulation Clicker — Free Online Aim & Click Speed Trainer | Reflex Lab',
    desc:  'Free stimulation clicker aim trainer. Hit moving targets to improve mouse accuracy and click speed simultaneously. Perfect for FPS, Valorant, CS2 and Fortnite players. No download needed.',
    h1:    'Stimulation Clicker'
  },
  'cps':         {
    path: '/click-speed-test',
    title: 'Click Speed Test (CPS Test) — How Fast Can You Click? | Reflex Lab',
    desc:  'Free CPS test — measure your clicks per second instantly. 8 durations from 1 to 100 seconds. Average is 6–7 CPS. Compare your score and track improvements. Works on PC, Mac and mobile.',
    h1:    'Click Speed Test'
  },
  'jitter':      {
    path: '/jitter-click-test',
    title: 'Jitter Click Test — Practice Jitter Clicking & Measure CPS | Reflex Lab',
    desc:  'Free jitter click test. Practice the jitter clicking technique used in Minecraft PvP and measure your clicks per second. Tense your arm to vibrate and achieve maximum CPS. Compare against world averages.',
    h1:    'Jitter Click Test'
  },
  'spacebar':    {
    path: '/spacebar-speed-test',
    title: 'Spacebar Speed Test — Hits Per Second Counter | Reflex Lab',
    desc:  'Free spacebar speed test. Measure how many times you can press the spacebar per second. Choose from multiple durations and challenge your friends. Track your HPS and set a personal record.',
    h1:    'Spacebar Speed Test'
  },
  'dino':        {
    path: '/dinosaur-game',
    title: 'Dinosaur Game Online — Free Chrome T-Rex Runner | Reflex Lab',
    desc:  'Play the Chrome Dinosaur Game online for free — no internet needed. Jump over cacti, duck under pterodactyls, survive as long as possible. The classic Google T-Rex runner available anytime in your browser.',
    h1:    'Dinosaur Game'
  },
  'typing':      {
    path: '/typing-speed-test',
    title: 'Typing Speed Test — Free WPM Test Online | Reflex Lab',
    desc:  'Free typing speed test — measure your WPM (words per minute) and accuracy instantly. Real-time tracking, no sign-up needed. Average typing speed is 41 WPM — how fast do you type?',
    h1:    'Typing Speed Test'
  },
  'coreball':    {
    path: '/coreball-game',
    title: 'Coreball Game Online — Free Ball Shooting Puzzle Game | Reflex Lab',
    desc:  'Play Coreball online for free. Shoot balls onto the rotating core without hitting existing ones. Multi-level puzzle game with increasing difficulty. How far can you go?',
    h1:    'Coreball Game'
  },
  'memory':      {
    path: '/number-memory-test',
    title: 'Number Memory Test — Working Memory Test Online | Reflex Lab',
    desc:  'Free number memory test — how many digits can you memorize? Tests your working memory capacity. Average adults remember 5–7 digits (Miller\'s Law). Can you beat the average? No download needed.',
    h1:    'Number Memory Test'
  },
  'snake': {
    path: '/snake-game',
    title: 'Snake Game Online — Free Classic Snake | Reflex Lab',
    desc:  'Play the classic Snake game online for free. Eat food to grow, avoid hitting yourself. Arrow keys or swipe to control. How long can you survive?',
    h1:    'Snake Game'
  },
  'clicker': {
    path: '/clicker-tycoon',
    title: 'Clicker Tycoon — Idle Clicking Game Online Free | Reflex Lab',
    desc:  'Free idle clicker tycoon game. Click to earn coins, buy upgrades, unlock passive income and prestige for massive multipliers. How rich can you get?',
    h1:    'Clicker Tycoon'
  }
};

// Reverse map: URL path → panel key
const PATH_TO_PANEL = {};
Object.entries(ROUTES).forEach(([k, v]) => { PATH_TO_PANEL[v.path] = k; });

function routerUpdate(p) {
  const route = ROUTES[p] || ROUTES['reaction'];
  try { history.pushState({ panel: p }, route.title, route.path); } catch(e) {}
  document.title = route.title;
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc) metaDesc.setAttribute('content', route.desc);
  const canonical = document.querySelector('link[rel="canonical"]');
  if (canonical) canonical.setAttribute('href', 'https://reactionspeedtest.com' + route.path);
  const ogTitle = document.querySelector('meta[property="og:title"]');
  const ogDesc  = document.querySelector('meta[property="og:description"]');
  const ogUrl   = document.querySelector('meta[property="og:url"]');
  if (ogTitle) ogTitle.setAttribute('content', route.title);
  if (ogDesc)  ogDesc.setAttribute('content', route.desc);
  if (ogUrl)   ogUrl.setAttribute('content', 'https://reactionspeedtest.com' + route.path);
}

// Handle browser back/forward
window.addEventListener('popstate', e => {
  const panel = e.state?.panel || panelFromPath(location.pathname);
  if (panel) switchPanel(panel, true); // true = skip pushState
});

function panelFromPath(path) {
  return PATH_TO_PANEL[path] || 'reaction';
}

function switchPanel(p, fromPopstate) {
  curPanel = p;
  if (!fromPopstate) routerUpdate(p);

  // Tab highlight
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.panel === p));

  // Map jitter/kohi → cps panel
  const allPanels = ['cps','spacebar','reaction','stimulation','typing','coreball','dino','memory','snake','clicker'];
  allPanels.forEach(id => {
    const el = document.getElementById('panel-' + id);
    if (el) el.style.display = 'none';
  });
  const target = ['jitter','cps'].includes(p) ? 'cps' : p;
  const panelEl = document.getElementById('panel-' + target);
  if (panelEl) { panelEl.style.display = 'flex'; panelEl.style.flexDirection = 'column'; }

  // Row2: hide for reaction, stim, typing, coreball
  const row2 = document.getElementById('row2');
  const hideRow2 = ['reaction','stimulation','typing','coreball','dino','memory','snake','clicker'].includes(p);
  row2.classList.toggle('hidden', hideRow2);
  document.querySelector('.wrap').style.paddingTop =
    hideRow2 ? 'var(--row1-h)' : 'var(--header-h)';

  // Update CPS panel title per mode
  const titles = {
    cps:    ['Click Speed Test',  `${curDuration}s — click as fast as you can`],
    jitter: ['Jitter Click Test', `${curDuration}s — tense & vibrate for max speed`],
  };
  if (titles[p]) {
    document.getElementById('cpsH1').textContent = titles[p][0];
    document.getElementById('cpsSub').textContent = titles[p][1];
  }

  // Reset
  if (target === 'cps')    resetCPS();
  if (p === 'stimulation') resetStim();

  // Switch info section
  const infoMap = { reaction:'reaction', stimulation:'stimulation', cps:'cps', jitter:'cps', spacebar:'spacebar', typing:'typing', coreball:'coreball', dino:'dino', memory:'memory', snake:'snake', clicker:'clicker' };
  document.querySelectorAll('.info-section').forEach(s => s.style.display = 'none');
  const infoKey = infoMap[p] || 'reaction';
  const infoEl = document.querySelector(`.info-section[data-info="${infoKey}"]`);
  if (infoEl) infoEl.style.display = 'block';
}

/* ═══════════════════════════════════════════
   DURATION SELECTOR
═══════════════════════════════════════════ */
function setDuration(s) {
  curDuration = s;
  document.querySelectorAll('.tbtn').forEach(b => b.classList.toggle('active', +b.dataset.s === s));
  document.getElementById('cTime').textContent = s.toFixed(1);
  document.getElementById('sTime').textContent = s.toFixed(1);
  // Update subtitle
  const sub = document.getElementById('cpsSub');
  if (sub) {
    const map = { cps:'click as fast as you can', jitter:'tense & vibrate for max speed' };
    sub.textContent = `${s}s — ${map[curPanel] || 'click as fast as you can'}`;
  }
  const sSub = document.getElementById('sSub');
  if (sSub) sSub.textContent = `${s} seconds — press spacebar as fast as you can`;
  resetCPS();
  resetSpace();
}

function setClickMode(m) {
  clickMode = m;
  document.getElementById('modeNormal').classList.toggle('active', m === 'normal');
  document.getElementById('modeChallenge').classList.toggle('active', m === 'challenge');
  document.getElementById('challengeTip').style.display = m === 'challenge' ? 'block' : 'none';
  resetCPS();
}

/* ═══════════════════════════════════════════
   CPS GAME ENGINE (shared: cps / jitter / kohi)
   Includes working Challenge Mode
═══════════════════════════════════════════ */
const CPS_RANKS = [
  { min:15, label:'⚡ GOD MODE', color:'#ff2d55' },
  { min:11, label:'🐆 CHEETAH',  color:'#ffe000' },
  { min:8,  label:'⚡ FAST',     color:'#00f5a0' },
  { min:5,  label:'🐇 NORMAL',   color:'#7b61ff' },
  { min:0,  label:'🐢 TURTLE',   color:'#50507a' },
];
function getCPSRank(c) { return CPS_RANKS.find(r => c >= r.min) || CPS_RANKS[CPS_RANKS.length-1]; }

let cg = { clicks:0, running:false, ts:null, iv:null, best:0, combo:0, chTargets:[], chSpawnTimer:null };

const clickArena = document.getElementById('clickArena');
const bigCPS     = document.getElementById('bigCPS');
const cLabel     = document.getElementById('cLabel');
const cProg      = document.getElementById('cProg');
const cProgFill  = document.getElementById('cProgFill');
const cResult    = document.getElementById('cResult');
const rScore     = document.getElementById('rScore');
const rRank      = document.getElementById('rRank');
const comboBadge = document.getElementById('comboBadge');

function resetCPS() {
  clearInterval(cg.iv);
  clearTimeout(cg.chSpawnTimer);
  cg.chTargets.forEach(t => { clearTimeout(t.timer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  cg = { clicks:0, running:false, ts:null, iv:null, best:0, combo:0, chTargets:[], chSpawnTimer:null };
  clickArena.className = 'click-arena idle';
  bigCPS.textContent = '0'; bigCPS.style.color = 'var(--accent)';
  cLabel.textContent = 'Click Here to Start';
  cProg.style.display = 'none'; cProgFill.style.width = '100%';
  cResult.classList.remove('show');
  comboBadge.classList.remove('show');
  bigCPS.style.opacity  = '';
  cLabel.style.opacity  = '';
  cProg.style.opacity   = '';
  document.getElementById('cStat').textContent = '0';
  document.getElementById('cClicks').textContent = '0';
  document.getElementById('cBest').textContent = '—';
  document.getElementById('cTime').textContent = curDuration.toFixed(1);
}

/* Challenge mode: spawn small targets inside the arena that must be clicked */
function spawnChallengeTarget() {
  if (!cg.running || clickMode !== 'challenge') return;
  const W = clickArena.clientWidth, H = clickArena.clientHeight;
  const s = 44;
  const x = 14 + Math.random() * (W - s - 28);
  const y = 14 + Math.random() * (H - s - 28);

  const colors = ['#ff2d55','#ff6b00','#ffe000','#00f5a0','#7b61ff'];
  const col = colors[Math.floor(Math.random()*colors.length)];

  const el = document.createElement('div');
  el.className = 'ch-target';
  el.style.cssText = `left:${x}px;top:${y}px;width:${s}px;height:${s}px;background:${col}22;border:2.5px solid ${col};`;
  el.textContent = '✕';

  // Shrinking ring shows time pressure
  const ring = document.createElement('div');
  ring.className = 'ch-shrink-ring';
  ring.style.animationDuration = '0.9s';
  el.appendChild(ring);

  const tObj = { el, hit:false, timer:null };
  cg.chTargets.push(tObj);

  el.addEventListener('click', e => {
    e.stopPropagation();
    if (tObj.hit) return;
    tObj.hit = true; clearTimeout(tObj.timer);
    cg.combo++;
    comboBadge.textContent = `⚡ COMBO ×${cg.combo}`;
    comboBadge.classList.add('show');
    // Bonus click
    cg.clicks += Math.min(cg.combo, 5);
    el.style.transform = 'scale(1.5)'; el.style.opacity = '0';
    setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 100);
    cg.chTargets = cg.chTargets.filter(t => t !== tObj);
  });

  // Auto-expire
  tObj.timer = setTimeout(() => {
    if (!tObj.hit && el.parentNode) {
      el.parentNode.removeChild(el);
      cg.combo = 0;
      comboBadge.textContent = 'MISS! Combo Reset';
      setTimeout(() => comboBadge.classList.remove('show'), 800);
    }
    cg.chTargets = cg.chTargets.filter(t => t !== tObj);
  }, 950);

  clickArena.appendChild(el);

  // Next spawn — faster as time progresses
  const elapsed = cg.ts ? (Date.now() - cg.ts) / 1000 : 0;
  const spawnDelay = Math.max(500, 1200 - elapsed * 10);
  cg.chSpawnTimer = setTimeout(spawnChallengeTarget, spawnDelay);
}

function cgTick() {
  const elapsed = (Date.now() - cg.ts) / 1000;
  const rem = Math.max(0, curDuration - elapsed);
  const cps = elapsed > 0 ? +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2) : 0;
  bigCPS.textContent = cps.toFixed(1);
  document.getElementById('cStat').textContent = cps.toFixed(1);
  document.getElementById('cClicks').textContent = cg.clicks;
  document.getElementById('cTime').textContent = rem.toFixed(1);
  cProgFill.style.width = (rem / curDuration * 100) + '%';
  if (cps > cg.best) { cg.best = cps; document.getElementById('cBest').textContent = cps.toFixed(1); }
  if (rem <= 0) cgFinish();
}

function cgFinish() {
  clearInterval(cg.iv); cg.running = false;
  clearTimeout(cg.chSpawnTimer);
  cg.chTargets.forEach(t => { clearTimeout(t.timer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  cg.chTargets = [];
  comboBadge.classList.remove('show');
  const elapsed = Math.min(curDuration, (Date.now() - cg.ts) / 1000);
  const final = +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  bigCPS.textContent = final.toFixed(1);
  document.getElementById('cTime').textContent = '0.0';
  cProgFill.style.width = '0%';
  clickArena.className = 'click-arena done';
  const rank = getCPSRank(final);
  rScore.textContent = final.toFixed(1);
  rScore.style.color = rank.color;
  rRank.textContent = rank.label;
  rRank.style.cssText = `color:${rank.color};background:${rank.color}20;border:1px solid ${rank.color}55`;
  // New record badge
  const prevBest = parseFloat(document.getElementById('cBest').textContent) || 0;
  const newRecordEl = document.getElementById('cNewRecord');
  if (newRecordEl) newRecordEl.style.display = final > prevBest ? 'block' : 'none';
  cResult.classList.add('show');
  bigCPS.style.opacity = '0.07';
  cLabel.style.opacity = '0.04';
  cProg.style.opacity  = '0.04';
}

function cgClick(e) {
  if (e && e.target && e.target.classList.contains('ch-target')) return; // let target handle it
  if (cResult.classList.contains('show')) return;
  if (!cg.running) {
    cg.running = true; cg.ts = Date.now(); cg.clicks = 0;
    if (clickMode === 'challenge') {
      clickArena.className = 'click-arena running challenge-active';
      cLabel.textContent = '⚡ Hit targets for combos!';
      comboBadge.classList.add('show');
      comboBadge.textContent = 'CHALLENGE MODE!';
      setTimeout(spawnChallengeTarget, 600);
    } else {
      clickArena.className = 'click-arena running';
      cLabel.textContent = 'Keep clicking!';
    }
    cProg.style.display = 'block';
    cg.iv = setInterval(cgTick, 80);
  }
  cg.clicks++;
  cgTick();
}

clickArena.addEventListener('click', cgClick);
clickArena.addEventListener('touchstart', e => { e.preventDefault(); cgClick(e); }, {passive:false});

/* ═══════════════════════════════════════════
   SPACEBAR GAME
═══════════════════════════════════════════ */
let sg = { clicks:0, running:false, ts:null, iv:null, best:0 };

const spaceArena = document.getElementById('spaceArena');
const spaceKey   = document.getElementById('spaceKey');
const sBig       = document.getElementById('sBig');
const sLabel     = document.getElementById('sLabel');
const sProg      = document.getElementById('sProg');
const sProgFill  = document.getElementById('sProgFill');
const sResult    = document.getElementById('sResult');

function resetSpace() {
  clearInterval(sg.iv);
  sg = { clicks:0, running:false, ts:null, iv:null, best:0 };
  spaceArena.className = 'click-arena idle';
  sBig.textContent = '0';
  sLabel.textContent = 'Press Space Key or Tap Above to Start';
  sProg.style.display = 'none'; sProgFill.style.width = '100%';
  sResult.classList.remove('show');
  sBig.style.opacity   = '';
  sLabel.style.opacity = '';
  sProg.style.opacity  = '';
  document.getElementById('sCPS').textContent = '0';
  document.getElementById('sClicks').textContent = '0';
  document.getElementById('sBest').textContent = '—';
  document.getElementById('sTime').textContent = curDuration.toFixed(1);
}

function sgTick() {
  const elapsed = (Date.now() - sg.ts) / 1000;
  const rem = Math.max(0, curDuration - elapsed);
  const cps = +(sg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  sBig.textContent = cps.toFixed(1);
  document.getElementById('sCPS').textContent = cps.toFixed(1);
  document.getElementById('sClicks').textContent = sg.clicks;
  document.getElementById('sTime').textContent = rem.toFixed(1);
  sProgFill.style.width = (rem / curDuration * 100) + '%';
  if (cps > sg.best) { sg.best = cps; document.getElementById('sBest').textContent = cps.toFixed(1); }
  if (rem <= 0) sgFinish();
}

function sgFinish() {
  clearInterval(sg.iv); sg.running = false;
  const elapsed = Math.min(curDuration, (Date.now() - sg.ts) / 1000);
  const final = +(sg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  sBig.textContent = final.toFixed(1);
  document.getElementById('sTime').textContent = '0.0';
  sProgFill.style.width = '0%';
  spaceArena.className = 'click-arena done';
  document.getElementById('srScore').textContent = final.toFixed(1);
  sResult.classList.add('show');
  sBig.style.opacity   = '0.07';
  sLabel.style.opacity = '0.04';
  sProg.style.opacity  = '0.04';
}

function sgClick() {
  if (sResult.classList.contains('show')) return;
  if (!sg.running) {
    sg.running = true; sg.ts = Date.now(); sg.clicks = 0;
    spaceArena.className = 'click-arena running';
    sLabel.textContent = 'Keep pressing!';
    sProg.style.display = 'block';
    sg.iv = setInterval(sgTick, 80);
  }
  sg.clicks++;
  sgTick();
}

spaceArena.addEventListener('click', sgClick);
spaceArena.addEventListener('touchstart', e => { e.preventDefault(); sgClick(); }, {passive:false});
spaceKey.addEventListener('click', sgClick);
spaceKey.addEventListener('touchstart', e => { e.preventDefault(); sgClick(); }, {passive:false});
document.addEventListener('keydown', e => {
  if (e.code === 'Space' && curPanel === 'spacebar') {
    e.preventDefault();
    if (e.repeat) return; // ignore held-down key repeats
    spaceKey.classList.add('down');
    sgClick();
  }
});
document.addEventListener('keyup', e => { if (e.code === 'Space') spaceKey.classList.remove('down'); });

/* ═══════════════════════════════════════════
   REACTION GAME
═══════════════════════════════════════════ */
const ROUNDS = 5, DMIN = 1500, DMAX = 4500;
let rState = 'idle', rStartMs = 0, rTimer = null, rRound = 0, rResults = [], rScore2 = 0;

const reactArena = document.getElementById('reactArena');
const rIcon = document.getElementById('rIcon');
const rText = document.getElementById('rText');
const rSub  = document.getElementById('rSub');
const rDisp = document.getElementById('rDisp');
const rBest = document.getElementById('rBest');
const rAvg  = document.getElementById('rAvg');
const rRound2 = document.getElementById('rRound');
const rdots = document.getElementById('rdots').children;
const hist  = document.getElementById('hist');
const gover = document.getElementById('gover');

function setRArena(icon, text, sub, cls) {
  rIcon.textContent = icon; rText.textContent = text; rSub.textContent = sub;
  reactArena.className = 'reaction-arena ' + cls;
}
function updateDots() {
  for (let i = 0; i < ROUNDS; i++) {
    rdots[i].className = 'dot';
    if (i < rResults.length) rdots[i].classList.add(rResults[i]==='early'?'fail':'done');
    else if (i === rResults.length && rState !== 'gameover') rdots[i].classList.add('current');
  }
}
function rRating(ms) {
  const r = [
    {l:150,t:'⚡ LEGENDARY',c:'#ffe000'},{l:200,t:'🔥 PERFECT',c:'#00f5a0'},
    {l:250,t:'✅ GREAT',c:'#00f5a0'},{l:320,t:'👍 GOOD',c:'#80f0c0'},
    {l:400,t:'😐 AVERAGE',c:'#aaaacc'},{l:Infinity,t:'🐢 SLOW',c:'#ff6b00'}
  ];
  return r.find(x => ms < x.l);
}
function rPts(ms){ return ms<150?1000:ms<200?800:ms<250?600:ms<320?400:ms<400?200:100; }
function updateRStats() {
  const valid = rResults.filter(r=>r!=='early');
  const avg = valid.length ? Math.round(valid.reduce((a,b)=>a+b,0)/valid.length) : null;
  const best = valid.length ? Math.min(...valid) : null;
  const sv = v => v!==null ? v+'ms' : '---';
  rDisp.textContent = rScore2;
  rBest.textContent = sv(best);
  rAvg.textContent  = sv(avg);
  rRound2.textContent = rRound+'/'+ROUNDS;
}
function addChip(ms, isBest, isFail) {
  const c = document.createElement('div');
  c.className = 'hchip'+(isFail?' fail':isBest?' best':'');
  c.textContent = isFail ? 'EARLY' : ms+'ms';
  hist.appendChild(c);
}

function startRound() {
  if (rRound >= ROUNDS) { endReaction(); return; }
  rState = 'waiting';
  setRArena('⏳','Wait...','Tap when it turns green!','s-ready'); updateDots();
  rTimer = setTimeout(()=>{
    rState='ready'; rStartMs=Date.now();
    setRArena('🟢','TAP NOW!','Hit it!','s-go');
  }, DMIN + Math.random()*(DMAX-DMIN));
}

function handleReactionTap() {
  if (rState==='idle'||rState==='gameover') { resetReaction(); setTimeout(startRound,600); return; }
  if (rState==='waiting') {
    clearTimeout(rTimer); rState='early';
    rResults.push('early'); rRound++;
    rScore2 = Math.max(0, rScore2-200);
    setRArena('💥','TOO EARLY!','-200 pts — Be more patient','s-early');
    addChip(null,false,true); updateRStats(); updateDots();
    setTimeout(()=>startRound(),1600); return;
  }
  if (rState==='ready') {
    const ms = Date.now()-rStartMs; rState='result';
    const pts = rPts(ms); rScore2+=pts; rResults.push(ms); rRound++;
    const valid = rResults.filter(r=>r!=='early');
    const isBest = valid.length===1||ms===Math.min(...valid);
    const rat = rRating(ms);
    addChip(ms,isBest,false); updateRStats(); updateDots();
    rIcon.textContent = '✅';
    rText.innerHTML = `<span class="ms-big">${ms}</span>`;
    rSub.innerHTML  = `<span class="ms-unit">MILLISECONDS</span>`;
    reactArena.className = 'reaction-arena s-done';
    const pill = document.createElement('div');
    pill.className='rat-pill';
    pill.style.cssText=`background:${rat.c}20;color:${rat.c};border:1px solid ${rat.c}55`;
    pill.textContent=rat.t+`  +${pts} pts`;
    reactArena.appendChild(pill);
    setTimeout(()=>{
      if(pill.parentNode)pill.parentNode.removeChild(pill);
      if(rRound>=ROUNDS)endReaction(); else startRound();
    }, 1400);
  }
}

function endReaction() {
  rState='gameover';
  const valid=rResults.filter(r=>r!=='early');
  const best=valid.length?Math.min(...valid):null;
  const avg=valid.length?Math.round(valid.reduce((a,b)=>a+b,0)/valid.length):null;
  setRArena('🏆','Game Over!','Check your results','s-done');
  let title='🏆 GAME OVER';
  if(rScore2>=4000)title='⚡ LEGENDARY!';
  else if(rScore2>=3000)title='🔥 PERFECT!';
  document.getElementById('goTitle').textContent=title;
  document.getElementById('goBest').textContent=best?best+'ms':'---';
  document.getElementById('goAvg').textContent=avg?avg+'ms':'---';
  document.getElementById('goScore').textContent=rScore2;
  gover.classList.add('show'); updateDots();
}

function resetReaction() {
  rResults=[]; rScore2=0; rRound=0; hist.innerHTML='';
  gover.classList.remove('show'); rState='idle';
  setRArena('⚡','Tap to Start','Test your reaction speed','s-wait');
  rDisp.textContent='0'; rBest.textContent='---'; rAvg.textContent='---'; rRound2.textContent='0/5';
  for(let i=0;i<ROUNDS;i++) rdots[i].className='dot';
}

reactArena.addEventListener('click', handleReactionTap);
reactArena.addEventListener('touchstart', e=>{e.preventDefault();handleReactionTap();},{passive:false});
document.getElementById('replayBtn').addEventListener('click', ()=>{resetReaction();setTimeout(startRound,600);});

/* ═══════════════════════════════════════════
   STIMULATION CLICKER
═══════════════════════════════════════════ */
const STIM_CONFIGS = {
  easy:   { size:80, lifetime:1200, interval:800,  pts:100 },
  medium: { size:55, lifetime:800,  interval:580,  pts:200 },
  hard:   { size:38, lifetime:500,  interval:380,  pts:400 },
};
const STIM_DURATION = 30;
let stim = { running:false, score:0, hits:0, misses:0, timeLeft:STIM_DURATION, iv:null, spawnTimer:null };
let activeTargets = [];

function setStimDiff(d) {
  stimDiff = d;
  ['easy','medium','hard'].forEach(x => {
    const b = document.getElementById('db'+x.charAt(0).toUpperCase()+x.slice(1));
    b.classList.toggle('selected', x === d);
  });
}

function resetStim() {
  clearInterval(stim.iv); clearTimeout(stim.spawnTimer);
  activeTargets.forEach(t => { clearTimeout(t.expTimer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  activeTargets = [];
  stim = { running:false, score:0, hits:0, misses:0, timeLeft:STIM_DURATION, iv:null, spawnTimer:null };
  document.getElementById('stScore').textContent = '0';
  document.getElementById('stHits').textContent  = '0';
  document.getElementById('stAcc').textContent   = '—';
  document.getElementById('stTime').textContent  = STIM_DURATION.toFixed(1);
  document.getElementById('stimResult').classList.remove('show');
  document.getElementById('stimIdle').style.display = 'flex';
}

function startStim() {
  document.getElementById('stimIdle').style.display = 'none';
  stim.running = true;
  stim.timeLeft = STIM_DURATION;

  stim.iv = setInterval(() => {
    stim.timeLeft = Math.max(0, +(stim.timeLeft - 0.1).toFixed(1));
    document.getElementById('stTime').textContent = stim.timeLeft.toFixed(1);
    if (stim.timeLeft <= 0) finishStim();
  }, 100);

  spawnTarget();
}

function spawnTarget() {
  if (!stim.running) return;
  const cfg = STIM_CONFIGS[stimDiff];
  const arena = document.getElementById('stimArena');
  const W = arena.clientWidth, H = arena.clientHeight;
  const s = cfg.size;
  const x = Math.max(5, Math.random() * (W - s - 10));
  const y = Math.max(5, Math.random() * (H - s - 10));

  const palette = [
    ['#00f5a0','#003d29'], ['#ff2d55','#3d000d'],
    ['#ffe000','#3d3700'], ['#7b61ff','#1e0f4a'], ['#ff6b00','#3d1a00']
  ];
  const [col, bg] = palette[Math.floor(Math.random() * palette.length)];

  const el = document.createElement('div');
  el.className = 'stim-target';
  el.style.cssText = `left:${x}px;top:${y}px;width:${s}px;height:${s}px;background:${bg};border:3px solid ${col};`;

  // Shrinking ring
  const ring = document.createElement('div');
  ring.className = 'target-ring';
  ring.style.cssText = `border:2px solid ${col};`;
  el.appendChild(ring);

  // Hit handler
  const tObj = { el, hit:false, expTimer:null };
  activeTargets.push(tObj);

  el.addEventListener('click', e => {
    e.stopPropagation();
    if (tObj.hit) return;
    tObj.hit = true;
    clearTimeout(tObj.expTimer);
    stim.hits++;
    stim.score += cfg.pts;
    document.getElementById('stScore').textContent = stim.score;
    document.getElementById('stHits').textContent  = stim.hits;
    updateStimAcc();
    // Hit popup
    const popup = document.createElement('div');
    popup.className = 'hit-popup';
    popup.style.cssText = `left:${x+s/2}px;top:${y}px;color:${col}`;
    popup.textContent = '+' + cfg.pts;
    arena.appendChild(popup);
    setTimeout(() => { if(popup.parentNode) popup.parentNode.removeChild(popup); }, 500);
    // Remove target
    el.style.transition = 'transform 0.1s, opacity 0.1s';
    el.style.transform = 'scale(1.4)'; el.style.opacity = '0';
    setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 120);
    activeTargets = activeTargets.filter(t => t !== tObj);
  });

  // Expiry
  tObj.expTimer = setTimeout(() => {
    if (!tObj.hit && el.parentNode) {
      el.parentNode.removeChild(el);
      stim.misses++;
      updateStimAcc();
      activeTargets = activeTargets.filter(t => t !== tObj);
    }
  }, cfg.lifetime);

  arena.appendChild(el);

  // Next spawn
  stim.spawnTimer = setTimeout(spawnTarget, cfg.interval);
}

function updateStimAcc() {
  const total = stim.hits + stim.misses;
  document.getElementById('stAcc').textContent = total > 0
    ? Math.round(stim.hits / total * 100) + '%' : '—';
}

function finishStim() {
  clearInterval(stim.iv); clearTimeout(stim.spawnTimer);
  stim.running = false;
  activeTargets.forEach(t => { clearTimeout(t.expTimer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  activeTargets = [];

  const acc = stim.hits + stim.misses > 0
    ? Math.round(stim.hits / (stim.hits + stim.misses) * 100) : 0;

  let rank = '🐢 BEGINNER', rankColor = '#50507a';
  if      (stim.score >= 9000) { rank = '⚡ GOD TIER';  rankColor = '#ff2d55'; }
  else if (stim.score >= 6000) { rank = '🐆 ELITE';     rankColor = '#ffe000'; }
  else if (stim.score >= 3500) { rank = '⚡ SKILLED';   rankColor = '#00f5a0'; }
  else if (stim.score >= 1500) { rank = '🐇 AVERAGE';   rankColor = '#7b61ff'; }

  document.getElementById('stFinalScore').textContent = stim.score;
  document.getElementById('stFinalScore').style.color = rankColor;
  document.getElementById('stFinalAcc').textContent   = acc + '%';
  document.getElementById('stFinalRank').textContent  = rank;
  document.getElementById('stFinalRank').style.color  = rankColor;
  document.getElementById('stimResult').classList.add('show');
}

// Click on arena background = miss
document.getElementById('stimArena').addEventListener('click', e => {
  if (!stim.running) return;
  if (e.target.id === 'stimArena' || e.target === document.getElementById('stimArena')) {
    stim.misses++;
    updateStimAcc();
    // Miss flash
    const flash = document.createElement('div');
    flash.className = 'miss-flash';
    const rect = document.getElementById('stimArena').getBoundingClientRect();
    flash.style.left = (e.clientX - rect.left) + 'px';
    flash.style.top  = (e.clientY - rect.top) + 'px';
    document.getElementById('stimArena').appendChild(flash);
    setTimeout(() => { if(flash.parentNode) flash.parentNode.removeChild(flash); }, 400);
  }
});

/* ═══════════════════════════════════════════
   FAQ ACCORDION
═══════════════════════════════════════════ */
document.querySelectorAll('.faq-q').forEach(btn => {
  btn.addEventListener('click', () => {
    const item = btn.closest('.faq-item');
    const open = item.classList.contains('open');
    document.querySelectorAll('.faq-item.open').forEach(el => {
      el.classList.remove('open');
      el.querySelector('.faq-q').setAttribute('aria-expanded','false');
    });
    if (!open) { item.classList.add('open'); btn.setAttribute('aria-expanded','true'); }
  });
});

/* ═══════════════════════════════════════════
   LANGUAGE SYSTEM (EN / TR)
═══════════════════════════════════════════ */
const TRANSLATIONS = {
  en: {
    // nav
    tabReaction:'⚡ Reaction', tabStimulation:'🎯 Stimulation', tabCPS:'🔥 Click Speed',
    tabJitter:'🖱 Jitter Click', tabKohi:'☕ Kohi Click', tabSpacebar:'⌨️ Spacebar',
    durLabel:'Duration', modeLabel:'Mode', modeNormal:'🖱 Normal', modeChallenge:'⚡ Challenge',
    // cps panel
    cpsH1_cps:'Click Speed Test', cpsH1_jitter:'Jitter Click Test', cpsH1_kohi:'Kohi Click Test',
    cpsSubSuffix_cps:'click as fast as you can', cpsSubSuffix_jitter:'tense & vibrate for max speed', cpsSubSuffix_kohi:'sustained CPS endurance',
    cpsClickStart:'Click Here to Start', cpsKeepClick:'Keep clicking!', cpsChallengeStart:'⚡ Hit targets for combos!', cpsTip:'⚡ CHALLENGE MODE — Hit targets for bonus clicks!',
    lCPS:'CPS', lClicks:'Clicks', lBestCPS:'Best CPS', lTimeLeft:'Time Left',
    rYourScore:'Your Score', rCPS:'Clicks Per Second', rRetry:'↺ Try Again',
    // spacebar
    sTitle:'Spacebar Speed Test', sPressSec:'Press/sec', sTotalPress:'Total Presses', sBest:'Best',
    sStart:'Press Space Key or Tap Above to Start', sKeep:'Keep pressing!',
    rPPS:'Presses Per Second',
    // reaction
    rTitle:'Reaction Speed Test', rSub5r:'5 rounds — tap when the arena turns green',
    rScore:'Score', rBest:'Best', rAvg:'Average', rRound:'Round', rProgress:'Round Progress',
    rWaitTxt:'Wait...', rWaitSub:'Tap when it turns green!', rGoTxt:'TAP NOW!', rGoSub:'Hit it!',
    rEarlyTxt:'TOO EARLY!', rEarlySub:'-200 pts — Be more patient',
    rOverTxt:'Game Over!', rOverSub:'Check your results',
    rFastLB:'Fastest', rAvgLB:'Average', rScoreLB:'Score', rPlayAgain:'↺ Play Again',
    rTapStart:'Tap to Start', rTestSub:'Test your reaction speed',
    // stim
    stTitle:'Stimulation Clicker', stSub:'Click the targets before they disappear',
    stScore:'Score', stHits:'Targets Hit', stAcc:'Accuracy',
    stIdleSub:'Choose difficulty and start', stStart:'▶ START', stReplay:'↺ Play Again',
    stFinalLbl:'Final Score', stAccLbl:'Accuracy:',
    // info
    aboutTitle:'ABOUT THE TESTS', worldTitle:'WORLD RECORDS', reactionTitle:'REACTION TIME',
    // footer
    footCopy:'Reaction Speed Test — Free Online CPS & Reaction Time Tester',
    footSub:'Test your click speed, jitter click, Kohi click, spacebar speed, and reaction time for free. No downloads. No registration.',
    // challenge tip
    challengeTipText:'⚡ CHALLENGE MODE — Hit targets for bonus clicks!',
    // stim idle title
    stimIdleTitle:'Stimulation Clicker',
  },
  tr: {
    tabReaction:'⚡ Tepki Testi', tabStimulation:'🎯 Hedef Tıklama', tabCPS:'🔥 Tıklama Hızı',
    tabJitter:'🖱 Jitter Tıklama', tabKohi:'☕ Kohi Testi', tabSpacebar:'⌨️ Boşluk Çubuğu',
    durLabel:'Süre', modeLabel:'Mod', modeNormal:'🖱 Normal', modeChallenge:'⚡ Zorlu',
    cpsH1_cps:'Tıklama Hızı Testi', cpsH1_jitter:'Jitter Tıklama Testi', cpsH1_kohi:'Kohi Tıklama Testi',
    cpsSubSuffix_cps:'olabildiğince hızlı tıkla', cpsSubSuffix_jitter:'titretme tekniğiyle max hız', cpsSubSuffix_kohi:'sürdürülebilir TPS testi',
    cpsClickStart:'Başlamak için Tıkla', cpsKeepClick:'Tıklamaya devam et!', cpsChallengeStart:'⚡ Hedeflere tıkla, kombo yap!', cpsTip:'⚡ ZORLU MOD — Hedeflere tıkla, bonus kazan!',
    lCPS:'TPS', lClicks:'Tıklama', lBestCPS:'En İyi TPS', lTimeLeft:'Kalan Süre',
    rYourScore:'Skorun', rCPS:'Saniye Başına Tıklama', rRetry:'↺ Tekrar Dene',
    sTitle:'Boşluk Çubuğu Testi', sPressSec:'Basış/sn', sTotalPress:'Toplam Basış', sBest:'En İyi',
    sStart:'Boşluk tuşuna bas veya yukarıya dokun', sKeep:'Basmaya devam et!',
    rPPS:'Saniye Başına Basış',
    rTitle:'Tepki Hızı Testi', rSub5r:'5 tur — alan yeşile dönünce dokun',
    rScore:'Skor', rBest:'En İyi', rAvg:'Ortalama', rRound:'Tur', rProgress:'Tur Takibi',
    rWaitTxt:'Bekle...', rWaitSub:'Alan yeşile dönünce dokun!', rGoTxt:'DOKUN!', rGoSub:'Hadi!',
    rEarlyTxt:'ÇOK ERKEN!', rEarlySub:'-200 puan — Daha sabırlı ol',
    rOverTxt:'Oyun Bitti!', rOverSub:'Sonuçlarına bak',
    rFastLB:'En Hızlı', rAvgLB:'Ortalama', rScoreLB:'Skor', rPlayAgain:'↺ Tekrar Oyna',
    rTapStart:'Başlamak için Dokun', rTestSub:'Tepki hızını test et',
    stTitle:'Hedef Tıklama', stSub:'Hedefler kaybolmadan önce tıkla',
    stScore:'Skor', stHits:'Hedef İsabeti', stAcc:'İsabet Oranı',
    stIdleSub:'Zorluk seç ve başla', stStart:'▶ BAŞLA', stReplay:'↺ Tekrar Oyna',
    stFinalLbl:'Final Skor', stAccLbl:'İsabet:',
    aboutTitle:'TESTLER HAKKINDA', worldTitle:'DÜNYA REKORLARI', reactionTitle:'TEPKİ SÜRESİ',
    footCopy:'Tepki Testi — Ücretsiz Online TPS & Tepki Süresi Testi',
    footSub:'Tıklama hızı, jitter tıklama, Kohi, boşluk çubuğu ve tepki süren testlerini ücretsiz dene. İndirme yok. Kayıt yok.',
    challengeTipText:'⚡ ZORLU MOD — Hedeflere tıkla, bonus kazan!',
    stimIdleTitle:'Hedef Tıklama',
  }
};

let currentLang = 'en';

function setLang(l) {
  currentLang = l;
  const _lbtnTR = document.getElementById('lbtnTR');
  const _lbtnEN = document.getElementById('lbtnEN');
  if (_lbtnTR) _lbtnTR.classList.toggle('active', l==='tr');
  if (_lbtnEN) _lbtnEN.classList.toggle('active', l==='en');
  document.documentElement.lang = l;
  const T = TRANSLATIONS[l];

  // Tabs
  const tabs = document.querySelectorAll('.tab[data-panel]');
  const tabMap = { reaction:'tabReaction', stimulation:'tabStimulation', cps:'tabCPS', jitter:'tabJitter', kohi:'tabKohi', spacebar:'tabSpacebar' };
  tabs.forEach(t => { if(tabMap[t.dataset.panel]) t.innerHTML = T[tabMap[t.dataset.panel]]; });

  // Row2 labels
  document.querySelectorAll('.row2-label')[0].textContent = T.durLabel;
  document.querySelectorAll('.row2-label')[1].textContent = T.modeLabel;
  document.getElementById('modeNormal').textContent = T.modeNormal;
  document.getElementById('modeChallenge').textContent = T.modeChallenge;

  // CPS panel
  const p = ['cps','jitter','kohi'].includes(curPanel) ? curPanel : 'cps';
  document.getElementById('cpsH1').textContent = T['cpsH1_'+p] || T.cpsH1_cps;
  document.getElementById('cpsSub').textContent = `${curDuration}s — ${T['cpsSubSuffix_'+p] || T.cpsSubSuffix_cps}`;
  document.querySelector('#clickArena .arena-label')?.textContent; // keep state
  document.getElementById('challengeTip').textContent = T.challengeTipText;

  // Stats labels CPS
  const sc = document.querySelectorAll('#panel-cps .slbl');
  if(sc.length>=4){ sc[0].textContent=T.lCPS; sc[1].textContent=T.lClicks; sc[2].textContent=T.lBestCPS; sc[3].textContent=T.lTimeLeft; }
  document.querySelector('#cResult .r-label').textContent = T.rYourScore;
  document.querySelector('#cResult .r-unit').textContent = T.rCPS;
  document.querySelector('#cResult .r-retry').textContent = T.rRetry;

  // Spacebar
  document.querySelector('#panel-spacebar h1').textContent = T.sTitle;
  const ss = document.querySelectorAll('#panel-spacebar .slbl');
  if(ss.length>=4){ ss[0].textContent=T.sPressSec; ss[1].textContent=T.sTotalPress; ss[2].textContent=T.sBest; ss[3].textContent=T.lTimeLeft; }
  document.querySelector('#sResult .r-label').textContent = T.rYourScore;
  document.querySelector('#sResult .r-unit').textContent = T.rPPS;
  document.querySelector('#sResult .r-retry').textContent = T.rRetry;

  // Reaction
  document.querySelector('#panel-reaction h1').textContent = T.rTitle;
  document.querySelector('#panel-reaction .gsub').textContent = T.rSub5r;
  document.getElementById('lScore').textContent = T.rScore;
  document.getElementById('lBest').textContent  = T.rBest;
  document.getElementById('lAvg').textContent   = T.rAvg;
  document.getElementById('lRound').textContent = T.rRound;
  document.getElementById('lDots').textContent  = T.rProgress;
  document.getElementById('goLB').textContent   = T.rFastLB;
  document.getElementById('goLA').textContent   = T.rAvgLB;
  document.getElementById('goLS').textContent   = T.rScoreLB;
  document.getElementById('replayBtn').textContent = T.rPlayAgain;
  if(rState==='idle'||rState==='gameover'){
    document.getElementById('rText').textContent = T.rTapStart;
    document.getElementById('rSub').textContent  = T.rTestSub;
  }

  // Stim
  document.querySelector('#panel-stimulation h1').textContent = T.stTitle;
  document.querySelector('#panel-stimulation .gsub').textContent = T.stSub;
  const stCards = document.querySelectorAll('#panel-stimulation .slbl');
  if(stCards.length>=4){ stCards[0].textContent=T.stScore; stCards[1].textContent=T.stHits; stCards[2].textContent=T.stAcc; stCards[3].textContent=T.lTimeLeft; }
  document.querySelector('.stim-idle-sub').textContent = T.stIdleSub;
  document.querySelector('.stim-idle-title').textContent = T.stimIdleTitle;
  document.querySelector('.stim-start-btn').textContent = T.stStart;
  document.querySelector('.stim-replay').textContent = T.stReplay;
  document.querySelector('#stimResult .r-label').textContent = T.stFinalLbl;

  // Dividers
  const divs = document.querySelectorAll('.sec-divider');
  if(divs[0]) divs[0].textContent = T.aboutTitle;
  if(divs[1]) divs[1].textContent = T.worldTitle;
  if(divs[2]) divs[2].textContent = T.reactionTitle;

  // Footer
  const footPs = document.querySelectorAll('.sfooter p');
  if(footPs[0]) footPs[0].innerHTML = `© <span id="footYear"></span> ${T.footCopy}`;
  if(footPs[1]) footPs[1].innerHTML = T.footSub;
  document.getElementById('footYear').textContent = new Date().getFullYear();
}

/* ═══════════════════════════════════════════
   TYPING TEST ENGINE
═══════════════════════════════════════════ */
const WORD_LIST = ['the','be','to','of','and','in','that','have','it','for','on','with','he','as','you','do','at','this','but','his','by','from','they','we','say','her','she','or','an','will','my','one','all','would','there','their','what','so','up','out','if','about','who','get','which','go','me','when','make','can','like','time','no','just','him','know','take','people','into','year','your','good','some','could','them','see','other','than','then','now','look','only','come','its','over','think','also','back','after','use','two','how','our','work','first','well','way','even','new','want','because','any','these','give','day','most','us','great','between','need','large','often','hand','high','place','hold','real','life','few','north','open','seem','together','next','white','children','begin','got','walk','example','ease','paper','group','always','music','those','both','mark','book','letter','until','mile','river','car','feet','care','second','enough','plain','girl','usual','young','ready','above','ever','red','list','though','feel','talk','bird','soon','body','dog','family','direct','pose','leave'];

let typing = {
  running:false, duration:60, timeLeft:60, iv:null,
  words:[], currentIdx:0,
  correctCount:0, wrongCount:0, charCount:0,
  startTime:null,
  wrongWords: new Set()   // track which word indices were typed wrong
};

function setTypingDuration(s) {
  typing.duration = s;
  ['30','60','120'].forEach(x => {
    document.getElementById('td'+x).classList.toggle('active', +x === s);
  });
  resetTyping();
}

function generateWords() {
  const arr = [];
  for (let i = 0; i < 80; i++) arr.push(WORD_LIST[Math.floor(Math.random()*WORD_LIST.length)]);
  return arr;
}

function renderWords() {
  const container = document.getElementById('tWords');
  container.innerHTML = '';
  typing.words.forEach((w, i) => {
    const span = document.createElement('span');
    span.textContent = w;
    span.id = 'tw' + i;
    span.style.cssText = 'padding:2px 4px;border-radius:4px;transition:all 0.12s;';
    if (i < typing.currentIdx) {
      // completed words — green if correct, red if wrong
      if (typing.wrongWords.has(i)) {
        span.style.color = '#ff2d55';
        span.style.background = 'rgba(255,45,85,0.12)';
      } else {
        span.style.color = '#00f5a0';
      }
    } else if (i === typing.currentIdx) {
      span.style.color = '#f0f0ff';
      span.style.background = 'rgba(0,180,216,0.18)';
      span.style.borderBottom = '2px solid #00b4d8';
      setTimeout(() => span.scrollIntoView({block:'nearest'}), 10);
    } else {
      span.style.color = '#6060a0';
    }
    container.appendChild(span);
  });
}

// Live-highlight current input vs target word
function updateInputColor() {
  const inp = document.getElementById('tInput');
  const typed = inp.value;
  if (!typed) { inp.style.color = 'var(--text)'; inp.style.borderColor = 'var(--border2)'; return; }
  const target = typing.words[typing.currentIdx] || '';
  const isMatch = target.startsWith(typed);
  inp.style.color   = isMatch ? '#00f5a0' : '#ff2d55';
  inp.style.borderColor = isMatch ? '#00f5a028' : 'rgba(255,45,85,0.5)';
}

function resetTyping() {
  clearInterval(typing.iv);
  const dur = typing.duration;
  typing = {
    running:false, duration:dur, timeLeft:dur, iv:null,
    words:generateWords(), currentIdx:0,
    correctCount:0, wrongCount:0, charCount:0,
    startTime:null, wrongWords: new Set()
  };
  document.getElementById('tWpm').textContent    = '0';
  document.getElementById('tAcc').textContent    = '—';
  document.getElementById('tCorrect').textContent= '0';
  document.getElementById('tTime').textContent   = dur;
  document.getElementById('tResult').style.display = 'none';
  const inp = document.getElementById('tInput');
  inp.value = '';
  inp.disabled = false;
  inp.style.color = 'var(--text)';
  inp.style.borderColor = 'var(--border2)';
  renderWords();
  setTimeout(() => inp.focus(), 50);
}

function finishTyping() {
  clearInterval(typing.iv); typing.running = false;
  document.getElementById('tInput').disabled = true;
  const elapsed = typing.duration;
  const wpm = Math.round(typing.correctCount / (elapsed / 60));
  const total = typing.correctCount + typing.wrongCount;
  const acc = total > 0 ? Math.round(typing.correctCount / total * 100) : 100;
  document.getElementById('tFinalWpm').textContent = wpm;
  document.getElementById('tFinalAcc').textContent = `Accuracy: ${acc}% — ${typing.correctCount} correct / ${typing.wrongCount} wrong`;
  document.getElementById('tResult').style.display = 'flex';
  if (typeof recordStat !== 'undefined') recordStat('typing', wpm, 'WPM');
  if (typeof SFX !== 'undefined') SFX.stimEnd();
}

document.getElementById('tInput').addEventListener('input', function() {
  const val = this.value;
  if (!typing.running && val.length > 0) {
    typing.running = true; typing.startTime = Date.now();
    typing.iv = setInterval(() => {
      typing.timeLeft--;
      document.getElementById('tTime').textContent = typing.timeLeft;
      const elapsed = Math.max(1, typing.duration - typing.timeLeft);
      const wpm = Math.round(typing.correctCount / (elapsed / 60));
      document.getElementById('tWpm').textContent = wpm;
      if (typing.timeLeft <= 0) finishTyping();
    }, 1000);
  }
  if (!typing.running && val.length === 0) return;
  updateInputColor();
  if (val.endsWith(' ')) {
    const typed = val.trim();
    const target = typing.words[typing.currentIdx];
    if (typed === target) {
      typing.correctCount++;
    } else {
      typing.wrongCount++;
      typing.wrongWords.add(typing.currentIdx);   // mark this word red
    }
    typing.currentIdx++;
    this.value = '';
    this.style.color = 'var(--text)';
    this.style.borderColor = 'var(--border2)';
    document.getElementById('tCorrect').textContent = typing.correctCount;
    const total = typing.correctCount + typing.wrongCount;
    document.getElementById('tAcc').textContent = total > 0 ? Math.round(typing.correctCount/total*100)+'%' : '—';
    if (typing.currentIdx >= typing.words.length) { typing.words = typing.words.concat(generateWords()); }
    renderWords();
  }
});

/* ═══════════════════════════════════════════
   COREBALL — collision via real pixel distance
═══════════════════════════════════════════ */
const cbCanvas = document.getElementById('coreCanvas');
const cbCtx    = cbCanvas.getContext('2d');

const CB_R      = 110;   // core circle radius
const CB_BRAD   = 10;    // ball radius
const CB_COLORS = ['#00f5a0','#ff2d55','#ffe000','#7b61ff','#ff6b00','#00b4d8','#ff69b4'];

let cb = {
  score:0, best:0, level:1, ballsLeft:10,
  rotSpeed:0.012,           // radians per frame — whole cluster rotates
  stuckBalls:[],            // {angle, color}  — rotate with cluster
  danger:[],                // {angle, color}  — rotate with cluster
  flyBall:null,             // {x, y, vy, color} — one ball in flight at a time
  gameOver:false, transitioning:false, animId:null
};

function cbCX() { return cbCanvas.width  / 2; }
function cbCY() { return cbCanvas.height / 2; }

/* ── reset / next-level ─────────────────────────────── */
function cbReset() {
  cancelAnimationFrame(cb.animId);
  cb = { score:0, best:cb.best, level:1, ballsLeft:10,
         rotSpeed:0.012, stuckBalls:[], danger:[],
         flyBall:null, gameOver:false, transitioning:false, animId:null };
  document.getElementById('cbScore').textContent  = '0';
  document.getElementById('cbLevel').textContent  = '1';
  document.getElementById('cbBalls').textContent  = '10';
  document.getElementById('cbMsg').textContent    = 'TAP TO SHOOT';
  cbDraw();
}

function cbNextLevel() {
  cb.level++;
  cb.stuckBalls  = [];
  cb.flyBall     = null;
  cb.ballsLeft   = 10;
  cb.rotSpeed    = Math.min(0.012 + cb.level * 0.004, 0.05);
  cb.transitioning = false;
  cb.animId = null;

  // danger balls evenly spaced
  cb.danger = [];
  const dCount = Math.min(cb.level - 1, 6);
  for (let i = 0; i < dCount; i++) {
    cb.danger.push({ angle: (Math.PI * 2 / Math.max(dCount, 1)) * i });
  }

  document.getElementById('cbLevel').textContent = cb.level;
  document.getElementById('cbBalls').textContent = cb.ballsLeft;
  document.getElementById('cbMsg').textContent   =
    `⭐ LEVEL ${cb.level}${dCount ? ' — avoid red balls!' : ''} — TAP TO SHOOT`;
  cbDraw();
  cb.animId = requestAnimationFrame(cbTick);
}

/* ── draw ───────────────────────────────────────────── */
function cbDraw() {
  const W = cbCanvas.width, H = cbCanvas.height;
  const cx = cbCX(), cy = cbCY(), R = CB_R;
  cbCtx.clearRect(0, 0, W, H);

  // Core ring
  cbCtx.beginPath();
  cbCtx.arc(cx, cy, R, 0, Math.PI * 2);
  cbCtx.strokeStyle = cb.gameOver ? '#ff2d55' : '#2a2a4a';
  cbCtx.lineWidth = 4;
  cbCtx.stroke();

  // Danger balls
  cb.danger.forEach(d => {
    const bx = cx + Math.cos(d.angle) * R;
    const by = cy + Math.sin(d.angle) * R;
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD + 4, 0, Math.PI * 2);
    cbCtx.strokeStyle = 'rgba(255,45,85,0.35)';
    cbCtx.lineWidth = 2;
    cbCtx.stroke();
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = '#ff2d55';
    cbCtx.fill();
    cbCtx.strokeStyle = '#fff';
    cbCtx.lineWidth = 2;
    cbCtx.beginPath();
    cbCtx.moveTo(bx-4, by-4); cbCtx.lineTo(bx+4, by+4);
    cbCtx.moveTo(bx+4, by-4); cbCtx.lineTo(bx-4, by+4);
    cbCtx.stroke();
  });

  // Stuck balls + spokes
  cb.stuckBalls.forEach(s => {
    const bx = cx + Math.cos(s.angle) * R;
    const by = cy + Math.sin(s.angle) * R;
    cbCtx.beginPath();
    cbCtx.moveTo(cx, cy); cbCtx.lineTo(bx, by);
    cbCtx.strokeStyle = s.color + '30';
    cbCtx.lineWidth = 1;
    cbCtx.stroke();
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = s.color;
    cbCtx.fill();
  });

  // Flying ball
  if (cb.flyBall) {
    const b = cb.flyBall;
    cbCtx.beginPath();
    cbCtx.arc(b.x, b.y + 10, 6, 0, Math.PI * 2);
    cbCtx.fillStyle = b.color + '40';
    cbCtx.fill();
    cbCtx.beginPath();
    cbCtx.arc(b.x, b.y, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = b.color;
    cbCtx.fill();
    cbCtx.beginPath();
    cbCtx.arc(b.x - 3, b.y - 3, 3, 0, Math.PI * 2);
    cbCtx.fillStyle = 'rgba(255,255,255,0.5)';
    cbCtx.fill();
  }

  // Center score
  cbCtx.fillStyle    = cb.gameOver ? '#ff2d55' : '#ffffff';
  cbCtx.font         = `bold ${cb.gameOver ? 22 : 38}px 'Bebas Neue',sans-serif`;
  cbCtx.textAlign    = 'center';
  cbCtx.textBaseline = 'middle';
  cbCtx.fillText(cb.gameOver ? 'GAME OVER' : cb.score, cx, cy);

  // Remaining balls dots — ABOVE shooter, no overlap
  const dotsY = H - 52;   // row of dots
  for (let i = 0; i < 10; i++) {
    const bx = cx + (i - 4.5) * 22;
    cbCtx.beginPath();
    cbCtx.arc(bx, dotsY, 7, 0, Math.PI * 2);
    cbCtx.fillStyle = i < cb.ballsLeft ? '#00f5a0' : '#1c1c30';
    cbCtx.fill();
    if (i < cb.ballsLeft) {
      cbCtx.beginPath();
      cbCtx.arc(bx - 2, dotsY - 2, 2.5, 0, Math.PI * 2);
      cbCtx.fillStyle = 'rgba(255,255,255,0.4)';
      cbCtx.fill();
    }
  }

  // Shooter circle — at very bottom, separate from dots
  const shooterY = H - 22;
  cbCtx.beginPath();
  cbCtx.arc(cx, shooterY, 11, 0, Math.PI * 2);
  cbCtx.strokeStyle = cb.gameOver ? '#ff2d5580' : '#ffffff40';
  cbCtx.lineWidth = 2; cbCtx.stroke();
  cbCtx.beginPath();
  cbCtx.arc(cx, shooterY, 5, 0, Math.PI * 2);
  cbCtx.fillStyle = cb.gameOver ? '#ff2d55' : '#00f5a0';
  cbCtx.fill();
  // Dashed aim line — from shooter to ring
  cbCtx.setLineDash([4, 5]);
  cbCtx.beginPath();
  cbCtx.moveTo(cx, shooterY - 13); cbCtx.lineTo(cx, cy + CB_R + 22);
  cbCtx.strokeStyle = '#ffffff14'; cbCtx.lineWidth = 1; cbCtx.stroke();
  cbCtx.setLineDash([]);
}

/* ── main tick ──────────────────────────────────────── */
function cbTick() {
  if (curPanel !== 'coreball') { cb.animId = requestAnimationFrame(cbTick); return; }

  // Rotate whole cluster
  cb.stuckBalls.forEach(s => s.angle += cb.rotSpeed);
  cb.danger.forEach(d     => d.angle += cb.rotSpeed);

  // Move flying ball
  if (cb.flyBall) {
    cb.flyBall.y += cb.flyBall.vy;
    const b  = cb.flyBall;
    const cx = cbCX(), cy = cbCY();
    const dx = b.x - cx, dy = b.y - cy;
    const dist = Math.sqrt(dx * dx + dy * dy);

    // Ball touches the ring when its CENTER reaches R (not R+brad,
    // because we want it to land ON the ring, not outside it)
    if (dist <= CB_R + CB_BRAD) {

      // Where exactly on the ring does it land?
      const landAngle = Math.atan2(dy, dx);

      // Convert every stuck/danger ball angle → XY on ring, then
      // measure PIXEL distance to landing point. This is exact — no angle math.
      const landX = cx + Math.cos(landAngle) * CB_R;
      const landY = cy + Math.sin(landAngle) * CB_R;

      // Check danger balls
      const hitDanger = cb.danger.some(d => {
        const ex = cx + Math.cos(d.angle) * CB_R;
        const ey = cy + Math.sin(d.angle) * CB_R;
        return Math.hypot(ex - landX, ey - landY) < CB_BRAD * 2;
      });

      if (hitDanger) {
        cb.gameOver = true;
        if (cb.score > cb.best) { cb.best = cb.score; document.getElementById('cbBest').textContent = cb.best; }
        document.getElementById('cbMsg').textContent = `💥 Hit danger ball! Score: ${cb.score} — TAP TO RESTART`;
        cb.flyBall = null;
        cbDraw(); return;
      }

      // Check stuck balls
      const hitStuck = cb.stuckBalls.some(s => {
        const ex = cx + Math.cos(s.angle) * CB_R;
        const ey = cy + Math.sin(s.angle) * CB_R;
        return Math.hypot(ex - landX, ey - landY) < CB_BRAD * 2;
      });

      if (hitStuck) {
        cb.gameOver = true;
        if (cb.score > cb.best) { cb.best = cb.score; document.getElementById('cbBest').textContent = cb.best; }
        document.getElementById('cbMsg').textContent = `💥 Hit existing ball! Score: ${cb.score} — TAP TO RESTART`;
        cb.flyBall = null;
        cbDraw(); return;
      }

      // ✅ Stick!
      cb.stuckBalls.push({ angle: landAngle, color: b.color });
      cb.flyBall = null;
      cb.score++;
      document.getElementById('cbScore').textContent = cb.score;
      cb.rotSpeed = Math.min(0.012 + cb.score * 0.001, 0.05);

      if (cb.stuckBalls.length >= 10) {
        cb.transitioning = true;
        document.getElementById('cbMsg').textContent = `🎉 LEVEL CLEAR! Going to level ${cb.level + 1}…`;
        cbDraw();
        setTimeout(cbNextLevel, 1200);
        return;
      }
      document.getElementById('cbMsg').textContent = `${cb.ballsLeft} balls left`;
    }

    // Ball flew off screen
    if (b.y < -CB_BRAD) {
      cb.flyBall = null;
    }
  }

  cbDraw();
  if (!cb.gameOver && !cb.transitioning) cb.animId = requestAnimationFrame(cbTick);
}

/* ── shoot ──────────────────────────────────────────── */
cbCanvas.addEventListener('click', () => {
  if (cb.gameOver) { cbReset(); return; }
  if (cb.transitioning) return;
  if (cb.flyBall) return;          // one ball at a time
  if (cb.ballsLeft <= 0) return;

  cb.ballsLeft--;
  document.getElementById('cbBalls').textContent = cb.ballsLeft;
  document.getElementById('cbMsg').textContent   =
    cb.ballsLeft === 0 ? '🎯 Last ball!' : `${cb.ballsLeft} balls left`;

  const color = CB_COLORS[Math.floor(Math.random() * CB_COLORS.length)];
  cb.flyBall = { x: cbCX(), y: cbCanvas.height - 22, vy: -9, color };

  if (!cb.animId) cb.animId = requestAnimationFrame(cbTick);
});
cbCanvas.addEventListener('touchstart', e => { e.preventDefault(); }, {passive:false});
cbCanvas.addEventListener('touchend', e => {
  e.preventDefault();
  const t = e.changedTouches[0];
  const rect = cbCanvas.getBoundingClientRect();
  // Only fire if touch was within canvas bounds
  if (t.clientX >= rect.left && t.clientX <= rect.right &&
      t.clientY >= rect.top  && t.clientY <= rect.bottom) {
    cbCanvas.click();
  }
}, {passive:false});

/* ═══════════════════════════════════════════
   DINOSAUR GAME ENGINE
═══════════════════════════════════════════ */
const dc = document.getElementById('dinoCanvas');
const dctx = dc.getContext('2d');
let dino = {
  x:80, y:220, w:44, h:48, vy:0, jumping:false, ducking:false,
  score:0, best:0, speed:5, alive:false, started:false,
  obstacles:[], clouds:[], frame:0, animId:null, groundY:240,
  legFrame:0
};

function dinoReset() {
  if(dino.animId) cancelAnimationFrame(dino.animId);
  const best = dino.best;
  dino = {
    x:80, y:220, w:44, h:48, vy:0, jumping:false, ducking:false,
    score:0, best, speed:5, alive:false, started:false,
    obstacles:[], clouds:[], frame:0, animId:null, groundY:240,
    legFrame:0
  };
  document.getElementById('dinoScore').textContent = '0';
  document.getElementById('dinoSpeed').textContent = '1x';
  document.getElementById('dinoStatus').textContent = 'Ready';
  dinoDraw();
}

function dinoJump() {
  if (!dino.started) {
    dino.started = true; dino.alive = true;
    document.getElementById('dinoStatus').textContent = 'Running';
    dino.animId = requestAnimationFrame(dinoLoop);
  }
  if (!dino.jumping && !dino.ducking && dino.y >= dino.groundY - dino.h) {
    dino.vy = -14; dino.jumping = true;
  }
}

function dinoDuck(on) {
  if (on && !dino.jumping) { dino.ducking = true; dino.h = 28; dino.y = dino.groundY - 28; }
  else { dino.ducking = false; dino.h = 48; dino.y = Math.min(dino.y, dino.groundY - 48); }
}

function dinoSpawnObstacle() {
  const types = ['cactus-s','cactus-m','cactus-l','bird'];
  const t = types[Math.floor(Math.random()*types.length)];
  const isBird = t === 'bird';
  dino.obstacles.push({
    x: dc.width + 20,
    y: isBird ? dino.groundY - 30 - Math.random()*20 : dino.groundY,
    w: isBird ? 46 : t==='cactus-s'?20:t==='cactus-m'?28:38,
    h: isBird ? 32 : t==='cactus-s'?40:t==='cactus-m'?52:60,
    type: t, bird: isBird, wingUp: true, wingTimer: 0
  });
}

function dinoCheckHit() {
  const pad = 6;
  const dx = dino.x + pad, dy = dino.y + pad, dw = dino.w - pad*2, dh = dino.h - pad*2;
  return dino.obstacles.some(o => {
    const op = 4;
    return dx < o.x+o.w-op && dx+dw > o.x+op && dy < o.y && dy+dh > o.y-o.h;
  });
}

function dinoDraw() {
  const W = dc.width, H = dc.height, gy = dino.groundY;
  dctx.clearRect(0, 0, W, H);

  // Ground
  dctx.fillStyle = '#2a2a4a';
  dctx.fillRect(0, gy, W, 2);

  // Clouds
  dino.clouds.forEach(c => {
    dctx.fillStyle = 'rgba(255,255,255,0.08)';
    dctx.beginPath();
    dctx.ellipse(c.x, c.y, 40, 14, 0, 0, Math.PI*2);
    dctx.fill();
  });

  // Dino — pixel T-Rex facing right
  const col = !dino.alive ? '#555577' : dino.jumping ? '#00f5a0' : '#d0d0f8';
  const dx = dino.x, dy = dino.y, dw = dino.w, dh = dino.h;
  dctx.fillStyle = col;
  if (dino.ducking) {
    // Ducking body
    dctx.fillRect(dx + 4, dy + 4, dw + 10, dh - 4);
    // Head facing right
    dctx.fillRect(dx + dw + 2, dy, 18, 14);
    // Snout
    dctx.fillRect(dx + dw + 16, dy + 4, 8, 7);
    // Eye
    dctx.fillStyle = '#06060e';
    dctx.fillRect(dx + dw + 10, dy + 2, 5, 5);
    // Tiny teeth
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + dw + 18, dy + 9, 3, 2);
  } else {
    // === MAIN BODY ===
    dctx.fillRect(dx + 6, dy + 18, dw - 8, dh - 18);
    // === NECK ===
    dctx.fillRect(dx + 18, dy + 8, 12, 14);
    // === HEAD ===
    dctx.fillRect(dx + 14, dy - 2, 24, 16);
    // === SNOUT (longer, pointy) ===
    dctx.fillRect(dx + 32, dy + 2, 14, 9);
    dctx.fillRect(dx + 40, dy + 4, 8, 5); // tip
    // === TOP BUMP (skull) ===
    dctx.fillRect(dx + 16, dy - 6, 14, 6);
    // === TINY ARM ===
    dctx.fillRect(dx + 16, dy + 24, 10, 5);
    dctx.fillRect(dx + 22, dy + 27, 6, 4);
    // === TAIL ===
    dctx.fillRect(dx, dy + 22, 10, 10);
    dctx.fillRect(dx - 8, dy + 28, 10, 7);
    dctx.fillRect(dx - 14, dy + 32, 8, 5);
    // === EYE (white + pupil) ===
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 28, dy, 7, 7);
    dctx.fillStyle = '#06060e';
    dctx.fillRect(dx + 30, dy + 1, 4, 4);
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 32, dy + 1, 1, 1); // highlight
    // === NOSTRIL ===
    dctx.fillStyle = '#9090b8';
    dctx.fillRect(dx + 42, dy + 4, 2, 2);
    // === TEETH ===
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 34, dy + 9, 3, 3);
    dctx.fillRect(dx + 39, dy + 9, 2, 2);
    // === LEGS & FEET ===
    dctx.fillStyle = col;
    if (!dino.jumping && dino.alive) {
      const lp = Math.floor(dino.legFrame / 5) % 2;
      // Thighs
      dctx.fillRect(dx + 20, dy + dh - 16, 11, lp ? 18 : 10);
      dctx.fillRect(dx + 8, dy + dh - 16, 11, lp ? 10 : 18);
      // Shins
      dctx.fillRect(dx + 20, dy + dh + (lp ? 2 : -6), 9, 8);
      dctx.fillRect(dx + 8, dy + dh + (lp ? -6 : 2), 9, 8);
      // Feet / claws
      dctx.fillRect(dx + 18, dy + dh + (lp ? 8 : 0), 14, 4);
      dctx.fillRect(dx + 6, dy + dh + (lp ? 0 : 8), 14, 4);
    } else {
      // Mid-air tucked
      dctx.fillRect(dx + 16, dy + dh - 10, 11, 12);
      dctx.fillRect(dx + 8, dy + dh - 8, 11, 10);
    }
  }

  // Obstacles
  dino.obstacles.forEach(o => {
    if (o.bird) {
      // Pterodactyl facing LEFT (toward dino)
      const bx = o.x, by = o.y - o.h, bw = o.w, bh = o.h;
      // Body
      dctx.fillStyle = '#b03000';
      dctx.fillRect(bx + 6, by + 8, bw - 12, bh - 10);
      // Head (left side — facing dino)
      dctx.fillStyle = '#cc3a00';
      dctx.fillRect(bx, by + 6, 16, 12);
      // Beak pointing LEFT
      dctx.fillStyle = '#ff9900';
      dctx.fillRect(bx - 10, by + 9, 12, 5);
      // Eye on left head
      dctx.fillStyle = '#ffffff';
      dctx.fillRect(bx + 3, by + 8, 5, 5);
      dctx.fillStyle = '#000';
      dctx.fillRect(bx + 4, by + 9, 3, 3);
      // Wings flap
      dctx.fillStyle = '#b03000';
      if (o.wingUp) {
        dctx.fillRect(bx + 4, by - 10, bw - 8, 12); // up
        dctx.fillRect(bx + 8, by - 18, bw - 18, 10);
      } else {
        dctx.fillRect(bx + 4, by + bh - 8, bw - 8, 12); // down
        dctx.fillRect(bx + 8, by + bh, bw - 18, 8);
      }
      // Tail (right side)
      dctx.fillStyle = '#9a2800';
      dctx.fillRect(bx + bw - 6, by + 10, 10, 6);
      dctx.fillRect(bx + bw + 2, by + 8, 6, 4);
    } else {
      // Cactus — main stem + side arms
      const cx2 = o.x, cy2 = o.y - o.h, cw = o.w, ch = o.h;
      dctx.fillStyle = '#1a8a3a';
      // Main stem
      dctx.fillRect(cx2 + Math.floor(cw*0.3), cy2, Math.floor(cw*0.4), ch);
      // Left arm
      dctx.fillRect(cx2, cy2 + Math.floor(ch*0.25), Math.floor(cw*0.35), Math.floor(cw*0.35));
      dctx.fillRect(cx2, cy2 + Math.floor(ch*0.1), Math.floor(cw*0.35), Math.floor(cw*0.35));
      // Right arm
      dctx.fillRect(cx2 + Math.floor(cw*0.65), cy2 + Math.floor(ch*0.35), Math.floor(cw*0.35), Math.floor(cw*0.35));
      dctx.fillRect(cx2 + Math.floor(cw*0.65), cy2 + Math.floor(ch*0.18), Math.floor(cw*0.35), Math.floor(cw*0.35));
      // Highlight
      dctx.fillStyle = '#22aa4a';
      dctx.fillRect(cx2 + Math.floor(cw*0.33), cy2 + 2, Math.floor(cw*0.12), Math.floor(ch*0.6));
    }
  });

  // Score
  dctx.fillStyle = '#ffffff';
  dctx.font = '700 18px JetBrains Mono,monospace';
  dctx.textAlign = 'right';
  dctx.fillText(String(Math.floor(dino.score)).padStart(5,'0'), W - 20, 30);
  if (dino.best > 0) {
    dctx.fillStyle = '#6060a0';
    dctx.font = '12px JetBrains Mono,monospace';
    dctx.fillText('HI ' + String(dino.best).padStart(5,'0'), W - 20, 50);
  }

  // Start / Game Over overlay
  if (!dino.started) {
    dctx.fillStyle = 'rgba(6,6,14,0.6)';
    dctx.fillRect(0, 0, W, H);
    dctx.fillStyle = '#ffffff';
    dctx.font = 'bold 28px Bebas Neue,sans-serif';
    dctx.textAlign = 'center';
    dctx.fillText('PRESS SPACE OR TAP TO START', W/2, H/2);
  } else if (!dino.alive) {
    dctx.fillStyle = 'rgba(6,6,14,0.7)';
    dctx.fillRect(0, 0, W, H);
    dctx.fillStyle = '#ff2d55';
    dctx.font = 'bold 32px Bebas Neue,sans-serif';
    dctx.textAlign = 'center';
    dctx.fillText('GAME OVER', W/2, H/2 - 20);
    dctx.fillStyle = '#ffffff';
    dctx.font = '18px Bebas Neue,sans-serif';
    dctx.fillText('TAP TO RESTART', W/2, H/2 + 20);
  }
  dctx.textAlign = 'left';
}

function dinoLoop() {
  if (curPanel !== 'dino' || !dino.alive) return;

  dino.frame++;
  dino.legFrame++;
  dino.score += 0.1;
  dino.speed = 5 + dino.score * 0.005;

  // Physics
  dino.vy += 0.7;
  dino.y += dino.vy;
  if (dino.y >= dino.groundY - dino.h) {
    dino.y = dino.groundY - dino.h;
    dino.vy = 0; dino.jumping = false;
  }

  // Spawn obstacles
  const gap = Math.max(800 - dino.score * 2, 400);
  if (dino.obstacles.length === 0 || dc.width - dino.obstacles[dino.obstacles.length-1].x > gap + Math.random()*300) {
    dinoSpawnObstacle();
  }

  // Move & animate obstacles
  dino.obstacles = dino.obstacles.filter(o => {
    o.x -= dino.speed;
    o.wingTimer++;
    if (o.wingTimer > 8) { o.wingUp = !o.wingUp; o.wingTimer = 0; }
    return o.x > -100;
  });

  // Clouds
  if (Math.random() < 0.005) dino.clouds.push({x: dc.width, y: 40 + Math.random()*60});
  dino.clouds = dino.clouds.filter(c => { c.x -= 0.8; return c.x > -100; });

  // Score & speed display
  const sc = Math.floor(dino.score);
  document.getElementById('dinoScore').textContent = sc;
  document.getElementById('dinoSpeed').textContent = (1 + dino.score*0.005).toFixed(1) + 'x';

  if (dinoCheckHit()) {
    dino.alive = false;
    if (sc > dino.best) { dino.best = sc; document.getElementById('dinoBest').textContent = dino.best; }
    document.getElementById('dinoStatus').textContent = 'Dead 💀';
    dinoDraw();
    return;
  }

  dinoDraw();
  dino.animId = requestAnimationFrame(dinoLoop);
}

dc.addEventListener('click', () => {
  if (!dino.started || !dino.alive) { dinoReset(); setTimeout(()=>{ dinoJump(); }, 100); }
  else dinoJump();
});
// Touch: tap = jump, swipe down = duck
let dcTouchY = 0;
dc.addEventListener('touchstart', e => {
  e.preventDefault();
  dcTouchY = e.touches[0].clientY;
}, {passive:false});
dc.addEventListener('touchend', e => {
  e.preventDefault();
  const dy = e.changedTouches[0].clientY - dcTouchY;
  if (dy > 30) {
    // Swipe down = duck
    dinoDuck(true);
    setTimeout(() => dinoDuck(false), 400);
  } else {
    // Tap = jump
    if (!dino.started || !dino.alive) { dinoReset(); setTimeout(()=>{ dinoJump(); }, 100); }
    else dinoJump();
  }
}, {passive:false});
document.addEventListener('keydown', e => {
  if (curPanel !== 'dino') return;
  if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); if (!e.repeat) dinoJump(); }
  if (e.code === 'ArrowDown') { e.preventDefault(); dinoDuck(true); }
});
document.addEventListener('keyup', e => {
  if (e.code === 'ArrowDown') dinoDuck(false);
});

/* ═══════════════════════════════════════════
   NUMBER MEMORY ENGINE
═══════════════════════════════════════════ */
let mem = { level:1, best:0, lives:3, number:'', phase:'idle', timer:null };

function memReset() {
  clearTimeout(mem.timer);
  mem = { level:1, best:0, lives:3, number:'', phase:'idle', timer:null };
  document.getElementById('memLevel').textContent = '1';
  document.getElementById('memDigits').textContent = '1';
  document.getElementById('memLives').textContent = '❤️❤️❤️';
  document.getElementById('memBest').textContent = '—';
  memSetMsg('PRESS START', '');
  document.getElementById('memInputArea').style.display = 'none';
  document.getElementById('memStartBtn').style.display = 'block';
  document.getElementById('memStartBtn').textContent = 'START';
  const bar = document.getElementById('memBar');
  bar.style.transition = 'none'; bar.style.width = '100%';
}

function memSetMsg(msg, num) {
  document.getElementById('memMsg').textContent = msg;
  document.getElementById('memNumber').textContent = num;
}

function memStart() {
  if (mem.phase === 'gameover') {
    const best = mem.best;
    mem = { level:1, best, lives:3, number:'', phase:'idle', timer:null };
    document.getElementById('memLives').textContent = '❤️❤️❤️';
  }
  mem.phase = 'show';
  const digits = mem.level;
  document.getElementById('memDigits').textContent = digits;
  document.getElementById('memLevel').textContent = mem.level;
  let num = String(Math.floor(Math.random()*9)+1);
  for (let i = 1; i < digits; i++) num += String(Math.floor(Math.random()*10));
  mem.number = num;
  document.getElementById('memStartBtn').style.display = 'none';
  document.getElementById('memInputArea').style.display = 'none';
  document.getElementById('memInput').value = '';
  memSetMsg('MEMORIZE!', num);
  const showTime = Math.max(1000, digits * 800);
  const bar = document.getElementById('memBar');
  bar.style.transition = 'none'; bar.style.width = '100%'; bar.style.background = 'var(--purple)';
  setTimeout(() => { bar.style.transition = `width ${showTime}ms linear`; bar.style.width = '0%'; }, 50);
  mem.timer = setTimeout(() => {
    memSetMsg('WHAT WAS THE NUMBER?', '');
    document.getElementById('memInputArea').style.display = 'flex';
    document.getElementById('memInput').focus();
    mem.phase = 'input';
    bar.style.transition = 'none'; bar.style.width = '100%'; bar.style.background = 'var(--accent)';
  }, showTime);
}

function memCheck() {
  if (mem.phase !== 'input') return;
  const answer = document.getElementById('memInput').value.trim();
  document.getElementById('memInputArea').style.display = 'none';
  if (answer === mem.number) {
    if (mem.level > mem.best) { mem.best = mem.level; document.getElementById('memBest').textContent = mem.best; }
    mem.level++;
    document.getElementById('memLevel').textContent = mem.level;
    document.getElementById('memDigits').textContent = mem.level;
    document.getElementById('memBar').style.background = 'var(--accent)';
    memSetMsg(`✅ CORRECT! Ready for ${mem.level} digits`, '');
    document.getElementById('memStartBtn').textContent = 'NEXT LEVEL →';
    document.getElementById('memStartBtn').style.display = 'block';
    mem.phase = 'idle';
  } else {
    mem.lives--;
    const hearts = '❤️'.repeat(Math.max(0,mem.lives)) + '🖤'.repeat(Math.max(0,3-mem.lives));
    document.getElementById('memLives').textContent = hearts;
    document.getElementById('memBar').style.background = 'var(--red)';
    if (mem.lives <= 0) {
      mem.phase = 'gameover';
      if (mem.level-1 > mem.best) { mem.best = mem.level-1; document.getElementById('memBest').textContent = mem.best; }
      memSetMsg(`GAME OVER — It was:`, mem.number);
      document.getElementById('memStartBtn').textContent = 'PLAY AGAIN';
      document.getElementById('memStartBtn').style.display = 'block';
    } else {
      mem.level = Math.max(1, mem.level-1);
      document.getElementById('memLevel').textContent = mem.level;
      memSetMsg(`❌ WRONG! It was: ${mem.number} — ${mem.lives} ${mem.lives===1?'life':'lives'} left`, '');
      document.getElementById('memStartBtn').textContent = 'TRY AGAIN';
      document.getElementById('memStartBtn').style.display = 'block';
      mem.phase = 'idle';
    }
  }
}
document.getElementById('memInput').addEventListener('keydown', e => { if(e.key==='Enter') memCheck(); });

/* ═══════════════════════════════════════════
   SNAKE GAME ENGINE — smooth interpolated movement
═══════════════════════════════════════════ */
const snakeCanvas = document.getElementById('snakeCanvas');
const sctx = snakeCanvas.getContext('2d');
const SN_GRID = 20;
const SN_CELL = snakeCanvas.width / SN_GRID;

const SN_BASE_MS = 200;  // starting interval (ms per step)
const SN_MIN_MS  = 80;   // fastest tick
const SN_SPEEDUP = 2;    // ms reduction per apple

let snake = {
  body: [{x:10,y:10},{x:9,y:10},{x:8,y:10}],
  prevBody: [{x:10,y:10},{x:9,y:10},{x:8,y:10}],
  dir: {x:1,y:0}, nextDir: {x:1,y:0},
  food: null, score: 0, best: 0,
  alive: false, started: false,
  tickMs: SN_BASE_MS,
  lastTickTime: 0,
  rafId: null, iv: null, touchStart: null
};

function snakeRandFood() {
  let pos;
  do { pos = { x: Math.floor(Math.random()*SN_GRID), y: Math.floor(Math.random()*SN_GRID) }; }
  while (snake.body.some(s => s.x===pos.x && s.y===pos.y));
  return pos;
}

function snakeReset() {
  clearInterval(snake.iv);
  cancelAnimationFrame(snake.rafId);
  const best = snake.best;
  const initBody = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  snake = {
    body: initBody, prevBody: initBody.map(s=>({...s})),
    dir: {x:1,y:0}, nextDir: {x:1,y:0},
    food: snakeRandFood(), score: 0, best,
    alive: false, started: false, tickMs: SN_BASE_MS,
    lastTickTime: 0, rafId: null, iv: null, touchStart: null
  };
  document.getElementById('snakeScore').textContent = '0';
  document.getElementById('snakeLen').textContent = '3';
  document.getElementById('snakeStatus').textContent = 'Ready';
  snakeDraw(1);
}

function lerpPos(prev, cur, t) {
  if (!prev) return cur;
  let dx = cur.x - prev.x, dy = cur.y - prev.y;
  if (Math.abs(dx) > SN_GRID/2) dx = 0;
  if (Math.abs(dy) > SN_GRID/2) dy = 0;
  return { x: prev.x + dx*t, y: prev.y + dy*t };
}

function snakeDraw(t) {
  const W = snakeCanvas.width, H = snakeCanvas.height;
  sctx.fillStyle = '#0a0a14';
  sctx.fillRect(0, 0, W, H);

  // Subtle grid dots
  sctx.fillStyle = 'rgba(255,255,255,0.025)';
  for (let gx=0; gx<SN_GRID; gx++) for (let gy=0; gy<SN_GRID; gy++)
    sctx.fillRect(gx*SN_CELL+SN_CELL/2-1, gy*SN_CELL+SN_CELL/2-1, 2, 2);

  // Border walls — glowing green border
  sctx.shadowColor = 'rgba(0,245,160,0.5)';
  sctx.shadowBlur = 8;
  sctx.strokeStyle = 'rgba(0,245,160,0.45)';
  sctx.lineWidth = 2;
  sctx.strokeRect(1, 1, W-2, H-2);
  sctx.shadowBlur = 0;

  // Food with pulse
  if (snake.food) {
    const pulse = 0.86 + 0.14*Math.sin(Date.now()/200);
    const fx = snake.food.x*SN_CELL + SN_CELL/2;
    const fy = snake.food.y*SN_CELL + SN_CELL/2;
    const gr = sctx.createRadialGradient(fx,fy,1,fx,fy,SN_CELL*0.65*pulse);
    gr.addColorStop(0,'rgba(255,45,85,1)');
    gr.addColorStop(0.45,'rgba(255,45,85,0.5)');
    gr.addColorStop(1,'rgba(255,45,85,0)');
    sctx.fillStyle = gr;
    sctx.beginPath(); sctx.arc(fx,fy,SN_CELL*0.65*pulse,0,Math.PI*2); sctx.fill();
    sctx.shadowColor = '#ff2d55'; sctx.shadowBlur = 10;
    sctx.fillStyle = '#ff2d55';
    sctx.beginPath(); sctx.arc(fx,fy,SN_CELL*0.32*pulse,0,Math.PI*2); sctx.fill();
    sctx.shadowBlur = 0;
    sctx.fillStyle = 'rgba(255,255,255,0.55)';
    sctx.beginPath(); sctx.arc(fx-SN_CELL*0.09,fy-SN_CELL*0.09,SN_CELL*0.08,0,Math.PI*2); sctx.fill();
  }

  // Draw snake body (back to front for correct layering)
  const n = snake.body.length;
  for (let i = n-1; i >= 0; i--) {
    const cur  = snake.body[i];
    const prev = (snake.prevBody && i < snake.prevBody.length) ? snake.prevBody[i] : cur;
    const pos  = lerpPos(prev, cur, t);
    const px = pos.x * SN_CELL;
    const py = pos.y * SN_CELL;
    const frac = 1 - i/n;

    if (i === 0) {
      // Head glow
      const hcx = px+SN_CELL/2, hcy = py+SN_CELL/2;
      const hg = sctx.createRadialGradient(hcx,hcy,0,hcx,hcy,SN_CELL);
      hg.addColorStop(0, snake.alive ? 'rgba(0,245,160,0.3)' : 'rgba(255,45,85,0.3)');
      hg.addColorStop(1,'rgba(0,0,0,0)');
      sctx.fillStyle = hg;
      sctx.beginPath(); sctx.arc(hcx,hcy,SN_CELL,0,Math.PI*2); sctx.fill();
    }

    const g = Math.round(130 + 115*frac);
    const b = Math.round(80*frac);
    const a = 0.45 + frac*0.55;
    sctx.fillStyle = i===0
      ? (snake.alive ? '#00f5a0' : '#ff2d55')
      : `rgba(0,${g},${b},${a})`;
    const pad = i===0 ? 1 : 2.5;
    sctx.beginPath();
    if (sctx.roundRect) sctx.roundRect(px+pad, py+pad, SN_CELL-pad*2, SN_CELL-pad*2, i===0?5:3);
    else sctx.rect(px+pad, py+pad, SN_CELL-pad*2, SN_CELL-pad*2);
    sctx.fill();

    // Eyes on head
    if (i===0 && snake.alive) {
      const hcx=px+SN_CELL/2, hcy=py+SN_CELL/2;
      const eOff=SN_CELL*0.22, eR=SN_CELL*0.1;
      let ex1,ey1,ex2,ey2;
      if      (snake.dir.x=== 1){ex1=hcx+SN_CELL*0.12;ey1=hcy-eOff;ex2=hcx+SN_CELL*0.12;ey2=hcy+eOff;}
      else if (snake.dir.x===-1){ex1=hcx-SN_CELL*0.12;ey1=hcy-eOff;ex2=hcx-SN_CELL*0.12;ey2=hcy+eOff;}
      else if (snake.dir.y===-1){ex1=hcx-eOff;ey1=hcy-SN_CELL*0.12;ex2=hcx+eOff;ey2=hcy-SN_CELL*0.12;}
      else                      {ex1=hcx-eOff;ey1=hcy+SN_CELL*0.12;ex2=hcx+eOff;ey2=hcy+SN_CELL*0.12;}
      sctx.fillStyle='#06060e';
      sctx.beginPath();sctx.arc(ex1,ey1,eR,0,Math.PI*2);sctx.fill();
      sctx.beginPath();sctx.arc(ex2,ey2,eR,0,Math.PI*2);sctx.fill();
      sctx.fillStyle='rgba(255,255,255,0.7)';
      sctx.beginPath();sctx.arc(ex1+eR*0.3,ey1-eR*0.3,eR*0.35,0,Math.PI*2);sctx.fill();
      sctx.beginPath();sctx.arc(ex2+eR*0.3,ey2-eR*0.3,eR*0.35,0,Math.PI*2);sctx.fill();
    }
  }

  // Idle overlay
  if (!snake.started) {
    sctx.fillStyle='rgba(6,6,14,0.62)'; sctx.fillRect(0,0,W,H);
    sctx.fillStyle='#00f5a0'; sctx.font='bold 44px Bebas Neue,sans-serif'; sctx.textAlign='center';
    sctx.fillText('SNAKE',W/2,H/2-22);
    sctx.fillStyle='#b0b0d0'; sctx.font='13px monospace';
    sctx.fillText('Tap / Arrow Key to Start',W/2,H/2+14);
    sctx.textAlign='left';
  }

  // Game over overlay
  if (snake.started && !snake.alive) {
    sctx.fillStyle='rgba(6,6,14,0.72)'; sctx.fillRect(0,0,W,H);
    sctx.fillStyle='#ff2d55'; sctx.font='bold 44px Bebas Neue,sans-serif'; sctx.textAlign='center';
    sctx.fillText('GAME OVER',W/2,H/2-30);
    sctx.fillStyle='#ffffff'; sctx.font='bold 24px Bebas Neue,sans-serif';
    sctx.fillText('Score: '+snake.score,W/2,H/2+4);
    if (snake.score>0 && snake.score>=snake.best) {
      sctx.fillStyle='#ffe000'; sctx.font='16px Bebas Neue,sans-serif';
      sctx.fillText('🏆 NEW BEST!',W/2,H/2+28);
    }
    sctx.fillStyle='#9090b8'; sctx.font='13px monospace';
    sctx.fillText('Tap to Restart',W/2,H/2+56);
    sctx.textAlign='left';
  }
}

// rAF render loop — interpolates positions between logic ticks
function snakeRenderLoop(now) {
  if (curPanel !== 'snake') return;
  snake.rafId = requestAnimationFrame(snakeRenderLoop);
  if (!snake.started) return;
  const elapsed = now - snake.lastTickTime;
  const t = snake.alive ? Math.min(elapsed / snake.tickMs, 1) : 1;
  snakeDraw(t);
}

function snakeTick() {
  if (curPanel !== 'snake' || !snake.alive) return;

  // Save previous positions for smooth interpolation
  snake.prevBody = snake.body.map(s => ({...s}));
  snake.lastTickTime = performance.now();

  snake.dir = { ...snake.nextDir };
  const head = { x: snake.body[0].x + snake.dir.x, y: snake.body[0].y + snake.dir.y };

  // Wall collision = death
  if (head.x < 0 || head.x >= SN_GRID || head.y < 0 || head.y >= SN_GRID) {
    snake.alive = false;
    if (snake.score > snake.best) { snake.best = snake.score; document.getElementById('snakeBest').textContent = snake.best; }
    document.getElementById('snakeStatus').textContent = 'Dead 💀';
    if (typeof recordStat !== 'undefined') recordStat('snake', snake.score, 'pts');
    if (typeof SFX !== 'undefined') SFX.dinoDie();
    snakeDraw(1); return;
  }

  // Self collision
  if (snake.body.some(s => s.x===head.x && s.y===head.y)) {
    snake.alive = false;
    if (snake.score > snake.best) { snake.best = snake.score; document.getElementById('snakeBest').textContent = snake.best; }
    document.getElementById('snakeStatus').textContent = 'Dead 💀';
    if (typeof recordStat !== 'undefined') recordStat('snake', snake.score, 'pts');
    if (typeof SFX !== 'undefined') SFX.dinoDie();
    snakeDraw(1); return;
  }

  snake.body.unshift(head);

  if (head.x === snake.food.x && head.y === snake.food.y) {
    snake.score += 10;
    snake.food = snakeRandFood();
    // Slow acceleration: 2ms per apple, floor at 80ms
    const apples = Math.floor(snake.score / 10);
    snake.tickMs = Math.max(SN_MIN_MS, SN_BASE_MS - apples * SN_SPEEDUP);
    clearInterval(snake.iv);
    snake.iv = setInterval(snakeTick, snake.tickMs);
    document.getElementById('snakeScore').textContent = snake.score;
    document.getElementById('snakeLen').textContent = snake.body.length;
    if (typeof SFX !== 'undefined') SFX.memCorrect();
  } else {
    snake.body.pop();
    if (snake.prevBody.length > snake.body.length) snake.prevBody.pop();
  }
}

function snakeStart() {
  snakeReset();
  snake.started = true; snake.alive = true;
  snake.lastTickTime = performance.now();
  document.getElementById('snakeStatus').textContent = 'Running';
  snake.iv = setInterval(snakeTick, snake.tickMs);
  snake.rafId = requestAnimationFrame(snakeRenderLoop);
}

snakeCanvas.addEventListener('click', () => {
  if (!snake.started || !snake.alive) snakeStart();
});
snakeCanvas.addEventListener('touchstart', e => {
  e.preventDefault();
  snake.touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  if (!snake.started || !snake.alive) snakeStart();
}, { passive:false });
snakeCanvas.addEventListener('touchend', e => {
  e.preventDefault();
  if (!snake.touchStart) return;
  const dx = e.changedTouches[0].clientX - snake.touchStart.x;
  const dy = e.changedTouches[0].clientY - snake.touchStart.y;
  if (Math.abs(dx) < 12 && Math.abs(dy) < 12) return;
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 0 && snake.dir.x !== -1) snake.nextDir = {x:1,y:0};
    else if (dx < 0 && snake.dir.x !== 1) snake.nextDir = {x:-1,y:0};
  } else {
    if (dy > 0 && snake.dir.y !== -1) snake.nextDir = {x:0,y:1};
    else if (dy < 0 && snake.dir.y !== 1) snake.nextDir = {x:0,y:-1};
  }
  snake.touchStart = null;
}, { passive:false });

document.addEventListener('keydown', e => {
  if (curPanel !== 'snake') return;
  const map = {
    ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
    KeyW:{x:0,y:-1}, KeyS:{x:0,y:1}, KeyA:{x:-1,y:0}, KeyD:{x:1,y:0}
  };
  const d = map[e.code];
  if (d) {
    e.preventDefault();
    if (!snake.started || !snake.alive) { snakeStart(); return; }
    if (!(d.x === -snake.dir.x && d.y === -snake.dir.y)) snake.nextDir = d;
  }
});


/* ═══════════════════════════════════════════
   TAB SCROLL ARROWS
═══════════════════════════════════════════ */
function scrollTabs(dir) {
  const tabs = document.getElementById('tabsContainer');
  tabs.scrollBy({ left: dir * 160, behavior: 'smooth' });
}

// Show/hide arrows based on scroll position
function updateTabArrows() {
  const tabs = document.getElementById('tabsContainer');
  const btnL = document.getElementById('tabScrollLeft');
  const btnR = document.getElementById('tabScrollRight');
  if (!tabs || !btnL || !btnR) return;
  const atStart = tabs.scrollLeft <= 4;
  const atEnd   = tabs.scrollLeft + tabs.clientWidth >= tabs.scrollWidth - 4;
  btnL.style.opacity = atStart ? '0.25' : '1';
  btnR.style.opacity = atEnd   ? '0.25' : '1';
}

document.getElementById('tabsContainer').addEventListener('scroll', updateTabArrows, { passive: true });
window.addEventListener('resize', updateTabArrows);
setTimeout(updateTabArrows, 100);

// Auto-scroll active tab into view when switching
const _origSwitchPanel_scroll = switchPanel;
switchPanel = function(p, fromPopstate) {
  _origSwitchPanel_scroll(p, fromPopstate);
  const activeTab = document.querySelector(`.tab[data-panel="${p}"]`);
  if (activeTab) activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
};

/* ═══════════════════════════════════════════
   INIT
═══════════════════════════════════════════ */
setLang('en');
resetTyping();
cbReset();
dinoReset();
memReset();
snakeReset();
// Read panel from current URL path, fall back to 'reaction'
const _initPanel = panelFromPath(location.pathname);
// fromPopstate=true → switchPanel skips pushState, no extra history entry
switchPanel(_initPanel, true);
// Set initial state so back button works correctly from first visit
const _initRoute = ROUTES[_initPanel] || ROUTES['reaction'];
try {
  history.replaceState({ panel: _initPanel }, _initRoute.title, _initRoute.path);
  document.title = _initRoute.title;
  const _md = document.querySelector('meta[name="description"]');
  if (_md) _md.setAttribute('content', _initRoute.desc);
  const _cl = document.querySelector('link[rel="canonical"]');
  if (_cl) _cl.setAttribute('href', 'https://reactionspeedtest.com' + _initRoute.path);
} catch(e) {}
setDuration(5);
</script>
<!-- ═══════════════════════════════════════════════════
     STATS MODAL
═══════════════════════════════════════════════════ -->
<div id="statsModal" style="
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(6,6,14,0.88);backdrop-filter:blur(12px);
  align-items:center;justify-content:center;
">
  <div style="
    background:var(--surf);border:1px solid var(--border);border-radius:20px;
    padding:28px 24px;max-width:500px;width:92%;max-height:85vh;overflow-y:auto;
    position:relative;
  ">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:0.15em;color:var(--accent);">📊 MY STATS</div>
      <button onclick="closeStatsModal()" style="background:none;border:none;color:var(--muted);font-size:1.4rem;cursor:pointer;line-height:1;">✕</button>
    </div>
    <div id="statsContent" style="display:flex;flex-direction:column;gap:14px;"></div>
    <button onclick="clearStats()" style="
      margin-top:18px;width:100%;padding:11px;background:transparent;
      border:1px solid var(--red);color:var(--red);border-radius:10px;
      font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:0.1em;
      cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.background='rgba(255,45,85,0.1)'" onmouseout="this.style.background='transparent'">
      🗑 CLEAR ALL STATS
    </button>
  </div>
</div>

<script>
/* ═══════════════════════════════════════════
   WEB AUDIO — SOUND ENGINE
═══════════════════════════════════════════ */
let audioCtx = null;
let soundEnabled = true;

function getAudioCtx() {
  if (!audioCtx) {
    try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
  }
  return audioCtx;
}

function playTone(freq, type, duration, vol, decay) {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = type || 'sine';
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(vol || 0.18, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + (decay || duration));
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + (duration || 0.12));
  } catch(e) {}
}

function playNoise(duration, vol) {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    const bufLen = ctx.sampleRate * duration;
    const buf = ctx.createBuffer(1, bufLen, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bufLen; i++) data[i] = (Math.random() * 2 - 1);
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const gain = ctx.createGain();
    const filter = ctx.createBiquadFilter();
    filter.type = 'bandpass'; filter.frequency.value = 200;
    src.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
    gain.gain.setValueAtTime(vol || 0.1, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
    src.start(); src.stop(ctx.currentTime + duration);
  } catch(e) {}
}

// Game sounds
const SFX = {
  click:      () => playTone(600, 'square', 0.06, 0.12),
  clickFail:  () => playTone(180, 'sawtooth', 0.1, 0.15),
  dinoJump:   () => { playTone(280, 'sine', 0.10, 0.08); playTone(420, 'sine', 0.07, 0.07); },
  dinoDie:    () => { playTone(200,'sawtooth',0.06,0.08); setTimeout(()=>playTone(130,'sawtooth',0.07,0.15),70); playNoise(0.18, 0.04); },
  dinoStep:   () => playTone(80, 'square', 0.04, 0.04),
  reactionGo: () => playTone(880, 'sine', 0.15, 0.22, 0.3),
  reactionHit:() => { playTone(660,'sine',0.08,0.14); setTimeout(()=>playTone(880,'sine',0.1,0.12),60); },
  reactionEarly:() => { playTone(200,'sawtooth',0.15,0.18); setTimeout(()=>playTone(150,'sawtooth',0.12,0.2),100); },
  reactionEnd:() => { [523,659,784,1047].forEach((f,i)=>setTimeout(()=>playTone(f,'sine',0.15,0.1),i*90)); },
  stimHit:    () => playTone(660 + Math.random()*200, 'sine', 0.07, 0.12),
  stimMiss:   () => playTone(200, 'sawtooth', 0.06, 0.08),
  stimEnd:    () => { [392,494,659,784].forEach((f,i)=>setTimeout(()=>playTone(f,'sine',0.12,0.15),i*80)); },
  cpsClick:   () => playTone(500 + Math.random()*200, 'square', 0.04, 0.08),
  spacePress: () => playTone(350, 'sine', 0.05, 0.06),
  memCorrect: () => { playTone(523,'sine',0.12,0.15); setTimeout(()=>playTone(659,'sine',0.12,0.15),120); },
  memWrong:   () => { playTone(250,'sawtooth',0.15,0.2); setTimeout(()=>playTone(200,'sawtooth',0.12,0.2),120); },
  cbHit:      () => playTone(440 + Math.random()*160, 'sine', 0.08, 0.1),
  cbMiss:     () => playTone(160, 'sawtooth', 0.1, 0.12),
  typingKey:  () => playTone(700 + Math.random()*300, 'square', 0.02, 0.025),
};

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? '🔊' : '🔇';
  // Unlock audio ctx on first interaction
  if (soundEnabled) { getAudioCtx(); playTone(440,'sine',0.05,0.1); }
}

/* ═══════════════════════════════════════════
   PERSONAL STATS (localStorage)
═══════════════════════════════════════════ */
const STATS_KEY = 'reflexlab_stats_v1';

function loadStats() {
  try { return JSON.parse(localStorage.getItem(STATS_KEY)) || {}; } catch(e) { return {}; }
}
function saveStats(s) {
  try { localStorage.setItem(STATS_KEY, JSON.stringify(s)); } catch(e) {}
}
function recordStat(game, value, unit) {
  const s = loadStats();
  if (!s[game]) s[game] = { sessions:0, best:null, history:[] };
  s[game].sessions++;
  s[game].history.push({ v: value, t: Date.now() });
  if (s[game].history.length > 50) s[game].history.shift(); // keep last 50
  const isBetter = s[game].best === null ||
    (game === 'reaction' ? value < s[game].best : value > s[game].best);
  if (isBetter) s[game].best = value;
  saveStats(s);
}

function showStatsModal() {
  const s = loadStats();
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  const games = [
    { key:'reaction', label:'⚡ Reaction Time', unit:'ms', lower:true },
    { key:'cps',      label:'🔥 Click Speed',   unit:'CPS', lower:false },
    { key:'spacebar', label:'⌨️ Spacebar',       unit:'HPS', lower:false },
    { key:'stim',     label:'🎯 Stimulation',    unit:'pts', lower:false },
    { key:'typing',   label:'📝 Typing Speed',   unit:'WPM', lower:false },
    { key:'memory',   label:'🧠 Memory',         unit:'digits', lower:false },
  ];
  content.innerHTML = '';
  let hasData = false;
  games.forEach(g => {
    const d = s[g.key];
    if (!d) return;
    hasData = true;
    const avg = d.history.length ? Math.round(d.history.reduce((a,b)=>a+b.v,0)/d.history.length*10)/10 : '—';
    content.innerHTML += `
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:14px 16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <span style="font-size:0.7rem;font-weight:700;color:var(--text);">${g.label}</span>
          <span style="font-size:0.55rem;color:var(--muted);letter-spacing:0.1em;">${d.sessions} sessions</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center;">
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--accent);">${d.best}${g.unit==='ms'?'':''}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Best (${g.unit})</div>
          </div>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--yellow);">${avg}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Avg (${g.unit})</div>
          </div>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--purple);">${d.sessions}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Sessions</div>
          </div>
        </div>
      </div>`;
  });
  if (!hasData) {
    content.innerHTML = '<div style="text-align:center;color:var(--muted);padding:32px 0;font-size:0.7rem;letter-spacing:0.1em;">No data yet — play some tests first!</div>';
  }
  modal.style.display = 'flex';
}
function closeStatsModal() { document.getElementById('statsModal').style.display = 'none'; }
function clearStats() {
  if (confirm('Clear all your saved stats?')) {
    localStorage.removeItem(STATS_KEY);
    showStatsModal();
  }
}
document.getElementById('statsModal').addEventListener('click', e => {
  if (e.target === document.getElementById('statsModal')) closeStatsModal();
});
</script>

<script>
/* ═══════════════════════════════════════════
   GAME SOUND & EFFECT HOOKS
═══════════════════════════════════════════ */

/* ────────────────────────────────────────
   DINO — jump + softer die + footsteps
──────────────────────────────────────── */
const _origDinoJump = dinoJump;
dinoJump = function() {
  const wasJumping = dino.jumping;
  _origDinoJump();
  if (!wasJumping) SFX.dinoJump();
};

let _dinoPrevAlive = false;
setInterval(() => {
  if (_dinoPrevAlive && !dino.alive && dino.started) SFX.dinoDie();
  _dinoPrevAlive = dino.alive;
}, 50);

/* ────────────────────────────────────────
   REACTION — clean override approach
   (don't double-wrap startRound, just
    patch the go-signal directly inside
    handleReactionTap's wait→go path)
──────────────────────────────────────── */

/* ────────────────────────────────────────
   REACTION — stat tracking only (no sounds)
──────────────────────────────────────── */

// Patch endReaction — stat save only, no sounds
const _origEndReaction = endReaction;
endReaction = function() {
  _origEndReaction();
  const valid = rResults.filter(r => r !== 'early');
  if (valid.length) recordStat('reaction', Math.round(valid.reduce((a,b)=>a+b,0)/valid.length), 'ms');
};

// When switching away from reaction panel, cancel pending rTimer
const _origSwitchPanel_react = switchPanel;
switchPanel = function(p, fromPopstate) {
  if (curPanel === 'reaction' && p !== 'reaction') {
    clearTimeout(rTimer);
    rState = 'idle';
  }
  if (curPanel === 'snake' && p !== 'snake') {
    clearInterval(snake.iv);
  }
  _origSwitchPanel_react(p, fromPopstate);
};

/* ────────────────────────────────────────
   STIMULATION — proper event-based sounds
   Only on: correct hit & wrong click (miss)
   NOT on target expiry
──────────────────────────────────────── */

// Wrap spawnTarget to inject sound into the click handler of each target
const _origSpawnTarget = spawnTarget;
spawnTarget = function() {
  // Call original — it appends targets to arena
  _origSpawnTarget();
  // Find the most recently appended target element and patch its click
  const arena = document.getElementById('stimArena');
  const targets = arena.querySelectorAll('.stim-target');
  if (!targets.length) return;
  const lastEl = targets[targets.length - 1];
  // Wrap click to add sound — stopPropagation already handled inside original
  lastEl.addEventListener('click', (e) => {
    // Only fire if this target hasn't been hit yet (check via opacity not yet 0)
    if (lastEl.style.opacity !== '0') SFX.stimHit();
  }, true); // capture phase — runs before original
};

// Arena background click = miss sound
document.getElementById('stimArena').addEventListener('click', (e) => {
  if (!stim.running) return;
  if (e.target.id === 'stimArena' || e.target === document.getElementById('stimArena')) {
    SFX.stimMiss();
  }
});

// Finish sound + stat
const _origFinishStim = finishStim;
finishStim = function() {
  _origFinishStim();
  SFX.stimEnd();
  recordStat('stim', stim.score, 'pts');
};

/* ────────────────────────────────────────
   CPS / JITTER — NO sound, ripple effect only
──────────────────────────────────────── */
function spawnClickRipple(container, clientX, clientY) {
  const rect = container.getBoundingClientRect();
  const x = clientX - rect.left;
  const y = clientY - rect.top;
  const ripple = document.createElement('div');
  ripple.style.cssText = `
    position:absolute;
    left:${x}px; top:${y}px;
    width:0; height:0;
    border-radius:50%;
    border:2px solid rgba(0,245,160,0.7);
    transform:translate(-50%,-50%);
    pointer-events:none;
    animation:rippleGrow 0.5s ease-out forwards;
    z-index:10;
  `;
  container.style.position = 'relative';
  container.appendChild(ripple);
  setTimeout(() => ripple.remove(), 500);
}

clickArena.addEventListener('click', (e) => {
  spawnClickRipple(clickArena, e.clientX, e.clientY);
});
clickArena.addEventListener('touchstart', (e) => {
  if (e.touches.length) spawnClickRipple(clickArena, e.touches[0].clientX, e.touches[0].clientY);
}, { passive: true });

// CPS finish → stat
const _origCgFinish = cgFinish;
cgFinish = function() {
  _origCgFinish();
  const elapsed = Math.min(curDuration, (Date.now() - cg.ts)/1000);
  recordStat('cps', +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2), 'CPS');
};

/* ────────────────────────────────────────
   SPACEBAR — mechanical key sound
──────────────────────────────────────── */
function playSpacebarSound() {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    // Thump: low body
    const bufLen = Math.floor(ctx.sampleRate * 0.04);
    const buf = ctx.createBuffer(1, bufLen, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bufLen; i++) data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufLen * 0.3));
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass'; filter.frequency.value = 180;
    const gain = ctx.createGain();
    gain.gain.value = 0.4;
    src.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
    src.start();
    // Click transient
    const osc = ctx.createOscillator();
    const g2 = ctx.createGain();
    osc.type = 'square'; osc.frequency.value = 1200;
    g2.gain.setValueAtTime(0.07, ctx.currentTime);
    g2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.015);
    osc.connect(g2); g2.connect(ctx.destination);
    osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.015);
  } catch(e) {}
}

const _origSgClick = sgClick;
sgClick = function() {
  playSpacebarSound();
  _origSgClick();
};

const _origSgFinish = sgFinish;
sgFinish = function() {
  _origSgFinish();
  const elapsed = Math.min(curDuration, (Date.now() - sg.ts)/1000);
  recordStat('spacebar', +(sg.clicks/Math.max(elapsed,0.01)).toFixed(2), 'HPS');
};

/* ────────────────────────────────────────
   NUMBER MEMORY — correct / wrong sounds
──────────────────────────────────────── */
const _origMemCheck = memCheck;
memCheck = function() {
  const answer = document.getElementById('memInput').value.trim();
  const wasCorrect = answer === mem.number;
  _origMemCheck();
  if (wasCorrect) SFX.memCorrect();
  else SFX.memWrong();
};

let _lastMemBestRecorded = 0;
setInterval(() => {
  if (mem.phase === 'gameover' && mem.best > 0 && mem.best !== _lastMemBestRecorded) {
    recordStat('memory', mem.best, 'digits');
    _lastMemBestRecorded = mem.best;
  }
}, 500);

/* ────────────────────────────────────────
   COREBALL — hit sound
──────────────────────────────────────── */
cbCanvas.addEventListener('click', () => {
  if (!cb.gameOver && !cb.flyBall && cb.ballsLeft > 0) SFX.cbHit();
}, true);

/* ────────────────────────────────────────
   TYPING — keystroke sound
──────────────────────────────────────── */
const typingInput = document.getElementById('tInput');
if (typingInput) typingInput.addEventListener('keydown', () => SFX.typingKey());

/* ────────────────────────────────────────
   RIPPLE CSS KEYFRAME (injected once)
──────────────────────────────────────── */
const _rippleStyle = document.createElement('style');
_rippleStyle.textContent = `
@keyframes rippleGrow {
  0%   { width:0; height:0; opacity:0.9; }
  100% { width:120px; height:120px; opacity:0; }
}`;
document.head.appendChild(_rippleStyle);

/* ────────────────────────────────────────
   Unlock AudioContext on first interaction
──────────────────────────────────────── */
document.addEventListener('click',   () => { if(soundEnabled) getAudioCtx(); }, { once:true });
document.addEventListener('keydown', () => { if(soundEnabled) getAudioCtx(); }, { once:true });

/* ═══════════════════════════════════════════════════════════
   💰 CLICKER TYCOON ENGINE  v4
   FIXES:
     • Enter/Space key can NEVER trigger coin or shop buttons
     • pointerdown on shop cards — no click/touch ambiguity
     • No render caching that skips real state changes
   FEATURES:
     • Canvas particle bursts on click
     • Floating +N text with random drift
     • SVG coin with glow ring animation
     • Smooth prestige flash + fanfare sound
═══════════════════════════════════════════════════════════ */

// ── DATA ──────────────────────────────────────────────────
const CT_UPG = [
  {id:'cursor',  name:'Auto Cursor',  ico:'🖱️', base:10,      cps:0.1,   info:'Clicks for you while you rest'},
  {id:'intern',  name:'Intern',       ico:'👶', base:80,      cps:0.5,   info:'Very keen, learning the ropes'},
  {id:'miner',   name:'Coin Miner',   ico:'⛏️', base:300,     cps:2,     info:'Digs gold from the earth'},
  {id:'factory', name:'Factory',      ico:'🏭', base:1200,    cps:8,     info:'Mass-produces coins 24/7'},
  {id:'bank',    name:'Bank',         ico:'🏦', base:5000,    cps:25,    info:'Compound interest never sleeps'},
  {id:'lab',     name:'Research Lab', ico:'🔬', base:20000,   cps:80,    info:'Science-powered income engine'},
  {id:'rocket',  name:'Rocket',       ico:'🚀', base:80000,   cps:250,   info:'Mining asteroids for profit'},
  {id:'ai',      name:'AI System',    ico:'🤖', base:300000,  cps:800,   info:'Self-optimizing money printer'},
  {id:'portal',  name:'Coin Portal',  ico:'🌀', base:1000000, cps:2500,  info:'Siphons coins from other dims'},
];

const CT_MS = [
  {id:'c1',   lbl:'First Coin',     ico:'🪙',  chk:s=>s.te>=1          },
  {id:'c100', lbl:'100 Coins',      ico:'💯',  chk:s=>s.te>=100         },
  {id:'c1k',  lbl:'1K Coins',       ico:'🥉',  chk:s=>s.te>=1000        },
  {id:'c10k', lbl:'10K Club',       ico:'🥈',  chk:s=>s.te>=10000       },
  {id:'c100k',lbl:'100K Big Shot',  ico:'🥇',  chk:s=>s.te>=100000      },
  {id:'c1m',  lbl:'Millionaire',    ico:'💎',  chk:s=>s.te>=1e6         },
  {id:'c1b',  lbl:'Billionaire',    ico:'👑',  chk:s=>s.te>=1e9         },
  {id:'p1',   lbl:'First Prestige', ico:'⭐',  chk:s=>s.pres>=1         },
  {id:'p5',   lbl:'5 Prestiges',    ico:'🌟',  chk:s=>s.pres>=5         },
  {id:'u10',  lbl:'10 Upgrades',    ico:'🛒',  chk:s=>ctOwned(s)>=10    },
  {id:'u100', lbl:'100 Upgrades',   ico:'🏪',  chk:s=>ctOwned(s)>=100   },
];

// ── STATE ─────────────────────────────────────────────────
let ct = {
  c:0,          // current coins
  te:0,         // total earned (lifetime, resets on prestige)
  tc:0,         // total clicks
  pres:0,       // prestige count
  mult:1,       // prestige multiplier
  own:{},       // { upgId: count }
  ms:new Set(), // unlocked milestone ids
  iv:null, tick:0,
};

function ctOwned(s){ return Object.values(s.own).reduce((a,b)=>a+b,0); }

// ── MATH ──────────────────────────────────────────────────
function ctCost(u){ return Math.ceil(u.base * Math.pow(1.15, ct.own[u.id]||0)); }
function ctCPS(){   let s=0; CT_UPG.forEach(u=>{ s+=(ct.own[u.id]||0)*u.cps; }); return s*ct.mult; }
function ctEPC(){   let b=1; CT_UPG.forEach(u=>{ b+=(ct.own[u.id]||0)*u.cps*0.1; }); return Math.max(1,Math.floor(b*ct.mult)); }

// ── FORMAT ────────────────────────────────────────────────
function ctF(n){
  n = Math.floor(n);
  if(n>=1e12) return (n/1e12).toFixed(2)+'T';
  if(n>=1e9)  return (n/1e9).toFixed(2)+'B';
  if(n>=1e6)  return (n/1e6).toFixed(2)+'M';
  if(n>=1e3)  return (n/1e3).toFixed(1)+'K';
  return n.toString();
}

// ── CANVAS PARTICLES ──────────────────────────────────────
(function(){
  const cv = document.getElementById('ctParticleCanvas');
  if(!cv) return;
  const ctx = cv.getContext('2d');
  let parts = [], raf = null;

  function resize(){
    const w = document.getElementById('ctCoinWrap');
    if(!w) return;
    cv.width  = w.offsetWidth  || 200;
    cv.height = w.offsetHeight || 200;
  }
  resize();
  window.addEventListener('resize', resize);

  function spawn(n){
    const cx=cv.width/2, cy=cv.height/2;
    const cols=['#ffd600','#ffee58','#fff9c4','#ff9800','#ffb300','#fff'];
    for(let i=0;i<n;i++){
      const a=Math.random()*Math.PI*2, spd=1.8+Math.random()*4;
      parts.push({x:cx,y:cy,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd,
        r:1.8+Math.random()*3.2, col:cols[Math.floor(Math.random()*cols.length)],
        life:1, dec:0.022+Math.random()*0.028});
    }
  }

  function tick(){
    ctx.clearRect(0,0,cv.width,cv.height);
    parts = parts.filter(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.14; p.life-=p.dec;
      if(p.life<=0) return false;
      ctx.globalAlpha=p.life;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=p.col; ctx.fill();
      return true;
    });
    ctx.globalAlpha=1;
    if(parts.length) raf=requestAnimationFrame(tick);
    else raf=null;
  }

  window.ctBurst = function(n=12){
    spawn(n);
    if(!raf) raf=requestAnimationFrame(tick);
  };
  window.ctResizeParticles = resize;
})();

// ── FLOAT TEXT ────────────────────────────────────────────
function ctFloat(txt){
  const layer=document.getElementById('ctFloatLayer');
  if(!layer) return;
  const el=document.createElement('div');
  el.className='ct-float';
  const dx=(Math.random()-.5)*50;
  el.style.cssText=`left:calc(50% + ${dx}px);top:35%`;
  el.textContent='+'+txt;
  layer.appendChild(el);
  setTimeout(()=>el.remove(), 900);
}

// ── CLICK (called only by pointer events, never keyboard) ─
function ctDoClick(){
  if(curPanel!=='clicker') return;
  const earn=ctEPC();
  ct.c+=earn; ct.te+=earn; ct.tc++;
  ctFloat(ctF(earn));
  if(typeof ctBurst==='function') ctBurst(earn>500?24:earn>50?16:10);
  // Squeeze animation
  const btn=document.getElementById('ctCoinBtn');
  if(btn){ btn.style.transform='scale(0.89)'; setTimeout(()=>btn.style.transform='',90); }
  // Sound (respects ctSoundOn toggle)
  if(typeof ctSoundOn==='undefined' || ctSoundOn){
    try{
      const a=getAudioCtx();
      const o=a.createOscillator(),g=a.createGain();
      o.connect(g); g.connect(a.destination);
      o.frequency.value=350+Math.random()*220+(ct.tc%4)*30;
      g.gain.setValueAtTime(0.07,a.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+0.13);
      o.start(); o.stop(a.currentTime+0.13);
    }catch(e){}
  }
  ctRefresh();
}

// ── BUY ───────────────────────────────────────────────────
function ctDoBuy(id){
  const u=CT_UPG.find(x=>x.id===id);
  if(!u) return;
  const cost=ctCost(u);
  if(ct.c<cost) return;
  ct.c-=cost;
  ct.own[id]=(ct.own[id]||0)+1;
  // Buy sound (respects ctSoundOn toggle)
  if(typeof ctSoundOn==='undefined' || ctSoundOn){
    try{
      const a=getAudioCtx();
      const o=a.createOscillator(),g=a.createGain();
      o.type='triangle'; o.connect(g); g.connect(a.destination);
      o.frequency.setValueAtTime(500,a.currentTime);
      o.frequency.linearRampToValueAtTime(850,a.currentTime+0.1);
      g.gain.setValueAtTime(0.09,a.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+0.18);
      o.start(); o.stop(a.currentTime+0.18);
    }catch(e){}
  }
  ctSave();
  ctRefresh();
}

// ── PRESTIGE ──────────────────────────────────────────────
function ctPrestige(){
  const thresh=Math.pow(10,5+ct.pres);
  if(ct.te<thresh) return;
  ct.pres++; ct.mult=Math.pow(2,ct.pres);
  ct.c=0; ct.te=0; ct.own={};
  // Fanfare
  try{
    const a=getAudioCtx();
    [300,450,600,750,1000,1400].forEach((f,i)=>{
      const o=a.createOscillator(),g=a.createGain();
      o.type='sine'; o.connect(g); g.connect(a.destination);
      o.frequency.value=f;
      g.gain.setValueAtTime(0.08,a.currentTime+i*0.06);
      g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+i*0.06+0.22);
      o.start(a.currentTime+i*0.06); o.stop(a.currentTime+i*0.06+0.22);
    });
  }catch(e){}
  const btn=document.getElementById('ctCoinBtn');
  if(btn){
    btn.style.filter='brightness(5) saturate(0)';
    setTimeout(()=>btn.style.filter='',600);
  }
  if(typeof ctBurst==='function') ctBurst(50);
  ctSave();
  ctRefresh();
}

// ── RENDER SHOP ───────────────────────────────────────────
function ctRenderShop(){
  const list=document.getElementById('ctUpgradeList');
  if(!list) return;

  // Build skeleton cards once — listeners attached ONCE, never re-attached
  if(list.children.length !== CT_UPG.length){
    list.innerHTML='';
    CT_UPG.forEach(u=>{
      const card=document.createElement('div');
      card.className='ct-upg';
      card.dataset.cid=u.id;
      card.setAttribute('tabindex','-1');
      card.addEventListener('pointerdown', function(e){
        e.preventDefault(); e.stopPropagation(); ctDoBuy(u.id);
      });
      card.addEventListener('touchend', function(e){
        e.preventDefault(); e.stopPropagation(); ctDoBuy(u.id);
      });
      card.addEventListener('keydown',  e=>{e.preventDefault();e.stopPropagation();});
      card.addEventListener('keyup',    e=>{e.preventDefault();e.stopPropagation();});
      list.appendChild(card);
    });
  }

  // Update content — innerHTML wipe is safe because listeners are on outer div
  CT_UPG.forEach((u,i)=>{
    const card=list.children[i];
    if(!card) return;
    const owned  = ct.own[u.id]||0;
    const cost   = ctCost(u);
    const afford = ct.c >= cost;
    const hidden = cost > ct.te*6+200 && owned===0;
    const newKey = owned+'|'+(afford?1:0)+'|'+(hidden?1:0);
    if(card.dataset.key === newKey) return; // skip if nothing changed
    card.dataset.key = newKey;
    card.className = 'ct-upg'+(afford?' can-afford':'')+(hidden?' ct-hidden':'');
    card.style.cursor = afford ? 'pointer' : 'default';
    const nextCPS=(u.cps*ct.mult).toFixed(2);
    const totCPS=(owned*u.cps*ct.mult).toFixed(1);
    card.innerHTML=
      '<div class="ct-upg-icon" style="pointer-events:none">'+u.ico+'</div>'+
      '<div class="ct-upg-body" style="pointer-events:none">'+
        '<div class="ct-upg-name">'+u.name+(owned>0?' <span class="ct-owned-count">×'+owned+'</span>':'')+'</div>'+
        '<div class="ct-upg-info">'+u.info+'</div>'+
        (owned>0?'<div class="ct-upg-total">'+totCPS+'/s total</div>':'')+
      '</div>'+
      '<div class="ct-upg-cost" style="pointer-events:none">'+
        '<div class="ct-cost-num '+(afford?'yes':'no')+'">🪙 '+ctF(cost)+'</div>'+
        '<div class="ct-cost-cps">+'+nextCPS+'/s each</div>'+
      '</div>';
  });
}


// ── RENDER PASSIVE LIST ───────────────────────────────────
function ctRenderPassive(){
  const el=document.getElementById('ctAutoList');
  if(!el) return;
  const active=CT_UPG.filter(u=>(ct.own[u.id]||0)>0);
  if(!active.length){
    el.innerHTML='<span style="color:#444;font-size:0.78rem">Buy upgrades to earn coins passively</span>';
    return;
  }
  el.innerHTML=active.map(u=>{
    const cps=((ct.own[u.id]||0)*u.cps*ct.mult).toFixed(1);
    return `<div class="ct-auto-row"><span>${u.ico} ${u.name} ×${ct.own[u.id]}</span><b style="color:#00f5a0">${cps}/s</b></div>`;
  }).join('');
}

// ── RENDER MILESTONES ─────────────────────────────────────
function ctRenderMS(){
  const el=document.getElementById('ctMilestones');
  if(!el) return;
  if(!el.children.length){
    CT_MS.forEach(m=>{
      const s=document.createElement('span');
      s.id='ctms-'+m.id;
      s.className='ct-badge';
      s.innerHTML=`<span>${m.ico}</span> ${m.lbl}`;
      el.appendChild(s);
    });
  }
  CT_MS.forEach(m=>{
    const b=document.getElementById('ctms-'+m.id);
    if(!b) return;
    const done=m.chk(ct);
    if(done && !ct.ms.has(m.id)){
      ct.ms.add(m.id);
      b.classList.add('earned','ct-pop');
      setTimeout(()=>b.classList.remove('ct-pop'),400);
    } else if(done){
      b.classList.add('earned');
    }
  });
}

// ── PROGRESS BAR ─────────────────────────────────────────
function ctRenderProgress(){
  const thresh=Math.pow(10,5+ct.pres);
  const pct=Math.min(100,ct.te/thresh*100);
  const bar=document.getElementById('ctProgressBar');
  const goal=document.getElementById('ctPrestigeGoal');
  if(bar) bar.style.width=pct+'%';
  if(goal){
    if(ct.te>=thresh){ goal.textContent='Ready! ✓'; goal.style.color='#c4b5fd'; }
    else { goal.textContent=ctF(thresh-ct.te)+' to go'; goal.style.color='#555'; }
  }
}

// ── FULL REFRESH (called after every state change) ────────
function ctRefresh(){
  const g=id=>document.getElementById(id);
  if(!g('ctCoins')) return;
  g('ctCoins').textContent    = ctF(ct.c);
  g('ctPerClick').textContent = ctF(ctEPC());
  g('ctPerSec').textContent   = ctF(ctCPS())+'/s';
  g('ctPrestige').textContent = '×'+ct.mult;
  g('ctTotal').textContent    = ctF(ct.te);
  if(g('ctClicks')) g('ctClicks').textContent = ctF(ct.tc);

  const thresh=Math.pow(10,5+ct.pres);
  const pb=g('ctPrestigeBtn');
  if(pb){
    const show=ct.te>=thresh;
    pb.style.display=show?'block':'none';
    if(show) pb.textContent=`⭐ PRESTIGE — Reset & Earn ×${ct.mult*2} Forever`;
  }
  ctRenderProgress();
  ctRenderShop();
  ctRenderPassive();
  ctRenderMS();
}

// ── SAVE / LOAD ───────────────────────────────────────────
function ctSave(){
  try{
    localStorage.setItem('ct_v4',JSON.stringify({
      c:ct.c, te:ct.te, tc:ct.tc,
      pres:ct.pres, mult:ct.mult,
      own:ct.own, ms:[...ct.ms]
    }));
  }catch(e){}
}
function ctLoad(){
  try{
    const raw=localStorage.getItem('ct_v4');
    if(!raw) return;
    const d=JSON.parse(raw);
    ct.c=d.c||0; ct.te=d.te||0; ct.tc=d.tc||0;
    ct.pres=d.pres||0; ct.mult=d.mult||1;
    ct.own=d.own||{}; ct.ms=new Set(d.ms||[]);
  }catch(e){}
}

// ── PASSIVE TICK ─────────────────────────────────────────
function ctStartTick(){
  if(ct.iv) clearInterval(ct.iv);
  ct.iv=setInterval(()=>{
    if(curPanel!=='clicker') return;
    const cps=ctCPS();
    if(cps>0){ const g=cps/10; ct.c+=g; ct.te+=g; }
    ct.tick++;
    // Full refresh every 200ms (every 2 ticks)
    if(ct.tick%2===0) ctRefresh();
    // Autosave every 10s
    if(ct.tick%100===0) ctSave();
  },100);
}

// ── COIN BUTTON WIRE-UP ───────────────────────────────────
// Done here (after DOM ready) — pointer only, no keyboard path
(function wireCoinBtn(){
  const btn=document.getElementById('ctCoinBtn');
  if(!btn) return;
  btn.setAttribute('tabindex','-1');
  // Remove any onclick attribute binding to be sure
  btn.removeAttribute('onclick');

  let _pointerDown=false;
  btn.addEventListener('pointerdown', e=>{
    if(e.button!==undefined && e.button!==0) return; // left only
    e.preventDefault(); e.stopPropagation();
    _pointerDown=true;
    ctDoClick();
  });
  btn.addEventListener('pointerup',   e=>{ _pointerDown=false; });
  btn.addEventListener('touchstart',  e=>{ e.preventDefault(); },  {passive:false});
  btn.addEventListener('touchend',    e=>{ e.preventDefault(); ctDoClick(); },{passive:false});
  btn.addEventListener('keydown',     e=>{ e.preventDefault(); });
  btn.addEventListener('keyup',       e=>{ e.preventDefault(); });
})();

// ── PRESTIGE BUTTON: no keyboard ─────────────────────────
(function(){
  const pb=document.getElementById('ctPrestigeBtn');
  if(!pb) return;
  pb.setAttribute('tabindex','-1');
  pb.addEventListener('keydown', e=>e.preventDefault());
})();

// ── GLOBAL ENTER GUARD ────────────────────────────────────
// Nuke Enter/Space completely while clicker panel is active
document.addEventListener('keydown', function ctKeyGuard(e){
  const panel=document.getElementById('panel-clicker');
  if(!panel || panel.style.display==='none') return;
  if(e.key==='Enter' || e.key===' '){
    e.preventDefault();
    e.stopImmediatePropagation();
  }
}, true); // capture phase — fires before any other handler

// ── SOUND TOGGLE ──────────────────────────────────────────
let ctSoundOn = true;
(function(){
  try { ctSoundOn = localStorage.getItem('ct_snd') !== '0'; } catch(e){}
  function updateBtn(){
    const b=document.getElementById('ctSoundBtn');
    if(!b) return;
    if(ctSoundOn){ b.textContent='🔊 Sound ON';  b.className='ct-sound-btn on'; }
    else          { b.textContent='🔇 Sound OFF'; b.className='ct-sound-btn off'; }
  }
  updateBtn();
  const b=document.getElementById('ctSoundBtn');
  if(b){
    b.addEventListener('pointerdown',function(e){
      e.preventDefault(); e.stopPropagation();
      ctSoundOn=!ctSoundOn;
      try{ localStorage.setItem('ct_snd', ctSoundOn?'1':'0'); }catch(e2){}
      updateBtn();
    });
    b.addEventListener('touchend',function(e){ e.preventDefault(); });
    b.addEventListener('keydown',function(e){ e.preventDefault(); });
  }
})();

// ── WORLD CANVAS ENGINE  v3 — Beautiful City ─────────────
(function(){
  const WCV = document.getElementById('ctWorldCanvas');
  if(!WCV) return;
  const WCX = WCV.getContext('2d');

  /* Each upgrade contributes height to the skyscraper.
     More expensive = more floors. */
  const UPG_CONTRIB = {
    cursor:  { h:3,   floor:'#3a5a8a', window:'#a0d0ff', glow:'#60aaff', label:'Cursor'  },
    intern:  { h:6,   floor:'#5a7a2a', window:'#c0ff80', glow:'#80ff40', label:'Intern'  },
    miner:   { h:11,  floor:'#7a5020', window:'#ffc080', glow:'#ff9040', label:'Miner'   },
    factory: { h:18,  floor:'#8a3a20', window:'#ffa060', glow:'#ff6020', label:'Factory' },
    bank:    { h:30,  floor:'#206050', window:'#60ffc0', glow:'#00ffaa', label:'Bank'    },
    lab:     { h:48,  floor:'#502080', window:'#d090ff', glow:'#c060ff', label:'Lab'     },
    rocket:  { h:75,  floor:'#802020', window:'#ff8080', glow:'#ff4040', label:'Rocket'  },
    ai:      { h:115, floor:'#106060', window:'#40ffff', glow:'#00e8ff', label:'AI'      },
    portal:  { h:170, floor:'#602060', window:'#ff80ff', glow:'#ff40ff', label:'Portal'  },
  };

  let wW=400, wH=420;
  let wRaf=null;
  let cityH=0, targetH=0;           // animated height
  let stars=[], clouds=[];
  let particles=[];
  let lastOwned={}, lastCheck=0;

  /* Crane state */
  const crane={
    x:0, topY:0,                    // base position (right edge of roof)
    jibAngle: -0.18,                // horizontal arm angle (radians from horizontal)
    jibDir: 1,
    hookY: 0,                       // rope length (animated)
    hookTargetY: 40,
    active: false,
    activeTimer: 0,
  };

  function calcTarget(){
    let h=0;
    CT_UPG.forEach(u=>{ const d=UPG_CONTRIB[u.id]; if(d) h+=(ct.own[u.id]||0)*d.h; });
    return Math.min(h, wH*0.86);
  }

  function initStars(){
    stars=[];
    for(let i=0;i<100;i++) stars.push({
      x:Math.random()*wW, y:Math.random()*wH*0.72,
      r:Math.random()*1.5+0.2, a:0.3+Math.random()*0.7,
      da:(Math.random()-0.5)*0.007,
    });
  }
  function initClouds(){
    clouds=[];
    for(let i=0;i<3;i++) clouds.push({
      x:-80+Math.random()*wW, y:15+Math.random()*wH*0.22,
      w:50+Math.random()*70, h:14+Math.random()*16,
      spd:0.08+Math.random()*0.14,
    });
  }

  function resize(){
    const p=WCV.parentElement;
    const r=p.getBoundingClientRect();
    wW=Math.max(160,r.width||280);
    wH=Math.max(260,Math.min(540,r.height||420));
    WCV.width=wW; WCV.height=wH;
    WCV.style.height=wH+'px';
    initStars(); initClouds();
  }

  function spawnSparks(x,y){
    const cols=['#ffd700','#ff9800','#ffffff','#ffee58','#ff7043'];
    for(let i=0;i<14;i++){
      const a=Math.random()*Math.PI*2, s=1.5+Math.random()*3;
      particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,
        life:1, dec:0.03+Math.random()*0.04,
        r:1.5+Math.random()*3, col:cols[~~(Math.random()*cols.length)]});
    }
  }

  function checkOwned(){
    let changed=false;
    CT_UPG.forEach(u=>{
      const n=ct.own[u.id]||0;
      if((lastOwned[u.id]||0)!==n){ changed=true; lastOwned[u.id]=n; }
    });
    if(changed){
      targetH=calcTarget();
      crane.active=true; crane.activeTimer=180;
      // sparks near top
      const bx=wW*0.5+(Math.random()-0.5)*wW*0.3;
      const by=wH-cityH-5;
      spawnSparks(bx,by);
    }
  }

  /* ── Draw starfield background ── */
  function drawBg(){
    const bg=WCX.createLinearGradient(0,0,0,wH);
    bg.addColorStop(0,'#010108');
    bg.addColorStop(0.55,'#030510');
    bg.addColorStop(1,'#050a08');
    WCX.fillStyle=bg; WCX.fillRect(0,0,wW,wH);

    stars.forEach(s=>{
      s.a+=s.da; if(s.a<0.15) s.da=Math.abs(s.da); if(s.a>1) s.da=-Math.abs(s.da);
      WCX.globalAlpha=s.a; WCX.fillStyle='#fff';
      WCX.beginPath(); WCX.arc(s.x,s.y,s.r,0,Math.PI*2); WCX.fill();
    });
    WCX.globalAlpha=1;

    // Moon
    const mx=wW*0.8, my=wH*0.1;
    const mg=WCX.createRadialGradient(mx,my,1,mx,my,22);
    mg.addColorStop(0,'rgba(255,252,220,1)');
    mg.addColorStop(0.5,'rgba(255,248,200,0.5)');
    mg.addColorStop(1,'transparent');
    WCX.fillStyle=mg; WCX.beginPath(); WCX.arc(mx,my,22,0,Math.PI*2); WCX.fill();
    WCX.fillStyle='rgba(255,252,220,0.95)';
    WCX.beginPath(); WCX.arc(mx,my,10,0,Math.PI*2); WCX.fill();

    // Clouds
    clouds.forEach(cl=>{
      cl.x+=cl.spd; if(cl.x>wW+cl.w) cl.x=-cl.w;
      WCX.globalAlpha=0.07;
      WCX.fillStyle='#b0c8ff';
      WCX.beginPath(); WCX.ellipse(cl.x,cl.y,cl.w*0.5,cl.h*0.4,0,0,Math.PI*2); WCX.fill();
      WCX.beginPath(); WCX.ellipse(cl.x-cl.w*0.22,cl.y+4,cl.w*0.3,cl.h*0.32,0,0,Math.PI*2); WCX.fill();
      WCX.beginPath(); WCX.ellipse(cl.x+cl.w*0.2,cl.y+5,cl.w*0.24,cl.h*0.28,0,0,Math.PI*2); WCX.fill();
    });
    WCX.globalAlpha=1;
  }

  /* ── Draw ground & road ── */
  function drawGround(){
    const gy=wH-10;
    const gg=WCX.createLinearGradient(0,gy,0,wH);
    gg.addColorStop(0,'#1a2e14'); gg.addColorStop(1,'#060c04');
    WCX.fillStyle=gg; WCX.fillRect(0,gy,wW,wH-gy);
    // Road
    const rg=WCX.createLinearGradient(0,wH-10,0,wH);
    rg.addColorStop(0,'#222222'); rg.addColorStop(1,'#141414');
    WCX.fillStyle=rg; WCX.fillRect(0,wH-10,wW,10);
    // Center line
    WCX.save();
    WCX.setLineDash([14,16]); WCX.strokeStyle='rgba(255,220,50,0.22)'; WCX.lineWidth=2;
    WCX.beginPath(); WCX.moveTo(0,wH-5); WCX.lineTo(wW,wH-5); WCX.stroke();
    WCX.setLineDash([]);
    WCX.restore();
    // Pavement reflection
    WCX.save();
    WCX.globalAlpha=0.12;
    const ref=WCX.createLinearGradient(0,wH-10,wW,wH-10);
    ref.addColorStop(0,'transparent'); ref.addColorStop(0.5,'#6080ff'); ref.addColorStop(1,'transparent');
    WCX.fillStyle=ref; WCX.fillRect(0,wH-10,wW,3);
    WCX.restore();
  }

  /* ── Determine dominant color from owned upgrades ── */
  function getDomColor(){
    let bestH=0, col={floor:'#304060',window:'#80a0d0',glow:'#6080ff'};
    CT_UPG.forEach(u=>{
      const d=UPG_CONTRIB[u.id]; if(!d) return;
      const contribution=(ct.own[u.id]||0)*d.h;
      if(contribution>bestH){ bestH=contribution; col=d; }
    });
    return col;
  }

  /* ── MAIN BUILDING ── */
  function drawBuilding(){
    if(cityH<4) return;
    const dom=getDomColor();

    const bW  = wW*0.56;              // building width
    const bX  = (wW-bW)/2;           // centered
    const bTop= wH-10-cityH;         // top of building (above ground)
    const bBot= wH-10;               // bottom (ground level)
    const flH = 18;                   // floor height in pixels

    /* ── Ambient ground glow (reflection on road) ── */
    const glow=WCX.createRadialGradient(wW/2,bBot,10,wW/2,bBot,bW*0.7);
    glow.addColorStop(0,dom.glow+'40');
    glow.addColorStop(1,'transparent');
    WCX.fillStyle=glow;
    WCX.beginPath(); WCX.ellipse(wW/2,bBot,bW*0.7,20,0,0,Math.PI*2); WCX.fill();

    /* ── Building body ── */
    // Slight perspective taper: top is 8% narrower than base
    const taper=bW*0.08;
    WCX.save();
    WCX.beginPath();
    WCX.moveTo(bX+taper, bTop);
    WCX.lineTo(bX+bW-taper, bTop);
    WCX.lineTo(bX+bW, bBot);
    WCX.lineTo(bX, bBot);
    WCX.closePath();

    // Face gradient
    const faceG=WCX.createLinearGradient(bX,bTop,bX+bW,bBot);
    faceG.addColorStop(0,  dom.floor+'cc');
    faceG.addColorStop(0.3,dom.floor+'ee');
    faceG.addColorStop(0.7,dom.floor+'bb');
    faceG.addColorStop(1,  dom.floor+'99');
    WCX.fillStyle=faceG;
    // Outer glow
    WCX.shadowColor=dom.glow; WCX.shadowBlur=30;
    WCX.fill();
    WCX.restore();

    /* ── Floor lines ── */
    WCX.save();
    WCX.beginPath();
    WCX.moveTo(bX+taper, bTop);
    WCX.lineTo(bX+bW-taper, bTop);
    WCX.lineTo(bX+bW, bBot);
    WCX.lineTo(bX, bBot);
    WCX.closePath();
    WCX.clip();
    const floors=Math.floor(cityH/flH);
    WCX.strokeStyle=dom.glow+'25'; WCX.lineWidth=1;
    for(let f=1;f<=floors+1;f++){
      const y=bBot-f*flH;
      WCX.beginPath(); WCX.moveTo(bX-4,y); WCX.lineTo(bX+bW+4,y); WCX.stroke();
    }
    WCX.restore();

    /* ── Vertical pillar lines ── */
    WCX.save();
    WCX.strokeStyle=dom.glow+'30'; WCX.lineWidth=1;
    const cols=Math.max(3,Math.floor(bW/32));
    for(let col=1;col<cols;col++){
      const px=bX+(bW/cols)*col;
      WCX.beginPath(); WCX.moveTo(px,bTop+4); WCX.lineTo(px,bBot); WCX.stroke();
    }
    WCX.restore();

    /* ── Left/right façade depth strips ── */
    // Left dark face
    WCX.save();
    const sideW=bW*0.07;
    const sideG=WCX.createLinearGradient(bX-sideW,0,bX,0);
    sideG.addColorStop(0,'transparent');
    sideG.addColorStop(1,dom.floor+'88');
    WCX.fillStyle=sideG; WCX.shadowColor='transparent'; WCX.shadowBlur=0;
    WCX.beginPath();
    WCX.moveTo(bX-sideW, bBot-2);
    WCX.lineTo(bX+taper, bTop);
    WCX.lineTo(bX, bBot);
    WCX.closePath();
    WCX.fill();
    // Right dark face
    const sideG2=WCX.createLinearGradient(bX+bW,0,bX+bW+sideW,0);
    sideG2.addColorStop(0,dom.floor+'66');
    sideG2.addColorStop(1,'transparent');
    WCX.fillStyle=sideG2;
    WCX.beginPath();
    WCX.moveTo(bX+bW-taper, bTop);
    WCX.lineTo(bX+bW+sideW, bBot-2);
    WCX.lineTo(bX+bW, bBot);
    WCX.closePath();
    WCX.fill();
    WCX.restore();

    /* ── Bright edge lines ── */
    WCX.save();
    WCX.shadowColor=dom.glow; WCX.shadowBlur=14;
    WCX.strokeStyle=dom.glow+'cc'; WCX.lineWidth=2;
    WCX.beginPath(); WCX.moveTo(bX+taper,bTop); WCX.lineTo(bX,bBot); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(bX+bW-taper,bTop); WCX.lineTo(bX+bW,bBot); WCX.stroke();
    WCX.restore();

    /* ── Roof edge bright line ── */
    WCX.save();
    WCX.shadowColor=dom.glow; WCX.shadowBlur=20;
    WCX.strokeStyle=dom.glow; WCX.lineWidth=2.5;
    WCX.beginPath(); WCX.moveTo(bX+taper,bTop); WCX.lineTo(bX+bW-taper,bTop); WCX.stroke();
    WCX.restore();

    /* ── Windows ── */
    WCX.save();
    WCX.beginPath();
    WCX.moveTo(bX+taper,bTop); WCX.lineTo(bX+bW-taper,bTop);
    WCX.lineTo(bX+bW,bBot); WCX.lineTo(bX,bBot); WCX.closePath();
    WCX.clip();
    const wCols=Math.max(2,Math.floor(bW/28));
    const wRows=Math.max(1,Math.floor(cityH/flH));
    const wPadX=14, wPadY=5, wW2=9, wH2=11;
    for(let row=0;row<wRows;row++){
      for(let col=0;col<wCols;col++){
        const wx=bX+wPadX+col*((bW-wPadX*2)/Math.max(1,wCols-1));
        const wy=bBot-flH*row-wPadY-wH2;
        // Random seed per window
        const seed=(row*37+col*13)%7;
        const lit=seed<5;
        if(!lit){ WCX.globalAlpha=0.12; WCX.fillStyle='#203060'; }
        else {
          WCX.globalAlpha=0.6+Math.sin(Date.now()*0.002+row*col*0.4)*0.12;
          WCX.fillStyle=dom.window;
          WCX.shadowColor=dom.window; WCX.shadowBlur=8;
        }
        WCX.fillRect(wx-wW2/2, wy, wW2, wH2);
        WCX.shadowBlur=0;
      }
    }
    WCX.restore();

    /* ── Setback / step on top 25% of building if tall enough ── */
    if(cityH>80){
      const stepH=cityH*0.22;
      const stepW=bW*0.55;
      const stepX=(wW-stepW)/2;
      const stepTop=bTop;
      WCX.save();
      WCX.fillStyle=dom.floor+'dd';
      WCX.shadowColor=dom.glow; WCX.shadowBlur=20;
      WCX.fillRect(stepX, stepTop, stepW, stepH);
      WCX.strokeStyle=dom.glow+'aa'; WCX.lineWidth=2;
      WCX.strokeRect(stepX, stepTop, stepW, stepH);
      WCX.restore();
    }

    /* ── Antenna & blinking light ── */
    const antX=wW/2, antBot=bTop, antTop=bTop-22-Math.min(cityH*0.1,30);
    WCX.save();
    WCX.strokeStyle=dom.glow+'bb'; WCX.lineWidth=2; WCX.shadowColor=dom.glow; WCX.shadowBlur=10;
    WCX.beginPath(); WCX.moveTo(antX,antBot); WCX.lineTo(antX,antTop); WCX.stroke();
    // Blinking red beacon
    const blink=Math.sin(Date.now()*0.0035)>0;
    WCX.fillStyle=blink?'#ff3030':'#880000';
    WCX.shadowColor=blink?'#ff3030':'transparent'; WCX.shadowBlur=blink?12:0;
    WCX.beginPath(); WCX.arc(antX,antTop,3.5,0,Math.PI*2); WCX.fill();
    WCX.restore();

    /* ── "YOUR EMPIRE" label ── */
    WCX.save();
    WCX.textAlign='center'; WCX.textBaseline='middle';
    WCX.font='bold 12px "Bebas Neue",sans-serif';
    WCX.shadowColor='rgba(255,220,60,1)'; WCX.shadowBlur=20;
    WCX.fillStyle='rgba(255,235,100,0.98)';
    WCX.fillText('YOUR EMPIRE', wW/2, 18);
    if(targetH>0){
      WCX.font='10px sans-serif'; WCX.shadowBlur=8; WCX.fillStyle='rgba(160,200,255,0.8)';
      const lvl=Math.max(1,~~(targetH/8));
      WCX.fillText('Level '+lvl, wW/2, 32);
    }
    WCX.restore();
  }

  /* ── CRANE — proper tower crane ── */
  function drawCrane(){
    if(cityH<8) return;
    if(crane.activeTimer>0) crane.activeTimer--;
    else crane.active=false;

    // Crane sits on right edge of roof
    const bW=wW*0.56, bX=(wW-bW)/2;
    const bTop=wH-10-cityH;
    const cx=bX+bW-4;   // base X (right edge)
    const cy=bTop;       // base Y (roof level)

    // Mast height: 45px or 30% of building, whichever is smaller
    const mastH=Math.min(48, cityH*0.32+16);
    const mastTop=cy-mastH;

    WCX.save();
    WCX.shadowColor='#aaaacc'; WCX.shadowBlur=6;

    // ── Mast (vertical tower) ──
    // Double-beam lattice mast
    WCX.strokeStyle='#8888bb'; WCX.lineWidth=3.5;
    WCX.beginPath(); WCX.moveTo(cx-3,cy); WCX.lineTo(cx-3,mastTop); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(cx+3,cy); WCX.lineTo(cx+3,mastTop); WCX.stroke();
    // Cross braces on mast
    WCX.strokeStyle='#7070aa'; WCX.lineWidth=1.5;
    const braces=Math.max(2,~~(mastH/12));
    for(let i=0;i<braces;i++){
      const by=cy-i*(mastH/braces)-mastH/braces/2;
      WCX.beginPath();
      WCX.moveTo(cx-3,by); WCX.lineTo(cx+3,by-mastH/braces); WCX.stroke();
      WCX.beginPath();
      WCX.moveTo(cx+3,by); WCX.lineTo(cx-3,by-mastH/braces); WCX.stroke();
    }
    // Mast cap
    WCX.fillStyle='#aaaace'; WCX.beginPath(); WCX.arc(cx,mastTop,4,0,Math.PI*2); WCX.fill();

    // ── Operator cabin ──
    WCX.fillStyle='#4466aa';
    WCX.strokeStyle='#6688cc'; WCX.lineWidth=1;
    WCX.fillRect(cx-9,mastTop+2,10,9);
    WCX.strokeRect(cx-9,mastTop+2,10,9);
    // Cabin window
    WCX.fillStyle='rgba(140,220,255,0.6)';
    WCX.fillRect(cx-7,mastTop+4,4,5);

    // ── Counter-jib (short rear arm) ──
    WCX.strokeStyle='#9999cc'; WCX.lineWidth=3;
    WCX.beginPath(); WCX.moveTo(cx,mastTop); WCX.lineTo(cx+22,mastTop); WCX.stroke();
    // Counter-weight block
    WCX.fillStyle='#555577';
    WCX.fillRect(cx+14,mastTop-5,12,8);

    // ── Main jib (long arm — swings) ──
    if(crane.active){
      crane.jibAngle+=0.006*crane.jibDir;
      if(crane.jibAngle>0.12||crane.jibAngle<-0.3) crane.jibDir*=-1;
    }
    const jibLen=Math.min(70, bW*0.55+20);

    WCX.save();
    WCX.translate(cx, mastTop);
    WCX.rotate(crane.jibAngle);

    // Jib double-beam
    WCX.strokeStyle='#8888bb'; WCX.lineWidth=3;
    WCX.beginPath(); WCX.moveTo(0,-2.5); WCX.lineTo(-jibLen,-2.5); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(0, 2.5); WCX.lineTo(-jibLen, 2.5); WCX.stroke();
    // Jib cross braces
    WCX.strokeStyle='#7070aa'; WCX.lineWidth=1.2;
    const jbr=Math.max(3,~~(jibLen/18));
    for(let i=0;i<jbr;i++){
      const bx2=-i*(jibLen/jbr)-jibLen/jbr/2;
      WCX.beginPath(); WCX.moveTo(bx2,-2.5); WCX.lineTo(bx2-jibLen/jbr,2.5); WCX.stroke();
    }
    // Jib tip
    WCX.fillStyle='#aaaace'; WCX.beginPath(); WCX.arc(-jibLen,0,3,0,Math.PI*2); WCX.fill();

    // Support cable from mast top to jib tip
    WCX.strokeStyle='#aaaacc88'; WCX.lineWidth=1.2;
    WCX.beginPath(); WCX.moveTo(0,-4); WCX.lineTo(-jibLen,-2.5); WCX.stroke();

    // Trolley on jib (travels along arm)
    const trolleyX=crane.active ? -jibLen*(0.4+Math.sin(Date.now()*0.0008)*0.3) : -jibLen*0.55;
    WCX.fillStyle='#cc8844';
    WCX.fillRect(trolleyX-5,-6,10,6);

    // Hook rope
    crane.hookY+=(crane.hookTargetY-crane.hookY)*0.04;
    if(crane.active && Math.random()<0.02){
      crane.hookTargetY = 25+Math.random()*40;
    }
    WCX.strokeStyle='#aaaacc'; WCX.lineWidth=1.5;
    WCX.beginPath(); WCX.moveTo(trolleyX,0); WCX.lineTo(trolleyX,crane.hookY); WCX.stroke();

    // Hook (J-shaped)
    const hx=trolleyX, hy=crane.hookY;
    WCX.strokeStyle='#ccccee'; WCX.lineWidth=2.5;
    WCX.lineCap='round';
    WCX.beginPath();
    WCX.moveTo(hx,hy);
    WCX.lineTo(hx,hy+6);
    WCX.arc(hx+2,hy+6,3,Math.PI,-0.2,false);
    WCX.stroke();

    WCX.restore(); // end jib transform
    WCX.restore(); // end crane shadow
  }

  /* ── Sparks ── */
  function drawSparks(){
    particles=particles.filter(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.09; p.vx*=0.97;
      p.life-=p.dec; if(p.life<=0) return false;
      WCX.save();
      WCX.globalAlpha=p.life;
      WCX.fillStyle=p.col; WCX.shadowColor=p.col; WCX.shadowBlur=6;
      WCX.beginPath(); WCX.arc(p.x,p.y,p.r,0,Math.PI*2); WCX.fill();
      WCX.restore(); return true;
    });
  }

  /* ── Empty placeholder ── */
  function drawEmpty(){
    WCX.save();
    WCX.globalAlpha=0.3;
    WCX.textAlign='center'; WCX.textBaseline='middle';
    WCX.font='bold 13px sans-serif'; WCX.fillStyle='#7080c0';
    WCX.fillText('Buy upgrades to build your city!', wW/2, wH/2-10);
    WCX.font='32px serif'; WCX.fillText('🏗️', wW/2, wH/2+28);
    WCX.restore();
  }

  /* ── Main tick ── */
  function tick(){
    wRaf=requestAnimationFrame(tick);

    drawBg();

    const now=Date.now();
    if(now-lastCheck>280){ lastCheck=now; checkOwned(); }

    // Smooth height animation — accelerates when far, decelerates near target
    if(cityH<targetH){
      const gap=targetH-cityH;
      cityH+=Math.max(0.08, gap*0.016);
      if(cityH>targetH) cityH=targetH;
    }

    drawGround();
    if(cityH>2){ drawBuilding(); drawCrane(); } else { drawEmpty(); }
    drawSparks();
  }

  function startWorld(){
    if(wRaf) return;
    resize();
    targetH=calcTarget();
    cityH=Math.min(targetH*0.05,5);
    tick();
  }
  function stopWorld(){
    if(wRaf){ cancelAnimationFrame(wRaf); wRaf=null; }
  }

  window.ctWorldStart  = startWorld;
  window.ctWorldStop   = stopWorld;
  window.ctWorldResize = resize;

  if(window.ResizeObserver)
    new ResizeObserver(()=>{ if(wRaf) resize(); }).observe(WCV.parentElement||WCV);
})();

// ── INIT ─────────────────────────────────────────────────
ctLoad();
ctStartTick();
ctRefresh();

// Wire prestige button
(function(){
  const pb=document.getElementById('ctPrestigeBtn');
  if(!pb) return;
  pb.setAttribute('tabindex','-1');
  pb.addEventListener('pointerdown',function(e){ e.preventDefault(); e.stopPropagation(); ctPrestige(); });
  pb.addEventListener('touchend',function(e){ e.preventDefault(); e.stopPropagation(); ctPrestige(); });
  pb.addEventListener('keydown',function(e){ e.preventDefault(); });
})();

// Start world when clicker panel becomes visible
const _origSwitchForCT = switchPanel;
switchPanel = function(p, fromPop){
  _origSwitchForCT(p, fromPop);
  if(p==='clicker'){
    if(typeof ctWorldStart==='function') setTimeout(ctWorldStart, 50);
  } else {
    if(typeof ctWorldStop==='function') ctWorldStop();
  }
};

// Extra CSS
(function(){
  const s=document.createElement('style');
  s.textContent=`
.ct-hidden { display:none !important; }
.ct-coin   { outline:none !important; }
.ct-upg    { outline:none !important; }
.ct-prestige-btn { outline:none !important; }
.ct-owned-count  { color:#00f5a0; font-weight:700; font-size:0.82rem; }
.ct-upg-total    { font-size:0.66rem; color:#00c880; margin-top:2px; }
.ct-upg-info     { font-size:0.7rem; color:#50507a; line-height:1.35; margin-top:2px; }
.ct-upg-name     { font-size:0.9rem; font-weight:700; color:#d8d8f0; margin-bottom:2px; }
.ct-cost-num     { font-family:'Bebas Neue',sans-serif; font-size:1.1rem; letter-spacing:.05em; }
.ct-cost-num.yes { color:#ffd600; }
.ct-cost-num.no  { color:#333355; }
.ct-cost-cps     { font-size:0.62rem; color:#50507a; margin-top:2px; }
`;
  document.head.appendChild(s);
})();
</script>

</body>
</html>
