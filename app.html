<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ═══ PRIMARY SEO ═══ -->
<title>Reaction Speed Test – Measure Your Reflex Time Online</title>
<meta name="description" content="Test your reaction speed instantly with our free online tool. Measure your reflex time, improve focus, and challenge your friends. Try it now!">
<meta name="keywords" content="reaction speed test, reaction time test, reflex test, measure reaction time, human benchmark, online reaction test, reflex time test, response time test, free reaction test, reaction time ms, reflex speed test, click speed test CPS, typing speed test WPM, jitter click test, spacebar speed test, stimulation clicker, clicker tycoon, number memory test, brain games online, snake game, dinosaur game, coreball, cognitive test">
<link rel="canonical" href="https://reactionspeedtest.com/">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large">
<meta name="author" content="Reaction Speed Test">
<meta name="copyright" content="Reaction Speed Test">
<meta name="language" content="English">
<meta name="revisit-after" content="7 days">
<meta name="rating" content="general">
<meta name="theme-color" content="#06060e">

<!-- Alternate page URLs -->
<link rel="alternate" href="https://reactionspeedtest.com/reaction-time-test">
<link rel="alternate" href="https://reactionspeedtest.com/clicker-tycoon">
<link rel="alternate" href="https://reactionspeedtest.com/click-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/jitter-click-test">
<link rel="alternate" href="https://reactionspeedtest.com/spacebar-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/stimulation-clicker">
<link rel="alternate" href="https://reactionspeedtest.com/typing-speed-test">
<link rel="alternate" href="https://reactionspeedtest.com/dinosaur-game">
<link rel="alternate" href="https://reactionspeedtest.com/coreball-game">
<link rel="alternate" href="https://reactionspeedtest.com/number-memory-test">
<link rel="alternate" href="https://reactionspeedtest.com/snake-game">

<!-- ═══ OPEN GRAPH / SOCIAL ═══ -->
<meta property="og:type" content="website">
<meta property="og:title" content="Reaction Speed Test – Measure Your Reflex Time Online">
<meta property="og:description" content="Test your reaction speed instantly with our free online tool. Measure your reflex time, improve focus, and challenge your friends. Try it now!">
<meta property="og:url" content="https://reactionspeedtest.com/">
<meta property="og:image" content="https://reactionspeedtest.com/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="Reaction Speed Test – Free Online Reflex Test">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Reaction Speed Test">

<!-- ═══ TWITTER CARD ═══ -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Reaction Speed Test – Measure Your Reflex Time Online">
<meta name="twitter:description" content="Test your reaction speed instantly with our free online tool. Measure your reflex time, improve focus, and challenge your friends.">
<meta name="twitter:image" content="https://reactionspeedtest.com/og-image.png">
<meta name="twitter:image:alt" content="Reaction Speed Test">

<!-- ═══ FAVICON ═══ -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%2306060e'/><text y='24' x='4' font-size='22'>⚡</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%2306060e'/><text y='24' x='4' font-size='22'>⚡</text></svg>">

<!-- ═══ PRECONNECT (Core Web Vitals / LCP improvement) ═══ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- ═══ STRUCTURED DATA (JSON-LD) ═══ -->

<!-- 1. Organization -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": "https://reactionspeedtest.com/#org",
  "name": "Reaction Speed Test",
  "alternateName": "Reflex Lab",
  "url": "https://reactionspeedtest.com/",
  "logo": {
    "@type": "ImageObject",
    "url": "https://reactionspeedtest.com/og-image.png",
    "width": 1200,
    "height": 630
  },
  "description": "Free online reaction speed test and reflex training tools. Measure your reaction time, click speed, typing speed and more.",
  "sameAs": [
    "https://reactionspeedtest.com/",
    "https://reactionspeedtest.com/reaction-time-test"
  ]
}
</script>

<!-- 2. WebSite with SearchAction -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": "https://reactionspeedtest.com/#website",
  "name": "Reaction Speed Test – Measure Your Reflex Time Online",
  "alternateName": "Reflex Lab",
  "url": "https://reactionspeedtest.com/",
  "description": "Test your reaction speed instantly with our free online tool. Measure your reflex time, improve focus, and challenge your friends.",
  "publisher": { "@id": "https://reactionspeedtest.com/#org" },
  "potentialAction": {
    "@type": "SearchAction",
    "target": { "@type": "EntryPoint", "urlTemplate": "https://reactionspeedtest.com/?q={search_term_string}" },
    "query-input": "required name=search_term_string"
  }
}
</script>

<!-- 3. WebPage -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "@id": "https://reactionspeedtest.com/#webpage",
  "url": "https://reactionspeedtest.com/",
  "name": "Reaction Speed Test – Measure Your Reflex Time Online",
  "description": "Test your reaction speed instantly with our free online tool. Measure your reflex time, improve focus, and challenge your friends. Try it now!",
  "isPartOf": { "@id": "https://reactionspeedtest.com/#website" },
  "about": { "@id": "https://reactionspeedtest.com/#org" },
  "breadcrumb": { "@id": "https://reactionspeedtest.com/#breadcrumb" },
  "inLanguage": "en-US",
  "speakable": { "@type": "SpeakableSpecification", "cssSelector": [".gtitle", ".gsub"] }
}
</script>

<!-- 4. Primary tool – Reaction Speed Test app -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "@id": "https://reactionspeedtest.com/#reaction-test",
  "name": "Reaction Speed Test",
  "alternateName": ["Reaction Time Test", "Reflex Test", "Human Benchmark Reaction Test", "Online Reflex Tester", "Reflex Speed Test"],
  "url": "https://reactionspeedtest.com/reaction-time-test",
  "description": "Free online reaction speed test. Measure your reflex time in milliseconds and compare to human benchmarks. Average human reaction time is 200–250ms. Used by gamers, students and athletes.",
  "applicationCategory": "UtilitiesApplication",
  "applicationSubCategory": "Cognitive Test",
  "operatingSystem": "Windows, macOS, Linux, Android, iOS",
  "browserRequirements": "Requires JavaScript. Works in all modern browsers.",
  "isAccessibleForFree": true,
  "offers": { "@type": "Offer", "price": 0, "priceCurrency": "USD", "availability": "https://schema.org/InStock" },
  "featureList": [
    "Reaction time measured in milliseconds",
    "5-round average with automatic scoring",
    "Performance ratings: Legendary, Perfect, Great, Good, Average, Slow",
    "Human benchmark comparison",
    "Mobile and desktop compatible",
    "No signup or download required"
  ],
  "aggregateRating": { "@type": "AggregateRating", "ratingValue": "4.9", "ratingCount": "4218", "bestRating": "5", "worstRating": "1" },
  "publisher": { "@id": "https://reactionspeedtest.com/#org" }
}
</script>

<!-- 5. Full platform SoftwareApplication -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "@id": "https://reactionspeedtest.com/#webapp",
  "name": "Reaction Speed Test – Free Online Reflex & Skill Tests",
  "url": "https://reactionspeedtest.com/",
  "description": "Free browser-based reflex and skill tests: reaction speed (ms), click speed (CPS), typing speed (WPM), Clicker Tycoon idle game, jitter click, spacebar speed, number memory, Snake, Dinosaur and Coreball. No download, no signup.",
  "applicationCategory": "GameApplication",
  "operatingSystem": "Windows, macOS, Linux, Android, iOS",
  "isAccessibleForFree": true,
  "offers": { "@type": "Offer", "price": 0, "priceCurrency": "USD", "availability": "https://schema.org/InStock", "url": "https://reactionspeedtest.com/" },
  "featureList": [
    "Reaction Speed Test – reflex time in ms",
    "Human Benchmark comparison",
    "Click Speed Test (CPS) – 8 durations",
    "Typing Speed Test (WPM)",
    "Stimulation Clicker Aim Trainer",
    "Jitter Click Test",
    "Spacebar Speed Test",
    "Number Memory Test",
    "Clicker Tycoon Idle Game with prestige",
    "Snake Game",
    "Dinosaur Game",
    "Coreball Game"
  ],
  "aggregateRating": { "@type": "AggregateRating", "ratingValue": "4.8", "ratingCount": "5219", "bestRating": "5", "worstRating": "1" },
  "publisher": { "@id": "https://reactionspeedtest.com/#org" }
}
</script>

<!-- 6. ItemList of all tools -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Free Online Tests and Games – Reaction Speed Test",
  "description": "All free online tests and games available on Reaction Speed Test",
  "url": "https://reactionspeedtest.com/",
  "numberOfItems": 11,
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Reaction Speed Test", "url": "https://reactionspeedtest.com/reaction-time-test", "description": "Measure your reflex time in milliseconds. Compare to human benchmarks." },
    { "@type": "ListItem", "position": 2, "name": "Click Speed Test (CPS)", "url": "https://reactionspeedtest.com/click-speed-test", "description": "How many clicks per second can you achieve?" },
    { "@type": "ListItem", "position": 3, "name": "Typing Speed Test (WPM)", "url": "https://reactionspeedtest.com/typing-speed-test", "description": "Measure your words per minute and accuracy." },
    { "@type": "ListItem", "position": 4, "name": "Stimulation Clicker", "url": "https://reactionspeedtest.com/stimulation-clicker", "description": "Free aim trainer — hit moving targets for FPS training." },
    { "@type": "ListItem", "position": 5, "name": "Jitter Click Test", "url": "https://reactionspeedtest.com/jitter-click-test", "description": "Practice jitter clicking and measure your max CPS." },
    { "@type": "ListItem", "position": 6, "name": "Spacebar Speed Test", "url": "https://reactionspeedtest.com/spacebar-speed-test", "description": "How fast can you press the spacebar per second?" },
    { "@type": "ListItem", "position": 7, "name": "Number Memory Test", "url": "https://reactionspeedtest.com/number-memory-test", "description": "Test working memory — how many digits can you recall?" },
    { "@type": "ListItem", "position": 8, "name": "Clicker Tycoon", "url": "https://reactionspeedtest.com/clicker-tycoon", "description": "Free idle clicker game with upgrades and prestige system." },
    { "@type": "ListItem", "position": 9, "name": "Dinosaur Game", "url": "https://reactionspeedtest.com/dinosaur-game", "description": "Play the classic Chrome T-Rex runner online." },
    { "@type": "ListItem", "position": 10, "name": "Snake Game", "url": "https://reactionspeedtest.com/snake-game", "description": "Classic snake game — grow longer, avoid yourself." },
    { "@type": "ListItem", "position": 11, "name": "Coreball Game", "url": "https://reactionspeedtest.com/coreball-game", "description": "Shoot balls onto the rotating core without colliding." }
  ]
}
</script>

<!-- 7. FAQ Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    { "@type": "Question", "name": "What is a good reaction speed?", "acceptedAnswer": { "@type": "Answer", "text": "The average human reaction time is 200–250ms. Gamers average 150–200ms. Elite esports professionals react in under 150ms. Our test measures your exact reflex time and compares it to human benchmarks." } },
    { "@type": "Question", "name": "How is this different from the Human Benchmark reaction test?", "acceptedAnswer": { "@type": "Answer", "text": "Our reaction speed test works identically to Human Benchmark — click when a stimulus appears and we record your response time in milliseconds. We additionally offer CPS test, typing speed, aim training and idle games, all free with no account needed." } },
    { "@type": "Question", "name": "How do I measure my reaction time online?", "acceptedAnswer": { "@type": "Answer", "text": "Open the Reaction Time Test, click to start, then click as fast as you can when the screen turns green. After 5 rounds you get your average reflex time and a rating versus the human benchmark of 200–250ms." } },
    { "@type": "Question", "name": "What is a good CPS (clicks per second)?", "acceptedAnswer": { "@type": "Answer", "text": "6–7 CPS is average. Above 10 CPS is good. Above 14 CPS requires jitter or butterfly clicking. Pro Minecraft PvP players sustain 8–12 CPS." } },
    { "@type": "Question", "name": "What is average typing speed in WPM?", "acceptedAnswer": { "@type": "Answer", "text": "Global average is 40–50 WPM. Office professionals average 55–70 WPM. The world record is 212 WPM by Barbara Blackburn." } },
    { "@type": "Question", "name": "What is jitter clicking?", "acceptedAnswer": { "@type": "Answer", "text": "Jitter clicking involves tensing forearm and wrist muscles to create rapid vibrations achieving 10–14 CPS. It is used in Minecraft PvP but carries injury risk with prolonged use." } },
    { "@type": "Question", "name": "How many digits can the average person memorize?", "acceptedAnswer": { "@type": "Answer", "text": "Most adults hold 5–7 digits in working memory (Miller's Law). Chunking techniques can extend this to 10+ digits." } },
    { "@type": "Question", "name": "Does the stimulation clicker improve FPS aim?", "acceptedAnswer": { "@type": "Answer", "text": "Yes. Hard mode (38px targets, 0.5s lifetime) is comparable to Aimlabs Gridshot. Regular practice improves flick-shot accuracy in CS2, Valorant and Fortnite." } },
    { "@type": "Question", "name": "What is Clicker Tycoon?", "acceptedAnswer": { "@type": "Answer", "text": "Clicker Tycoon is a free idle clicker game. Click to earn coins, buy upgrades, and prestige for a permanent 2x multiplier. Progress saves automatically in your browser." } },
    { "@type": "Question", "name": "Are all tests free with no account required?", "acceptedAnswer": { "@type": "Answer", "text": "Yes — every test and game is completely free. No account, no download, no signup required. Works on all devices including mobile." } }
  ]
}
</script>

<!-- 8. HowTo: How to test reaction speed -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "How to Test Your Reaction Speed Online",
  "description": "Step-by-step guide to measuring your reflex time with the free Reaction Speed Test.",
  "totalTime": "PT2M",
  "estimatedCost": { "@type": "MonetaryAmount", "currency": "USD", "value": "0" },
  "step": [
    { "@type": "HowToStep", "position": 1, "name": "Open the reaction test", "text": "Visit reactionspeedtest.com and select the Reaction Time Test tab." },
    { "@type": "HowToStep", "position": 2, "name": "Click to start", "text": "Click inside the arena to begin. A countdown will start." },
    { "@type": "HowToStep", "position": 3, "name": "React to the signal", "text": "When the screen turns green, click as fast as you can. Your reaction time in milliseconds is recorded." },
    { "@type": "HowToStep", "position": 4, "name": "Complete 5 rounds", "text": "The test runs 5 rounds to calculate your true average reaction speed." },
    { "@type": "HowToStep", "position": 5, "name": "See your results", "text": "View your average, best time, and rating compared to the human benchmark of 200–250ms." }
  ]
}
</script>

<!-- 9. BreadcrumbList -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "@id": "https://reactionspeedtest.com/#breadcrumb",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Reaction Speed Test", "item": "https://reactionspeedtest.com/" },
    { "@type": "ListItem", "position": 2, "name": "Reaction Time Test", "item": "https://reactionspeedtest.com/reaction-time-test" }
  ]
}
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5019628877403001" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ════════════════════════════════════════════════
   TOKENS
════════════════════════════════════════════════ */
:root {
  --bg:       #06060e;
  --surf:     #0d0d1a;
  --surf2:    #111122;
  --border:   #1c1c30;
  --border2:  #252540;
  --accent:   #00f5a0;
  --red:      #ff2d55;
  --yellow:   #ffe000;
  --purple:   #7b61ff;
  --orange:   #ff6b00;
  --text:     #ffffff;
  --muted:    #b0b0d0;
  --muted2:   #8080b0;
  --row1-h:   52px;
  --row2-h:   44px;
  --header-h: 96px; /* row1 + row2 */
}

/* ════════════════════════════════════════════════
   RESET & BASE
════════════════════════════════════════════════ */
*,*::before,*::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg); color: var(--text);
  min-height: 100vh; overflow-x: hidden;
}

/* Subtle ambient glow */
body::before {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
  background:
    radial-gradient(ellipse 70% 35% at 50% 0%, rgba(0,245,160,0.05) 0%, transparent 60%),
    radial-gradient(ellipse 40% 30% at 85% 90%, rgba(255,45,85,0.04) 0%, transparent 60%);
}

/* ════════════════════════════════════════════════
   HEADER — two fixed rows spanning full width
════════════════════════════════════════════════ */
.header {
  position: fixed; top:0; left:0; right:0; z-index:200;
  display: flex; flex-direction: column;
  background: rgba(6,6,14,0.96);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(16px);
}

/* ─── ROW 1: logo + test type tabs + lang ─── */
.row1 {
  height: var(--row1-h);
  display: flex; align-items: center;
  border-bottom: 1px solid var(--border2);
  gap: 0;
  padding: 0 10px 0 0;
}
.row1::-webkit-scrollbar { display: none; }

.logo { display: none; }

.home-btn {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 12px; border-radius: 8px; margin: 0 8px 0 10px;
  background: var(--surf2); border: 1px solid var(--border);
  color: #c0c0e0; font-size: 0.72rem; font-weight: 600;
  letter-spacing: 0.06em; text-transform: uppercase;
  text-decoration: none; white-space: nowrap; flex-shrink: 0;
  transition: border-color 0.15s, color 0.15s;
}
.home-btn:hover { border-color: var(--accent); color: var(--accent); }
/* Mobilde home-btn kısalt */
@media(max-width:480px){
  .home-btn { padding:5px 8px; font-size:0.64rem; gap:4px; margin:0 4px 0 6px; }
  .home-btn .home-label { display:none; }
}

/* Test type tabs */
.tabs {
  display: flex; align-items: center;
  flex: 1; overflow-x: auto; scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
  padding: 0 6px;
  gap: 5px;
  overflow-y: hidden;
}
.tabs::-webkit-scrollbar { display: none; }

.tab {
  display: flex; align-items: center; gap: 5px;
  padding: 6px 13px; cursor: pointer;
  font-size: 0.68rem; font-weight: 700; letter-spacing: 0.07em; text-transform: uppercase;
  color: #ffffff; white-space: nowrap; flex-shrink: 0;
  background: var(--surf);
  border: 1px solid var(--border);
  border-radius: 4px;
  transition: color 0.15s, border-color 0.2s, background 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}
.tab::after {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(circle at center, rgba(0,245,160,0.15) 0%, transparent 70%);
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}
.tab:hover {
  color: #ffffff;
  border-color: rgba(0,245,160,0.55);
  background: rgba(0,245,160,0.08);
  box-shadow: 0 0 14px rgba(0,245,160,0.22), inset 0 0 8px rgba(0,245,160,0.05);
}
.tab:hover::after { opacity: 1; }
.tab.active {
  color: #00f5a0;
  border-color: rgba(0,245,160,0.65);
  background: rgba(0,245,160,0.11);
  box-shadow: 0 0 16px rgba(0,245,160,0.25);
}
.tab.active::after { opacity: 0.6; }
.tab .ticon { font-size: 0.9rem; }

/* Language */
.lang {
  display: flex; align-items: center;
  padding: 0 10px; gap: 3px;
  flex-shrink: 0; margin-left: auto;
  border-left: 1px solid var(--border2);
}
@media(max-width:400px){ .lang { padding:0 6px; gap:2px; } .lbtn { padding:3px 7px; font-size:0.48rem; } }
.lbtn {
  padding: 4px 10px; border: 1px solid var(--border2); border-radius: 6px;
  font-size: 0.55rem; font-weight: 700; letter-spacing: 0.1em;
  cursor: pointer; background: none; color: var(--muted); transition: all 0.15s;
}
.lbtn.active { background: var(--accent); border-color: var(--accent); color: #000; }

/* ─── ROW 2: time selector + mode (hidden for reaction/stim) ─── */
.row2 {
  height: var(--row2-h);
  display: flex; align-items: center;
  padding: 0 16px; gap: 6px;
  overflow-x: auto; scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}
.row2::-webkit-scrollbar { display: none; }
.row2.hidden { display: none; }

.row2-label {
  font-size: 0.5rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); flex-shrink: 0; padding-right: 6px;
  border-right: 1px solid var(--border2); margin-right: 2px;
}
.row2-sep { width: 1px; height: 22px; background: var(--border2); flex-shrink: 0; margin: 0 6px; }

.tbtn {
  flex-shrink: 0; padding: 5px 14px;
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 8px; cursor: pointer;
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.05em;
  color: var(--muted); white-space: nowrap;
  transition: all 0.14s;
}
.tbtn:hover { border-color: rgba(0,245,160,0.4); color: var(--text); }
.tbtn.active { background: var(--accent); border-color: var(--accent); color: #000; }

.mbtn {
  flex-shrink: 0; display: flex; align-items: center; gap: 5px;
  padding: 5px 14px; background: var(--surf); border: 1px solid var(--border);
  border-radius: 8px; cursor: pointer;
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.05em;
  color: var(--muted); white-space: nowrap; transition: all 0.14s;
}
.mbtn:hover { border-color: rgba(123,97,255,0.4); color: var(--text); }
.mbtn.active { background: var(--purple); border-color: var(--purple); color: #fff; }

/* ════════════════════════════════════════════════
   MAIN WRAPPER
════════════════════════════════════════════════ */
.wrap {
  padding-top: var(--header-h);
  min-height: 100vh;
  position: relative; z-index: 1;
}

/* ════════════════════════════════════════════════
   GAME ZONE — full viewport width, generous height
════════════════════════════════════════════════ */
.game-zone {
  width: 100%; padding: 28px 24px 0;
  display: flex; flex-direction: column; gap: 18px;
}

/* Page title row */
.gtitle-row { display: flex; align-items: baseline; gap: 14px; flex-wrap: wrap; }
.gtitle {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(2rem, 5vw, 3.2rem);
  letter-spacing: 0.1em; line-height: 1;
  background: linear-gradient(135deg, var(--accent), var(--yellow));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.gtitle.red { background: linear-gradient(135deg, var(--red), var(--orange)); -webkit-background-clip: text; background-clip: text; }
.gsub {
  font-size: 0.58rem; letter-spacing: 0.22em; text-transform: uppercase; color: var(--muted);
}

/* Stats bar — always 4 cards, full width */
.stats-bar {
  display: grid; grid-template-columns: repeat(4,1fr); gap: 10px;
}
@media(max-width:480px) { .stats-bar { grid-template-columns: repeat(2,1fr); } }

.scard {
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 12px; padding: 12px 14px; text-align: center;
  transition: border-color 0.3s;
}
.scard.hi1 { border-color: var(--accent); }
.scard.hi2 { border-color: var(--yellow); }
.scard.hi3 { border-color: var(--purple); }
.scard.hi4 { border-color: var(--red); }
.slbl { font-size: 0.48rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 5px; }
.sval {
  font-family: 'Bebas Neue', sans-serif; font-size: clamp(1.6rem, 4vw, 2.2rem);
  letter-spacing: 0.04em; color: var(--accent); line-height: 1;
}
.sval.yellow { color: var(--yellow); }
.sval.purple { color: var(--purple); }
.sval.red    { color: var(--red); }
.sval.muted  { color: var(--muted); }

/* ─── CLICK ARENA ─── */
.click-arena {
  width: 100%; max-width: 680px; align-self: center;
  height: clamp(300px, 45vh, 520px);
  background: var(--surf);
  border: 2px solid var(--border);
  border-radius: 20px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 14px;
  cursor: pointer; position: relative; overflow: hidden;
  transition: background 0.2s, border-color 0.2s, transform 0.07s;
  user-select: none; touch-action: manipulation;
}
.click-arena:active { transform: scale(0.995); }

/* Grid texture */
.click-arena::before {
  content:''; position:absolute; inset:0; pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px);
}

.click-arena.idle    { background: #090914; }
.click-arena.running { background: #040f0a; border-color: rgba(0,245,160,0.4); }
.click-arena.done    { background: #0f0f04; border-color: rgba(255,224,0,0.4); }

.big-cps {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(5rem, 18vw, 11rem);
  letter-spacing: 0.03em; line-height: 1;
  color: var(--accent); transition: color 0.2s;
  pointer-events: none; position: relative; z-index: 1;
}
.click-arena.done    .big-cps { color: var(--yellow); }

/* When result overlay shows, fade the background CPS number so it doesn't bleed through */
.result-overlay.show ~ * { opacity: 0.08; }
.result-overlay.show + .arena-label { opacity: 0.06; }

/* Explicit fade for big-cps when overlay active — target via sibling */
.click-arena:has(.result-overlay.show) .big-cps { opacity: 0.06; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .arena-label { opacity: 0.04; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .prog { opacity: 0.04; transition: opacity 0.2s; }
.click-arena:has(.result-overlay.show) .combo-badge { display: none; }

.arena-label {
  font-size: 0.65rem; letter-spacing: 0.25em; text-transform: uppercase;
  color: var(--muted); text-align: center; pointer-events: none;
  position: relative; z-index: 1;
}

/* Progress bar */
.prog {
  width: 70%; max-width: 500px; height: 5px;
  background: var(--border); border-radius: 3px; overflow: hidden;
  position: relative; z-index: 1;
}
.prog-fill {
  height: 100%; background: var(--accent); border-radius: 3px;
  transition: width 0.1s linear;
}
.click-arena.done .prog-fill { background: var(--yellow); }

/* Result overlay */
.result-overlay {
  display: none; position: absolute; inset: 0; z-index: 10;
  background: rgba(6,6,14,0.92); border-radius: 18px;
  flex-direction: column; align-items: center; justify-content: center; gap: 8px;
  text-align: center; padding: 20px;
}
.result-overlay.show { display: flex; animation: popIn 0.22s ease; }
@keyframes popIn { from{opacity:0;transform:scale(0.94)} to{opacity:1;transform:scale(1)} }

.r-label  { font-size: 0.58rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--muted); width:100%; text-align:center; }
.r-score  { font-family: 'Bebas Neue', sans-serif; font-size: clamp(4rem,15vw,9rem); line-height: 1; width:100%; text-align:center; display:block; }
.r-unit   { font-size: 0.58rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); width:100%; text-align:center; }
.r-rank   { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.15em; padding: 6px 22px; border-radius: 30px; text-align:center; }
.r-retry  {
  margin-top: 8px; padding: 12px 36px;
  background: var(--accent); color: #000; border: none; border-radius: 12px;
  font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.15em;
  cursor: pointer; transition: all 0.2s;
}
.r-retry:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,245,160,0.35); }

/* Challenge mode */
.click-arena.challenge-active { border-color: var(--red) !important; animation: challengePulse 0.4s infinite; }
@keyframes challengePulse { 0%,100%{box-shadow:0 0 0 0 rgba(255,45,85,0.3)} 50%{box-shadow:0 0 0 20px rgba(255,45,85,0)} }
.ch-target {
  position:absolute; border-radius:50%; cursor:pointer; pointer-events:auto; z-index:5;
  display:flex; align-items:center; justify-content:center;
  font-size:0.5rem; font-weight:700; color:#fff; letter-spacing:0.05em;
  animation: chTargetIn 0.15s ease;
  transition: transform 0.06s, opacity 0.06s;
}
.ch-target:hover { transform: scale(1.1); }
@keyframes chTargetIn { from{opacity:0;transform:scale(0.4)} to{opacity:1;transform:scale(1)} }
.ch-shrink-ring {
  position:absolute; inset:-4px; border-radius:50%;
  border:2px solid rgba(255,45,85,0.6);
  animation: shrink linear forwards;
}
@keyframes shrink { from{transform:scale(1);opacity:1} to{transform:scale(0.1);opacity:0} }
.combo-badge {
  position:absolute; top:10px; right:12px; z-index:6;
  font-family:'Bebas Neue',sans-serif; font-size:1rem; letter-spacing:0.1em;
  color:var(--red); background:rgba(255,45,85,0.12); border:1px solid rgba(255,45,85,0.3);
  padding:4px 10px; border-radius:8px; pointer-events:none;
  display:none;
}
.combo-badge.show { display:block; }
.space-key {
  width: 100%; max-width: 600px; height: 72px;
  background: var(--surf2); border: 2px solid var(--border);
  border-bottom: 6px solid var(--border2); border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.68rem; letter-spacing: 0.35em; text-transform: uppercase;
  color: var(--muted); cursor: pointer; user-select: none; touch-action: manipulation;
  transition: all 0.07s;
}
.space-key:active, .space-key.down {
  border-bottom-width: 2px; transform: translateY(4px);
  border-color: var(--purple); color: var(--purple);
}

/* ─── REACTION ARENA ─── */
.reaction-arena {
  width: 100%; max-width: 680px; align-self: center;
  height: clamp(300px, 45vh, 520px);
  border-radius: 20px; overflow: hidden;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 12px;
  cursor: pointer; position: relative;
  border: 2px solid var(--border);
  transition: background 0.18s, border-color 0.18s, transform 0.07s;
  user-select: none; touch-action: manipulation;
}
.reaction-arena::before {
  content:''; position:absolute; inset:0; pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px),
    repeating-linear-gradient(90deg,transparent,transparent 39px,rgba(255,255,255,0.013) 40px);
}
.reaction-arena:active { transform: scale(0.995); }
.reaction-arena.s-wait  { background: #08080f; }
.reaction-arena.s-ready { background: #0f0209; border-color: rgba(255,45,85,0.5); animation: pRed 0.7s infinite; }
.reaction-arena.s-go    { background: #01100a; border-color: rgba(0,245,160,0.7); animation: pGreen 0.4s 1; }
.reaction-arena.s-early { background: #100500; border-color: rgba(255,107,0,0.6); }
.reaction-arena.s-done  { background: var(--surf); border-color: rgba(0,245,160,0.4); }
@keyframes pRed   { 0%,100%{box-shadow:0 0 0 0 rgba(255,45,85,0.2)} 50%{box-shadow:0 0 0 30px rgba(255,45,85,0)} }
@keyframes pGreen { 0%{box-shadow:0 0 0 0 rgba(0,245,160,0.5)} 100%{box-shadow:0 0 0 60px rgba(0,245,160,0)} }
.arena-icon { font-size: 3.5rem; position: relative; z-index:1; pointer-events: none; }
.arena-text {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(2.2rem,8vw,4rem);
  letter-spacing: 0.1em; text-align: center; line-height: 1;
  position: relative; z-index:1; pointer-events: none; padding: 0 20px;
}
.arena-sub {
  font-size: 0.6rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); text-align: center;
  position: relative; z-index:1; pointer-events: none;
}
.ms-big { font-family:'Bebas Neue',sans-serif; font-size:clamp(4rem,15vw,8rem); line-height:1; color:var(--accent); }
.ms-unit{ font-size:0.62rem; letter-spacing:0.3em; color:var(--muted); text-transform:uppercase; }
.rat-pill{ font-size:0.68rem; letter-spacing:0.15em; text-transform:uppercase; padding:5px 16px; border-radius:20px; margin-top:4px; }

/* Rounds dots */
.dots-row { display:flex; gap:8px; width:100%; }
.dot { flex:1; height:6px; border-radius:3px; background:var(--border); transition:background 0.3s; }
.dot.done    { background:var(--accent); }
.dot.fail    { background:var(--red); }
.dot.current { background:var(--muted); animation:blink 0.9s ease-in-out infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

.hist-row { display:flex; gap:6px; flex-wrap:wrap; min-height:26px; }
.hchip { background:var(--surf); border:1px solid var(--border); border-radius:7px; padding:3px 9px; font-size:0.6rem; color:var(--muted); }
.hchip.best{ border-color:var(--accent); color:var(--accent); }
.hchip.fail{ border-color:var(--red); color:var(--red); }

.gameover {
  width:100%; background:var(--surf); border:1px solid var(--border);
  border-radius:18px; padding:24px 20px; text-align:center;
  display:none; flex-direction:column; align-items:center; gap:16px;
  animation:slideUp 0.35s ease;
}
.gameover.show{ display:flex; }
@keyframes slideUp{ from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
.go-title{ font-family:'Bebas Neue',sans-serif; font-size:2.2rem; letter-spacing:0.1em; color:var(--yellow); }
.go-stats{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; width:100%; }
.go-stat{ background:var(--bg); border-radius:10px; padding:10px 8px; }
.go-slbl{ font-size:0.48rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--muted); margin-bottom:4px; }
.go-sval{ font-family:'Bebas Neue',sans-serif; font-size:1.5rem; color:var(--accent); }
.go-sval.bad{ color:var(--red); }
.replay-btn{
  width:100%; padding:16px; background:var(--accent); color:#000; border:none;
  border-radius:13px; font-family:'Bebas Neue',sans-serif; font-size:1.3rem;
  letter-spacing:0.15em; cursor:pointer; transition:all 0.2s;
}
.replay-btn:hover{ transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,245,160,0.3); }

/* ─── STIMULATION ARENA ─── */
.stim-arena {
  width: 100%;
  height: clamp(340px, 50vh, 560px);
  background: #08060f;
  border: 2px solid var(--border);
  border-radius: 20px;
  position: relative; overflow: hidden;
  cursor: crosshair;
}
.stim-idle {
  position:absolute; inset:0; display:flex;
  flex-direction:column; align-items:center; justify-content:center; gap:16px; z-index:5;
}
.stim-idle-title {
  font-family:'Bebas Neue',sans-serif;
  font-size:clamp(2rem,6vw,3.5rem); letter-spacing:0.1em;
  background:linear-gradient(135deg,var(--red),var(--orange));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.stim-idle-sub { font-size:0.62rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--muted); }
.diff-row { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.diff-btn {
  padding:9px 22px; border-radius:10px; cursor:pointer;
  font-family:'JetBrains Mono',monospace; font-size:0.62rem; font-weight:700; letter-spacing:0.1em;
  transition:all 0.15s; background:none; border:2px solid transparent;
}
.diff-btn.easy   { border-color:var(--accent); color:var(--accent); background:rgba(0,245,160,0.08); }
.diff-btn.medium { border-color:var(--yellow); color:var(--yellow); background:rgba(255,224,0,0.08); }
.diff-btn.hard   { border-color:var(--red);    color:var(--red);    background:rgba(255,45,85,0.1); }
.diff-btn.selected { color:#000; }
.diff-btn.easy.selected   { background:var(--accent); }
.diff-btn.medium.selected { background:var(--yellow); }
.diff-btn.hard.selected   { background:var(--red); }
.stim-start-btn {
  padding:12px 36px; border-radius:12px;
  background:var(--red); color:#fff; border:none; cursor:pointer;
  font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:0.15em;
  transition:all 0.2s;
}
.stim-start-btn:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(255,45,85,0.35); }

/* Target circles */
.stim-target {
  position:absolute; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  cursor:crosshair; pointer-events:auto; z-index:4;
  animation: targetIn 0.12s ease;
  transition: transform 0.06s;
}
.stim-target:hover { transform:scale(1.06); }
@keyframes targetIn{ from{opacity:0;transform:scale(0.5)} to{opacity:1;transform:scale(1)} }
.target-ring {
  position:absolute; inset:0; border-radius:50%;
  animation: ringPulse 0.8s ease-in-out infinite;
}
@keyframes ringPulse{
  0%,100%{transform:scale(1);opacity:0.6}
  50%{transform:scale(1.12);opacity:0.3}
}

/* Countdown inside arena */
.stim-countdown {
  position:absolute; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center; pointer-events:none; z-index:3;
}
.stim-count-num {
  font-family:'Bebas Neue',sans-serif; font-size:clamp(3rem,10vw,6rem);
  letter-spacing:0.1em; color:var(--red); opacity:0;
  animation:countAnim 1s ease-in-out;
}
@keyframes countAnim{ 0%{opacity:1;transform:scale(1.3)} 70%{opacity:1} 100%{opacity:0;transform:scale(0.8)} }

/* Stim result */
.stim-result {
  display:none; position:absolute; inset:0; z-index:20;
  background:rgba(6,6,14,0.92); border-radius:18px;
  flex-direction:column; align-items:center; justify-content:center; gap:10px;
}
.stim-result.show{ display:flex; animation:popIn 0.25s ease; }
.stim-r-score{ font-family:'Bebas Neue',sans-serif; font-size:clamp(5rem,16vw,9rem); line-height:1; }
.stim-r-rank { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:0.15em; }
.stim-replay{ margin-top:6px; padding:12px 36px; background:var(--red); color:#fff; border:none; border-radius:12px; font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:0.15em; cursor:pointer; transition:all 0.2s; }
.stim-replay:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(255,45,85,0.4); }

/* Miss flash */
.miss-flash {
  position:absolute; pointer-events:none; z-index:6;
  width:60px; height:60px; margin:-30px;
  border-radius:50%; background:rgba(255,45,85,0.4);
  animation: missAnim 0.4s ease forwards;
}
@keyframes missAnim{ 0%{opacity:1;transform:scale(0.8)} 100%{opacity:0;transform:scale(2)} }

/* Hit popup */
.hit-popup {
  position:absolute; pointer-events:none; z-index:7;
  font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:0.1em;
  animation:hitAnim 0.5s ease forwards;
}
@keyframes hitAnim{ 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-40px)} }

/* ════════════════════════════════════════════════
   INFO SECTION
════════════════════════════════════════════════ */
.info-wrap {
  width: 100%; margin: 48px auto 0;
  padding: 0 24px 80px;
  display: flex; flex-direction: column; gap: 28px;
}
.sec-divider {
  display:flex; align-items:center; gap:14px;
  font-family:'Bebas Neue',sans-serif; font-size:1.1rem; letter-spacing:0.2em; color:var(--muted);
}
.sec-divider::before,.sec-divider::after { content:''; flex:1; height:1px; background:var(--border); }

.icard {
  background:var(--surf); border:1px solid var(--border); border-radius:16px;
  padding:26px 22px; display:flex; flex-direction:column; gap:16px;
}
.icard-title { font-family:'Bebas Neue',sans-serif; font-size:clamp(1.3rem,4vw,1.8rem); letter-spacing:0.1em; color:var(--accent); }
.ibody { font-size:0.78rem; line-height:1.9; color:#c8c8e8; }
.ibody strong { color:#ffffff; }

/* Rank table */
.rtable { width:100%; border-collapse:collapse; }
.rtable th { font-size:0.5rem; letter-spacing:0.18em; text-transform:uppercase; color:var(--muted); padding:8px 12px; text-align:left; border-bottom:1px solid var(--border); }
.rtable td { padding:12px 12px; font-size:0.63rem; border-bottom:1px solid rgba(28,28,48,0.7); vertical-align:middle; }
.rtable tr:last-child td { border-bottom:none; }
.rbadge { display:inline-flex; align-items:center; gap:8px; font-weight:700; font-size:0.66rem; }
.rdot   { width:10px; height:10px; border-radius:50%; flex-shrink:0; }

/* Technique grid */
.tech-grid { display:flex; flex-direction:column; gap:12px; }
.tcard { background:var(--bg); border:1px solid var(--border); border-radius:14px; padding:16px 16px; display:flex; flex-direction:column; gap:8px; }
.thead-row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.tname { font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:0.08em; color:var(--text); }
.tbadge { font-size:0.5rem; letter-spacing:0.15em; text-transform:uppercase; padding:3px 10px; border-radius:20px; }
.tbadge.g { background:rgba(0,245,160,0.1); border:1px solid rgba(0,245,160,0.3); color:var(--accent); }
.tbadge.y { background:rgba(255,224,0,0.1); border:1px solid rgba(255,224,0,0.3); color:var(--yellow); }
.tbadge.r { background:rgba(255,45,85,0.1); border:1px solid rgba(255,45,85,0.3); color:var(--red); }
.tbadge.p { background:rgba(123,97,255,0.1); border:1px solid rgba(123,97,255,0.3); color:var(--purple); }
.tbody-t { font-size:0.75rem; line-height:1.8; color:#c8c8e8; }
.tbody-t strong { color:var(--text); }

/* Factors */
.fgrid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:400px){ .fgrid{ grid-template-columns:1fr; } }
.fitem { background:var(--bg); border:1px solid var(--border); border-radius:12px; padding:14px 12px; }
.ficon { font-size:1.4rem; margin-bottom:6px; }
.fname { font-size:0.6rem; letter-spacing:0.1em; text-transform:uppercase; color:var(--text); margin-bottom:4px; }
.fdesc { font-size:0.58rem; line-height:1.6; color:var(--muted); }

/* Exercise list */
.exlist { display:flex; flex-direction:column; gap:10px; }
.exitem { display:flex; align-items:flex-start; gap:12px; background:var(--bg); border-radius:10px; padding:13px 14px; }
.exnum  { font-family:'Bebas Neue',sans-serif; font-size:1.2rem; color:var(--accent); min-width:26px; flex-shrink:0; line-height:1; }
.extxt  { font-size:0.63rem; line-height:1.68; color:var(--muted); }
.extxt strong { color:var(--text); }

/* Records */
.rgrid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
@media(min-width:600px){ .rgrid{ grid-template-columns:repeat(4,1fr); } }
.ritem { background:var(--bg); border:1px solid var(--border); border-radius:12px; padding:14px 10px; text-align:center; }
.rval  { font-family:'Bebas Neue',sans-serif; font-size:1.9rem; letter-spacing:0.05em; line-height:1; margin-bottom:4px; }
.rlbl  { font-size:0.49rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--muted); }
.rholder{ font-size:0.57rem; color:var(--text); margin-top:5px; }

/* Compare table */
.ctable { width:100%; border-collapse:collapse; font-size:0.6rem; }
.ctable th { text-align:center; padding:8px 6px; font-size:0.48rem; letter-spacing:0.14em; text-transform:uppercase; color:var(--muted); border-bottom:1px solid var(--border); }
.ctable td { text-align:center; padding:9px 6px; border-bottom:1px solid rgba(28,28,48,0.5); color:var(--muted); }
.ctable tr:last-child td { border-bottom:none; }
.ctable td:first-child { text-align:left; color:var(--text); font-weight:700; }
.yes { color:var(--accent); } .no { color:var(--red); } .mid { color:var(--yellow); }

/* Chart */
.chart-wrap { width:100%; overflow-x:auto; }
.chart-ttl  { font-size:0.55rem; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); margin-bottom:12px; }
svg.rchart  { width:100%; height:auto; display:block; min-width:280px; }

/* Speedometer legend */
.slegend { display:flex; flex-wrap:wrap; gap:8px 16px; justify-content:center; margin-top:8px; }
.sleg-item { display:flex; align-items:center; gap:5px; font-size:0.54rem; letter-spacing:0.07em; text-transform:uppercase; }
.sleg-dot  { width:8px; height:8px; border-radius:50%; flex-shrink:0; }

/* Tips */
.tips { display:flex; flex-wrap:wrap; gap:8px; }
.tip  { background:rgba(0,245,160,0.07); border:1px solid rgba(0,245,160,0.2); border-radius:20px; padding:6px 13px; font-size:0.57rem; letter-spacing:0.07em; color:var(--accent); }

/* FAQ */
.faq-list { display:flex; flex-direction:column; gap:8px; }
.faq-item { background:var(--bg); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
.faq-q {
  width:100%; background:none; border:none; text-align:left;
  padding:14px 16px; cursor:pointer; display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-family:'JetBrains Mono',monospace; font-size:0.61rem; font-weight:700; letter-spacing:0.03em; line-height:1.4;
  color:var(--text); transition:color 0.2s;
}
.faq-q:hover { color:var(--accent); }
.faq-arrow { font-size:0.62rem; color:var(--muted); flex-shrink:0; transition:transform 0.25s; }
.faq-item.open .faq-arrow { transform:rotate(180deg); color:var(--accent); }
.faq-a { max-height:0; overflow:hidden; transition:max-height 0.3s ease; font-size:0.62rem; line-height:1.82; color:var(--muted); padding:0 16px; }
.faq-item.open .faq-a { max-height:600px; padding:0 16px 14px; }
.faq-a strong { color:var(--text); }

/* Footer */
.sfooter { width:100%; text-align:center; padding:28px 0 12px; font-size:0.53rem; letter-spacing:0.07em; color:var(--muted); line-height:1.9; border-top:1px solid var(--border); margin-top:10px; }
.sfooter strong { color:var(--text); }

/* ════════════════════════════════════════════════
   RESPONSIVE / MOBILE
════════════════════════════════════════════════ */

/* Tablet */
/* ════════════════════════════════
   RESPONSIVE — ANA SAYFA
════════════════════════════════ */

/* Tablet */
@media(max-width:768px){
  .game-zone  { padding:12px 12px 0; gap:10px; }
  .info-wrap  { padding:0 12px 60px; gap:16px; }
  .gtitle     { font-size:clamp(1.4rem,5vw,2.2rem); }
  .icard      { padding:16px 14px; }
  .go-stats   { grid-template-columns:repeat(3,1fr); }
  .stats-bar  { gap:6px; }
  .scard      { padding:10px 10px; }
}

/* Telefon */
@media(max-width:520px){
  :root {
    --row1-h:44px;
    --row2-h:36px;
    --header-h:80px;
  }

  /* ─ Header ─ */
  .home-btn { padding:5px 8px; font-size:0.62rem; margin:0 4px 0 6px; }
  .tabs     { gap:3px; padding:0 2px; }
  .tab      { height:28px; padding:0 9px; font-size:0.58rem; min-width:0; border-radius:6px; }
  .tab .ticon { font-size:0.78rem; }
  .row2     { padding:0 8px; gap:3px; }
  .row2-label { font-size:0.4rem; padding-right:3px; }
  .tbtn,.mbtn { padding:3px 8px; font-size:0.5rem; border-radius:6px; }

  /* ─ Sayfa başlığı ─ */
  .game-zone  { padding:8px 8px 0; gap:8px; }
  .gtitle-row { gap:5px; }
  .gtitle     { font-size:clamp(1.25rem,6vw,1.9rem); }
  .gsub       { font-size:0.46rem; letter-spacing:0.09em; }

  /* ─ Oyun alanları ─ */
  .click-arena    { height:clamp(180px,50vw,300px); max-width:100%; border-radius:14px; }
  .reaction-arena { height:clamp(200px,52vw,320px); max-width:100%; border-radius:14px; }
  .stim-arena     { height:clamp(220px,54vw,360px); border-radius:14px; }
  .big-cps        { font-size:clamp(3.5rem,18vw,7rem); }
  .arena-icon     { font-size:2rem; }
  .arena-text     { font-size:clamp(1.5rem,6vw,2.6rem); }
  .space-key      { height:48px; font-size:0.52rem; }

  /* ─ Stats bar: 2 sütun ─ */
  .stats-bar  { grid-template-columns:1fr 1fr; gap:5px; }
  .scard      { padding:8px 7px; border-radius:10px; }
  .sval       { font-size:clamp(1.2rem,5vw,1.7rem); }
  .slbl       { font-size:0.38rem; letter-spacing:0.12em; }

  /* ─ Gameover ─ */
  .go-stats { grid-template-columns:repeat(3,1fr); gap:5px; }
  .go-sval  { font-size:1rem; }
  .go-slbl  { font-size:0.38rem; }
  .r-score  { font-size:clamp(2.8rem,15vw,5.5rem); }
  .r-rank   { font-size:0.95rem; }

  /* ─ Stim ─ */
  .stim-idle-title { font-size:clamp(1.2rem,5vw,2rem); }
  .diff-btn        { padding:6px 13px; font-size:0.54rem; }

  /* ─ Info / makale ─ */
  .info-wrap   { padding:0 8px 48px; gap:12px; }
  .icard       { padding:11px 10px; border-radius:11px; }
  .icard-title { font-size:clamp(0.86rem,3.6vw,1.05rem); }
  .ibody       { font-size:0.6rem; line-height:1.68; }
  .sec-divider { font-size:0.46rem; }

  /* ─ Tablolar yatay scroll ─ */
  .rtable,.ctable       { font-size:0.5rem; display:block; overflow-x:auto; }
  .rtable th,.rtable td { padding:6px 5px; }

  /* ─ Grid'ler ─ */
  .fgrid { grid-template-columns:1fr; }
  .rgrid { grid-template-columns:1fr 1fr; }

  /* ─ FAQ ─ */
  .tip   { font-size:0.48rem; padding:5px 8px; }
  .faq-q { font-size:0.52rem; padding:10px 10px; }
  .faq-a { font-size:0.54rem; line-height:1.58; }

  /* ─ Footer ─ */
  .sfooter { font-size:0.44rem; padding:16px 0 8px; }
}

/* Çok küçük telefon */
@media(max-width:360px){
  .tab { padding:0 6px; font-size:0.46rem; }
  .click-arena,.reaction-arena { height:clamp(155px,48vw,240px); }
  .stim-arena { height:clamp(185px,50vw,280px); }
  .gtitle { font-size:clamp(1.05rem,5.5vw,1.5rem); }
  .scard  { padding:6px 5px; }
  .sval   { font-size:clamp(1.1rem,4.5vw,1.5rem); }
}

/* ══════════════════════════════════════════
   CLICKER TYCOON STYLES  v5
══════════════════════════════════════════ */

/* Panel override — needs more width */
.ct-panel { max-width:1100px !important; width:100% !important; align-self:center; align-items:center !important; margin:0 auto; }

/* Title row */
.ct-titlerow {
  display:flex; align-items:flex-start; justify-content:space-between;
  width:100%; gap:12px; flex-wrap:wrap;
}
.ct-gtitle {
  background:linear-gradient(135deg,#ffe000,#ff6b00) !important;
  -webkit-background-clip:text !important;
  -webkit-text-fill-color:transparent !important;
  background-clip:text !important;
}

/* Sound toggle button */
.ct-sound-btn {
  padding:7px 14px; border-radius:10px; border:1px solid #2a2a4a;
  background:#0d0d1a; color:#8080b0; font-size:0.72rem; font-weight:700;
  letter-spacing:0.08em; cursor:pointer; white-space:nowrap;
  transition:all 0.2s; flex-shrink:0; margin-top:4px;
}
.ct-sound-btn:hover { border-color:#4a4a8a; color:#c0c0e0; }
.ct-sound-btn.on  { border-color:#00f5a040; color:#00f5a0; }
.ct-sound-btn.off { border-color:#ff4a4a30; color:#ff7070; }

/* Stats */
.ct-stats {
  display:flex; flex-wrap:wrap; gap:8px; width:100%;
}
.ct-stat {
  flex:1; min-width:90px;
  background:#0a0a18; border:1px solid #181828;
  border-radius:12px; padding:10px 12px; text-align:center;
}
.ct-stat-lbl {
  font-size:0.58rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#505080; margin-bottom:4px;
}
.ct-stat-val {
  font-family:'Bebas Neue',sans-serif;
  font-size:1.55rem; letter-spacing:0.05em; color:#fff; line-height:1;
}
.ct-gold   { color:#ffd600; }
.ct-green  { color:#00f5a0; }
.ct-purple { color:#a78bfa; }

/* 3-column main layout */
.ct-main {
  display:grid;
  grid-template-columns:200px minmax(360px,1fr) 340px;
  gap:14px; width:100%;
  align-items:start;
}

.ct-col { display:flex; flex-direction:column; gap:10px; }

/* ── LEFT COL ── */
.ct-coin-wrap {
  position:relative; align-self:center;
  width:min(190px,100%); height:min(190px,42vw);
  flex-shrink:0;
}

/* Coin + sağ bilgi: yan yana satır (desktop'ta coin-wrap tam genişlik, right gizli) */
.ct-coin-row {
  display:flex; flex-direction:column; gap:10px; width:100%; align-items:center;
}
.ct-coin-right {
  display:contents; /* desktop: elementler normal akışta, wrapper gibi davran */
}
#ctParticleCanvas {
  position:absolute; inset:0; width:100%; height:100%;
  pointer-events:none; border-radius:50%;
}
.ct-coin {
  position:relative; z-index:1;
  width:100%; height:100%;
  border-radius:50%; cursor:pointer;
  border:none; background:none; padding:0; display:block;
  filter:drop-shadow(0 0 22px rgba(255,210,0,0.55));
  transition:transform 0.08s, filter 0.08s;
  -webkit-tap-highlight-color:transparent;
  user-select:none; -webkit-user-select:none;
}
.ct-coin:hover { filter:drop-shadow(0 0 36px rgba(255,210,0,0.9)); }
.ct-coin.pressed {
  transform:scale(0.88);
  filter:drop-shadow(0 0 10px rgba(255,210,0,0.25));
}
.ct-coin svg { width:100%; height:100%; display:block; }

#ctFloatLayer { position:absolute; inset:0; pointer-events:none; overflow:visible; z-index:10; }
.ct-float {
  position:absolute; left:50%; top:20%;
  font-family:'Bebas Neue',sans-serif;
  font-size:1.4rem; font-weight:700; letter-spacing:0.06em;
  color:#ffd600; pointer-events:none;
  text-shadow:0 2px 12px rgba(255,200,0,0.9);
  animation:ctFloatUp 0.95s ease-out forwards;
  white-space:nowrap; z-index:20;
}
@keyframes ctFloatUp {
  0%   { opacity:1; transform:translateX(-50%) translateY(0) scale(1.1); }
  55%  { opacity:1; transform:translateX(-50%) translateY(-55px) scale(1.18); }
  100% { opacity:0; transform:translateX(-50%) translateY(-95px) scale(0.7); }
}

.ct-click-info {
  display:flex; justify-content:space-between;
  font-size:0.74rem; color:#7070a0; font-weight:600;
}
.ct-click-info b { color:#ddd; }

.ct-progress-wrap { display:flex; flex-direction:column; gap:5px; }
.ct-progress-label { display:flex; justify-content:space-between; font-size:0.64rem; font-weight:600; }
.ct-progress-bg {
  height:7px; background:#0a0a18;
  border:1px solid #181828; border-radius:100px; overflow:hidden;
}
.ct-progress-fill {
  height:100%; border-radius:100px;
  background:linear-gradient(90deg,#7b61ff,#c4b5fd);
  transition:width 0.35s ease;
  box-shadow:0 0 6px rgba(123,97,255,0.7);
}

.ct-prestige-btn {
  width:100%; padding:11px; border-radius:12px;
  border:1.5px solid #7b61ff;
  background:linear-gradient(135deg,rgba(123,97,255,0.18),rgba(167,139,250,0.08));
  color:#c4b5fd; font-size:0.8rem; font-weight:700;
  letter-spacing:0.05em; cursor:pointer; transition:all 0.2s;
  text-transform:uppercase; outline:none;
  animation:ctPrestigePulse 1.8s ease-in-out infinite;
}
.ct-prestige-btn:hover {
  background:rgba(123,97,255,0.3);
  box-shadow:0 0 22px rgba(123,97,255,0.6);
}
@keyframes ctPrestigePulse {
  0%,100% { box-shadow:0 0 6px rgba(123,97,255,0.3); }
  50%      { box-shadow:0 0 18px rgba(123,97,255,0.7),0 0 40px rgba(123,97,255,0.2); }
}

.ct-auto-box {
  background:#0a0a18; border:1px solid #181828;
  border-radius:12px; padding:12px 14px;
  max-height:200px; overflow-y:auto;
  scrollbar-width:thin; scrollbar-color:#252545 transparent;
}
.ct-auto-title {
  font-size:0.58rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#404060; margin-bottom:8px;
}
.ct-auto-list { display:flex; flex-direction:column; gap:5px; }
.ct-auto-row {
  display:flex; justify-content:space-between; align-items:center;
  font-size:0.76rem; color:#9090b8;
}
.ct-auto-row b { color:#00f5a0; font-weight:700; font-size:0.8rem; }

/* ── MID COL — World Canvas ── */
.ct-col-mid { align-self:stretch; }
.ct-world-label {
  font-size:0.58rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#404060; text-align:center;
  margin-bottom:4px;
}
.ct-world-canvas {
  width:100%; height:500px;
  display:block; border-radius:18px;
  background:#010108;
  box-shadow:0 0 50px rgba(0,0,0,0.7), inset 0 0 0 1px rgba(255,255,255,0.04);
}

/* ── RIGHT COL — Shop ── */
.ct-col-right { min-width:0; overflow:hidden; }
.ct-shop-header {
  font-size:0.65rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#505080; padding:2px 0;
}
.ct-shop-list {
  display:flex; flex-direction:column; gap:8px;
  overflow-y:auto; height:500px; padding:4px 6px 12px 4px;
  scrollbar-width:thin; scrollbar-color:#3a3a5a transparent;
}
.ct-shop-list::-webkit-scrollbar { width:5px; }
.ct-shop-list::-webkit-scrollbar-track { background:transparent; }
.ct-shop-list::-webkit-scrollbar-thumb { background:#3a3a5a; border-radius:10px; }
/* ct-upg styles consolidated → see bottom of stylesheet */

/* Milestones */
.ct-milestones-wrap {
  width:100%;
  background:#0a0a18; border:1px solid #181828;
  border-radius:14px; padding:14px 16px;
}
.ct-milestones-title {
  font-size:0.62rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#404060; margin-bottom:10px;
}
.ct-milestones-grid { display:flex; flex-wrap:wrap; gap:6px; }
.ct-badge {
  display:inline-flex; align-items:center; gap:5px;
  padding:6px 12px; border-radius:100px; font-size:0.72rem; font-weight:700;
  border:1px solid #181828; color:#303050; transition:all 0.3s;
}
.ct-badge.earned {
  border-color:#ffd60035;
  background:rgba(255,214,0,0.07);
  color:#ffe066;
  box-shadow:0 0 8px rgba(255,214,0,0.18);
}
@keyframes ctPop {
  0%{transform:scale(0.4);opacity:0} 70%{transform:scale(1.2);opacity:1} 100%{transform:scale(1)}
}
.ct-pop { animation:ctPop 0.4s ease-out forwards; }

/* ════════════════════════════════
   RESPONSIVE — CLİCKER TYCOON
════════════════════════════════ */

/* Geniş tablet (900px altı) */
@media(max-width:900px){
  .ct-main { grid-template-columns:1fr 1fr; gap:10px; }
  .ct-col-mid   { grid-column:1/-1; order:-1; }
  .ct-col-right { min-width:0; }
  .ct-world-canvas { height:340px; }
}

/* Dar tablet / büyük telefon */
@media(max-width:680px){
  .ct-world-canvas { height:300px; }
  .ct-shop-list   { height:420px; }
}

/* Telefon — tam mobil layout */
@media(max-width:560px){

  /* Panel padding azalt */
  .ct-panel { padding:8px 8px 0 !important; gap:6px !important; }

  /* Başlık */
  .ct-titlerow { flex-direction:column; gap:6px; align-items:flex-start; }
  .ct-gtitle   { font-size:clamp(1.3rem,6vw,1.9rem) !important; }
  .ct-sound-btn { align-self:flex-start; padding:5px 10px; font-size:0.64rem; }

  /* Stats şeridi: 3 col, kompakt */
  .ct-stats { gap:4px; }
  .ct-stat  {
    flex:1 1 calc(33.3% - 4px); min-width:0;
    padding:6px 5px; border-radius:8px;
  }
  .ct-stat-lbl { font-size:0.42rem; letter-spacing:0.08em; margin-bottom:2px; }
  .ct-stat-val { font-size:1rem; }

  /* Ana 3-kolon → 1 kolon, sıralama değişir */
  .ct-main {
    display:flex; flex-direction:column; gap:8px;
  }

  /* Canvas en ÜSTE — tam genişlik, iyi yükseklik */
  .ct-col-mid {
    order:0; width:100%;
  }
  .ct-world-canvas {
    width:100%;
    height:clamp(220px,64vw,360px);   /* 375px telefonda ≈240px, 414px ≈265px */
    border-radius:14px;
  }

  /* Sol kolon — normal flex column */
  .ct-col-left { order:1; width:100%; }

  /* Coin row: coin solda, bilgi sağda */
  .ct-coin-row {
    flex-direction:row;
    align-items:flex-start;
    gap:10px;
    width:100%;
  }

  .ct-coin-wrap {
    width:110px; height:110px;
    flex-shrink:0; align-self:flex-start;
  }

  /* Sağ bilgi: normal block akış */
  .ct-coin-right {
    display:flex; flex-direction:column;
    gap:6px; flex:1; min-width:0;
  }

  .ct-click-info   { font-size:0.6rem; flex-direction:column; gap:2px; }
  .ct-combo-display{ font-size:0.75rem; }

  /* Prestige btn: coin row'dan sonra tam genişlik */
  .ct-prestige-btn { width:100%; }

  /* Spin, quest, auto: tam genişlik */
  .ct-spin-box,.ct-quest-box,.ct-auto-box { width:100%; }

  /* Spin kompakt */
  .ct-spin-box   { padding:8px 10px; gap:5px; }
  .ct-spin-btn   { padding:8px; font-size:0.78rem; }
  .ct-spin-result{ font-size:0.7rem; }
  .ct-spin-cd    { font-size:0.62rem; }

  /* Quest kompakt */
  .ct-quest-box  { padding:8px 10px; gap:5px; }
  .ct-quest-item { font-size:0.66rem; }
  .ct-quest-bar-bg { height:4px; }

  /* Auto list */
  .ct-auto-box   { padding:8px 10px; max-height:120px; }
  .ct-auto-row   { font-size:0.64rem; }

  /* Sağ kolon (shop) */
  .ct-col-right { order:2; width:100%; min-width:0; }

  /* Tab butonlar */
  .ct-tabs-bar { gap:4px; }
  .ct-tab-btn  { font-size:0.6rem; padding:6px 6px; border-radius:8px; }

  /* Shop list: makul yükseklik */
  .ct-shop-list   { height:360px; }
  .ct-stats-panel { height:280px; }
  .ct-res-card    { padding:10px; }

  /* Upgrade kartları mobilde biraz daha kompakt */
  .ct-upg      { padding:7px 8px; gap:7px; min-height:48px; }
  .ct-upg-icon { width:32px; height:32px; font-size:1.15rem; border-radius:8px; }
  .ct-upg-name { font-size:0.78rem; }
  .ct-upg-sub  { font-size:0.6rem; }
  .ct-cost-num { font-size:0.9rem; }
  .ct-cost-cps { font-size:0.55rem; }
  .ct-upg-cost { min-width:54px; }

  /* Progress label */
  .ct-progress-label { font-size:0.56rem; }

  /* Milestones */
  .ct-milestones-wrap { padding:8px 9px; }
  .ct-milestones-grid { gap:4px; }
  .ct-badge { font-size:0.6rem; padding:3px 7px; }

  /* Banner / notif */
  .ct-frenzy-banner { font-size:0.64rem; padding:4px 8px; flex-wrap:nowrap; }
  .ct-build-notif   { right:10px; bottom:14px; max-width:200px; font-size:0.76rem; padding:10px 14px; }
  .ct-weather-banner{ font-size:0.64rem; padding:5px 8px; }
}

/* Çok küçük telefon ≤380px */
@media(max-width:380px){
  .ct-world-canvas { height:clamp(190px,58vw,280px); }
  .ct-coin-wrap    { width:90px; height:90px; }
  .ct-stat-val     { font-size:0.9rem; }
  .ct-shop-list    { height:320px; }
  .ct-upg          { padding:6px 7px; min-height:44px; }
  .ct-upg-icon     { width:28px; height:28px; font-size:1rem; }
  .ct-upg-name     { font-size:0.72rem; }
}
.ct-stats {
  display:flex; flex-wrap:wrap; gap:8px;
  width:100%; max-width:760px; align-self:center;
}
.ct-stat {
  flex:1; min-width:110px;
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:12px; padding:10px 14px;
  text-align:center;
}
.ct-stat-lbl {
  font-size:0.6rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#606090; margin-bottom:4px;
}
.ct-stat-val {
  font-family:'Bebas Neue',sans-serif;
  font-size:1.5rem; letter-spacing:0.06em; color:#fff;
  line-height:1;
}
.ct-gold   { color:#ffd600; }
.ct-green  { color:#00f5a0; }
.ct-purple { color:#a78bfa; }

.ct-layout {
  display:grid; grid-template-columns:1fr 1.15fr;
  gap:14px; width:100%; max-width:760px; align-self:center;
}

/* LEFT */
.ct-left { display:flex; flex-direction:column; gap:10px; }

.ct-coin-wrap {
  position:relative; align-self:center;
  width:min(200px, 55vw); height:min(200px, 55vw);
}
#ctParticleCanvas {
  position:absolute; inset:0;
  width:100%; height:100%;
  pointer-events:none; border-radius:50%;
}
.ct-coin {
  position:relative; z-index:1;
  width:100%; height:100%;
  border-radius:50%; cursor:pointer;
  border:none; background:none; padding:0;
  display:block;
  filter:drop-shadow(0 0 20px rgba(255,210,0,0.5));
  transition:transform 0.08s, filter 0.08s;
  -webkit-tap-highlight-color:transparent;
  user-select:none; -webkit-user-select:none;
}
.ct-coin:hover {
  filter:drop-shadow(0 0 32px rgba(255,210,0,0.8));
}
.ct-coin.pressed {
  transform:scale(0.91);
  filter:drop-shadow(0 0 12px rgba(255,210,0,0.3));
}
.ct-coin svg { width:100%; height:100%; display:block; }

#ctFloatLayer { position:absolute; inset:0; pointer-events:none; overflow:visible; }
.ct-float {
  position:absolute; left:50%; top:30%;
  font-family:'Bebas Neue',sans-serif;
  font-size:1.3rem; font-weight:700; letter-spacing:0.08em;
  color:#ffd600; pointer-events:none;
  text-shadow:0 0 8px rgba(255,210,0,0.8);
  animation:ctFloatUp 0.9s ease-out forwards;
  transform:translateX(-50%);
  white-space:nowrap;
}
@keyframes ctFloatUp {
  0%   { opacity:1; transform:translateX(-50%) translateY(0) scale(1); }
  60%  { opacity:1; transform:translateX(-50%) translateY(-52px) scale(1.15); }
  100% { opacity:0; transform:translateX(-50%) translateY(-90px) scale(0.8); }
}

.ct-click-info {
  display:flex; justify-content:space-between;
  font-size:0.72rem; color:#888; padding:0 2px;
}
.ct-click-info b { font-weight:700; }

.ct-progress-wrap { display:flex; flex-direction:column; gap:5px; }
.ct-progress-label {
  display:flex; justify-content:space-between;
  font-size:0.65rem; color:#666; font-weight:600;
}
.ct-progress-bg {
  height:8px; background:#111122;
  border:1px solid #1c1c30; border-radius:100px; overflow:hidden;
}
.ct-progress-fill {
  height:100%; border-radius:100px;
  background:linear-gradient(90deg, #7b61ff, #a78bfa);
  transition:width 0.3s ease;
  box-shadow:0 0 8px rgba(123,97,255,0.6);
}

.ct-prestige-btn {
  width:100%; padding:12px; border-radius:12px;
  border:1.5px solid #7b61ff;
  background:linear-gradient(135deg,rgba(123,97,255,0.15),rgba(167,139,250,0.1));
  color:#c4b5fd; font-size:0.8rem; font-weight:700;
  letter-spacing:0.06em; cursor:pointer;
  transition:all 0.2s; text-transform:uppercase;
  animation:ctPrestigePulse 2s ease-in-out infinite;
  outline:none;
}
.ct-prestige-btn:hover {
  background:rgba(123,97,255,0.3);
  box-shadow:0 0 20px rgba(123,97,255,0.5);
}
@keyframes ctPrestigePulse {
  0%,100% { box-shadow:0 0 8px rgba(123,97,255,0.3); }
  50%      { box-shadow:0 0 20px rgba(123,97,255,0.7); }
}

.ct-auto-box {
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:12px; padding:12px 14px;
  max-height:200px; overflow-y:auto;
  scrollbar-width:thin; scrollbar-color:#252545 transparent;
}
.ct-auto-title {
  font-size:0.62rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:#505080; margin-bottom:8px;
}
.ct-auto-list {
  display:flex; flex-direction:column; gap:5px;
  font-size:0.76rem; color:#9090b8;
}
.ct-auto-row {
  display:flex; justify-content:space-between; align-items:center;
}
.ct-auto-row b { color:#00f5a0; font-weight:700; }

/* RIGHT — shop */
.ct-right { display:flex; flex-direction:column; gap:8px; }
.ct-shop-header {
  font-size:0.65rem; font-weight:700; letter-spacing:0.18em;
  text-transform:uppercase; color:#505080; padding:2px 0;
}
.ct-shop-list {
  display:flex; flex-direction:column; gap:6px;
  overflow-y:auto; max-height:500px;
  scrollbar-width:thin; scrollbar-color:#1c1c30 transparent;
}

/* Individual upgrade card */
/* ct-upg styles consolidated → see bottom */

/* MILESTONES */
.ct-milestones-wrap {
  width:100%; max-width:760px; align-self:center;
  background:#0d0d1a; border:1px solid #1c1c30;
  border-radius:14px; padding:14px 16px;
}
.ct-milestones-title {
  font-size:0.65rem; font-weight:700; letter-spacing:0.16em;
  text-transform:uppercase; color:#505080; margin-bottom:10px;
}
.ct-milestones-grid {
  display:flex; flex-wrap:wrap; gap:6px;
}
.ct-badge {
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 12px; border-radius:100px;
  font-size:0.72rem; font-weight:700;
  border:1px solid #1c1c30; color:#404060;
  transition:all 0.3s;
}
.ct-badge.earned {
  border-color:#ffd60040;
  background:rgba(255,214,0,0.08);
  color:#ffe066;
  box-shadow:0 0 8px rgba(255,214,0,0.2);
}
.ct-badge .ct-badge-icon { font-size:0.9rem; }

/* NEW UNLOCK POP */
@keyframes ctUnlockPop {
  0%  { transform:scale(0.5); opacity:0; }
  70% { transform:scale(1.15); opacity:1; }
  100%{ transform:scale(1); opacity:1; }
}
.ct-badge.just-earned { animation:ctUnlockPop 0.4s ease-out forwards; }

/* RESPONSIVE */
@media(max-width:600px){
  .ct-layout { grid-template-columns:1fr; }
  .ct-coin-wrap { width:min(170px,50vw); height:min(170px,50vw); }
  .ct-shop-list { height:280px; }
  .ct-stat-val { font-size:1.2rem; }
}

/* ── CLICKER EXTRA FEATURES ────────────────────────────── */
.ct-frenzy-banner {
  padding:6px 14px; border-radius:8px; font-size:0.78rem; font-weight:700;
  letter-spacing:0.06em; background:rgba(255,80,0,0.25); border:1px solid #ff5000aa;
  color:#ff9060; animation:ctFrenzyPulse 0.4s ease-in-out infinite alternate;
}
@keyframes ctFrenzyPulse { from{opacity:0.7} to{opacity:1;box-shadow:0 0 18px #ff500088} }

.ct-golden-coin {
  position:absolute; font-size:2rem;
  cursor:pointer; z-index:30;
  animation:ctGoldenBounce 0.7s ease-in-out infinite alternate;
  filter:drop-shadow(0 0 10px #ffd700);
  user-select:none; -webkit-user-select:none;
  pointer-events:all;
  transform-origin:center;
}
@keyframes ctGoldenBounce { from{transform:scale(1) rotate(-8deg)} to{transform:scale(1.15) rotate(8deg)} }

/* Fortune Spin */
.ct-spin-box {
  background:#0a0a18; border:1px solid #1e1e3a;
  border-radius:12px; padding:12px 14px; display:flex;
  flex-direction:column; gap:7px;
}
.ct-spin-title { font-size:0.6rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:#606090; }
.ct-spin-result { font-size:0.78rem; color:#aaaacc; min-height:1.2em; }
.ct-spin-btn {
  padding:9px; border-radius:10px; border:1.5px solid #7b61ff55;
  background:rgba(123,97,255,0.12); color:#c4b5fd;
  font-size:0.82rem; font-weight:700; cursor:pointer;
  transition:all 0.2s; letter-spacing:0.04em;
}
.ct-spin-btn:hover { background:rgba(123,97,255,0.28); border-color:#7b61ffaa; }
.ct-spin-btn:disabled { opacity:0.4; cursor:not-allowed; }
.ct-spin-cd { font-size:0.72rem; color:#505080; text-align:center; }

/* Quests */
.ct-quest-box {
  background:#0a0a18; border:1px solid #1a1a30;
  border-radius:12px; padding:12px 14px; display:flex;
  flex-direction:column; gap:6px;
}
.ct-quest-title { font-size:0.6rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:#606090; }
.ct-quest-item {
  display:flex; align-items:center; gap:8px;
  font-size:0.74rem; color:#8888b0;
}
.ct-quest-bar-bg { flex:1; height:5px; background:#111128; border-radius:100px; overflow:hidden; }
.ct-quest-bar { height:100%; background:linear-gradient(90deg,#00f5a0,#00c880); border-radius:100px; transition:width 0.4s; }
.ct-quest-done { color:#ffd600; font-size:0.7rem; font-weight:700; }
.ct-quest-claim {
  padding:3px 9px; border-radius:6px; border:1px solid #ffd60055;
  background:rgba(255,214,0,0.1); color:#ffd600; font-size:0.7rem;
  font-weight:700; cursor:pointer; flex-shrink:0;
  transition:all 0.15s;
}
.ct-quest-claim:hover { background:rgba(255,214,0,0.25); }

/* Shop tabs */
.ct-tabs-bar {
  display:flex; gap:6px; margin-bottom:6px;
}
.ct-tab-btn {
  flex:1; padding:7px 4px; border-radius:8px; font-size:0.68rem; font-weight:700;
  letter-spacing:0.06em; border:1.5px solid #1e1e3a;
  background:#0a0a18; color:#505080; cursor:pointer; transition:all 0.15s;
}
.ct-tab-btn.active {
  border-color:#ffd60055; background:rgba(255,214,0,0.07); color:#ffd600;
}

/* Research cards */
.ct-res-card {
  background:#0a0a18; border:1.5px solid #181830;
  border-radius:12px; padding:10px 12px;
  display:flex; flex-direction:column; gap:5px;
  margin-bottom:6px;
}
.ct-res-name { font-size:0.84rem; font-weight:700; color:#c8c8f0; }
.ct-res-desc { font-size:0.66rem; color:#50507a; line-height:1.3; }
.ct-res-tiers { display:flex; gap:6px; flex-wrap:wrap; margin-top:2px; }
.ct-res-tier {
  padding:5px 10px; border-radius:8px; font-size:0.7rem; font-weight:700;
  border:1px solid #282848; background:#0d0d22; color:#7070a0;
  cursor:pointer; transition:all 0.15s; white-space:nowrap;
}
.ct-res-tier.buyable { border-color:#00f5a055; color:#00f5a0; background:rgba(0,245,160,0.07); }
.ct-res-tier.bought  { border-color:#ffd60044; color:#ffd600; background:rgba(255,214,0,0.06); cursor:default; }
.ct-res-tier.locked  { opacity:0.35; cursor:not-allowed; }

/* ── NEW FEATURES CSS ──────────────────────────────────── */
.ct-combo-display {
  text-align:center; font-size:0.9rem; font-weight:800;
  letter-spacing:0.06em; padding:4px 0; border-radius:8px;
  background:rgba(255,255,255,0.04);
  animation:ctComboPop 0.2s ease-out;
}
@keyframes ctComboPop { from{transform:scale(1.2)} to{transform:scale(1)} }

.ct-offline-msg {
  padding:8px 10px; border-radius:10px; font-size:0.74rem; font-weight:600;
  background:rgba(0,200,130,0.12); border:1px solid #00c88044; color:#00f5a0;
  text-align:center; line-height:1.4;
}

.ct-weather-banner {
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:7px 14px; border-radius:10px; border:1px solid #444460;
  background:#08081a; font-size:0.78rem; font-weight:700;
  margin-bottom:8px; animation:ctWeatherIn 0.4s ease-out;
  flex-wrap:wrap;
}
@keyframes ctWeatherIn { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:none} }

.ct-build-notif {
  position:fixed; bottom:24px; right:24px; z-index:999;
  padding:14px 20px; border-radius:14px;
  background:linear-gradient(135deg,#1a1030,#0c0820);
  border:1.5px solid #a78bfa66; color:#e0d0ff;
  font-size:0.82rem; font-weight:700; line-height:1.5;
  text-align:center; max-width:240px;
  box-shadow:0 0 30px rgba(100,60,200,0.4);
}
.ct-notif-pop { animation:ctNotifIn 0.4s cubic-bezier(0.34,1.56,0.64,1); }
@keyframes ctNotifIn { from{opacity:0;transform:translateY(20px) scale(0.9)} to{opacity:1;transform:none} }

.ct-stats-panel {
  flex-direction:column; gap:5px; padding:10px 4px;
  overflow-y:auto; height:420px;
}
.ct-stat-row {
  display:flex; justify-content:space-between; align-items:center;
  padding:6px 10px; border-radius:8px; font-size:0.74rem;
  background:#08081a; border:1px solid #141428; color:#8888b0;
}
.ct-stat-row b { color:#d8d8f0; font-weight:700; }
</style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════
     FIXED HEADER
═══════════════════════════════════════════════════ -->
<div class="header">

  <!-- ROW 1: tabs + controls -->
  <div class="row1">
    <a class="home-btn" href="/" aria-label="Back to homepage">⚡ Home</a>

    <!-- Left scroll arrow -->
    <button id="tabScrollLeft" onclick="scrollTabs(-1)" aria-label="Scroll left" style="
      flex-shrink:0; border:none; cursor:pointer;
      color:#ffffff; font-size:1.2rem; padding:0 10px; height:100%;
      display:flex; align-items:center; z-index:2;
      background:linear-gradient(to right, rgba(6,6,14,0.95) 60%, transparent);
      transition:color 0.15s;
    ">‹</button>

    <div class="tabs" id="tabsContainer" role="tablist">
      <button class="tab active" data-panel="reaction" onclick="switchPanel('reaction')" role="tab">
        <span class="ticon">⚡</span> Reaction
      </button>
      <button class="tab" data-panel="stimulation" onclick="switchPanel('stimulation')" role="tab">
        <span class="ticon">🎯</span> Stimulation
      </button>
      <button class="tab" data-panel="clicker" onclick="switchPanel('clicker')" role="tab">
        <span class="ticon">💰</span> Clicker
      </button>
      <button class="tab" data-panel="cps" onclick="switchPanel('cps')" role="tab">
        <span class="ticon">🔥</span> Click Speed
      </button>
      <button class="tab" data-panel="jitter" onclick="switchPanel('jitter')" role="tab">
        <span class="ticon">🖱</span> Jitter Click
      </button>
      <button class="tab" data-panel="spacebar" onclick="switchPanel('spacebar')" role="tab">
        <span class="ticon">⌨️</span> Spacebar
      </button>
      <button class="tab" data-panel="dino" onclick="switchPanel('dino')" role="tab">
        <span class="ticon">🦕</span> Dino Game
      </button>
      <button class="tab" data-panel="typing" onclick="switchPanel('typing')" role="tab">
        <span class="ticon">📝</span> Typing Test
      </button>
      <button class="tab" data-panel="coreball" onclick="switchPanel('coreball')" role="tab">
        <span class="ticon">🎮</span> Coreball
      </button>
      <button class="tab" data-panel="memory" onclick="switchPanel('memory')" role="tab">
        <span class="ticon">🧠</span> Memory
      </button>
      <button class="tab" data-panel="snake" onclick="switchPanel('snake')" role="tab">
        <span class="ticon">🐍</span> Snake
      </button>
    </div>

    <!-- Right scroll arrow -->
    <button id="tabScrollRight" onclick="scrollTabs(1)" aria-label="Scroll right" style="
      flex-shrink:0; border:none; cursor:pointer;
      color:#ffffff; font-size:1.2rem; padding:0 10px; height:100%;
      display:flex; align-items:center; z-index:2;
      background:linear-gradient(to left, rgba(6,6,14,0.95) 60%, transparent);
      transition:color 0.15s;
    ">›</button>

    <div class="lang" style="border-left:1px solid var(--border2); padding:0 10px; gap:4px; flex-shrink:0;">
      <button class="lbtn" id="soundToggle" onclick="toggleSound()" title="Toggle Sound" style="font-size:0.8rem;padding:4px 8px;">🔊</button>
      <button class="lbtn" id="statsBtn" onclick="showStatsModal()" title="My Stats" style="font-size:0.6rem;padding:4px 8px;letter-spacing:0.04em;">📊</button>
    </div>
  </div>

  <!-- ROW 2: time selector + challenge mode (hidden for reaction & stimulation) -->
  <div class="row2" id="row2">
    <span class="row2-label">Duration</span>

    <button class="tbtn" data-s="1"   onclick="setDuration(1)">1s</button>
    <button class="tbtn" data-s="2"   onclick="setDuration(2)">2s</button>
    <button class="tbtn active" data-s="5"   onclick="setDuration(5)">5s</button>
    <button class="tbtn" data-s="10"  onclick="setDuration(10)">10s</button>
    <button class="tbtn" data-s="15"  onclick="setDuration(15)">15s</button>
    <button class="tbtn" data-s="30"  onclick="setDuration(30)">30s</button>
    <button class="tbtn" data-s="60"  onclick="setDuration(60)">60s</button>
    <button class="tbtn" data-s="100" onclick="setDuration(100)">100s</button>

    <div class="row2-sep"></div>
    <span class="row2-label">Mode</span>
    <button class="mbtn active" id="modeNormal" onclick="setClickMode('normal')">🖱 Normal</button>
    <button class="mbtn"        id="modeChallenge" onclick="setClickMode('challenge')">⚡ Challenge</button>
  </div>

</div>

<!-- ═══════════════════════════════════════════════════
     MAIN
═══════════════════════════════════════════════════ -->
<div class="wrap">

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: CLICK SPEED (shared with jitter & kohi)
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-cps" class="game-zone">

    <div class="gtitle-row">
      <h1 class="gtitle" id="cpsH1">Click Speed Test</h1>
      <span class="gsub" id="cpsSub">5 seconds — click as fast as you can</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">CPS</div><div class="sval" id="cStat">0</div></div>
      <div class="scard"><div class="slbl">Clicks</div><div class="sval muted" id="cClicks">0</div></div>
      <div class="scard hi2"><div class="slbl">Best CPS</div><div class="sval yellow" id="cBest">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="cTime">5.0</div></div>
    </div>

    <div class="click-arena idle" id="clickArena" tabindex="0" role="button" aria-label="Click area to start">

      <div class="combo-badge" id="comboBadge">COMBO: 0</div>
      <div class="big-cps" id="bigCPS">0</div>
      <div class="arena-label" id="cLabel">Click Here to Start</div>
      <div class="prog" id="cProg" style="display:none">
        <div class="prog-fill" id="cProgFill" style="width:100%"></div>
      </div>

      <!-- Result overlay -->
      <div class="result-overlay" id="cResult">
        <div class="r-label">Your Score</div>
        <div class="r-score" id="rScore">0</div>
        <div class="r-unit">Clicks Per Second</div>
        <div class="r-rank" id="rRank"></div>
        <div id="cNewRecord" style="display:none;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.18em;color:var(--yellow);background:rgba(255,224,0,0.12);border:1px solid rgba(255,224,0,0.4);border-radius:20px;padding:4px 18px;">🏆 NEW RECORD!</div>
        <button class="r-retry" onclick="resetCPS()">↺ Try Again</button>
      </div>

    </div>

    <!-- Challenge mode tip -->
    <div id="challengeTip" style="display:none; font-size:0.6rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--red); text-align:center; padding:4px 0">
      ⚡ CHALLENGE MODE — targets appear, click them!
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: SPACEBAR
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-spacebar" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,var(--purple),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Spacebar Speed Test</h1>
      <span class="gsub" id="sSub">5 seconds — press spacebar as fast as you can</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Press/sec</div><div class="sval" id="sCPS">0</div></div>
      <div class="scard"><div class="slbl">Total Presses</div><div class="sval muted" id="sClicks">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="sBest">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="sTime">5.0</div></div>
    </div>

    <div class="space-key" id="spaceKey" tabindex="0" role="button">SPACEBAR</div>

    <div class="click-arena idle" id="spaceArena" tabindex="0" role="button" style="min-height:260px">
      <div class="big-cps" id="sBig" style="color:var(--purple)">0</div>
      <div class="arena-label" id="sLabel">Press Space Key or Tap Above to Start</div>
      <div class="prog" id="sProg" style="display:none">
        <div class="prog-fill" id="sProgFill" style="width:100%;background:var(--purple)"></div>
      </div>
      <div class="result-overlay" id="sResult">
        <div class="r-label">Your Score</div>
        <div class="r-score" id="srScore" style="color:var(--purple)">0</div>
        <div class="r-unit">Presses Per Second</div>
        <button class="r-retry" style="background:var(--purple);color:#fff" onclick="resetSpace()">↺ Try Again</button>
      </div>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: REACTION
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-reaction" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle">Reaction Speed Test</h1>
      <span class="gsub">5 rounds — tap when the arena turns green</span>
    </div>

    <div class="stats-bar">
      <div class="scard"><div class="slbl" id="lScore">Score</div><div class="sval" id="rDisp">0</div></div>
      <div class="scard hi1"><div class="slbl" id="lBest">Best</div><div class="sval" id="rBest">---</div></div>
      <div class="scard"><div class="slbl" id="lAvg">Average</div><div class="sval yellow" id="rAvg">---</div></div>
      <div class="scard hi3"><div class="slbl" id="lRound">Round</div><div class="sval purple" id="rRound">0/5</div></div>
    </div>

    <div class="reaction-arena s-wait" id="reactArena">
      <div class="arena-icon" id="rIcon">⚡</div>
      <div class="arena-text" id="rText">Tap to Start</div>
      <div class="arena-sub"  id="rSub">Test your reaction speed</div>
    </div>

    <div>
      <div class="slbl" style="margin-bottom:8px" id="lDots">Round Progress</div>
      <div class="dots-row" id="rdots">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div class="dot"></div><div class="dot"></div>
      </div>
    </div>

    <div class="hist-row" id="hist"></div>

    <div class="gameover" id="gover">
      <div class="go-title" id="goTitle">🏆 GAME OVER</div>
      <div class="go-stats">
        <div class="go-stat"><div class="go-slbl" id="goLB">Fastest</div><div class="go-sval" id="goBest">---</div></div>
        <div class="go-stat"><div class="go-slbl" id="goLA">Average</div><div class="go-sval" id="goAvg">---</div></div>
        <div class="go-stat"><div class="go-slbl" id="goLS">Score</div><div class="go-sval" id="goScore">0</div></div>
      </div>
      <button class="replay-btn" id="replayBtn">↺ Play Again</button>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: STIMULATION CLICKER
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-stimulation" class="game-zone" style="display:none">

    <div class="gtitle-row">
      <h1 class="gtitle red">Stimulation Clicker</h1>
      <span class="gsub">Click the targets before they disappear</span>
    </div>

    <div class="stats-bar">
      <div class="scard hi4"><div class="slbl">Score</div><div class="sval red" id="stScore">0</div></div>
      <div class="scard"><div class="slbl">Targets Hit</div><div class="sval" id="stHits">0</div></div>
      <div class="scard hi2"><div class="slbl">Accuracy</div><div class="sval yellow" id="stAcc">—</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="stTime">30.0</div></div>
    </div>

    <div class="stim-arena" id="stimArena">

      <!-- Idle / config screen -->
      <div class="stim-idle" id="stimIdle">
        <div style="font-size:3rem">🎯</div>
        <div class="stim-idle-title">Stimulation Clicker</div>
        <div class="stim-idle-sub">Choose difficulty and start</div>
        <div class="diff-row">
          <button class="diff-btn easy"   id="dbEasy"   onclick="setStimDiff('easy')">🟢 EASY</button>
          <button class="diff-btn medium selected" id="dbMedium" onclick="setStimDiff('medium')">🟡 MEDIUM</button>
          <button class="diff-btn hard"   id="dbHard"   onclick="setStimDiff('hard')">🔴 HARD</button>
        </div>
        <button class="stim-start-btn" onclick="startStim()">▶ START</button>
      </div>

      <!-- Result overlay -->
      <div class="stim-result" id="stimResult">
        <div class="r-label" style="color:var(--muted)">Final Score</div>
        <div class="stim-r-score" id="stFinalScore"></div>
        <div class="r-label" style="color:var(--muted)">Accuracy: <span id="stFinalAcc"></span></div>
        <div class="stim-r-rank" id="stFinalRank"></div>
        <button class="stim-replay" onclick="resetStim()">↺ Play Again</button>
      </div>

    </div>

    <!-- Difficulty guide -->
    <div class="icard" style="padding:16px 18px">
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🟢</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">EASY</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">80px targets · 1.2s lifetime · Perfect for beginners</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🟡</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--yellow);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">MEDIUM</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">55px targets · 0.8s lifetime · Standard challenge</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.2rem;margin-bottom:4px">🔴</div>
          <div style="font-size:0.6rem;font-weight:700;color:var(--red);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3px">HARD</div>
          <div style="font-size:0.58rem;color:var(--muted);line-height:1.6">38px targets · 0.5s lifetime · Elite aim required</div>
        </div>
      </div>
    </div>

  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: TYPING TEST
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-typing" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#00b4d8,#00f5a0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Typing Speed Test</h1>
      <span class="gsub">Type the words as fast as you can — WPM &amp; accuracy</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">WPM</div><div class="sval" id="tWpm" style="color:#00b4d8">0</div></div>
      <div class="scard"><div class="slbl">Accuracy</div><div class="sval muted" id="tAcc">—</div></div>
      <div class="scard hi2"><div class="slbl">Correct</div><div class="sval yellow" id="tCorrect">0</div></div>
      <div class="scard hi3"><div class="slbl">Time Left</div><div class="sval purple" id="tTime">60</div></div>
    </div>

    <!-- Word display -->
    <div id="typingBox" style="
      width:100%;max-width:680px;align-self:center;
      background:#090914;border:2px solid var(--border);border-radius:20px;
      padding:28px 24px;display:flex;flex-direction:column;gap:16px;position:relative;
    ">
      <div id="tWords" style="
        font-family:'JetBrains Mono',monospace;font-size:clamp(0.9rem,2.5vw,1.1rem);
        line-height:2.2;letter-spacing:0.03em;
        display:flex;flex-wrap:wrap;gap:6px;
        max-height:120px;overflow:hidden;
        pointer-events:none;user-select:none;
      "></div>
      <input id="tInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
        placeholder="Click here and start typing..."
        style="
          width:100%;background:var(--surf2);border:1.5px solid var(--border2);
          border-radius:10px;padding:12px 16px;
          font-family:'JetBrains Mono',monospace;font-size:0.85rem;
          color:var(--text);outline:none;transition:border-color 0.2s;
        "
      >
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px">
        <div style="display:flex;gap:8px">
          <button onclick="setTypingDuration(30)" id="td30" class="tbtn" style="font-size:0.6rem">30s</button>
          <button onclick="setTypingDuration(60)" id="td60" class="tbtn active" style="font-size:0.6rem">60s</button>
          <button onclick="setTypingDuration(120)" id="td120" class="tbtn" style="font-size:0.6rem">120s</button>
        </div>
        <button onclick="resetTyping()" style="
          padding:8px 20px;background:var(--surf);border:1px solid var(--border2);
          border-radius:8px;color:var(--muted);cursor:pointer;
          font-family:'JetBrains Mono',monospace;font-size:0.6rem;font-weight:700;
          transition:all 0.15s;
        ">↺ Restart</button>
      </div>
      <!-- Result overlay -->
      <div id="tResult" style="
        display:none;position:absolute;inset:0;z-index:10;border-radius:18px;
        background:rgba(6,6,14,0.93);flex-direction:column;
        align-items:center;justify-content:center;gap:10px;text-align:center;padding:20px;
      ">
        <div style="font-size:0.58rem;letter-spacing:0.25em;text-transform:uppercase;color:var(--muted)">Your Speed</div>
        <div id="tFinalWpm" style="font-family:'Bebas Neue',sans-serif;font-size:clamp(4rem,15vw,8rem);line-height:1;color:#00b4d8"></div>
        <div style="font-size:0.58rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">Words Per Minute</div>
        <div id="tFinalAcc" style="font-size:0.7rem;color:var(--accent);letter-spacing:0.1em"></div>
        <button onclick="resetTyping()" style="
          margin-top:8px;padding:12px 36px;background:#00b4d8;color:#000;
          border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;
          font-size:1.1rem;letter-spacing:0.15em;cursor:pointer;transition:all 0.2s;
        ">↺ Try Again</button>
      </div>
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: COREBALL
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-coreball" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#ff6b00,#ffe000);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Coreball Game</h1>
      <span class="gsub">Shoot balls into the spinning core — don't hit existing balls</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi4"><div class="slbl">Score</div><div class="sval red" id="cbScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="cbBest">0</div></div>
      <div class="scard"><div class="slbl">Level</div><div class="sval muted" id="cbLevel">1</div></div>
      <div class="scard hi3"><div class="slbl">Balls Left</div><div class="sval purple" id="cbBalls">10</div></div>
    </div>

    <div style="width:100%;max-width:480px;align-self:center;display:flex;flex-direction:column;gap:12px">
      <canvas id="coreCanvas" width="480" height="480" style="
        width:100%;border-radius:20px;
        background:#06060e;border:2px solid var(--border);
        cursor:pointer;touch-action:none;display:block;
      "></canvas>
      <div id="cbMsg" style="text-align:center;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:0.15em;color:var(--muted)">
        TAP TO SHOOT
      </div>
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: NUMBER MEMORY
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-memory" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#7b61ff,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Number Memory</h1>
      <span class="gsub">Memorize the number — how many digits can you remember?</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi3"><div class="slbl">Level</div><div class="sval purple" id="memLevel">1</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="memBest">—</div></div>
      <div class="scard"><div class="slbl">Digits</div><div class="sval muted" id="memDigits">1</div></div>
      <div class="scard hi1"><div class="slbl">Lives</div><div class="sval" id="memLives">❤️❤️❤️</div></div>
    </div>

    <div style="width:100%;max-width:520px;align-self:center;display:flex;flex-direction:column;gap:16px;align-items:center">

      <!-- Number display box -->
      <div id="memDisplay" style="
        width:100%;min-height:140px;
        background:#090914;border:2px solid var(--border);border-radius:20px;
        display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;
        padding:24px;position:relative;overflow:hidden;
      ">
        <div id="memNumber" style="
          font-family:'Bebas Neue',sans-serif;
          font-size:clamp(2.5rem,10vw,5rem);
          letter-spacing:0.18em;color:#ffffff;
          transition:opacity 0.3s;text-align:center;word-break:break-all;
        "></div>
        <div id="memMsg" style="font-size:0.75rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">PRESS START</div>
        <!-- Progress bar for memorize time -->
        <div id="memBar" style="position:absolute;bottom:0;left:0;height:4px;background:var(--purple);width:100%;transition:width linear;"></div>
      </div>

      <!-- Input area -->
      <div id="memInputArea" style="width:100%;display:flex;flex-direction:column;gap:10px;align-items:center;display:none">
        <div style="font-size:0.68rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted)">Type the number you saw</div>
        <input id="memInput" type="number" inputmode="numeric" pattern="[0-9]*"
          style="
            width:100%;background:var(--surf2);border:2px solid var(--purple);
            border-radius:12px;padding:14px 18px;text-align:center;
            font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:0.2em;
            color:#ffffff;outline:none;
          "
          placeholder="?"
        >
        <button id="memSubmit" onclick="memCheck()" style="
          width:100%;padding:14px;background:var(--purple);color:#fff;
          border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;
          font-size:1.2rem;letter-spacing:0.2em;cursor:pointer;transition:opacity 0.2s;
        ">SUBMIT</button>
      </div>

      <!-- Start / next button -->
      <button id="memStartBtn" onclick="memStart()" style="
        padding:14px 48px;background:var(--purple);color:#fff;
        border:none;border-radius:14px;font-family:'Bebas Neue',sans-serif;
        font-size:1.3rem;letter-spacing:0.2em;cursor:pointer;transition:all 0.2s;
      ">START</button>

    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: DINO GAME
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-dino" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#666,#ccc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Dinosaur Game</h1>
      <span class="gsub">Press Space or tap to jump — avoid cacti and pterodactyls</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Score</div><div class="sval" id="dinoScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="dinoBest">0</div></div>
      <div class="scard"><div class="slbl">Speed</div><div class="sval muted" id="dinoSpeed">1x</div></div>
      <div class="scard hi3"><div class="slbl">Status</div><div class="sval purple" id="dinoStatus">Ready</div></div>
    </div>
    <canvas id="dinoCanvas" width="800" height="280" style="
      width:100%;max-width:800px;align-self:center;
      border-radius:16px;background:#111118;border:2px solid var(--border);
      cursor:pointer;display:block;touch-action:none;
    "></canvas>
    <div style="text-align:center;font-size:0.58rem;letter-spacing:0.15em;color:var(--muted);text-transform:uppercase">
      Space / Tap = Jump &nbsp;·&nbsp; ↓ / Swipe Down = Duck
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: SNAKE GAME
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-snake" class="game-zone" style="display:none">
    <div class="gtitle-row">
      <h1 class="gtitle" style="background:linear-gradient(135deg,#00f5a0,#00b4d8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">Snake</h1>
      <span class="gsub">Arrow keys or swipe — eat food, don't hit yourself</span>
    </div>
    <div class="stats-bar">
      <div class="scard hi1"><div class="slbl">Score</div><div class="sval" id="snakeScore">0</div></div>
      <div class="scard hi2"><div class="slbl">Best</div><div class="sval yellow" id="snakeBest">0</div></div>
      <div class="scard"><div class="slbl">Length</div><div class="sval muted" id="snakeLen">3</div></div>
      <div class="scard hi3"><div class="slbl">Status</div><div class="sval purple" id="snakeStatus">Ready</div></div>
    </div>
    <canvas id="snakeCanvas" width="400" height="400" style="
      width:100%;max-width:420px;align-self:center;
      border-radius:16px;background:#0a0a14;border:2px solid var(--border);
      display:block;touch-action:none;cursor:pointer;
    "></canvas>
    <div style="text-align:center;font-size:0.58rem;letter-spacing:0.15em;color:var(--muted);text-transform:uppercase">
      Arrow Keys / WASD &nbsp;·&nbsp; Tap Canvas to Start &nbsp;·&nbsp; Swipe to Turn
    </div>
  </div>

  <!-- ━━━━━━━━━━━━━━━━━━━━━━━━━━━
       PANEL: CLICKER TYCOON
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ -->
  <div id="panel-clicker" class="game-zone ct-panel" style="display:none">

    <!-- TITLE ROW -->
    <div class="ct-titlerow">
      <div>
        <h1 class="gtitle ct-gtitle">💰 Clicker Tycoon</h1>
        <span class="gsub">Click · upgrade · prestige · research · events</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <div id="ctFrenzyBanner" class="ct-frenzy-banner" style="display:none">⚡ CLICK FRENZY! <span id="ctFrenzyTimer">30</span>s ×10</div>
        <button id="ctSoundBtn" class="ct-sound-btn" tabindex="-1">🔊 ON</button>
      </div>
    </div>

    <!-- STATS BAR -->
    <div class="ct-stats">
      <div class="ct-stat">
        <div class="ct-stat-lbl">💰 COINS</div>
        <div class="ct-stat-val" id="ctCoins">0</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">⚡ PER CLICK</div>
        <div class="ct-stat-val ct-gold" id="ctPerClick">1</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">🏭 PER SEC</div>
        <div class="ct-stat-val ct-green" id="ctPerSec">0</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">⭐ PRESTIGE</div>
        <div class="ct-stat-val ct-purple" id="ctPrestige">×1</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">🏆 ALL TIME</div>
        <div class="ct-stat-val" id="ctTotal">0</div>
      </div>
      <div class="ct-stat">
        <div class="ct-stat-lbl">🔬 RESEARCH</div>
        <div class="ct-stat-val ct-gold" id="ctResearchPts">0 RP</div>
      </div>
    </div>

    <!-- 3-COLUMN MAIN LAYOUT -->
    <div class="ct-main">

      <!-- COL 1: Coin + events -->
      <div class="ct-col ct-col-left">

        <!-- Coin + sağ bilgi: yan yana satır -->
        <div class="ct-coin-row">
          <div class="ct-coin-wrap" id="ctCoinWrap">
            <canvas id="ctParticleCanvas"></canvas>
            <div id="ctCoinBtn" class="ct-coin" tabindex="-1">
              <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <radialGradient id="cg1" cx="38%" cy="35%" r="65%">
                    <stop offset="0%"   stop-color="#fff9c4"/>
                    <stop offset="35%"  stop-color="#ffd600"/>
                    <stop offset="70%"  stop-color="#ff9800"/>
                    <stop offset="100%" stop-color="#bf6000"/>
                  </radialGradient>
                </defs>
                <circle cx="60" cy="60" r="57" fill="url(#cg1)" stroke="#b8860b" stroke-width="2.5"/>
                <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(255,255,180,0.25)" stroke-width="1.5"/>
                <text x="60" y="80" text-anchor="middle" font-family="Georgia,serif"
                      font-size="54" font-weight="bold" fill="#7a4000">$</text>
                <ellipse cx="40" cy="36" rx="13" ry="7" fill="rgba(255,255,255,0.28)" transform="rotate(-30 40 36)"/>
              </svg>
            </div>
            <!-- Golden coin event -->
            <div id="ctGoldenCoin" class="ct-golden-coin" style="display:none" tabindex="-1">🌟</div>
            <div id="ctFloatLayer" style="position:absolute;inset:0;pointer-events:none;overflow:visible"></div>
          </div>

          <!-- Sağ bilgi paneli -->
          <div class="ct-coin-right">
            <div class="ct-click-info">
              <span>Clicks: <b id="ctClicks">0</b></span>
              <span>All-time: <b id="ctTotalClicks" style="color:#aaa">0</b></span>
            </div>
            <div id="ctComboDisplay" class="ct-combo-display" style="display:none"></div>
            <div id="ctOfflineMsg" class="ct-offline-msg" style="display:none"></div>

            <!-- Prestige progress -->
            <div class="ct-progress-wrap">
              <div class="ct-progress-label">
                <span style="color:#7070a0">Prestige</span>
                <span id="ctPrestigeGoal" style="color:#555">—</span>
              </div>
              <div class="ct-progress-bg">
                <div id="ctProgressBar" class="ct-progress-fill" style="width:0%"></div>
              </div>
            </div>
          </div>
        </div><!-- /ct-coin-row -->

        <button id="ctPrestigeBtn" class="ct-prestige-btn" tabindex="-1" style="display:none">
          ⭐ PRESTIGE — Reset &amp; Get ×2 Forever
        </button>

        <!-- Fortune Spin -->
        <div class="ct-spin-box">
          <div class="ct-spin-title">🎰 FORTUNE SPIN</div>
          <div id="ctSpinResult" class="ct-spin-result">Spin every 2 min for free!</div>
          <button id="ctSpinBtn" class="ct-spin-btn" tabindex="-1">🎰 SPIN!</button>
          <div id="ctSpinTimer" class="ct-spin-cd" style="display:none"></div>
        </div>

        <!-- Daily Quests -->
        <div class="ct-quest-box">
          <div class="ct-quest-title">📋 QUESTS</div>
          <div id="ctQuestList" class="ct-quest-list"></div>
        </div>

        <!-- Passive list -->
        <div class="ct-auto-box">
          <div class="ct-auto-title">⚙️ Passive Income</div>
          <div id="ctAutoList" class="ct-auto-list">
            <span style="color:#444;font-size:0.78rem">Buy upgrades to earn passively</span>
          </div>
        </div>
      </div>

      <!-- COL 2: Animated world scene -->
      <div class="ct-col ct-col-mid">
        <canvas id="ctWorldCanvas" class="ct-world-canvas"></canvas>
      </div>

      <!-- COL 3: Shop tabs (Upgrades / Research) -->
      <div class="ct-col ct-col-right">
        <div class="ct-tabs-bar">
          <button class="ct-tab-btn active" id="ctTabUpg" tabindex="-1">🛒 Buy</button>
          <button class="ct-tab-btn" id="ctTabRes" tabindex="-1">🔬 Research</button>
          <button class="ct-tab-btn" id="ctTabStats" tabindex="-1">📊 Stats</button>
        </div>
        <div id="ctUpgradeList" class="ct-shop-list"></div>
        <div id="ctResearchList" class="ct-shop-list" style="display:none"></div>
        <div id="ctStatsPanel" class="ct-stats-panel" style="display:none"></div>
      </div>

    </div><!-- /ct-main -->

    <!-- MILESTONES -->
    <div class="ct-milestones-wrap">
      <div class="ct-milestones-title">🏆 Achievements</div>
      <div id="ctMilestones" class="ct-milestones-grid"></div>
    </div>

  </div><!-- /panel-clicker -->

  <!-- ═══════════════════════════════════════════════════
       INFO CONTENT SECTION
  ═══════════════════════════════════════════════════ -->
  <div class="info-wrap" id="infoWrap">

    <!-- ═══ INFO: REACTION ═══ -->
    <div class="info-section" data-info="reaction">
    <div class="sec-divider">ABOUT REACTION TIME TEST</div>
    <article class="icard">
      <h2 class="icard-title">⚡ What Is a Reaction Time Test?</h2>
      <p class="ibody">A <strong>reaction time test</strong> measures how quickly you respond to a visual stimulus — from when your eyes detect a signal to when your hand clicks. Results are in <strong>milliseconds (ms)</strong>. Average human reaction time is <strong>200–250ms</strong>, while elite gamers achieve <strong>150–200ms</strong>.<br><br>Our free online test runs <strong>5 rounds</strong>, gives ratings from <em>Slow</em> to <em>Legendary</em>, and shows your best, average, and score. No download needed — works on any browser.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Reaction Time Rating Chart</h2>
      <table class="rtable"><thead><tr><th>Time</th><th>Rating</th><th>Who?</th></tr></thead><tbody>
        <tr><td style="color:var(--yellow)">Under 150ms</td><td style="color:var(--yellow)">⚡ Legendary</td><td style="color:#c8c8e8">Pro esports athletes</td></tr>
        <tr><td style="color:var(--accent)">150–200ms</td><td style="color:var(--accent)">🔥 Perfect</td><td style="color:#c8c8e8">Top competitive gamers</td></tr>
        <tr><td style="color:var(--accent)">200–250ms</td><td style="color:var(--accent)">✅ Great</td><td style="color:#c8c8e8">Above average, serious player</td></tr>
        <tr><td style="color:var(--purple)">250–320ms</td><td style="color:var(--purple)">👍 Good</td><td style="color:#c8c8e8">Casual gamer, average adult</td></tr>
        <tr><td style="color:#c8c8e8">320–400ms</td><td style="color:#c8c8e8">😐 Average</td><td style="color:#c8c8e8">Most non-gamers</td></tr>
        <tr><td style="color:var(--red)">400ms+</td><td style="color:var(--red)">🐢 Slow</td><td style="color:#c8c8e8">Tired, distracted or first try</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 How to Improve Reaction Time</h2>
      <p class="ibody"><strong>Sleep:</strong> Even 1 hour less sleep adds 50ms+ to reaction time.<br><strong>Practice:</strong> Daily reaction tests build neural pathways over 2–4 weeks.<br><strong>Gaming:</strong> Fast-paced FPS games (CS2, Valorant) measurably improve reaction speed.<br><strong>Caffeine:</strong> 100–200mg reduces reaction time by 10–30ms temporarily.<br><strong>Monitor:</strong> A 144Hz+ monitor with low latency reduces visual delay significantly.</p>
    </article>
    <div class="sec-divider">FAQ — REACTION TIME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Average: <strong>200–250ms</strong>. Excellent: under <strong>200ms</strong>. Elite (pro gamers): under <strong>150ms</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">Why does my reaction time vary? <span class="faq-arrow">▼</span></button><div class="faq-a">Reaction time varies with <strong>fatigue, focus, and anticipation</strong>. Multiple rounds average out variance — 5 rounds gives a reliable score.</div></div>
      <div class="faq-item"><button class="faq-q">Does gaming improve reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. Action games improve <strong>visual processing speed</strong>. Studies show gamers react 50–100ms faster than non-gamers on average.</div></div>
      <div class="faq-item"><button class="faq-q">What is the fastest human reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">The world record visual reaction time is approximately <strong>100ms</strong>. For sprinters, the minimum legal reaction time in the 100m dash is 100ms.</div></div>
      <div class="faq-item"><button class="faq-q">Do monitors affect reaction time results? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. Results include ~5–15ms mouse latency and ~1–8ms monitor delay. A <strong>144Hz+ monitor</strong> reduces display lag significantly. Your true neural reaction is slightly faster than the number shown.</div></div>
      <div class="faq-item"><button class="faq-q">How can I get a lower reaction time score? <span class="faq-arrow">▼</span></button><div class="faq-a">Be well-rested, stay focused, and practice daily. Avoid anticipating the signal — early clicks are counted as failed rounds. Use a gaming mouse and high-refresh monitor for best results.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: STIMULATION ═══ -->
    <div class="info-section" data-info="stimulation" style="display:none">
    <div class="sec-divider">ABOUT STIMULATION CLICKER</div>
    <article class="icard">
      <h2 class="icard-title">🎯 What Is the Stimulation Clicker?</h2>
      <p class="ibody">The <strong>Stimulation Clicker</strong> is an aim training game where colorful targets appear at random positions and you must click them before they disappear. It combines <strong>clicking speed</strong> with <strong>spatial precision</strong> — the same skill set required in FPS games like CS2, Valorant, and Fortnite.<br><br>It is directly inspired by professional aim trainers like <strong>Aimlabs</strong> and <strong>KovaaK's</strong>, designed to build mouse accuracy under time pressure.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 Difficulty Levels</h2>
      <table class="rtable"><thead><tr><th>Level</th><th>Target Size</th><th>Lifetime</th><th>Best For</th></tr></thead><tbody>
        <tr><td style="color:var(--accent)">🟢 Easy</td><td style="color:#c8c8e8">80px</td><td style="color:#c8c8e8">1.2 seconds</td><td style="color:#c8c8e8">Beginners, warm-up</td></tr>
        <tr><td style="color:var(--yellow)">🟡 Medium</td><td style="color:#c8c8e8">55px</td><td style="color:#c8c8e8">0.8 seconds</td><td style="color:#c8c8e8">Standard aim training</td></tr>
        <tr><td style="color:var(--red)">🔴 Hard</td><td style="color:#c8c8e8">38px</td><td style="color:#c8c8e8">0.5 seconds</td><td style="color:#c8c8e8">Elite aim, comparable to Aimlabs Gridshot</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 How to Score Higher on Stimulation Clicker</h2>
      <p class="ibody"><strong>Predict, don't react:</strong> As targets appear, move your cursor toward the next likely zone rather than reacting to each target after it spawns. Targets appear randomly but your anticipation cuts reaction time in half.<br><br><strong>Stay centered:</strong> Keep your cursor near the center of the screen so you have equal range of motion in all directions. Edge-hugging leaves you slow on the opposite side.<br><br><strong>Use Hard mode to train:</strong> Hard mode's 38px targets and 0.5s lifetime mirrors professional aim trainer difficulty. Two weeks of daily Hard mode sessions measurably improves your flick-shot accuracy in CS2 and Valorant.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 Stimulation Clicker vs. Aimlabs vs. KovaaK's</h2>
      <p class="ibody">Professional aim trainers like Aimlabs and KovaaK's are the gold standard for FPS training — but they require downloads and setup. Stimulation Clicker fills the gap as a <strong>zero-install, browser-based alternative</strong> for quick warm-ups.<br><br>Hard mode is comparable to Aimlabs' Gridshot scenario in target size and time pressure. For a 5-minute pre-game warm-up, it's highly effective. For serious competitive training, dedicated aim trainers offer more scenario variety and tracking analytics.</p>
    </article>
    <div class="sec-divider">FAQ — STIMULATION CLICKER</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Does stimulation clicker help in real games? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. The mechanics directly mirror FPS target acquisition. <strong>Hard mode</strong> is comparable to professional aim trainer scenarios. Regular practice improves flick-shot accuracy in CS2 and Valorant.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good stimulation clicker score? <span class="faq-arrow">▼</span></button><div class="faq-a">On Medium: <strong>1500+ points</strong> is average, <strong>3500+</strong> is skilled, <strong>6000+</strong> is elite. On Hard: above <strong>3500</strong> indicates pro-level aim. Scores improve significantly after 1–2 weeks of daily practice.</div></div>
      <div class="faq-item"><button class="faq-q">How long should I train with Stimulation Clicker? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>15–20 minutes daily</strong> is optimal. More than 30 minutes causes fatigue that reduces accuracy and trains bad habits. Consistent daily sessions beat long occasional sessions.</div></div>
      <div class="faq-item"><button class="faq-q">What mouse sensitivity should I use? <span class="faq-arrow">▼</span></button><div class="faq-a">Use your in-game sensitivity. Training at a different sensitivity than you play at won't transfer to real games. If you're unsure, <strong>400 DPI × 2.0 in-game sens</strong> (800 effective DPI) is the most common pro player setting.</div></div>
      <div class="faq-item"><button class="faq-q">Is stimulation clicker good for Fortnite aim? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — the random target placement and short target lifetime closely mimics Fortnite's close-range build-fight scenarios. Medium difficulty is well-suited for Fortnite training. Hard mode is more relevant for CS2 and Valorant's smaller hitboxes.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: CPS / JITTER ═══ -->
    <div class="info-section" data-info="cps" style="display:none">
    <div class="sec-divider">ABOUT CLICK SPEED TEST</div>
    <article class="icard">
      <h2 class="icard-title">🖱️ What Is a CPS Test?</h2>
      <p class="ibody">A <strong>Click Speed Test</strong> (CPS Test) measures how many times you can click per second. It's the core benchmark for competitive gaming, especially <strong>Minecraft PvP</strong>, where raw clicking speed gives a combat advantage. Our free CPS test offers <strong>8 time durations</strong> (1s to 100s) and includes Normal and Challenge modes.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 CPS Ranking Table</h2>
      <table class="rtable"><thead><tr><th>Rank</th><th>CPS</th><th>Level</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">🐢 Turtle</td><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">Beginner</td></tr>
        <tr><td style="color:var(--purple)">🐇 Normal</td><td style="color:var(--purple)">5–7</td><td style="color:var(--purple)">Average</td></tr>
        <tr><td style="color:var(--accent)">⚡ Fast</td><td style="color:var(--accent)">8–10</td><td style="color:var(--accent)">Good</td></tr>
        <tr><td style="color:var(--yellow)">🐆 Cheetah</td><td style="color:var(--yellow)">11–14</td><td style="color:var(--yellow)">Pro</td></tr>
        <tr><td style="color:var(--red)">⚡ God Mode</td><td style="color:var(--red)">15+</td><td style="color:var(--red)">Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">🖱 Clicking Techniques</h2>
      <div class="tech-grid">
        <div class="tcard"><div class="thead-row"><span class="tname">Regular Clicking</span><span class="tbadge p">3–9 CPS</span></div><p class="tbody-t">Standard one-finger method. Best aim accuracy. Sustainable for all durations including 100s.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Jitter Clicking</span><span class="tbadge g">10–14 CPS</span></div><p class="tbody-t">Tense forearm and wrist to create rapid vibrations. Learnable with practice. Risk of wrist strain — take breaks every 15 min.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Butterfly Clicking</span><span class="tbadge y">15–25 CPS</span></div><p class="tbody-t">Two fingers alternate on the same button. World record: <strong>25.5 CPS (Nestor, 2022)</strong>. Often banned in competitive servers.</p></div>
        <div class="tcard"><div class="thead-row"><span class="tname">Drag Clicking</span><span class="tbadge r">30–100+ CPS</span></div><p class="tbody-t">Drag finger across button creating friction micro-clicks. Universally banned in competitive play.</p></div>
      </div>
    </article>
    <article class="icard">
      <h2 class="icard-title">⚡ How to Increase Your CPS</h2>
      <p class="ibody"><strong>Warm up first:</strong> Shake out your wrist and do 10–15 seconds of slow clicking before going for a record. Cold muscles click slower.<br><br><strong>Use your index finger only</strong> for regular clicking — it's the fastest single-finger technique for sustained CPS over 5+ seconds.<br><br><strong>Relax your grip:</strong> A tight grip on the mouse increases fatigue and lowers CPS. Hold firmly but not tensely.<br><br><strong>Shorter duration = higher peak CPS.</strong> Your 1-second score will always be higher than your 10-second score. Use shorter tests to benchmark raw speed, longer tests for stamina.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🖱️ Best Mouse Settings for CPS</h2>
      <p class="ibody"><strong>Polling rate: 1000Hz</strong> — registers up to 1000 clicks per second.<br><strong>Debounce time: 4–8ms</strong> — lower is better. Some mice like Logitech G Pro have configurable debounce.<br><strong>Switch type:</strong> Optical switches (Razer, SteelSeries) have near-zero debounce and register faster than mechanical switches.<br><br>Technique accounts for 90% of your CPS score. Hardware is the last 10%.</p>
    </article>
    <div class="sec-divider">FAQ — CLICK SPEED</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good CPS score? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>6–7 CPS</strong> is average for most adults. Above <strong>10 CPS</strong> is good and requires intentional technique. Above <strong>14 CPS</strong> requires jitter or butterfly clicking. Pro Minecraft PvP players typically sustain 8–12 CPS.</div></div>
      <div class="faq-item"><button class="faq-q">What is the world record CPS? <span class="faq-arrow">▼</span></button><div class="faq-a">Regular clicking: <strong>14.1 CPS (Dylan Allred, 2020)</strong>. Jitter: approximately <strong>16–17 CPS</strong>. Butterfly clicking: <strong>25.5 CPS (Nestor, 2022)</strong>. Drag clicking is excluded from most records as it uses friction rather than actual clicks.</div></div>
      <div class="faq-item"><button class="faq-q">Is jitter clicking harmful to your health? <span class="faq-arrow">▼</span></button><div class="faq-a">Extended jitter clicking can cause <strong>wrist strain, tendinitis, and carpal tunnel syndrome</strong>. Take breaks every 10–15 minutes. Stop immediately if you feel pain or numbness. Regular clicking technique carries minimal risk.</div></div>
      <div class="faq-item"><button class="faq-q">Does a gaming mouse improve CPS? <span class="faq-arrow">▼</span></button><div class="faq-a">Marginally. A gaming mouse with <strong>1000Hz polling rate</strong> and low debounce registers clicks more reliably. Most players gain 0.5–2 CPS from upgrading. Optical switches respond fastest. Technique matters far more than hardware.</div></div>
      <div class="faq-item"><button class="faq-q">What is jitter clicking? <span class="faq-arrow">▼</span></button><div class="faq-a">Jitter clicking involves tensing your forearm and wrist muscles to create rapid vibrations, translating into 10–14 CPS. It requires practice and carries injury risk with overuse. Commonly used in Minecraft PvP and legal in most servers.</div></div>
      <div class="faq-item"><button class="faq-q">What is butterfly clicking? <span class="faq-arrow">▼</span></button><div class="faq-a">Butterfly clicking uses <strong>two fingers alternating</strong> on the same mouse button to achieve 15–25+ CPS. Often banned in competitive Minecraft servers. Requires a mouse that registers both finger inputs without debounce filtering.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: SPACEBAR ═══ -->
    <div class="info-section" data-info="spacebar" style="display:none">
    <div class="sec-divider">ABOUT SPACEBAR TEST</div>
    <article class="icard">
      <h2 class="icard-title">⌨️ What Is the Spacebar Speed Test?</h2>
      <p class="ibody">The <strong>Spacebar Speed Test</strong> measures how many times per second you can press the spacebar. It's popular among <strong>rhythm game players</strong> (osu!, Beat Saber) and keyboard enthusiasts. Unlike mouse clicking, spacebar speed depends heavily on keyboard switch type and finger placement technique.<br><br>Our test supports 8 durations (1s–100s) and counts only new presses — holding down the spacebar does not register multiple presses.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ Spacebar Speed Rankings</h2>
      <table class="rtable"><thead><tr><th>Presses/sec</th><th>Rating</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">🐢 Slow</td></tr>
        <tr><td style="color:var(--purple)">5–7</td><td style="color:var(--purple)">👍 Average</td></tr>
        <tr><td style="color:var(--accent)">8–10</td><td style="color:var(--accent)">⚡ Fast</td></tr>
        <tr><td style="color:var(--yellow)">11+</td><td style="color:var(--yellow)">🏆 Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ How to Press Spacebar Faster</h2>
      <p class="ibody"><strong>Use your thumb's pad, not the tip:</strong> The fleshy pad of your thumb covers more key surface and rebounds faster than the tip. Plant your thumb flat and lift with wrist momentum rather than pure finger movement.<br><br><strong>Don't bottom out:</strong> Pressing the spacebar all the way down wastes time on return travel. Press just past actuation point and let the switch spring push your thumb back up.<br><br><strong>Keyboard matters here more than in typing:</strong> A mechanical keyboard with <strong>linear switches (Red, Speed Silver)</strong> has shorter travel distance and lower actuation force, directly improving spacebar speed by 10–20%.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Spacebar Speed World Records</h2>
      <p class="ibody">The verified spacebar speed record stands at approximately <strong>14–16 presses per second</strong> for a 10-second test using standard technique. Some claims of 20+ HPS exist but are typically achieved with modified technique or disputed timing.<br><br>For rhythm games like <strong>osu!</strong>, players regularly sustain 10–12 HPS for multiple seconds during streams (rapid consecutive notes). This makes osu! players among the fastest spacebar pressers in the world.</p>
    </article>
    <div class="sec-divider">FAQ — SPACEBAR</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is a good spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a"><strong>6–8 presses per second</strong> is average. Above <strong>10 HPS</strong> is exceptional and typically requires a mechanical keyboard with linear switches. Rhythm game players (osu!, Beat Saber) regularly achieve 10–12 HPS.</div></div>
      <div class="faq-item"><button class="faq-q">Does keyboard type affect spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, significantly. <strong>Linear mechanical switches</strong> (Red, Speed Silver) allow faster actuation than membrane keyboards. Switch actuation force and travel distance directly impact maximum speed. Speed Silver switches have the shortest travel at 1.2mm.</div></div>
      <div class="faq-item"><button class="faq-q">Why doesn't holding spacebar count? <span class="faq-arrow">▼</span></button><div class="faq-a">Browsers fire repeated keydown events when a key is held. We filter these with <code>e.repeat</code> detection — only actual new presses count, making the test accurate and fair across all keyboards and browsers.</div></div>
      <div class="faq-item"><button class="faq-q">What games use spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Rhythm games like <strong>osu!</strong> require rapid spacebar inputs during stream sections. Some Minecraft mechanics (horse jumping, fishing) benefit from spacebar timing. It's also used in parkour games and various browser-based games.</div></div>
      <div class="faq-item"><button class="faq-q">Can I train spacebar speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes. 5–10 minutes of daily spacebar testing builds the specific motor pattern for rapid thumb actuation. Most users improve by 1–3 HPS within two weeks of consistent practice. Combining this with a linear mechanical keyboard gives the fastest results.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: TYPING ═══ -->
    <div class="info-section" data-info="typing" style="display:none">
    <div class="sec-divider">ABOUT TYPING SPEED TEST</div>
    <article class="icard">
      <h2 class="icard-title">📝 What Is a Typing Speed Test (WPM)?</h2>
      <p class="ibody">A <strong>Typing Speed Test</strong> measures your typing speed in <strong>WPM (Words Per Minute)</strong> and accuracy. The standard WPM formula counts each 5 characters as one "word." Our test uses real English words, tracks correct/incorrect entries, and gives live WPM feedback.<br><br>Choose <strong>30s, 60s, or 120s</strong> modes. Average typing speed is <strong>40–50 WPM</strong>. Professional typists reach 70–100+ WPM.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ WPM Rankings</h2>
      <table class="rtable"><thead><tr><th>WPM</th><th>Level</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">Under 30</td><td style="color:#b0b0d0">🐢 Beginner</td></tr>
        <tr><td style="color:var(--purple)">30–50</td><td style="color:var(--purple)">👍 Average</td></tr>
        <tr><td style="color:var(--accent)">50–70</td><td style="color:var(--accent)">⚡ Good</td></tr>
        <tr><td style="color:var(--yellow)">70–100</td><td style="color:var(--yellow)">🏆 Fast</td></tr>
        <tr><td style="color:var(--red)">100+</td><td style="color:var(--red)">⚡ Elite</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⌨️ How to Type Faster: A Practical Guide</h2>
      <p class="ibody"><strong>1. Learn touch typing first.</strong> If you're still hunting for keys, that's the only thing that matters. Touch typing (all 10 fingers, never looking down) unlocks 60+ WPM as a baseline. Resources like Keybr.com or TypingClub teach it in 2–4 weeks of daily 15-minute sessions.<br><br><strong>2. Accuracy before speed.</strong> Correcting typos costs more time than typing slowly. Aim for 98%+ accuracy and your speed will naturally increase. Turn off autocorrect during practice so mistakes register.<br><br><strong>3. Common words are your shortcut.</strong> The 100 most common English words account for 50% of all text. Mastering their muscle memory patterns alone takes you from 30 to 55 WPM.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Typing Speed by Profession</h2>
      <table class="rtable"><thead><tr><th>Profession</th><th>Avg WPM</th><th>Notes</th></tr></thead><tbody>
        <tr><td style="color:#c8c8e8">Average adult</td><td style="color:var(--accent)">41 WPM</td><td style="color:#b0b0d0">2-finger or partial touch typing</td></tr>
        <tr><td style="color:#c8c8e8">Office worker</td><td style="color:var(--accent)">55–70 WPM</td><td style="color:#b0b0d0">Daily keyboard use</td></tr>
        <tr><td style="color:#c8c8e8">Professional typist</td><td style="color:var(--yellow)">70–100 WPM</td><td style="color:#b0b0d0">Touch typing mastered</td></tr>
        <tr><td style="color:#c8c8e8">Developer / writer</td><td style="color:var(--yellow)">60–90 WPM</td><td style="color:#b0b0d0">High accuracy requirement</td></tr>
        <tr><td style="color:#c8c8e8">Stenographer</td><td style="color:var(--red)">200–300 WPM</td><td style="color:#b0b0d0">Specialized chorded keyboard</td></tr>
        <tr><td style="color:#c8c8e8">World record</td><td style="color:var(--red)">212 WPM</td><td style="color:#b0b0d0">Barbara Blackburn, 2005</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — TYPING TEST</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is average typing speed? <span class="faq-arrow">▼</span></button><div class="faq-a">The global average is <strong>40–50 WPM</strong>. Office professionals average 55–70 WPM. Professional typists and stenographers reach 100–200+ WPM. The world record is 212 WPM held by Barbara Blackburn.</div></div>
      <div class="faq-item"><button class="faq-q">How is WPM calculated? <span class="faq-arrow">▼</span></button><div class="faq-a">The standard formula counts every <strong>5 characters as one "word"</strong> — including spaces and punctuation. This makes WPM scores comparable regardless of word length. Gross WPM counts all keystrokes; net WPM subtracts errors.</div></div>
      <div class="faq-item"><button class="faq-q">How can I type faster? <span class="faq-arrow">▼</span></button><div class="faq-a">Learn <strong>touch typing</strong> (all 10 fingers without looking). Practice 15–30 minutes daily. Focus on accuracy first — speed follows naturally. Target 98%+ accuracy before pushing for higher WPM. Sites like Keybr.com are excellent companions.</div></div>
      <div class="faq-item"><button class="faq-q">Does keyboard type affect typing speed? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, but technique matters far more. <strong>Mechanical keyboards</strong> with tactile feedback (Cherry MX Brown, Blue) help accuracy. Low-profile laptop keys cause more errors for some typists. Switching keyboards typically changes your WPM by ±5–10%.</div></div>
      <div class="faq-item"><button class="faq-q">What WPM do I need for a job? <span class="faq-arrow">▼</span></button><div class="faq-a">Most office jobs require <strong>40–60 WPM</strong>. Data entry positions typically require 60–80 WPM. Legal transcription and medical typing require 70–90 WPM with near-perfect accuracy. Stenographers need 200+ WPM with a specialized machine.</div></div>
      <div class="faq-item"><button class="faq-q">Is 100 WPM good? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — <strong>100 WPM puts you in the top 5%</strong> of typists worldwide. At this speed, typing is rarely a bottleneck for any professional task. Writers and developers at 100 WPM can focus entirely on thought rather than mechanics.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: COREBALL ═══ -->
    <div class="info-section" data-info="coreball" style="display:none">
    <div class="sec-divider">ABOUT COREBALL GAME</div>
    <article class="icard">
      <h2 class="icard-title">🎮 How to Play Coreball</h2>
      <p class="ibody">In <strong>Coreball</strong>, a central core spins continuously. You shoot balls from the bottom — each ball sticks to the core when it lands. The challenge: <strong>don't let your ball hit an existing ball</strong> already stuck on the core. As you score more, the core spins faster, increasing difficulty.<br><br>Tap or click to shoot. You start with 10 balls. Plan your shots carefully — timing is everything.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎯 Coreball Tips</h2>
      <p class="ibody"><strong>Watch the gaps:</strong> Focus on the spaces between stuck balls, not the balls themselves.<br><strong>Rhythm shooting:</strong> Find the rotation rhythm and shoot in sync.<br><strong>Don't rush:</strong> You have 10 balls — patience beats panic.<br><strong>Higher levels:</strong> Speed increases every 10 points. Adjust your timing accordingly.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎯 Advanced Coreball Strategy</h2>
      <p class="ibody"><strong>Find the rhythm, then shoot in sync.</strong> The core rotates at a constant speed. Count the rotation mentally ("1-2-3-shoot") until the pattern becomes automatic. Rhythm shooters consistently outperform reactive shooters.<br><br><strong>Target the largest gap, not the next one.</strong> As more balls accumulate on the core, look for the two largest adjacent gaps. Aim for the center of that gap — it gives you the most margin for error.<br><br><strong>Danger balls demand respect.</strong> Red danger balls move faster and reduce your margin. When a danger ball is on the core, slow down and wait for it to rotate to a safe position before shooting.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏆 Coreball Score Guide</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Level</th><th>Skill</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–9</td><td style="color:#b0b0d0">Level 1</td><td style="color:#c8c8e8">Learning the timing</td></tr>
        <tr><td style="color:var(--accent)">10–19</td><td style="color:var(--accent)">Level 2</td><td style="color:#c8c8e8">Consistent timing, above average</td></tr>
        <tr><td style="color:var(--yellow)">20–29</td><td style="color:var(--yellow)">Level 3</td><td style="color:#c8c8e8">Good rhythm, handles speed increase</td></tr>
        <tr><td style="color:var(--red)">30+</td><td style="color:var(--red)">Level 4+</td><td style="color:#c8c8e8">Elite — very few players reach this</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — COREBALL</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the Coreball game? <span class="faq-arrow">▼</span></button><div class="faq-a">Coreball is a precision timing game where you shoot balls onto a spinning core without hitting existing ones. It tests <strong>timing, patience, and spatial awareness</strong>. The core spins faster with each level, increasing difficulty progressively.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good Coreball score? <span class="faq-arrow">▼</span></button><div class="faq-a">Scoring <strong>10+ points</strong> without a miss is good. Above <strong>20</strong> is excellent. Above <strong>30</strong> is elite-level and requires mastery of the rhythm pattern at high rotation speeds.</div></div>
      <div class="faq-item"><button class="faq-q">Why do I keep losing on Coreball? <span class="faq-arrow">▼</span></button><div class="faq-a">The most common mistake is reacting to the gap you see <em>now</em> rather than where the gap will be when your ball arrives. The ball takes ~0.3 seconds to reach the core — aim slightly ahead of the gap you want.</div></div>
      <div class="faq-item"><button class="faq-q">What does the red ball do in Coreball? <span class="faq-arrow">▼</span></button><div class="faq-a">Red "danger balls" are pre-placed on the core and spin with it. They narrow the available gaps significantly. Always locate all danger balls before shooting to avoid unexpected collisions.</div></div>
      <div class="faq-item"><button class="faq-q">Does Coreball have an end? <span class="faq-arrow">▼</span></button><div class="faq-a">No — Coreball is an endless survival game. It gets progressively harder as rotation speed increases with each level. The challenge is surviving as long as possible, not reaching a final stage.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: DINO ═══ -->
    <div class="info-section" data-info="dino" style="display:none">
    <div class="sec-divider">ABOUT DINOSAUR GAME</div>
    <article class="icard">
      <h2 class="icard-title">🦕 How to Play the Dinosaur Game</h2>
      <p class="ibody">The <strong>Dinosaur Game</strong> (also known as the Chrome Dino or T-Rex Runner) is a classic endless runner. Press <strong>Space or tap</strong> to jump over cacti and duck under pterodactyls. The game speeds up over time — how far can you run?<br><br>This tests your <strong>reaction time and rhythm</strong> under escalating pressure, making it a fun complement to the reaction time test.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🦕 How to Get a High Score in the Dinosaur Game</h2>
      <p class="ibody"><strong>Jump earlier than feels natural.</strong> The cactus looks far away, but the dinosaur needs ~200ms to reach jump height. At high speeds, late jumpers always fail. Train yourself to jump when the obstacle is still about 1 character-width away.<br><br><strong>Duck under pterodactyls, don't jump.</strong> Many players instinctively jump at flying enemies, which often leads to mid-air collisions. Swipe down or press the down arrow to duck — it's faster and safer.<br><br><strong>The game speeds up every 100 points.</strong> Your mental model needs to constantly recalibrate. After each 100-point milestone, consciously reset your "jump early" threshold.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Dinosaur Game Score Milestones</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Rating</th><th>Speed</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">0–500</td><td style="color:#b0b0d0">🐣 Beginner</td><td style="color:#c8c8e8">Manageable, single cacti</td></tr>
        <tr><td style="color:var(--accent)">500–1000</td><td style="color:var(--accent)">✅ Getting there</td><td style="color:#c8c8e8">Cactus clusters appear</td></tr>
        <tr><td style="color:var(--yellow)">1000–5000</td><td style="color:var(--yellow)">⚡ Above average</td><td style="color:#c8c8e8">Pterodactyls + night mode</td></tr>
        <tr><td style="color:var(--red)">5000–10000</td><td style="color:var(--red)">🏆 Expert</td><td style="color:#c8c8e8">Maximum speed approaches</td></tr>
        <tr><td style="color:var(--red)">99999</td><td style="color:var(--red)">⚡ Legendary</td><td style="color:#c8c8e8">Score resets to 0 (rare)</td></tr>
      </tbody></table>
    </article>
    <div class="sec-divider">FAQ — DINO GAME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the Chrome Dinosaur game? <span class="faq-arrow">▼</span></button><div class="faq-a">Originally created by Google in 2014, the <strong>T-Rex Runner</strong> appears in Chrome when you have no internet connection. It's now one of the most played browser games in the world, with an estimated <strong>270 million plays per month</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">What is a good Dino game score? <span class="faq-arrow">▼</span></button><div class="faq-a">Reaching <strong>500 points</strong> is good for beginners. <strong>1000+</strong> is above average. Expert players regularly score <strong>5000–10000+</strong>. The theoretical maximum score before the counter resets is <strong>99999</strong>.</div></div>
      <div class="faq-item"><button class="faq-q">How do you duck in the Dinosaur game? <span class="faq-arrow">▼</span></button><div class="faq-a">Press the <strong>down arrow key</strong> on desktop or <strong>swipe down</strong> on mobile. Ducking is essential for avoiding low-flying pterodactyls. Holding down will keep you crouched until you release — useful for pterodactyls that hover at jump height.</div></div>
      <div class="faq-item"><button class="faq-q">Does the Dino game ever end? <span class="faq-arrow">▼</span></button><div class="faq-a">Technically no — the game is endless. The score counter resets to 00000 after reaching <strong>99999</strong>. In practice, game speed increases until human reaction time becomes insufficient at extreme scores, making it a practical limit.</div></div>
      <div class="faq-item"><button class="faq-q">Why does the screen go dark in the Dino game? <span class="faq-arrow">▼</span></button><div class="faq-a">The game alternates between day and night mode as your score increases. <strong>Night mode</strong> inverts colors (dark background, white obstacles) to increase difficulty. It's a visual challenge layer added to the original game.</div></div>
    </div></article>
    </div>

    <!-- ═══ INFO: NUMBER MEMORY ═══ -->
    <div class="info-section" data-info="memory" style="display:none">
    <div class="sec-divider">ABOUT NUMBER MEMORY TEST</div>
    <article class="icard">
      <h2 class="icard-title">🧠 What Is the Number Memory Test?</h2>
      <p class="ibody">The <strong>Number Memory Test</strong> challenges you to memorize increasingly long sequences of digits. Each level adds one more digit — starting at 1, going up as far as your working memory allows. You have <strong>3 lives</strong>; a wrong answer costs one life and drops you back a level. The number is shown briefly, then hidden — you must type it from memory.<br><br>This test directly measures your <strong>working memory capacity</strong>, one of the most researched cognitive abilities. It's used in IQ tests, psychology research, and neurological assessments worldwide.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Number Memory Score Rankings</h2>
      <table class="rtable"><thead><tr><th>Digits</th><th>Level</th><th>Population</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">1–4</td><td style="color:#b0b0d0">🐢 Below Average</td><td style="color:#c8c8e8">Bottom 25%</td></tr>
        <tr><td style="color:var(--purple)">5–6</td><td style="color:var(--purple)">👍 Average</td><td style="color:#c8c8e8">Most adults: 5–7 digits</td></tr>
        <tr><td style="color:var(--accent)">7–8</td><td style="color:var(--accent)">⚡ Good</td><td style="color:#c8c8e8">Top 30% — strong working memory</td></tr>
        <tr><td style="color:var(--yellow)">9–10</td><td style="color:var(--yellow)">🏆 Excellent</td><td style="color:#c8c8e8">Top 10% — gifted memory</td></tr>
        <tr><td style="color:var(--red)">11+</td><td style="color:var(--red)">🧠 Exceptional</td><td style="color:#c8c8e8">Top 1% — memory athlete level</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Tips to Improve Number Memory</h2>
      <p class="ibody"><strong>Chunking:</strong> Group digits into pairs or triples (e.g. 3-8-4-7-2 → 38, 47, 2). This is how phone numbers are remembered.<br><strong>Rhythm:</strong> Say the number aloud with a rhythm or melody — music memory is stronger than verbal memory.<br><strong>Visualization:</strong> Associate digits with images or locations (memory palace technique).<br><strong>Practice:</strong> Daily training measurably expands working memory span within 2–4 weeks.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🧠 Science Behind Working Memory</h2>
      <p class="ibody">Working memory is the brain's "mental whiteboard" — the system that temporarily holds and manipulates information. It's governed primarily by the <strong>prefrontal cortex</strong> and is one of the strongest predictors of academic and professional performance.<br><br>Psychologist George Miller's 1956 paper "The Magical Number Seven, Plus or Minus Two" established that humans can hold <strong>7±2 chunks</strong> of information in working memory. Modern research has revised this slightly downward to <strong>4±1 chunks</strong> when rehearsal is prevented — but chunking (grouping digits) effectively expands usable capacity back to 7+.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Memory Techniques That Actually Work</h2>
      <p class="ibody"><strong>Chunking:</strong> Group digits into 2–3 digit pairs. "8-3-7-4-1-9" becomes "83 · 74 · 19" — three items instead of six. This alone can add 3–4 digits to your memory span.<br><br><strong>Verbal rhythm:</strong> Say the number out loud (or mentally) with a musical rhythm. Melody-based memory is significantly more durable than silent reading. Phone numbers stuck in your head prove this works.<br><br><strong>The Major System:</strong> Convert digits to consonant sounds, build words, then create vivid mental images. 7 = K/G, 3 = M, 5 = L. With practice, this lets memory athletes remember 50+ random digits.</p>
    </article>
    <div class="sec-divider">FAQ — NUMBER MEMORY</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">What is the average number memory span? <span class="faq-arrow">▼</span></button><div class="faq-a">The average adult holds <strong>5–7 digits</strong> in working memory — the reason phone numbers were originally 7 digits long. George Miller called this "The Magical Number Seven, Plus or Minus Two" in his landmark 1956 paper.</div></div>
      <div class="faq-item"><button class="faq-q">What is the world record for number memory? <span class="faq-arrow">▼</span></button><div class="faq-a">Memory athletes using the <strong>memory palace technique</strong> can memorize hundreds of random digits. The world record for memorizing pi is over 70,000 digits (Rajveer Meena, 2015). For random digit sequences, competitive memorizers achieve 50–100+ digits.</div></div>
      <div class="faq-item"><button class="faq-q">Does number memory relate to IQ? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — working memory capacity is <strong>moderately correlated with fluid intelligence</strong> (r ≈ 0.5). Digit span tasks are included in WAIS and WISC intelligence tests. However, memory techniques can substantially increase your score independently of IQ.</div></div>
      <div class="faq-item"><button class="faq-q">Why does the number disappear so fast? <span class="faq-arrow">▼</span></button><div class="faq-a">Display time scales with digit count (~800ms per digit). At higher levels you get more total time. The challenge is transferring what you see into <strong>short-term verbal memory</strong> before it fades — this is precisely what the test measures.</div></div>
      <div class="faq-item"><button class="faq-q">Can working memory be improved? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes, through technique and practice. <strong>Chunking, verbal rehearsal, and visualization</strong> reliably expand your effective memory span. Daily memory testing for 2–4 weeks produces measurable improvements. Aerobic exercise and adequate sleep also improve working memory performance.</div></div>
      <div class="faq-item"><button class="faq-q">Is a memory span of 10 digits good? <span class="faq-arrow">▼</span></button><div class="faq-a">Excellent — a 10-digit span puts you in the <strong>top 10%</strong> of the population. Above 11 digits is memory-athlete territory (top 1%). Most untrained adults score 5–7 digits on their first attempt.</div></div>
    </div></article>
    </div>

    <div class="info-section" data-info="snake" style="display:none">
    <div class="sec-divider">ABOUT SNAKE GAME</div>
    <article class="icard">
      <h2 class="icard-title">🐍 What Is Snake? How to Play</h2>
      <p class="ibody">Snake is one of the most iconic games ever made — a simple concept with infinite replayability. You control a snake that grows longer every time it eats food. The challenge: avoid hitting the walls or your own body, which ends the game instantly.<br><br>Use <strong>Arrow Keys</strong> or <strong>WASD</strong> on keyboard to change direction. On mobile, <strong>swipe</strong> in any direction. Tap or press any arrow key to start. Each apple you eat adds 10 points and makes the snake one cell longer. The game speeds up gradually as your score climbs — plan your path ahead to survive.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">📊 Snake Score Rankings</h2>
      <table class="rtable"><thead><tr><th>Score</th><th>Level</th><th>Who?</th></tr></thead><tbody>
        <tr><td style="color:#b0b0d0">0–40</td><td style="color:#b0b0d0">🐣 Beginner</td><td style="color:#c8c8e8">First-time players</td></tr>
        <tr><td style="color:var(--blue)">50–100</td><td style="color:var(--blue)">🐍 Casual</td><td style="color:#c8c8e8">Getting comfortable</td></tr>
        <tr><td style="color:var(--accent)">110–200</td><td style="color:var(--accent)">⚡ Skilled</td><td style="color:#c8c8e8">Good spatial awareness</td></tr>
        <tr><td style="color:var(--yellow)">210–350</td><td style="color:var(--yellow)">🔥 Expert</td><td style="color:#c8c8e8">Top 15% of players</td></tr>
        <tr><td style="color:var(--red)">360+</td><td style="color:var(--red)">👑 Master</td><td style="color:#c8c8e8">Near-perfect routing</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">💡 Snake Strategy Tips</h2>
      <p class="ibody"><strong>Hug the walls early:</strong> In the first 30 seconds, move along the edges. This keeps the center open and gives you more room to maneuver as your body grows.<br><br><strong>Think in loops:</strong> Plan an S-shaped or U-shaped path that covers the whole board systematically. This avoids dead ends.<br><br><strong>Don't rush to food:</strong> A longer path to the apple is always better than a short path that boxes you in. Survival beats score optimization at first.<br><br><strong>Watch your tail:</strong> Remember your tail is moving too — a cell your body occupies now will be free in a few steps. Advanced players use this to thread through tight gaps.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🎮 History of Snake</h2>
      <p class="ibody">Snake was originally created in <strong>1976</strong> as an arcade game called <em>Blockade</em> by Gremlin Industries. The modern Snake phenomenon exploded in <strong>1998</strong> when Nokia pre-installed it on the <strong>Nokia 6110</strong>, making it the first game hundreds of millions of people played on a mobile device.<br><br>The game trained an entire generation's reflexes and spatial reasoning. Its simple grid-based movement, clear failure state, and addictive "just one more try" loop make it a timeless design masterpiece. Our version adds smooth 60fps animation via interpolation between game ticks, wall boundaries, and difficulty scaling.</p>
    </article>
    <div class="sec-divider">FAQ — SNAKE GAME</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Does the snake wrap around walls? <span class="faq-arrow">▼</span></button><div class="faq-a">No — in this version, hitting any wall <strong>ends the game instantly</strong>. The glowing green border is your reminder of the danger zone. This makes the game more challenging and rewards careful long-term planning.</div></div>
      <div class="faq-item"><button class="faq-q">How fast does the snake get? <span class="faq-arrow">▼</span></button><div class="faq-a">The snake starts at one move every <strong>200ms</strong> and speeds up by 2ms per apple eaten. At maximum speed (80ms/move) the snake moves 12× per second. Even at max speed, smooth 60fps interpolation keeps movement fluid.</div></div>
      <div class="faq-item"><button class="faq-q">What is the maximum possible score? <span class="faq-arrow">▼</span></button><div class="faq-a">The board is 20×20 = 400 cells. The snake starts with 3 segments, so the theoretical maximum is eating <strong>397 apples</strong> for a score of <strong>3,970 points</strong>. Achieving this requires perfect routing of the entire board — an extremely rare feat.</div></div>
      <div class="faq-item"><button class="faq-q">Can I play Snake on mobile? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — swipe left, right, up, or down on the canvas to control direction. Tap the canvas once to start the game. The game is fully touch-optimized with swipe detection.</div></div>
      <div class="faq-item"><button class="faq-q">Why does Snake train reaction time? <span class="faq-arrow">▼</span></button><div class="faq-a">Snake improves <strong>anticipatory reaction time</strong> — the ability to plan and execute decisions before a crisis arrives. Unlike pure reflex tests, Snake develops spatial working memory, decision-making under time pressure, and long-term trajectory planning.</div></div>
      <div class="faq-item"><button class="faq-q">What keyboard keys control the snake? <span class="faq-arrow">▼</span></button><div class="faq-a">You can use <strong>Arrow Keys</strong> (↑ ↓ ← →) or <strong>WASD</strong>. Both work identically. You cannot reverse direction 180° — pressing the opposite direction of travel is ignored to prevent instant self-collision.</div></div>
    </div></article>
    </div><!-- /snake info-section -->

    <!-- ═══ INFO: CLICKER TYCOON ═══ -->
    <div class="info-section" data-info="clicker" style="display:none">
    <div class="sec-divider">ABOUT CLICKER TYCOON</div>
    <article class="icard">
      <h2 class="icard-title">💰 What Is Clicker Tycoon?</h2>
      <p class="ibody">Clicker Tycoon is an <strong>idle incremental game</strong> built directly into your browser — no download, no sign-up. Click the big coin button to earn coins, then spend them on upgrades that generate income automatically. The core loop: <em>click → earn → buy → earn more passively → prestige → multiply everything</em>.<br><br>Your progress is <strong>automatically saved</strong> to your browser — close the tab and come back later. Your passive income keeps rolling while you're away.</p>
    </article>
    <article class="icard">
      <h2 class="icard-title">🏭 Upgrades &amp; Passive Income</h2>
      <table class="rtable"><thead><tr><th>Upgrade</th><th>Base Cost</th><th>Income/s</th></tr></thead><tbody>
        <tr><td>🖱️ Auto Cursor</td><td style="color:#c8c8e8">10 coins</td><td style="color:var(--accent)">0.1/s</td></tr>
        <tr><td>👶 Intern</td><td style="color:#c8c8e8">80 coins</td><td style="color:var(--accent)">0.5/s</td></tr>
        <tr><td>⛏️ Coin Miner</td><td style="color:#c8c8e8">300 coins</td><td style="color:var(--accent)">2/s</td></tr>
        <tr><td>🏭 Factory</td><td style="color:#c8c8e8">1,200 coins</td><td style="color:var(--accent)">8/s</td></tr>
        <tr><td>🏦 Bank</td><td style="color:#c8c8e8">5,000 coins</td><td style="color:var(--accent)">25/s</td></tr>
        <tr><td>🔬 Research Lab</td><td style="color:#c8c8e8">20,000 coins</td><td style="color:var(--accent)">80/s</td></tr>
        <tr><td>🚀 Space Launch</td><td style="color:#c8c8e8">80,000 coins</td><td style="color:var(--accent)">250/s</td></tr>
        <tr><td>🤖 AI Algorithm</td><td style="color:#c8c8e8">300,000 coins</td><td style="color:var(--accent)">800/s</td></tr>
        <tr><td>🌀 Coin Portal</td><td style="color:#c8c8e8">1,000,000 coins</td><td style="color:var(--accent)">2,500/s</td></tr>
      </tbody></table>
    </article>
    <article class="icard">
      <h2 class="icard-title">⭐ Prestige System</h2>
      <p class="ibody">Once you've earned <strong>100,000 coins</strong> total, the Prestige button appears. Prestiging <strong>resets your coins and upgrades</strong> but grants a permanent <strong>×2 income multiplier</strong> on everything — clicks and passive income.<br><br>Each subsequent prestige requires 10× more total earnings: 100K → 1M → 10M → 100M. After 10 prestiges, your multiplier reaches <strong>×1,024</strong>. The loop becomes exponentially more satisfying each cycle.</p>
    </article>
    <div class="sec-divider">FAQ — CLICKER TYCOON</div>
    <article class="icard"><div class="faq-list">
      <div class="faq-item"><button class="faq-q">Is my progress saved? <span class="faq-arrow">▼</span></button><div class="faq-a">Yes — your coins, upgrades, prestige level, and milestones are automatically saved to your browser's <strong>localStorage</strong> every 10 seconds. Close the tab and return anytime — your progress will be there.</div></div>
      <div class="faq-item"><button class="faq-q">Does passive income run while I'm away? <span class="faq-arrow">▼</span></button><div class="faq-a">Passive income runs <strong>only while the tab is open</strong>. The game doesn't run in the background when closed. Plan your session around when you'll check back — or leave it running while you play other games on the site.</div></div>
      <div class="faq-item"><button class="faq-q">When should I prestige? <span class="faq-arrow">▼</span></button><div class="faq-a">Prestige as soon as the button appears (100K total earned). The ×2 multiplier on everything makes your next run dramatically faster. Don't wait to "max out" — early prestige snowballs faster.</div></div>
      <div class="faq-item"><button class="faq-q">What's the best upgrade strategy? <span class="faq-arrow">▼</span></button><div class="faq-a">Early game: stack Auto Cursors and Interns until you can afford Miners. Mid game: prioritize Factories and Banks for high passive income. Late game: Research Labs and above give the best coins-per-coin return. Buy in bulk when you can afford 10+ of the same upgrade.</div></div>
    </div></article>
    </div>

    <footer class="sfooter">
      <div style="margin-bottom:10px">
        <span style="color:var(--yellow);font-size:0.9rem;letter-spacing:2px">★★★★★</span>
        <span style="color:var(--text);font-size:0.58rem;margin-left:6px">4.9/5 — 4,218 ratings</span>
      </div>
      <p style="margin-bottom:6px;font-size:0.5rem">
        Platform: <span>Windows, macOS, Linux, Android, iOS</span> &nbsp;·&nbsp;
        Category: <span>Reaction Test / Cognitive Games</span> &nbsp;·&nbsp;
        Price: <span>Free</span> &nbsp;·&nbsp;
        Rated: <span>4.9 / 5</span> by <span>4,218</span> users
      </p>
      <p>© <span id="footYear">2026</span> <strong>Reaction Speed Test</strong> — Free Online Reflex &amp; Brain Tests</p>
      <p style="margin-top:6px">Test your <strong>reaction speed</strong>, <strong>reflex time</strong>, <strong>typing speed (WPM)</strong>, <strong>click speed (CPS)</strong>, <strong>number memory</strong> and more — free, no download, works on any device.</p>
      <p style="margin-top:6px;font-size:0.48rem">Keywords: reaction speed test · reaction time test · reflex test · human benchmark · measure reaction time · free reaction test · response time test · reflex time ms · click speed test · CPS test · typing speed test · WPM test · jitter click · spacebar test · stimulation clicker · clicker tycoon · snake game · dinosaur game · coreball · number memory test · brain games online</p>
    </footer>

  </div>
</div><!-- /wrap -->

<script>
'use strict';

/* ═══════════════════════════════════════════
   STATE
═══════════════════════════════════════════ */
let curPanel    = 'cps';
let curDuration = 5;
let clickMode   = 'normal';
let stimDiff    = 'medium';

/* ═══════════════════════════════════════════
   HEADER / PANEL SWITCHING
═══════════════════════════════════════════ */
/* ═══════════════════════════════════════════
   ROUTER — URL-based navigation + SEO meta
═══════════════════════════════════════════ */
const ROUTES = {
  'reaction':    {
    path:  '/reaction-time-test',
    title: 'Reaction Speed Test – Measure Your Reflex Time Online',
    desc:  'Test your reaction speed instantly with our free online tool. Measure your reflex time in milliseconds, compare to the human benchmark (200–250ms average), and challenge your friends. No download required.',
    h1:    'Reaction Speed Test'
  },
  'stimulation': {
    path:  '/stimulation-clicker',
    title: 'Stimulation Clicker – Free Online Aim Trainer & Reflex Test',
    desc:  'Free stimulation clicker aim trainer. Hit moving targets to sharpen mouse accuracy and reaction speed for FPS games. Comparable to Aimlabs Gridshot on Hard mode. Works on all browsers, no download.',
    h1:    'Stimulation Clicker'
  },
  'cps':         {
    path:  '/click-speed-test',
    title: 'Click Speed Test (CPS Test) – How Fast Can You Click?',
    desc:  'Free CPS test — measure your clicks per second instantly. 8 durations from 1 to 100 seconds. Average is 6–7 CPS. Track your score and compare with friends. Works on PC, Mac and mobile.',
    h1:    'Click Speed Test'
  },
  'jitter':      {
    path:  '/jitter-click-test',
    title: 'Jitter Click Test – Practice Jitter Clicking & Measure CPS',
    desc:  'Free jitter click test. Practice the jitter clicking technique used in Minecraft PvP and measure your max CPS. Tense your arm to vibrate and hit top speeds. Compare against world averages.',
    h1:    'Jitter Click Test'
  },
  'spacebar':    {
    path:  '/spacebar-speed-test',
    title: 'Spacebar Speed Test – Hits Per Second Counter Online',
    desc:  'Free spacebar speed test. Measure how many times you can press the spacebar per second. Multiple durations available. Challenge your friends and set a personal record.',
    h1:    'Spacebar Speed Test'
  },
  'dino':        {
    path:  '/dinosaur-game',
    title: 'Dinosaur Game Online – Free Chrome T-Rex Runner',
    desc:  'Play the Chrome Dinosaur Game online for free — no internet required. Jump over cacti, duck under pterodactyls and survive as long as possible. The classic Google T-Rex runner in your browser.',
    h1:    'Dinosaur Game'
  },
  'typing':      {
    path:  '/typing-speed-test',
    title: 'Typing Speed Test – Free WPM Test Online',
    desc:  'Free typing speed test — measure your WPM (words per minute) and accuracy in real time. No sign-up needed. Average is 41 WPM — how fast do you type? Works on all devices.',
    h1:    'Typing Speed Test'
  },
  'coreball':    {
    path:  '/coreball-game',
    title: 'Coreball Game Online – Free Ball Shooting Puzzle',
    desc:  'Play Coreball online for free. Shoot balls onto the rotating core without hitting existing ones. Increasingly challenging levels — how far can you go?',
    h1:    'Coreball Game'
  },
  'memory':      {
    path:  '/number-memory-test',
    title: 'Number Memory Test – Working Memory Test Online',
    desc:  'Free number memory test — how many digits can you memorize? Tests your working memory capacity. Average adults remember 5–7 digits. Can you beat the human benchmark? No download needed.',
    h1:    'Number Memory Test'
  },
  'snake':       {
    path:  '/snake-game',
    title: 'Snake Game Online – Free Classic Snake',
    desc:  'Play the classic Snake game online for free. Eat food to grow longer, avoid hitting yourself or the walls. Arrow keys or swipe to control. How long can you survive?',
    h1:    'Snake Game'
  },
  'clicker':     {
    path:  '/clicker-tycoon',
    title: 'Clicker Tycoon – Free Idle Clicker Game Online',
    desc:  'Free idle Clicker Tycoon game. Click to earn coins, buy upgrades, unlock passive income and prestige for permanent multipliers. Build your empire — how rich can you get?',
    h1:    'Clicker Tycoon'
  }
};

// Reverse map: URL path → panel key
const PATH_TO_PANEL = {};
Object.entries(ROUTES).forEach(([k, v]) => { PATH_TO_PANEL[v.path] = k; });

function routerUpdate(p) {
  const route = ROUTES[p] || ROUTES['reaction'];
  try { history.pushState({ panel: p }, route.title, route.path); } catch(e) {}
  // Title + meta description
  document.title = route.title;
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc) metaDesc.setAttribute('content', route.desc);
  // Canonical
  const canonical = document.querySelector('link[rel="canonical"]');
  if (canonical) canonical.setAttribute('href', 'https://reactionspeedtest.com' + route.path);
  // Open Graph
  const ogTitle = document.querySelector('meta[property="og:title"]');
  const ogDesc  = document.querySelector('meta[property="og:description"]');
  const ogUrl   = document.querySelector('meta[property="og:url"]');
  if (ogTitle) ogTitle.setAttribute('content', route.title);
  if (ogDesc)  ogDesc.setAttribute('content', route.desc);
  if (ogUrl)   ogUrl.setAttribute('content', 'https://reactionspeedtest.com' + route.path);
  // Twitter
  const twTitle = document.querySelector('meta[name="twitter:title"]');
  const twDesc  = document.querySelector('meta[name="twitter:description"]');
  if (twTitle) twTitle.setAttribute('content', route.title);
  if (twDesc)  twDesc.setAttribute('content', route.desc);
}

// Handle browser back/forward
window.addEventListener('popstate', e => {
  const panel = e.state?.panel || panelFromPath(location.pathname);
  if (panel) switchPanel(panel, true); // true = skip pushState
});

function panelFromPath(path) {
  return PATH_TO_PANEL[path] || 'reaction';
}

function switchPanel(p, fromPopstate) {
  curPanel = p;
  if (!fromPopstate) routerUpdate(p);

  // Tab highlight
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.panel === p));

  // Map jitter/kohi → cps panel
  const allPanels = ['cps','spacebar','reaction','stimulation','typing','coreball','dino','memory','snake','clicker'];
  allPanels.forEach(id => {
    const el = document.getElementById('panel-' + id);
    if (el) el.style.display = 'none';
  });
  const target = ['jitter','cps'].includes(p) ? 'cps' : p;
  const panelEl = document.getElementById('panel-' + target);
  if (panelEl) { panelEl.style.display = 'flex'; panelEl.style.flexDirection = 'column'; }

  // Row2: hide for reaction, stim, typing, coreball
  const row2 = document.getElementById('row2');
  const hideRow2 = ['reaction','stimulation','typing','coreball','dino','memory','snake','clicker'].includes(p);
  row2.classList.toggle('hidden', hideRow2);
  document.querySelector('.wrap').style.paddingTop =
    hideRow2 ? 'var(--row1-h)' : 'var(--header-h)';

  // Update CPS panel title per mode
  const titles = {
    cps:    ['Click Speed Test',  `${curDuration}s — click as fast as you can`],
    jitter: ['Jitter Click Test', `${curDuration}s — tense & vibrate for max speed`],
  };
  if (titles[p]) {
    document.getElementById('cpsH1').textContent = titles[p][0];
    document.getElementById('cpsSub').textContent = titles[p][1];
  }

  // Reset
  if (target === 'cps')    resetCPS();
  if (p === 'stimulation') resetStim();

  // Switch info section
  const infoMap = { reaction:'reaction', stimulation:'stimulation', cps:'cps', jitter:'cps', spacebar:'spacebar', typing:'typing', coreball:'coreball', dino:'dino', memory:'memory', snake:'snake', clicker:'clicker' };
  document.querySelectorAll('.info-section').forEach(s => s.style.display = 'none');
  const infoKey = infoMap[p] || 'reaction';
  const infoEl = document.querySelector(`.info-section[data-info="${infoKey}"]`);
  if (infoEl) infoEl.style.display = 'block';
}

/* ═══════════════════════════════════════════
   DURATION SELECTOR
═══════════════════════════════════════════ */
function setDuration(s) {
  curDuration = s;
  document.querySelectorAll('.tbtn').forEach(b => b.classList.toggle('active', +b.dataset.s === s));
  document.getElementById('cTime').textContent = s.toFixed(1);
  document.getElementById('sTime').textContent = s.toFixed(1);
  // Update subtitle
  const sub = document.getElementById('cpsSub');
  if (sub) {
    const map = { cps:'click as fast as you can', jitter:'tense & vibrate for max speed' };
    sub.textContent = `${s}s — ${map[curPanel] || 'click as fast as you can'}`;
  }
  const sSub = document.getElementById('sSub');
  if (sSub) sSub.textContent = `${s} seconds — press spacebar as fast as you can`;
  resetCPS();
  resetSpace();
}

function setClickMode(m) {
  clickMode = m;
  document.getElementById('modeNormal').classList.toggle('active', m === 'normal');
  document.getElementById('modeChallenge').classList.toggle('active', m === 'challenge');
  document.getElementById('challengeTip').style.display = m === 'challenge' ? 'block' : 'none';
  resetCPS();
}

/* ═══════════════════════════════════════════
   CPS GAME ENGINE (shared: cps / jitter / kohi)
   Includes working Challenge Mode
═══════════════════════════════════════════ */
const CPS_RANKS = [
  { min:15, label:'⚡ GOD MODE', color:'#ff2d55' },
  { min:11, label:'🐆 CHEETAH',  color:'#ffe000' },
  { min:8,  label:'⚡ FAST',     color:'#00f5a0' },
  { min:5,  label:'🐇 NORMAL',   color:'#7b61ff' },
  { min:0,  label:'🐢 TURTLE',   color:'#50507a' },
];
function getCPSRank(c) { return CPS_RANKS.find(r => c >= r.min) || CPS_RANKS[CPS_RANKS.length-1]; }

let cg = { clicks:0, running:false, ts:null, iv:null, best:0, combo:0, chTargets:[], chSpawnTimer:null };

const clickArena = document.getElementById('clickArena');
const bigCPS     = document.getElementById('bigCPS');
const cLabel     = document.getElementById('cLabel');
const cProg      = document.getElementById('cProg');
const cProgFill  = document.getElementById('cProgFill');
const cResult    = document.getElementById('cResult');
const rScore     = document.getElementById('rScore');
const rRank      = document.getElementById('rRank');
const comboBadge = document.getElementById('comboBadge');

function resetCPS() {
  clearInterval(cg.iv);
  clearTimeout(cg.chSpawnTimer);
  cg.chTargets.forEach(t => { clearTimeout(t.timer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  cg = { clicks:0, running:false, ts:null, iv:null, best:0, combo:0, chTargets:[], chSpawnTimer:null };
  clickArena.className = 'click-arena idle';
  bigCPS.textContent = '0'; bigCPS.style.color = 'var(--accent)';
  cLabel.textContent = 'Click Here to Start';
  cProg.style.display = 'none'; cProgFill.style.width = '100%';
  cResult.classList.remove('show');
  comboBadge.classList.remove('show');
  bigCPS.style.opacity  = '';
  cLabel.style.opacity  = '';
  cProg.style.opacity   = '';
  document.getElementById('cStat').textContent = '0';
  document.getElementById('cClicks').textContent = '0';
  document.getElementById('cBest').textContent = '—';
  document.getElementById('cTime').textContent = curDuration.toFixed(1);
}

/* Challenge mode: spawn small targets inside the arena that must be clicked */
function spawnChallengeTarget() {
  if (!cg.running || clickMode !== 'challenge') return;
  const W = clickArena.clientWidth, H = clickArena.clientHeight;
  const s = 44;
  const x = 14 + Math.random() * (W - s - 28);
  const y = 14 + Math.random() * (H - s - 28);

  const colors = ['#ff2d55','#ff6b00','#ffe000','#00f5a0','#7b61ff'];
  const col = colors[Math.floor(Math.random()*colors.length)];

  const el = document.createElement('div');
  el.className = 'ch-target';
  el.style.cssText = `left:${x}px;top:${y}px;width:${s}px;height:${s}px;background:${col}22;border:2.5px solid ${col};`;
  el.textContent = '✕';

  // Shrinking ring shows time pressure
  const ring = document.createElement('div');
  ring.className = 'ch-shrink-ring';
  ring.style.animationDuration = '0.9s';
  el.appendChild(ring);

  const tObj = { el, hit:false, timer:null };
  cg.chTargets.push(tObj);

  el.addEventListener('click', e => {
    e.stopPropagation();
    if (tObj.hit) return;
    tObj.hit = true; clearTimeout(tObj.timer);
    cg.combo++;
    comboBadge.textContent = `⚡ COMBO ×${cg.combo}`;
    comboBadge.classList.add('show');
    // Bonus click
    cg.clicks += Math.min(cg.combo, 5);
    el.style.transform = 'scale(1.5)'; el.style.opacity = '0';
    setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 100);
    cg.chTargets = cg.chTargets.filter(t => t !== tObj);
  });

  // Auto-expire
  tObj.timer = setTimeout(() => {
    if (!tObj.hit && el.parentNode) {
      el.parentNode.removeChild(el);
      cg.combo = 0;
      comboBadge.textContent = 'MISS! Combo Reset';
      setTimeout(() => comboBadge.classList.remove('show'), 800);
    }
    cg.chTargets = cg.chTargets.filter(t => t !== tObj);
  }, 950);

  clickArena.appendChild(el);

  // Next spawn — faster as time progresses
  const elapsed = cg.ts ? (Date.now() - cg.ts) / 1000 : 0;
  const spawnDelay = Math.max(500, 1200 - elapsed * 10);
  cg.chSpawnTimer = setTimeout(spawnChallengeTarget, spawnDelay);
}

function cgTick() {
  const elapsed = (Date.now() - cg.ts) / 1000;
  const rem = Math.max(0, curDuration - elapsed);
  const cps = elapsed > 0 ? +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2) : 0;
  bigCPS.textContent = cps.toFixed(1);
  document.getElementById('cStat').textContent = cps.toFixed(1);
  document.getElementById('cClicks').textContent = cg.clicks;
  document.getElementById('cTime').textContent = rem.toFixed(1);
  cProgFill.style.width = (rem / curDuration * 100) + '%';
  if (cps > cg.best) { cg.best = cps; document.getElementById('cBest').textContent = cps.toFixed(1); }
  if (rem <= 0) cgFinish();
}

function cgFinish() {
  clearInterval(cg.iv); cg.running = false;
  clearTimeout(cg.chSpawnTimer);
  cg.chTargets.forEach(t => { clearTimeout(t.timer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  cg.chTargets = [];
  comboBadge.classList.remove('show');
  const elapsed = Math.min(curDuration, (Date.now() - cg.ts) / 1000);
  const final = +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  bigCPS.textContent = final.toFixed(1);
  document.getElementById('cTime').textContent = '0.0';
  cProgFill.style.width = '0%';
  clickArena.className = 'click-arena done';
  const rank = getCPSRank(final);
  rScore.textContent = final.toFixed(1);
  rScore.style.color = rank.color;
  rRank.textContent = rank.label;
  rRank.style.cssText = `color:${rank.color};background:${rank.color}20;border:1px solid ${rank.color}55`;
  // New record badge
  const prevBest = parseFloat(document.getElementById('cBest').textContent) || 0;
  const newRecordEl = document.getElementById('cNewRecord');
  if (newRecordEl) newRecordEl.style.display = final > prevBest ? 'block' : 'none';
  cResult.classList.add('show');
  bigCPS.style.opacity = '0.07';
  cLabel.style.opacity = '0.04';
  cProg.style.opacity  = '0.04';
}

function cgClick(e) {
  if (e && e.target && e.target.classList.contains('ch-target')) return; // let target handle it
  if (cResult.classList.contains('show')) return;
  if (!cg.running) {
    cg.running = true; cg.ts = Date.now(); cg.clicks = 0;
    if (clickMode === 'challenge') {
      clickArena.className = 'click-arena running challenge-active';
      cLabel.textContent = '⚡ Hit targets for combos!';
      comboBadge.classList.add('show');
      comboBadge.textContent = 'CHALLENGE MODE!';
      setTimeout(spawnChallengeTarget, 600);
    } else {
      clickArena.className = 'click-arena running';
      cLabel.textContent = 'Keep clicking!';
    }
    cProg.style.display = 'block';
    cg.iv = setInterval(cgTick, 80);
  }
  cg.clicks++;
  cgTick();
}

clickArena.addEventListener('click', cgClick);
clickArena.addEventListener('touchstart', e => { e.preventDefault(); cgClick(e); }, {passive:false});

/* ═══════════════════════════════════════════
   SPACEBAR GAME
═══════════════════════════════════════════ */
let sg = { clicks:0, running:false, ts:null, iv:null, best:0 };

const spaceArena = document.getElementById('spaceArena');
const spaceKey   = document.getElementById('spaceKey');
const sBig       = document.getElementById('sBig');
const sLabel     = document.getElementById('sLabel');
const sProg      = document.getElementById('sProg');
const sProgFill  = document.getElementById('sProgFill');
const sResult    = document.getElementById('sResult');

function resetSpace() {
  clearInterval(sg.iv);
  sg = { clicks:0, running:false, ts:null, iv:null, best:0 };
  spaceArena.className = 'click-arena idle';
  sBig.textContent = '0';
  sLabel.textContent = 'Press Space Key or Tap Above to Start';
  sProg.style.display = 'none'; sProgFill.style.width = '100%';
  sResult.classList.remove('show');
  sBig.style.opacity   = '';
  sLabel.style.opacity = '';
  sProg.style.opacity  = '';
  document.getElementById('sCPS').textContent = '0';
  document.getElementById('sClicks').textContent = '0';
  document.getElementById('sBest').textContent = '—';
  document.getElementById('sTime').textContent = curDuration.toFixed(1);
}

function sgTick() {
  const elapsed = (Date.now() - sg.ts) / 1000;
  const rem = Math.max(0, curDuration - elapsed);
  const cps = +(sg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  sBig.textContent = cps.toFixed(1);
  document.getElementById('sCPS').textContent = cps.toFixed(1);
  document.getElementById('sClicks').textContent = sg.clicks;
  document.getElementById('sTime').textContent = rem.toFixed(1);
  sProgFill.style.width = (rem / curDuration * 100) + '%';
  if (cps > sg.best) { sg.best = cps; document.getElementById('sBest').textContent = cps.toFixed(1); }
  if (rem <= 0) sgFinish();
}

function sgFinish() {
  clearInterval(sg.iv); sg.running = false;
  const elapsed = Math.min(curDuration, (Date.now() - sg.ts) / 1000);
  const final = +(sg.clicks / Math.max(elapsed, 0.01)).toFixed(2);
  sBig.textContent = final.toFixed(1);
  document.getElementById('sTime').textContent = '0.0';
  sProgFill.style.width = '0%';
  spaceArena.className = 'click-arena done';
  document.getElementById('srScore').textContent = final.toFixed(1);
  sResult.classList.add('show');
  sBig.style.opacity   = '0.07';
  sLabel.style.opacity = '0.04';
  sProg.style.opacity  = '0.04';
}

function sgClick() {
  if (sResult.classList.contains('show')) return;
  if (!sg.running) {
    sg.running = true; sg.ts = Date.now(); sg.clicks = 0;
    spaceArena.className = 'click-arena running';
    sLabel.textContent = 'Keep pressing!';
    sProg.style.display = 'block';
    sg.iv = setInterval(sgTick, 80);
  }
  sg.clicks++;
  sgTick();
}

spaceArena.addEventListener('click', sgClick);
spaceArena.addEventListener('touchstart', e => { e.preventDefault(); sgClick(); }, {passive:false});
spaceKey.addEventListener('click', sgClick);
spaceKey.addEventListener('touchstart', e => { e.preventDefault(); sgClick(); }, {passive:false});
document.addEventListener('keydown', e => {
  if (e.code === 'Space' && curPanel === 'spacebar') {
    e.preventDefault();
    if (e.repeat) return; // ignore held-down key repeats
    spaceKey.classList.add('down');
    sgClick();
  }
});
document.addEventListener('keyup', e => { if (e.code === 'Space') spaceKey.classList.remove('down'); });

/* ═══════════════════════════════════════════
   REACTION GAME
═══════════════════════════════════════════ */
const ROUNDS = 5, DMIN = 1500, DMAX = 4500;
let rState = 'idle', rStartMs = 0, rTimer = null, rRound = 0, rResults = [], rScore2 = 0;

const reactArena = document.getElementById('reactArena');
const rIcon = document.getElementById('rIcon');
const rText = document.getElementById('rText');
const rSub  = document.getElementById('rSub');
const rDisp = document.getElementById('rDisp');
const rBest = document.getElementById('rBest');
const rAvg  = document.getElementById('rAvg');
const rRound2 = document.getElementById('rRound');
const rdots = document.getElementById('rdots').children;
const hist  = document.getElementById('hist');
const gover = document.getElementById('gover');

function setRArena(icon, text, sub, cls) {
  rIcon.textContent = icon; rText.textContent = text; rSub.textContent = sub;
  reactArena.className = 'reaction-arena ' + cls;
}
function updateDots() {
  for (let i = 0; i < ROUNDS; i++) {
    rdots[i].className = 'dot';
    if (i < rResults.length) rdots[i].classList.add(rResults[i]==='early'?'fail':'done');
    else if (i === rResults.length && rState !== 'gameover') rdots[i].classList.add('current');
  }
}
function rRating(ms) {
  const r = [
    {l:150,t:'⚡ LEGENDARY',c:'#ffe000'},{l:200,t:'🔥 PERFECT',c:'#00f5a0'},
    {l:250,t:'✅ GREAT',c:'#00f5a0'},{l:320,t:'👍 GOOD',c:'#80f0c0'},
    {l:400,t:'😐 AVERAGE',c:'#aaaacc'},{l:Infinity,t:'🐢 SLOW',c:'#ff6b00'}
  ];
  return r.find(x => ms < x.l);
}
function rPts(ms){ return ms<150?1000:ms<200?800:ms<250?600:ms<320?400:ms<400?200:100; }
function updateRStats() {
  const valid = rResults.filter(r=>r!=='early');
  const avg = valid.length ? Math.round(valid.reduce((a,b)=>a+b,0)/valid.length) : null;
  const best = valid.length ? Math.min(...valid) : null;
  const sv = v => v!==null ? v+'ms' : '---';
  rDisp.textContent = rScore2;
  rBest.textContent = sv(best);
  rAvg.textContent  = sv(avg);
  rRound2.textContent = rRound+'/'+ROUNDS;
}
function addChip(ms, isBest, isFail) {
  const c = document.createElement('div');
  c.className = 'hchip'+(isFail?' fail':isBest?' best':'');
  c.textContent = isFail ? 'EARLY' : ms+'ms';
  hist.appendChild(c);
}

function startRound() {
  if (rRound >= ROUNDS) { endReaction(); return; }
  rState = 'waiting';
  setRArena('⏳','Wait...','Tap when it turns green!','s-ready'); updateDots();
  rTimer = setTimeout(()=>{
    rState='ready'; rStartMs=Date.now();
    setRArena('🟢','TAP NOW!','Hit it!','s-go');
  }, DMIN + Math.random()*(DMAX-DMIN));
}

function handleReactionTap() {
  if (rState==='idle'||rState==='gameover') { resetReaction(); setTimeout(startRound,600); return; }
  if (rState==='waiting') {
    clearTimeout(rTimer); rState='early';
    rResults.push('early'); rRound++;
    rScore2 = Math.max(0, rScore2-200);
    setRArena('💥','TOO EARLY!','-200 pts — Be more patient','s-early');
    addChip(null,false,true); updateRStats(); updateDots();
    setTimeout(()=>startRound(),1600); return;
  }
  if (rState==='ready') {
    const ms = Date.now()-rStartMs; rState='result';
    const pts = rPts(ms); rScore2+=pts; rResults.push(ms); rRound++;
    const valid = rResults.filter(r=>r!=='early');
    const isBest = valid.length===1||ms===Math.min(...valid);
    const rat = rRating(ms);
    addChip(ms,isBest,false); updateRStats(); updateDots();
    rIcon.textContent = '✅';
    rText.innerHTML = `<span class="ms-big">${ms}</span>`;
    rSub.innerHTML  = `<span class="ms-unit">MILLISECONDS</span>`;
    reactArena.className = 'reaction-arena s-done';
    const pill = document.createElement('div');
    pill.className='rat-pill';
    pill.style.cssText=`background:${rat.c}20;color:${rat.c};border:1px solid ${rat.c}55`;
    pill.textContent=rat.t+`  +${pts} pts`;
    reactArena.appendChild(pill);
    setTimeout(()=>{
      if(pill.parentNode)pill.parentNode.removeChild(pill);
      if(rRound>=ROUNDS)endReaction(); else startRound();
    }, 1400);
  }
}

function endReaction() {
  rState='gameover';
  const valid=rResults.filter(r=>r!=='early');
  const best=valid.length?Math.min(...valid):null;
  const avg=valid.length?Math.round(valid.reduce((a,b)=>a+b,0)/valid.length):null;
  setRArena('🏆','Game Over!','Check your results','s-done');
  let title='🏆 GAME OVER';
  if(rScore2>=4000)title='⚡ LEGENDARY!';
  else if(rScore2>=3000)title='🔥 PERFECT!';
  document.getElementById('goTitle').textContent=title;
  document.getElementById('goBest').textContent=best?best+'ms':'---';
  document.getElementById('goAvg').textContent=avg?avg+'ms':'---';
  document.getElementById('goScore').textContent=rScore2;
  gover.classList.add('show'); updateDots();
}

function resetReaction() {
  rResults=[]; rScore2=0; rRound=0; hist.innerHTML='';
  gover.classList.remove('show'); rState='idle';
  setRArena('⚡','Tap to Start','Test your reaction speed','s-wait');
  rDisp.textContent='0'; rBest.textContent='---'; rAvg.textContent='---'; rRound2.textContent='0/5';
  for(let i=0;i<ROUNDS;i++) rdots[i].className='dot';
}

reactArena.addEventListener('click', handleReactionTap);
reactArena.addEventListener('touchstart', e=>{e.preventDefault();handleReactionTap();},{passive:false});
document.getElementById('replayBtn').addEventListener('click', ()=>{resetReaction();setTimeout(startRound,600);});

/* ═══════════════════════════════════════════
   STIMULATION CLICKER
═══════════════════════════════════════════ */
const STIM_CONFIGS = {
  easy:   { size:80, lifetime:1200, interval:800,  pts:100 },
  medium: { size:55, lifetime:800,  interval:580,  pts:200 },
  hard:   { size:38, lifetime:500,  interval:380,  pts:400 },
};
const STIM_DURATION = 30;
let stim = { running:false, score:0, hits:0, misses:0, timeLeft:STIM_DURATION, iv:null, spawnTimer:null };
let activeTargets = [];

function setStimDiff(d) {
  stimDiff = d;
  ['easy','medium','hard'].forEach(x => {
    const b = document.getElementById('db'+x.charAt(0).toUpperCase()+x.slice(1));
    b.classList.toggle('selected', x === d);
  });
}

function resetStim() {
  clearInterval(stim.iv); clearTimeout(stim.spawnTimer);
  activeTargets.forEach(t => { clearTimeout(t.expTimer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  activeTargets = [];
  stim = { running:false, score:0, hits:0, misses:0, timeLeft:STIM_DURATION, iv:null, spawnTimer:null };
  document.getElementById('stScore').textContent = '0';
  document.getElementById('stHits').textContent  = '0';
  document.getElementById('stAcc').textContent   = '—';
  document.getElementById('stTime').textContent  = STIM_DURATION.toFixed(1);
  document.getElementById('stimResult').classList.remove('show');
  document.getElementById('stimIdle').style.display = 'flex';
}

function startStim() {
  document.getElementById('stimIdle').style.display = 'none';
  stim.running = true;
  stim.timeLeft = STIM_DURATION;

  stim.iv = setInterval(() => {
    stim.timeLeft = Math.max(0, +(stim.timeLeft - 0.1).toFixed(1));
    document.getElementById('stTime').textContent = stim.timeLeft.toFixed(1);
    if (stim.timeLeft <= 0) finishStim();
  }, 100);

  spawnTarget();
}

function spawnTarget() {
  if (!stim.running) return;
  const cfg = STIM_CONFIGS[stimDiff];
  const arena = document.getElementById('stimArena');
  const W = arena.clientWidth, H = arena.clientHeight;
  const s = cfg.size;
  const x = Math.max(5, Math.random() * (W - s - 10));
  const y = Math.max(5, Math.random() * (H - s - 10));

  const palette = [
    ['#00f5a0','#003d29'], ['#ff2d55','#3d000d'],
    ['#ffe000','#3d3700'], ['#7b61ff','#1e0f4a'], ['#ff6b00','#3d1a00']
  ];
  const [col, bg] = palette[Math.floor(Math.random() * palette.length)];

  const el = document.createElement('div');
  el.className = 'stim-target';
  el.style.cssText = `left:${x}px;top:${y}px;width:${s}px;height:${s}px;background:${bg};border:3px solid ${col};`;

  // Shrinking ring
  const ring = document.createElement('div');
  ring.className = 'target-ring';
  ring.style.cssText = `border:2px solid ${col};`;
  el.appendChild(ring);

  // Hit handler
  const tObj = { el, hit:false, expTimer:null };
  activeTargets.push(tObj);

  el.addEventListener('click', e => {
    e.stopPropagation();
    if (tObj.hit) return;
    tObj.hit = true;
    clearTimeout(tObj.expTimer);
    stim.hits++;
    stim.score += cfg.pts;
    document.getElementById('stScore').textContent = stim.score;
    document.getElementById('stHits').textContent  = stim.hits;
    updateStimAcc();
    // Hit popup
    const popup = document.createElement('div');
    popup.className = 'hit-popup';
    popup.style.cssText = `left:${x+s/2}px;top:${y}px;color:${col}`;
    popup.textContent = '+' + cfg.pts;
    arena.appendChild(popup);
    setTimeout(() => { if(popup.parentNode) popup.parentNode.removeChild(popup); }, 500);
    // Remove target
    el.style.transition = 'transform 0.1s, opacity 0.1s';
    el.style.transform = 'scale(1.4)'; el.style.opacity = '0';
    setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 120);
    activeTargets = activeTargets.filter(t => t !== tObj);
  });

  // Expiry
  tObj.expTimer = setTimeout(() => {
    if (!tObj.hit && el.parentNode) {
      el.parentNode.removeChild(el);
      stim.misses++;
      updateStimAcc();
      activeTargets = activeTargets.filter(t => t !== tObj);
    }
  }, cfg.lifetime);

  arena.appendChild(el);

  // Next spawn
  stim.spawnTimer = setTimeout(spawnTarget, cfg.interval);
}

function updateStimAcc() {
  const total = stim.hits + stim.misses;
  document.getElementById('stAcc').textContent = total > 0
    ? Math.round(stim.hits / total * 100) + '%' : '—';
}

function finishStim() {
  clearInterval(stim.iv); clearTimeout(stim.spawnTimer);
  stim.running = false;
  activeTargets.forEach(t => { clearTimeout(t.expTimer); if(t.el.parentNode) t.el.parentNode.removeChild(t.el); });
  activeTargets = [];

  const acc = stim.hits + stim.misses > 0
    ? Math.round(stim.hits / (stim.hits + stim.misses) * 100) : 0;

  let rank = '🐢 BEGINNER', rankColor = '#50507a';
  if      (stim.score >= 9000) { rank = '⚡ GOD TIER';  rankColor = '#ff2d55'; }
  else if (stim.score >= 6000) { rank = '🐆 ELITE';     rankColor = '#ffe000'; }
  else if (stim.score >= 3500) { rank = '⚡ SKILLED';   rankColor = '#00f5a0'; }
  else if (stim.score >= 1500) { rank = '🐇 AVERAGE';   rankColor = '#7b61ff'; }

  document.getElementById('stFinalScore').textContent = stim.score;
  document.getElementById('stFinalScore').style.color = rankColor;
  document.getElementById('stFinalAcc').textContent   = acc + '%';
  document.getElementById('stFinalRank').textContent  = rank;
  document.getElementById('stFinalRank').style.color  = rankColor;
  document.getElementById('stimResult').classList.add('show');
}

// Click on arena background = miss
document.getElementById('stimArena').addEventListener('click', e => {
  if (!stim.running) return;
  if (e.target.id === 'stimArena' || e.target === document.getElementById('stimArena')) {
    stim.misses++;
    updateStimAcc();
    // Miss flash
    const flash = document.createElement('div');
    flash.className = 'miss-flash';
    const rect = document.getElementById('stimArena').getBoundingClientRect();
    flash.style.left = (e.clientX - rect.left) + 'px';
    flash.style.top  = (e.clientY - rect.top) + 'px';
    document.getElementById('stimArena').appendChild(flash);
    setTimeout(() => { if(flash.parentNode) flash.parentNode.removeChild(flash); }, 400);
  }
});

/* ═══════════════════════════════════════════
   FAQ ACCORDION
═══════════════════════════════════════════ */
document.querySelectorAll('.faq-q').forEach(btn => {
  btn.addEventListener('click', () => {
    const item = btn.closest('.faq-item');
    const open = item.classList.contains('open');
    document.querySelectorAll('.faq-item.open').forEach(el => {
      el.classList.remove('open');
      el.querySelector('.faq-q').setAttribute('aria-expanded','false');
    });
    if (!open) { item.classList.add('open'); btn.setAttribute('aria-expanded','true'); }
  });
});

/* ═══════════════════════════════════════════
   LANGUAGE SYSTEM (EN / TR)
═══════════════════════════════════════════ */
const TRANSLATIONS = {
  en: {
    // nav
    tabReaction:'⚡ Reaction', tabStimulation:'🎯 Stimulation', tabCPS:'🔥 Click Speed',
    tabJitter:'🖱 Jitter Click', tabKohi:'☕ Kohi Click', tabSpacebar:'⌨️ Spacebar',
    durLabel:'Duration', modeLabel:'Mode', modeNormal:'🖱 Normal', modeChallenge:'⚡ Challenge',
    // cps panel
    cpsH1_cps:'Click Speed Test', cpsH1_jitter:'Jitter Click Test', cpsH1_kohi:'Kohi Click Test',
    cpsSubSuffix_cps:'click as fast as you can', cpsSubSuffix_jitter:'tense & vibrate for max speed', cpsSubSuffix_kohi:'sustained CPS endurance',
    cpsClickStart:'Click Here to Start', cpsKeepClick:'Keep clicking!', cpsChallengeStart:'⚡ Hit targets for combos!', cpsTip:'⚡ CHALLENGE MODE — Hit targets for bonus clicks!',
    lCPS:'CPS', lClicks:'Clicks', lBestCPS:'Best CPS', lTimeLeft:'Time Left',
    rYourScore:'Your Score', rCPS:'Clicks Per Second', rRetry:'↺ Try Again',
    // spacebar
    sTitle:'Spacebar Speed Test', sPressSec:'Press/sec', sTotalPress:'Total Presses', sBest:'Best',
    sStart:'Press Space Key or Tap Above to Start', sKeep:'Keep pressing!',
    rPPS:'Presses Per Second',
    // reaction
    rTitle:'Reaction Speed Test', rSub5r:'5 rounds — tap when the arena turns green',
    rScore:'Score', rBest:'Best', rAvg:'Average', rRound:'Round', rProgress:'Round Progress',
    rWaitTxt:'Wait...', rWaitSub:'Tap when it turns green!', rGoTxt:'TAP NOW!', rGoSub:'Hit it!',
    rEarlyTxt:'TOO EARLY!', rEarlySub:'-200 pts — Be more patient',
    rOverTxt:'Game Over!', rOverSub:'Check your results',
    rFastLB:'Fastest', rAvgLB:'Average', rScoreLB:'Score', rPlayAgain:'↺ Play Again',
    rTapStart:'Tap to Start', rTestSub:'Test your reaction speed',
    // stim
    stTitle:'Stimulation Clicker', stSub:'Click the targets before they disappear',
    stScore:'Score', stHits:'Targets Hit', stAcc:'Accuracy',
    stIdleSub:'Choose difficulty and start', stStart:'▶ START', stReplay:'↺ Play Again',
    stFinalLbl:'Final Score', stAccLbl:'Accuracy:',
    // info
    aboutTitle:'ABOUT THE TESTS', worldTitle:'WORLD RECORDS', reactionTitle:'REACTION TIME',
    // footer
    footCopy:'Reaction Speed Test — Free Online CPS & Reaction Time Tester',
    footSub:'Test your click speed, jitter click, Kohi click, spacebar speed, and reaction time for free. No downloads. No registration.',
    // challenge tip
    challengeTipText:'⚡ CHALLENGE MODE — Hit targets for bonus clicks!',
    // stim idle title
    stimIdleTitle:'Stimulation Clicker',
  },
  tr: {
    tabReaction:'⚡ Tepki Testi', tabStimulation:'🎯 Hedef Tıklama', tabCPS:'🔥 Tıklama Hızı',
    tabJitter:'🖱 Jitter Tıklama', tabKohi:'☕ Kohi Testi', tabSpacebar:'⌨️ Boşluk Çubuğu',
    durLabel:'Süre', modeLabel:'Mod', modeNormal:'🖱 Normal', modeChallenge:'⚡ Zorlu',
    cpsH1_cps:'Tıklama Hızı Testi', cpsH1_jitter:'Jitter Tıklama Testi', cpsH1_kohi:'Kohi Tıklama Testi',
    cpsSubSuffix_cps:'olabildiğince hızlı tıkla', cpsSubSuffix_jitter:'titretme tekniğiyle max hız', cpsSubSuffix_kohi:'sürdürülebilir TPS testi',
    cpsClickStart:'Başlamak için Tıkla', cpsKeepClick:'Tıklamaya devam et!', cpsChallengeStart:'⚡ Hedeflere tıkla, kombo yap!', cpsTip:'⚡ ZORLU MOD — Hedeflere tıkla, bonus kazan!',
    lCPS:'TPS', lClicks:'Tıklama', lBestCPS:'En İyi TPS', lTimeLeft:'Kalan Süre',
    rYourScore:'Skorun', rCPS:'Saniye Başına Tıklama', rRetry:'↺ Tekrar Dene',
    sTitle:'Boşluk Çubuğu Testi', sPressSec:'Basış/sn', sTotalPress:'Toplam Basış', sBest:'En İyi',
    sStart:'Boşluk tuşuna bas veya yukarıya dokun', sKeep:'Basmaya devam et!',
    rPPS:'Saniye Başına Basış',
    rTitle:'Tepki Hızı Testi', rSub5r:'5 tur — alan yeşile dönünce dokun',
    rScore:'Skor', rBest:'En İyi', rAvg:'Ortalama', rRound:'Tur', rProgress:'Tur Takibi',
    rWaitTxt:'Bekle...', rWaitSub:'Alan yeşile dönünce dokun!', rGoTxt:'DOKUN!', rGoSub:'Hadi!',
    rEarlyTxt:'ÇOK ERKEN!', rEarlySub:'-200 puan — Daha sabırlı ol',
    rOverTxt:'Oyun Bitti!', rOverSub:'Sonuçlarına bak',
    rFastLB:'En Hızlı', rAvgLB:'Ortalama', rScoreLB:'Skor', rPlayAgain:'↺ Tekrar Oyna',
    rTapStart:'Başlamak için Dokun', rTestSub:'Tepki hızını test et',
    stTitle:'Hedef Tıklama', stSub:'Hedefler kaybolmadan önce tıkla',
    stScore:'Skor', stHits:'Hedef İsabeti', stAcc:'İsabet Oranı',
    stIdleSub:'Zorluk seç ve başla', stStart:'▶ BAŞLA', stReplay:'↺ Tekrar Oyna',
    stFinalLbl:'Final Skor', stAccLbl:'İsabet:',
    aboutTitle:'TESTLER HAKKINDA', worldTitle:'DÜNYA REKORLARI', reactionTitle:'TEPKİ SÜRESİ',
    footCopy:'Tepki Testi — Ücretsiz Online TPS & Tepki Süresi Testi',
    footSub:'Tıklama hızı, jitter tıklama, Kohi, boşluk çubuğu ve tepki süren testlerini ücretsiz dene. İndirme yok. Kayıt yok.',
    challengeTipText:'⚡ ZORLU MOD — Hedeflere tıkla, bonus kazan!',
    stimIdleTitle:'Hedef Tıklama',
  }
};

let currentLang = 'en';

function setLang(l) {
  currentLang = l;
  const _lbtnTR = document.getElementById('lbtnTR');
  const _lbtnEN = document.getElementById('lbtnEN');
  if (_lbtnTR) _lbtnTR.classList.toggle('active', l==='tr');
  if (_lbtnEN) _lbtnEN.classList.toggle('active', l==='en');
  document.documentElement.lang = l;
  const T = TRANSLATIONS[l];

  // Tabs
  const tabs = document.querySelectorAll('.tab[data-panel]');
  const tabMap = { reaction:'tabReaction', stimulation:'tabStimulation', cps:'tabCPS', jitter:'tabJitter', kohi:'tabKohi', spacebar:'tabSpacebar' };
  tabs.forEach(t => { if(tabMap[t.dataset.panel]) t.innerHTML = T[tabMap[t.dataset.panel]]; });

  // Row2 labels
  document.querySelectorAll('.row2-label')[0].textContent = T.durLabel;
  document.querySelectorAll('.row2-label')[1].textContent = T.modeLabel;
  document.getElementById('modeNormal').textContent = T.modeNormal;
  document.getElementById('modeChallenge').textContent = T.modeChallenge;

  // CPS panel
  const p = ['cps','jitter','kohi'].includes(curPanel) ? curPanel : 'cps';
  document.getElementById('cpsH1').textContent = T['cpsH1_'+p] || T.cpsH1_cps;
  document.getElementById('cpsSub').textContent = `${curDuration}s — ${T['cpsSubSuffix_'+p] || T.cpsSubSuffix_cps}`;
  document.querySelector('#clickArena .arena-label')?.textContent; // keep state
  document.getElementById('challengeTip').textContent = T.challengeTipText;

  // Stats labels CPS
  const sc = document.querySelectorAll('#panel-cps .slbl');
  if(sc.length>=4){ sc[0].textContent=T.lCPS; sc[1].textContent=T.lClicks; sc[2].textContent=T.lBestCPS; sc[3].textContent=T.lTimeLeft; }
  document.querySelector('#cResult .r-label').textContent = T.rYourScore;
  document.querySelector('#cResult .r-unit').textContent = T.rCPS;
  document.querySelector('#cResult .r-retry').textContent = T.rRetry;

  // Spacebar
  document.querySelector('#panel-spacebar h1').textContent = T.sTitle;
  const ss = document.querySelectorAll('#panel-spacebar .slbl');
  if(ss.length>=4){ ss[0].textContent=T.sPressSec; ss[1].textContent=T.sTotalPress; ss[2].textContent=T.sBest; ss[3].textContent=T.lTimeLeft; }
  document.querySelector('#sResult .r-label').textContent = T.rYourScore;
  document.querySelector('#sResult .r-unit').textContent = T.rPPS;
  document.querySelector('#sResult .r-retry').textContent = T.rRetry;

  // Reaction
  document.querySelector('#panel-reaction h1').textContent = T.rTitle;
  document.querySelector('#panel-reaction .gsub').textContent = T.rSub5r;
  document.getElementById('lScore').textContent = T.rScore;
  document.getElementById('lBest').textContent  = T.rBest;
  document.getElementById('lAvg').textContent   = T.rAvg;
  document.getElementById('lRound').textContent = T.rRound;
  document.getElementById('lDots').textContent  = T.rProgress;
  document.getElementById('goLB').textContent   = T.rFastLB;
  document.getElementById('goLA').textContent   = T.rAvgLB;
  document.getElementById('goLS').textContent   = T.rScoreLB;
  document.getElementById('replayBtn').textContent = T.rPlayAgain;
  if(rState==='idle'||rState==='gameover'){
    document.getElementById('rText').textContent = T.rTapStart;
    document.getElementById('rSub').textContent  = T.rTestSub;
  }

  // Stim
  document.querySelector('#panel-stimulation h1').textContent = T.stTitle;
  document.querySelector('#panel-stimulation .gsub').textContent = T.stSub;
  const stCards = document.querySelectorAll('#panel-stimulation .slbl');
  if(stCards.length>=4){ stCards[0].textContent=T.stScore; stCards[1].textContent=T.stHits; stCards[2].textContent=T.stAcc; stCards[3].textContent=T.lTimeLeft; }
  document.querySelector('.stim-idle-sub').textContent = T.stIdleSub;
  document.querySelector('.stim-idle-title').textContent = T.stimIdleTitle;
  document.querySelector('.stim-start-btn').textContent = T.stStart;
  document.querySelector('.stim-replay').textContent = T.stReplay;
  document.querySelector('#stimResult .r-label').textContent = T.stFinalLbl;

  // Dividers
  const divs = document.querySelectorAll('.sec-divider');
  if(divs[0]) divs[0].textContent = T.aboutTitle;
  if(divs[1]) divs[1].textContent = T.worldTitle;
  if(divs[2]) divs[2].textContent = T.reactionTitle;

  // Footer
  const footPs = document.querySelectorAll('.sfooter p');
  if(footPs[0]) footPs[0].innerHTML = `© <span id="footYear"></span> ${T.footCopy}`;
  if(footPs[1]) footPs[1].innerHTML = T.footSub;
  document.getElementById('footYear').textContent = new Date().getFullYear();
}

/* ═══════════════════════════════════════════
   TYPING TEST ENGINE
═══════════════════════════════════════════ */
const WORD_LIST = ['the','be','to','of','and','in','that','have','it','for','on','with','he','as','you','do','at','this','but','his','by','from','they','we','say','her','she','or','an','will','my','one','all','would','there','their','what','so','up','out','if','about','who','get','which','go','me','when','make','can','like','time','no','just','him','know','take','people','into','year','your','good','some','could','them','see','other','than','then','now','look','only','come','its','over','think','also','back','after','use','two','how','our','work','first','well','way','even','new','want','because','any','these','give','day','most','us','great','between','need','large','often','hand','high','place','hold','real','life','few','north','open','seem','together','next','white','children','begin','got','walk','example','ease','paper','group','always','music','those','both','mark','book','letter','until','mile','river','car','feet','care','second','enough','plain','girl','usual','young','ready','above','ever','red','list','though','feel','talk','bird','soon','body','dog','family','direct','pose','leave'];

let typing = {
  running:false, duration:60, timeLeft:60, iv:null,
  words:[], currentIdx:0,
  correctCount:0, wrongCount:0, charCount:0,
  startTime:null,
  wrongWords: new Set()   // track which word indices were typed wrong
};

function setTypingDuration(s) {
  typing.duration = s;
  ['30','60','120'].forEach(x => {
    document.getElementById('td'+x).classList.toggle('active', +x === s);
  });
  resetTyping();
}

function generateWords() {
  const arr = [];
  for (let i = 0; i < 80; i++) arr.push(WORD_LIST[Math.floor(Math.random()*WORD_LIST.length)]);
  return arr;
}

function renderWords() {
  const container = document.getElementById('tWords');
  container.innerHTML = '';
  typing.words.forEach((w, i) => {
    const span = document.createElement('span');
    span.textContent = w;
    span.id = 'tw' + i;
    span.style.cssText = 'padding:2px 4px;border-radius:4px;transition:all 0.12s;';
    if (i < typing.currentIdx) {
      // completed words — green if correct, red if wrong
      if (typing.wrongWords.has(i)) {
        span.style.color = '#ff2d55';
        span.style.background = 'rgba(255,45,85,0.12)';
      } else {
        span.style.color = '#00f5a0';
      }
    } else if (i === typing.currentIdx) {
      span.style.color = '#f0f0ff';
      span.style.background = 'rgba(0,180,216,0.18)';
      span.style.borderBottom = '2px solid #00b4d8';
      setTimeout(() => span.scrollIntoView({block:'nearest'}), 10);
    } else {
      span.style.color = '#6060a0';
    }
    container.appendChild(span);
  });
}

// Live-highlight current input vs target word
function updateInputColor() {
  const inp = document.getElementById('tInput');
  const typed = inp.value;
  if (!typed) { inp.style.color = 'var(--text)'; inp.style.borderColor = 'var(--border2)'; return; }
  const target = typing.words[typing.currentIdx] || '';
  const isMatch = target.startsWith(typed);
  inp.style.color   = isMatch ? '#00f5a0' : '#ff2d55';
  inp.style.borderColor = isMatch ? '#00f5a028' : 'rgba(255,45,85,0.5)';
}

function resetTyping() {
  clearInterval(typing.iv);
  const dur = typing.duration;
  typing = {
    running:false, duration:dur, timeLeft:dur, iv:null,
    words:generateWords(), currentIdx:0,
    correctCount:0, wrongCount:0, charCount:0,
    startTime:null, wrongWords: new Set()
  };
  document.getElementById('tWpm').textContent    = '0';
  document.getElementById('tAcc').textContent    = '—';
  document.getElementById('tCorrect').textContent= '0';
  document.getElementById('tTime').textContent   = dur;
  document.getElementById('tResult').style.display = 'none';
  const inp = document.getElementById('tInput');
  inp.value = '';
  inp.disabled = false;
  inp.style.color = 'var(--text)';
  inp.style.borderColor = 'var(--border2)';
  renderWords();
  setTimeout(() => inp.focus(), 50);
}

function finishTyping() {
  clearInterval(typing.iv); typing.running = false;
  document.getElementById('tInput').disabled = true;
  const elapsed = typing.duration;
  const wpm = Math.round(typing.correctCount / (elapsed / 60));
  const total = typing.correctCount + typing.wrongCount;
  const acc = total > 0 ? Math.round(typing.correctCount / total * 100) : 100;
  document.getElementById('tFinalWpm').textContent = wpm;
  document.getElementById('tFinalAcc').textContent = `Accuracy: ${acc}% — ${typing.correctCount} correct / ${typing.wrongCount} wrong`;
  document.getElementById('tResult').style.display = 'flex';
  if (typeof recordStat !== 'undefined') recordStat('typing', wpm, 'WPM');
  if (typeof SFX !== 'undefined') SFX.stimEnd();
}

document.getElementById('tInput').addEventListener('input', function() {
  const val = this.value;
  if (!typing.running && val.length > 0) {
    typing.running = true; typing.startTime = Date.now();
    typing.iv = setInterval(() => {
      typing.timeLeft--;
      document.getElementById('tTime').textContent = typing.timeLeft;
      const elapsed = Math.max(1, typing.duration - typing.timeLeft);
      const wpm = Math.round(typing.correctCount / (elapsed / 60));
      document.getElementById('tWpm').textContent = wpm;
      if (typing.timeLeft <= 0) finishTyping();
    }, 1000);
  }
  if (!typing.running && val.length === 0) return;
  updateInputColor();
  if (val.endsWith(' ')) {
    const typed = val.trim();
    const target = typing.words[typing.currentIdx];
    if (typed === target) {
      typing.correctCount++;
    } else {
      typing.wrongCount++;
      typing.wrongWords.add(typing.currentIdx);   // mark this word red
    }
    typing.currentIdx++;
    this.value = '';
    this.style.color = 'var(--text)';
    this.style.borderColor = 'var(--border2)';
    document.getElementById('tCorrect').textContent = typing.correctCount;
    const total = typing.correctCount + typing.wrongCount;
    document.getElementById('tAcc').textContent = total > 0 ? Math.round(typing.correctCount/total*100)+'%' : '—';
    if (typing.currentIdx >= typing.words.length) { typing.words = typing.words.concat(generateWords()); }
    renderWords();
  }
});

/* ═══════════════════════════════════════════
   COREBALL — collision via real pixel distance
═══════════════════════════════════════════ */
const cbCanvas = document.getElementById('coreCanvas');
const cbCtx    = cbCanvas.getContext('2d');

const CB_R      = 110;   // core circle radius
const CB_BRAD   = 10;    // ball radius
const CB_COLORS = ['#00f5a0','#ff2d55','#ffe000','#7b61ff','#ff6b00','#00b4d8','#ff69b4'];

let cb = {
  score:0, best:0, level:1, ballsLeft:10,
  rotSpeed:0.012,           // radians per frame — whole cluster rotates
  stuckBalls:[],            // {angle, color}  — rotate with cluster
  danger:[],                // {angle, color}  — rotate with cluster
  flyBall:null,             // {x, y, vy, color} — one ball in flight at a time
  gameOver:false, transitioning:false, animId:null
};

function cbCX() { return cbCanvas.width  / 2; }
function cbCY() { return cbCanvas.height / 2; }

/* ── reset / next-level ─────────────────────────────── */
function cbReset() {
  cancelAnimationFrame(cb.animId);
  _cbLastTs = 0;
  cb = { score:0, best:cb.best, level:1, ballsLeft:10,
         rotSpeed:0.012, stuckBalls:[], danger:[],
         flyBall:null, gameOver:false, transitioning:false, animId:null };
  document.getElementById('cbScore').textContent  = '0';
  document.getElementById('cbLevel').textContent  = '1';
  document.getElementById('cbBalls').textContent  = '10';
  document.getElementById('cbMsg').textContent    = 'TAP TO SHOOT';
  cbDraw();
}

function cbNextLevel() {
  cb.level++;
  cb.stuckBalls  = [];
  cb.flyBall     = null;
  cb.ballsLeft   = 10;
  cb.rotSpeed    = Math.min(0.012 + cb.level * 0.004, 0.05);
  cb.transitioning = false;
  cb.animId = null;

  // danger balls evenly spaced
  cb.danger = [];
  const dCount = Math.min(cb.level - 1, 6);
  for (let i = 0; i < dCount; i++) {
    cb.danger.push({ angle: (Math.PI * 2 / Math.max(dCount, 1)) * i });
  }

  document.getElementById('cbLevel').textContent = cb.level;
  document.getElementById('cbBalls').textContent = cb.ballsLeft;
  document.getElementById('cbMsg').textContent   =
    `⭐ LEVEL ${cb.level}${dCount ? ' — avoid red balls!' : ''} — TAP TO SHOOT`;
  cbDraw();
  cb.animId = requestAnimationFrame(cbTick);
}

/* ── draw ───────────────────────────────────────────── */
function cbDraw() {
  const W = cbCanvas.width, H = cbCanvas.height;
  const cx = cbCX(), cy = cbCY(), R = CB_R;
  cbCtx.clearRect(0, 0, W, H);

  // Core ring
  cbCtx.beginPath();
  cbCtx.arc(cx, cy, R, 0, Math.PI * 2);
  cbCtx.strokeStyle = cb.gameOver ? '#ff2d55' : '#2a2a4a';
  cbCtx.lineWidth = 4;
  cbCtx.stroke();

  // Danger balls
  cb.danger.forEach(d => {
    const bx = cx + Math.cos(d.angle) * R;
    const by = cy + Math.sin(d.angle) * R;
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD + 4, 0, Math.PI * 2);
    cbCtx.strokeStyle = 'rgba(255,45,85,0.35)';
    cbCtx.lineWidth = 2;
    cbCtx.stroke();
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = '#ff2d55';
    cbCtx.fill();
    cbCtx.strokeStyle = '#fff';
    cbCtx.lineWidth = 2;
    cbCtx.beginPath();
    cbCtx.moveTo(bx-4, by-4); cbCtx.lineTo(bx+4, by+4);
    cbCtx.moveTo(bx+4, by-4); cbCtx.lineTo(bx-4, by+4);
    cbCtx.stroke();
  });

  // Stuck balls + spokes
  cb.stuckBalls.forEach(s => {
    const bx = cx + Math.cos(s.angle) * R;
    const by = cy + Math.sin(s.angle) * R;
    cbCtx.beginPath();
    cbCtx.moveTo(cx, cy); cbCtx.lineTo(bx, by);
    cbCtx.strokeStyle = s.color + '30';
    cbCtx.lineWidth = 1;
    cbCtx.stroke();
    cbCtx.beginPath();
    cbCtx.arc(bx, by, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = s.color;
    cbCtx.fill();
  });

  // Flying ball
  if (cb.flyBall) {
    const b = cb.flyBall;
    cbCtx.beginPath();
    cbCtx.arc(b.x, b.y + 10, 6, 0, Math.PI * 2);
    cbCtx.fillStyle = b.color + '40';
    cbCtx.fill();
    cbCtx.beginPath();
    cbCtx.arc(b.x, b.y, CB_BRAD, 0, Math.PI * 2);
    cbCtx.fillStyle = b.color;
    cbCtx.fill();
    cbCtx.beginPath();
    cbCtx.arc(b.x - 3, b.y - 3, 3, 0, Math.PI * 2);
    cbCtx.fillStyle = 'rgba(255,255,255,0.5)';
    cbCtx.fill();
  }

  // Center score
  cbCtx.fillStyle    = cb.gameOver ? '#ff2d55' : '#ffffff';
  cbCtx.font         = `bold ${cb.gameOver ? 22 : 38}px 'Bebas Neue',sans-serif`;
  cbCtx.textAlign    = 'center';
  cbCtx.textBaseline = 'middle';
  cbCtx.fillText(cb.gameOver ? 'GAME OVER' : cb.score, cx, cy);

  // Remaining balls dots — ABOVE shooter, no overlap
  const dotsY = H - 52;   // row of dots
  for (let i = 0; i < 10; i++) {
    const bx = cx + (i - 4.5) * 22;
    cbCtx.beginPath();
    cbCtx.arc(bx, dotsY, 7, 0, Math.PI * 2);
    cbCtx.fillStyle = i < cb.ballsLeft ? '#00f5a0' : '#1c1c30';
    cbCtx.fill();
    if (i < cb.ballsLeft) {
      cbCtx.beginPath();
      cbCtx.arc(bx - 2, dotsY - 2, 2.5, 0, Math.PI * 2);
      cbCtx.fillStyle = 'rgba(255,255,255,0.4)';
      cbCtx.fill();
    }
  }

  // Shooter circle — at very bottom, separate from dots
  const shooterY = H - 22;
  cbCtx.beginPath();
  cbCtx.arc(cx, shooterY, 11, 0, Math.PI * 2);
  cbCtx.strokeStyle = cb.gameOver ? '#ff2d5580' : '#ffffff40';
  cbCtx.lineWidth = 2; cbCtx.stroke();
  cbCtx.beginPath();
  cbCtx.arc(cx, shooterY, 5, 0, Math.PI * 2);
  cbCtx.fillStyle = cb.gameOver ? '#ff2d55' : '#00f5a0';
  cbCtx.fill();
  // Dashed aim line — from shooter to ring
  cbCtx.setLineDash([4, 5]);
  cbCtx.beginPath();
  cbCtx.moveTo(cx, shooterY - 13); cbCtx.lineTo(cx, cy + CB_R + 22);
  cbCtx.strokeStyle = '#ffffff14'; cbCtx.lineWidth = 1; cbCtx.stroke();
  cbCtx.setLineDash([]);
}

/* ── main tick ──────────────────────────────────────── */
let _cbLastTs = 0;
function cbTick(ts) {
  if (curPanel !== 'coreball') { _cbLastTs = 0; cb.animId = requestAnimationFrame(cbTick); return; }

  // Delta time — normalize to 60fps (16.667ms)
  const dt = _cbLastTs ? Math.min((ts - _cbLastTs) / 16.667, 3) : 1;
  _cbLastTs = ts;

  // Rotate whole cluster (scale by dt)
  cb.stuckBalls.forEach(s => s.angle += cb.rotSpeed * dt);
  cb.danger.forEach(d     => d.angle += cb.rotSpeed * dt);

  // Move flying ball
  if (cb.flyBall) {
    cb.flyBall.y += cb.flyBall.vy * dt;
    const b  = cb.flyBall;
    const cx = cbCX(), cy = cbCY();
    const dx = b.x - cx, dy = b.y - cy;
    const dist = Math.sqrt(dx * dx + dy * dy);

    // Ball touches the ring when its CENTER reaches R (not R+brad,
    // because we want it to land ON the ring, not outside it)
    if (dist <= CB_R + CB_BRAD) {

      // Where exactly on the ring does it land?
      const landAngle = Math.atan2(dy, dx);

      // Convert every stuck/danger ball angle → XY on ring, then
      // measure PIXEL distance to landing point. This is exact — no angle math.
      const landX = cx + Math.cos(landAngle) * CB_R;
      const landY = cy + Math.sin(landAngle) * CB_R;

      // Check danger balls
      const hitDanger = cb.danger.some(d => {
        const ex = cx + Math.cos(d.angle) * CB_R;
        const ey = cy + Math.sin(d.angle) * CB_R;
        return Math.hypot(ex - landX, ey - landY) < CB_BRAD * 2;
      });

      if (hitDanger) {
        cb.gameOver = true;
        if (cb.score > cb.best) { cb.best = cb.score; document.getElementById('cbBest').textContent = cb.best; }
        document.getElementById('cbMsg').textContent = `💥 Hit danger ball! Score: ${cb.score} — TAP TO RESTART`;
        cb.flyBall = null;
        cbDraw(); return;
      }

      // Check stuck balls
      const hitStuck = cb.stuckBalls.some(s => {
        const ex = cx + Math.cos(s.angle) * CB_R;
        const ey = cy + Math.sin(s.angle) * CB_R;
        return Math.hypot(ex - landX, ey - landY) < CB_BRAD * 2;
      });

      if (hitStuck) {
        cb.gameOver = true;
        if (cb.score > cb.best) { cb.best = cb.score; document.getElementById('cbBest').textContent = cb.best; }
        document.getElementById('cbMsg').textContent = `💥 Hit existing ball! Score: ${cb.score} — TAP TO RESTART`;
        cb.flyBall = null;
        cbDraw(); return;
      }

      // ✅ Stick!
      cb.stuckBalls.push({ angle: landAngle, color: b.color });
      cb.flyBall = null;
      cb.score++;
      document.getElementById('cbScore').textContent = cb.score;
      cb.rotSpeed = Math.min(0.012 + cb.score * 0.001, 0.05);

      if (cb.stuckBalls.length >= 10) {
        cb.transitioning = true;
        document.getElementById('cbMsg').textContent = `🎉 LEVEL CLEAR! Going to level ${cb.level + 1}…`;
        cbDraw();
        setTimeout(cbNextLevel, 1200);
        return;
      }
      document.getElementById('cbMsg').textContent = `${cb.ballsLeft} balls left`;
    }

    // Ball flew off screen
    if (b.y < -CB_BRAD) {
      cb.flyBall = null;
    }
  }

  cbDraw();
  if (!cb.gameOver && !cb.transitioning) cb.animId = requestAnimationFrame(cbTick);
  else _cbLastTs = 0;
}

/* ── shoot ──────────────────────────────────────────── */
cbCanvas.addEventListener('click', () => {
  if (cb.gameOver) { cbReset(); return; }
  if (cb.transitioning) return;
  if (cb.flyBall) return;          // one ball at a time
  if (cb.ballsLeft <= 0) return;

  cb.ballsLeft--;
  document.getElementById('cbBalls').textContent = cb.ballsLeft;
  document.getElementById('cbMsg').textContent   =
    cb.ballsLeft === 0 ? '🎯 Last ball!' : `${cb.ballsLeft} balls left`;

  const color = CB_COLORS[Math.floor(Math.random() * CB_COLORS.length)];
  cb.flyBall = { x: cbCX(), y: cbCanvas.height - 22, vy: -9, color };

  if (!cb.animId) cb.animId = requestAnimationFrame(cbTick);
});
cbCanvas.addEventListener('touchstart', e => { e.preventDefault(); }, {passive:false});
cbCanvas.addEventListener('touchend', e => {
  e.preventDefault();
  const t = e.changedTouches[0];
  const rect = cbCanvas.getBoundingClientRect();
  // Only fire if touch was within canvas bounds
  if (t.clientX >= rect.left && t.clientX <= rect.right &&
      t.clientY >= rect.top  && t.clientY <= rect.bottom) {
    cbCanvas.click();
  }
}, {passive:false});

/* ═══════════════════════════════════════════
   DINOSAUR GAME ENGINE
═══════════════════════════════════════════ */
const dc = document.getElementById('dinoCanvas');
const dctx = dc.getContext('2d');
let dino = {
  x:80, y:220, w:44, h:48, vy:0, jumping:false, ducking:false,
  score:0, best:0, speed:5, alive:false, started:false,
  obstacles:[], clouds:[], frame:0, animId:null, groundY:240,
  legFrame:0
};

function dinoReset() {
  _dinoLastTs = 0;
  if(dino.animId) cancelAnimationFrame(dino.animId);
  const best = dino.best;
  dino = {
    x:80, y:220, w:44, h:48, vy:0, jumping:false, ducking:false,
    score:0, best, speed:5, alive:false, started:false,
    obstacles:[], clouds:[], frame:0, animId:null, groundY:240,
    legFrame:0
  };
  document.getElementById('dinoScore').textContent = '0';
  document.getElementById('dinoSpeed').textContent = '1x';
  document.getElementById('dinoStatus').textContent = 'Ready';
  dinoDraw();
}

function dinoJump() {
  if (!dino.started) {
    dino.started = true; dino.alive = true;
    document.getElementById('dinoStatus').textContent = 'Running';
    dino.animId = requestAnimationFrame(dinoLoop);
  }
  if (!dino.jumping && !dino.ducking && dino.y >= dino.groundY - dino.h) {
    dino.vy = -14; dino.jumping = true;
  }
}

function dinoDuck(on) {
  if (on && !dino.jumping) { dino.ducking = true; dino.h = 28; dino.y = dino.groundY - 28; }
  else { dino.ducking = false; dino.h = 48; dino.y = Math.min(dino.y, dino.groundY - 48); }
}

function dinoSpawnObstacle() {
  const types = ['cactus-s','cactus-m','cactus-l','bird'];
  const t = types[Math.floor(Math.random()*types.length)];
  const isBird = t === 'bird';
  dino.obstacles.push({
    x: dc.width + 20,
    y: isBird ? dino.groundY - 30 - Math.random()*20 : dino.groundY,
    w: isBird ? 46 : t==='cactus-s'?20:t==='cactus-m'?28:38,
    h: isBird ? 32 : t==='cactus-s'?40:t==='cactus-m'?52:60,
    type: t, bird: isBird, wingUp: true, wingTimer: 0
  });
}

function dinoCheckHit() {
  const pad = 6;
  const dx = dino.x + pad, dy = dino.y + pad, dw = dino.w - pad*2, dh = dino.h - pad*2;
  return dino.obstacles.some(o => {
    const op = 4;
    return dx < o.x+o.w-op && dx+dw > o.x+op && dy < o.y && dy+dh > o.y-o.h;
  });
}

function dinoDraw() {
  const W = dc.width, H = dc.height, gy = dino.groundY;
  dctx.clearRect(0, 0, W, H);

  // Ground
  dctx.fillStyle = '#2a2a4a';
  dctx.fillRect(0, gy, W, 2);

  // Clouds
  dino.clouds.forEach(c => {
    dctx.fillStyle = 'rgba(255,255,255,0.08)';
    dctx.beginPath();
    dctx.ellipse(c.x, c.y, 40, 14, 0, 0, Math.PI*2);
    dctx.fill();
  });

  // Dino — pixel T-Rex facing right
  const col = !dino.alive ? '#555577' : dino.jumping ? '#00f5a0' : '#d0d0f8';
  const dx = dino.x, dy = dino.y, dw = dino.w, dh = dino.h;
  dctx.fillStyle = col;
  if (dino.ducking) {
    // Ducking body
    dctx.fillRect(dx + 4, dy + 4, dw + 10, dh - 4);
    // Head facing right
    dctx.fillRect(dx + dw + 2, dy, 18, 14);
    // Snout
    dctx.fillRect(dx + dw + 16, dy + 4, 8, 7);
    // Eye
    dctx.fillStyle = '#06060e';
    dctx.fillRect(dx + dw + 10, dy + 2, 5, 5);
    // Tiny teeth
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + dw + 18, dy + 9, 3, 2);
  } else {
    // === MAIN BODY ===
    dctx.fillRect(dx + 6, dy + 18, dw - 8, dh - 18);
    // === NECK ===
    dctx.fillRect(dx + 18, dy + 8, 12, 14);
    // === HEAD ===
    dctx.fillRect(dx + 14, dy - 2, 24, 16);
    // === SNOUT (longer, pointy) ===
    dctx.fillRect(dx + 32, dy + 2, 14, 9);
    dctx.fillRect(dx + 40, dy + 4, 8, 5); // tip
    // === TOP BUMP (skull) ===
    dctx.fillRect(dx + 16, dy - 6, 14, 6);
    // === TINY ARM ===
    dctx.fillRect(dx + 16, dy + 24, 10, 5);
    dctx.fillRect(dx + 22, dy + 27, 6, 4);
    // === TAIL ===
    dctx.fillRect(dx, dy + 22, 10, 10);
    dctx.fillRect(dx - 8, dy + 28, 10, 7);
    dctx.fillRect(dx - 14, dy + 32, 8, 5);
    // === EYE (white + pupil) ===
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 28, dy, 7, 7);
    dctx.fillStyle = '#06060e';
    dctx.fillRect(dx + 30, dy + 1, 4, 4);
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 32, dy + 1, 1, 1); // highlight
    // === NOSTRIL ===
    dctx.fillStyle = '#9090b8';
    dctx.fillRect(dx + 42, dy + 4, 2, 2);
    // === TEETH ===
    dctx.fillStyle = '#ffffff';
    dctx.fillRect(dx + 34, dy + 9, 3, 3);
    dctx.fillRect(dx + 39, dy + 9, 2, 2);
    // === LEGS & FEET ===
    dctx.fillStyle = col;
    if (!dino.jumping && dino.alive) {
      const lp = Math.floor(dino.legFrame / 5) % 2;
      // Thighs
      dctx.fillRect(dx + 20, dy + dh - 16, 11, lp ? 18 : 10);
      dctx.fillRect(dx + 8, dy + dh - 16, 11, lp ? 10 : 18);
      // Shins
      dctx.fillRect(dx + 20, dy + dh + (lp ? 2 : -6), 9, 8);
      dctx.fillRect(dx + 8, dy + dh + (lp ? -6 : 2), 9, 8);
      // Feet / claws
      dctx.fillRect(dx + 18, dy + dh + (lp ? 8 : 0), 14, 4);
      dctx.fillRect(dx + 6, dy + dh + (lp ? 0 : 8), 14, 4);
    } else {
      // Mid-air tucked
      dctx.fillRect(dx + 16, dy + dh - 10, 11, 12);
      dctx.fillRect(dx + 8, dy + dh - 8, 11, 10);
    }
  }

  // Obstacles
  dino.obstacles.forEach(o => {
    if (o.bird) {
      // Pterodactyl facing LEFT (toward dino)
      const bx = o.x, by = o.y - o.h, bw = o.w, bh = o.h;
      // Body
      dctx.fillStyle = '#b03000';
      dctx.fillRect(bx + 6, by + 8, bw - 12, bh - 10);
      // Head (left side — facing dino)
      dctx.fillStyle = '#cc3a00';
      dctx.fillRect(bx, by + 6, 16, 12);
      // Beak pointing LEFT
      dctx.fillStyle = '#ff9900';
      dctx.fillRect(bx - 10, by + 9, 12, 5);
      // Eye on left head
      dctx.fillStyle = '#ffffff';
      dctx.fillRect(bx + 3, by + 8, 5, 5);
      dctx.fillStyle = '#000';
      dctx.fillRect(bx + 4, by + 9, 3, 3);
      // Wings flap
      dctx.fillStyle = '#b03000';
      if (o.wingUp) {
        dctx.fillRect(bx + 4, by - 10, bw - 8, 12); // up
        dctx.fillRect(bx + 8, by - 18, bw - 18, 10);
      } else {
        dctx.fillRect(bx + 4, by + bh - 8, bw - 8, 12); // down
        dctx.fillRect(bx + 8, by + bh, bw - 18, 8);
      }
      // Tail (right side)
      dctx.fillStyle = '#9a2800';
      dctx.fillRect(bx + bw - 6, by + 10, 10, 6);
      dctx.fillRect(bx + bw + 2, by + 8, 6, 4);
    } else {
      // Cactus — main stem + side arms
      const cx2 = o.x, cy2 = o.y - o.h, cw = o.w, ch = o.h;
      dctx.fillStyle = '#1a8a3a';
      // Main stem
      dctx.fillRect(cx2 + Math.floor(cw*0.3), cy2, Math.floor(cw*0.4), ch);
      // Left arm
      dctx.fillRect(cx2, cy2 + Math.floor(ch*0.25), Math.floor(cw*0.35), Math.floor(cw*0.35));
      dctx.fillRect(cx2, cy2 + Math.floor(ch*0.1), Math.floor(cw*0.35), Math.floor(cw*0.35));
      // Right arm
      dctx.fillRect(cx2 + Math.floor(cw*0.65), cy2 + Math.floor(ch*0.35), Math.floor(cw*0.35), Math.floor(cw*0.35));
      dctx.fillRect(cx2 + Math.floor(cw*0.65), cy2 + Math.floor(ch*0.18), Math.floor(cw*0.35), Math.floor(cw*0.35));
      // Highlight
      dctx.fillStyle = '#22aa4a';
      dctx.fillRect(cx2 + Math.floor(cw*0.33), cy2 + 2, Math.floor(cw*0.12), Math.floor(ch*0.6));
    }
  });

  // Score
  dctx.fillStyle = '#ffffff';
  dctx.font = '700 18px JetBrains Mono,monospace';
  dctx.textAlign = 'right';
  dctx.fillText(String(Math.floor(dino.score)).padStart(5,'0'), W - 20, 30);
  if (dino.best > 0) {
    dctx.fillStyle = '#6060a0';
    dctx.font = '12px JetBrains Mono,monospace';
    dctx.fillText('HI ' + String(dino.best).padStart(5,'0'), W - 20, 50);
  }

  // Start / Game Over overlay
  if (!dino.started) {
    dctx.fillStyle = 'rgba(6,6,14,0.6)';
    dctx.fillRect(0, 0, W, H);
    dctx.fillStyle = '#ffffff';
    dctx.font = 'bold 28px Bebas Neue,sans-serif';
    dctx.textAlign = 'center';
    dctx.fillText('PRESS SPACE OR TAP TO START', W/2, H/2);
  } else if (!dino.alive) {
    dctx.fillStyle = 'rgba(6,6,14,0.7)';
    dctx.fillRect(0, 0, W, H);
    dctx.fillStyle = '#ff2d55';
    dctx.font = 'bold 32px Bebas Neue,sans-serif';
    dctx.textAlign = 'center';
    dctx.fillText('GAME OVER', W/2, H/2 - 20);
    dctx.fillStyle = '#ffffff';
    dctx.font = '18px Bebas Neue,sans-serif';
    dctx.fillText('TAP TO RESTART', W/2, H/2 + 20);
  }
  dctx.textAlign = 'left';
}

let _dinoLastTs = 0;
function dinoLoop(ts) {
  if (curPanel !== 'dino' || !dino.alive) return;

  // Delta time normalized to 60fps (16.667ms per frame)
  const dt = _dinoLastTs ? Math.min((ts - _dinoLastTs) / 16.667, 3) : 1;
  _dinoLastTs = ts;

  dino.frame++;
  dino.legFrame += dt;
  dino.score += 0.1 * dt;
  dino.speed = (5 + dino.score * 0.005) * dt;

  // Physics (all scaled by dt)
  dino.vy += 0.7 * dt;
  dino.y += dino.vy * dt;
  if (dino.y >= dino.groundY - dino.h) {
    dino.y = dino.groundY - dino.h;
    dino.vy = 0; dino.jumping = false;
  }

  // Spawn obstacles
  const gap = Math.max(800 - dino.score * 2, 400);
  if (dino.obstacles.length === 0 || dc.width - dino.obstacles[dino.obstacles.length-1].x > gap + Math.random()*300) {
    dinoSpawnObstacle();
  }

  // Move & animate obstacles (scaled by dt)
  dino.obstacles = dino.obstacles.filter(o => {
    o.x -= dino.speed;
    o.wingTimer += dt;
    if (o.wingTimer > 8) { o.wingUp = !o.wingUp; o.wingTimer = 0; }
    return o.x > -100;
  });

  // Clouds
  if (Math.random() < 0.005 * dt) dino.clouds.push({x: dc.width, y: 40 + Math.random()*60});
  dino.clouds = dino.clouds.filter(c => { c.x -= 0.8 * dt; return c.x > -100; });

  // Score & speed display
  const sc = Math.floor(dino.score);
  document.getElementById('dinoScore').textContent = sc;
  document.getElementById('dinoSpeed').textContent = (1 + dino.score*0.005).toFixed(1) + 'x';

  if (dinoCheckHit()) {
    dino.alive = false;
    if (sc > dino.best) { dino.best = sc; document.getElementById('dinoBest').textContent = dino.best; }
    document.getElementById('dinoStatus').textContent = 'Dead 💀';
    dinoDraw();
    _dinoLastTs = 0;
    return;
  }

  dinoDraw();
  dino.animId = requestAnimationFrame(dinoLoop);
}

dc.addEventListener('click', () => {
  if (!dino.started || !dino.alive) { dinoReset(); setTimeout(()=>{ dinoJump(); }, 100); }
  else dinoJump();
});
// Touch: tap = jump, swipe down = duck
let dcTouchY = 0;
dc.addEventListener('touchstart', e => {
  e.preventDefault();
  dcTouchY = e.touches[0].clientY;
}, {passive:false});
dc.addEventListener('touchend', e => {
  e.preventDefault();
  const dy = e.changedTouches[0].clientY - dcTouchY;
  if (dy > 30) {
    // Swipe down = duck
    dinoDuck(true);
    setTimeout(() => dinoDuck(false), 400);
  } else {
    // Tap = jump
    if (!dino.started || !dino.alive) { dinoReset(); setTimeout(()=>{ dinoJump(); }, 100); }
    else dinoJump();
  }
}, {passive:false});
document.addEventListener('keydown', e => {
  if (curPanel !== 'dino') return;
  if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); if (!e.repeat) dinoJump(); }
  if (e.code === 'ArrowDown') { e.preventDefault(); dinoDuck(true); }
});
document.addEventListener('keyup', e => {
  if (e.code === 'ArrowDown') dinoDuck(false);
});

/* ═══════════════════════════════════════════
   NUMBER MEMORY ENGINE
═══════════════════════════════════════════ */
let mem = { level:1, best:0, lives:3, number:'', phase:'idle', timer:null };

function memReset() {
  clearTimeout(mem.timer);
  mem = { level:1, best:0, lives:3, number:'', phase:'idle', timer:null };
  document.getElementById('memLevel').textContent = '1';
  document.getElementById('memDigits').textContent = '1';
  document.getElementById('memLives').textContent = '❤️❤️❤️';
  document.getElementById('memBest').textContent = '—';
  memSetMsg('PRESS START', '');
  document.getElementById('memInputArea').style.display = 'none';
  document.getElementById('memStartBtn').style.display = 'block';
  document.getElementById('memStartBtn').textContent = 'START';
  const bar = document.getElementById('memBar');
  bar.style.transition = 'none'; bar.style.width = '100%';
}

function memSetMsg(msg, num) {
  document.getElementById('memMsg').textContent = msg;
  document.getElementById('memNumber').textContent = num;
}

function memStart() {
  if (mem.phase === 'gameover') {
    const best = mem.best;
    mem = { level:1, best, lives:3, number:'', phase:'idle', timer:null };
    document.getElementById('memLives').textContent = '❤️❤️❤️';
  }
  mem.phase = 'show';
  const digits = mem.level;
  document.getElementById('memDigits').textContent = digits;
  document.getElementById('memLevel').textContent = mem.level;
  let num = String(Math.floor(Math.random()*9)+1);
  for (let i = 1; i < digits; i++) num += String(Math.floor(Math.random()*10));
  mem.number = num;
  document.getElementById('memStartBtn').style.display = 'none';
  document.getElementById('memInputArea').style.display = 'none';
  document.getElementById('memInput').value = '';
  memSetMsg('MEMORIZE!', num);
  const showTime = Math.max(1000, digits * 800);
  const bar = document.getElementById('memBar');
  bar.style.transition = 'none'; bar.style.width = '100%'; bar.style.background = 'var(--purple)';
  setTimeout(() => { bar.style.transition = `width ${showTime}ms linear`; bar.style.width = '0%'; }, 50);
  mem.timer = setTimeout(() => {
    memSetMsg('WHAT WAS THE NUMBER?', '');
    document.getElementById('memInputArea').style.display = 'flex';
    document.getElementById('memInput').focus();
    mem.phase = 'input';
    bar.style.transition = 'none'; bar.style.width = '100%'; bar.style.background = 'var(--accent)';
  }, showTime);
}

function memCheck() {
  if (mem.phase !== 'input') return;
  const answer = document.getElementById('memInput').value.trim();
  document.getElementById('memInputArea').style.display = 'none';
  if (answer === mem.number) {
    if (mem.level > mem.best) { mem.best = mem.level; document.getElementById('memBest').textContent = mem.best; }
    mem.level++;
    document.getElementById('memLevel').textContent = mem.level;
    document.getElementById('memDigits').textContent = mem.level;
    document.getElementById('memBar').style.background = 'var(--accent)';
    memSetMsg(`✅ CORRECT! Ready for ${mem.level} digits`, '');
    document.getElementById('memStartBtn').textContent = 'NEXT LEVEL →';
    document.getElementById('memStartBtn').style.display = 'block';
    mem.phase = 'idle';
  } else {
    mem.lives--;
    const hearts = '❤️'.repeat(Math.max(0,mem.lives)) + '🖤'.repeat(Math.max(0,3-mem.lives));
    document.getElementById('memLives').textContent = hearts;
    document.getElementById('memBar').style.background = 'var(--red)';
    if (mem.lives <= 0) {
      mem.phase = 'gameover';
      if (mem.level-1 > mem.best) { mem.best = mem.level-1; document.getElementById('memBest').textContent = mem.best; }
      memSetMsg(`GAME OVER — It was:`, mem.number);
      document.getElementById('memStartBtn').textContent = 'PLAY AGAIN';
      document.getElementById('memStartBtn').style.display = 'block';
    } else {
      mem.level = Math.max(1, mem.level-1);
      document.getElementById('memLevel').textContent = mem.level;
      memSetMsg(`❌ WRONG! It was: ${mem.number} — ${mem.lives} ${mem.lives===1?'life':'lives'} left`, '');
      document.getElementById('memStartBtn').textContent = 'TRY AGAIN';
      document.getElementById('memStartBtn').style.display = 'block';
      mem.phase = 'idle';
    }
  }
}
document.getElementById('memInput').addEventListener('keydown', e => { if(e.key==='Enter') memCheck(); });

/* ═══════════════════════════════════════════
   SNAKE GAME ENGINE — smooth interpolated movement
═══════════════════════════════════════════ */
const snakeCanvas = document.getElementById('snakeCanvas');
const sctx = snakeCanvas.getContext('2d');
const SN_GRID = 20;
const SN_CELL = snakeCanvas.width / SN_GRID;

const SN_BASE_MS = 200;  // starting interval (ms per step)
const SN_MIN_MS  = 80;   // fastest tick
const SN_SPEEDUP = 2;    // ms reduction per apple

let snake = {
  body: [{x:10,y:10},{x:9,y:10},{x:8,y:10}],
  prevBody: [{x:10,y:10},{x:9,y:10},{x:8,y:10}],
  dir: {x:1,y:0}, nextDir: {x:1,y:0},
  food: null, score: 0, best: 0,
  alive: false, started: false,
  tickMs: SN_BASE_MS,
  lastTickTime: 0,
  rafId: null, iv: null, touchStart: null
};

function snakeRandFood() {
  let pos;
  do { pos = { x: Math.floor(Math.random()*SN_GRID), y: Math.floor(Math.random()*SN_GRID) }; }
  while (snake.body.some(s => s.x===pos.x && s.y===pos.y));
  return pos;
}

function snakeReset() {
  clearInterval(snake.iv);
  cancelAnimationFrame(snake.rafId);
  const best = snake.best;
  const initBody = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  snake = {
    body: initBody, prevBody: initBody.map(s=>({...s})),
    dir: {x:1,y:0}, nextDir: {x:1,y:0},
    food: snakeRandFood(), score: 0, best,
    alive: false, started: false, tickMs: SN_BASE_MS,
    lastTickTime: 0, rafId: null, iv: null, touchStart: null
  };
  document.getElementById('snakeScore').textContent = '0';
  document.getElementById('snakeLen').textContent = '3';
  document.getElementById('snakeStatus').textContent = 'Ready';
  snakeDraw(1);
}

function lerpPos(prev, cur, t) {
  if (!prev) return cur;
  let dx = cur.x - prev.x, dy = cur.y - prev.y;
  if (Math.abs(dx) > SN_GRID/2) dx = 0;
  if (Math.abs(dy) > SN_GRID/2) dy = 0;
  return { x: prev.x + dx*t, y: prev.y + dy*t };
}

function snakeDraw(t) {
  const W = snakeCanvas.width, H = snakeCanvas.height;
  sctx.fillStyle = '#0a0a14';
  sctx.fillRect(0, 0, W, H);

  // Subtle grid dots
  sctx.fillStyle = 'rgba(255,255,255,0.025)';
  for (let gx=0; gx<SN_GRID; gx++) for (let gy=0; gy<SN_GRID; gy++)
    sctx.fillRect(gx*SN_CELL+SN_CELL/2-1, gy*SN_CELL+SN_CELL/2-1, 2, 2);

  // Border walls — glowing green border
  sctx.shadowColor = 'rgba(0,245,160,0.5)';
  sctx.shadowBlur = 8;
  sctx.strokeStyle = 'rgba(0,245,160,0.45)';
  sctx.lineWidth = 2;
  sctx.strokeRect(1, 1, W-2, H-2);
  sctx.shadowBlur = 0;

  // Food with pulse
  if (snake.food) {
    const pulse = 0.86 + 0.14*Math.sin(Date.now()/200);
    const fx = snake.food.x*SN_CELL + SN_CELL/2;
    const fy = snake.food.y*SN_CELL + SN_CELL/2;
    const gr = sctx.createRadialGradient(fx,fy,1,fx,fy,SN_CELL*0.65*pulse);
    gr.addColorStop(0,'rgba(255,45,85,1)');
    gr.addColorStop(0.45,'rgba(255,45,85,0.5)');
    gr.addColorStop(1,'rgba(255,45,85,0)');
    sctx.fillStyle = gr;
    sctx.beginPath(); sctx.arc(fx,fy,SN_CELL*0.65*pulse,0,Math.PI*2); sctx.fill();
    sctx.shadowColor = '#ff2d55'; sctx.shadowBlur = 10;
    sctx.fillStyle = '#ff2d55';
    sctx.beginPath(); sctx.arc(fx,fy,SN_CELL*0.32*pulse,0,Math.PI*2); sctx.fill();
    sctx.shadowBlur = 0;
    sctx.fillStyle = 'rgba(255,255,255,0.55)';
    sctx.beginPath(); sctx.arc(fx-SN_CELL*0.09,fy-SN_CELL*0.09,SN_CELL*0.08,0,Math.PI*2); sctx.fill();
  }

  // Draw snake body (back to front for correct layering)
  const n = snake.body.length;
  for (let i = n-1; i >= 0; i--) {
    const cur  = snake.body[i];
    const prev = (snake.prevBody && i < snake.prevBody.length) ? snake.prevBody[i] : cur;
    const pos  = lerpPos(prev, cur, t);
    const px = pos.x * SN_CELL;
    const py = pos.y * SN_CELL;
    const frac = 1 - i/n;

    if (i === 0) {
      // Head glow
      const hcx = px+SN_CELL/2, hcy = py+SN_CELL/2;
      const hg = sctx.createRadialGradient(hcx,hcy,0,hcx,hcy,SN_CELL);
      hg.addColorStop(0, snake.alive ? 'rgba(0,245,160,0.3)' : 'rgba(255,45,85,0.3)');
      hg.addColorStop(1,'rgba(0,0,0,0)');
      sctx.fillStyle = hg;
      sctx.beginPath(); sctx.arc(hcx,hcy,SN_CELL,0,Math.PI*2); sctx.fill();
    }

    const g = Math.round(130 + 115*frac);
    const b = Math.round(80*frac);
    const a = 0.45 + frac*0.55;
    sctx.fillStyle = i===0
      ? (snake.alive ? '#00f5a0' : '#ff2d55')
      : `rgba(0,${g},${b},${a})`;
    const pad = i===0 ? 1 : 2.5;
    sctx.beginPath();
    if (sctx.roundRect) sctx.roundRect(px+pad, py+pad, SN_CELL-pad*2, SN_CELL-pad*2, i===0?5:3);
    else sctx.rect(px+pad, py+pad, SN_CELL-pad*2, SN_CELL-pad*2);
    sctx.fill();

    // Eyes on head
    if (i===0 && snake.alive) {
      const hcx=px+SN_CELL/2, hcy=py+SN_CELL/2;
      const eOff=SN_CELL*0.22, eR=SN_CELL*0.1;
      let ex1,ey1,ex2,ey2;
      if      (snake.dir.x=== 1){ex1=hcx+SN_CELL*0.12;ey1=hcy-eOff;ex2=hcx+SN_CELL*0.12;ey2=hcy+eOff;}
      else if (snake.dir.x===-1){ex1=hcx-SN_CELL*0.12;ey1=hcy-eOff;ex2=hcx-SN_CELL*0.12;ey2=hcy+eOff;}
      else if (snake.dir.y===-1){ex1=hcx-eOff;ey1=hcy-SN_CELL*0.12;ex2=hcx+eOff;ey2=hcy-SN_CELL*0.12;}
      else                      {ex1=hcx-eOff;ey1=hcy+SN_CELL*0.12;ex2=hcx+eOff;ey2=hcy+SN_CELL*0.12;}
      sctx.fillStyle='#06060e';
      sctx.beginPath();sctx.arc(ex1,ey1,eR,0,Math.PI*2);sctx.fill();
      sctx.beginPath();sctx.arc(ex2,ey2,eR,0,Math.PI*2);sctx.fill();
      sctx.fillStyle='rgba(255,255,255,0.7)';
      sctx.beginPath();sctx.arc(ex1+eR*0.3,ey1-eR*0.3,eR*0.35,0,Math.PI*2);sctx.fill();
      sctx.beginPath();sctx.arc(ex2+eR*0.3,ey2-eR*0.3,eR*0.35,0,Math.PI*2);sctx.fill();
    }
  }

  // Idle overlay
  if (!snake.started) {
    sctx.fillStyle='rgba(6,6,14,0.62)'; sctx.fillRect(0,0,W,H);
    sctx.fillStyle='#00f5a0'; sctx.font='bold 44px Bebas Neue,sans-serif'; sctx.textAlign='center';
    sctx.fillText('SNAKE',W/2,H/2-22);
    sctx.fillStyle='#b0b0d0'; sctx.font='13px monospace';
    sctx.fillText('Tap / Arrow Key to Start',W/2,H/2+14);
    sctx.textAlign='left';
  }

  // Game over overlay
  if (snake.started && !snake.alive) {
    sctx.fillStyle='rgba(6,6,14,0.72)'; sctx.fillRect(0,0,W,H);
    sctx.fillStyle='#ff2d55'; sctx.font='bold 44px Bebas Neue,sans-serif'; sctx.textAlign='center';
    sctx.fillText('GAME OVER',W/2,H/2-30);
    sctx.fillStyle='#ffffff'; sctx.font='bold 24px Bebas Neue,sans-serif';
    sctx.fillText('Score: '+snake.score,W/2,H/2+4);
    if (snake.score>0 && snake.score>=snake.best) {
      sctx.fillStyle='#ffe000'; sctx.font='16px Bebas Neue,sans-serif';
      sctx.fillText('🏆 NEW BEST!',W/2,H/2+28);
    }
    sctx.fillStyle='#9090b8'; sctx.font='13px monospace';
    sctx.fillText('Tap to Restart',W/2,H/2+56);
    sctx.textAlign='left';
  }
}

// rAF render loop — interpolates positions between logic ticks
function snakeRenderLoop(now) {
  if (curPanel !== 'snake') return;
  snake.rafId = requestAnimationFrame(snakeRenderLoop);
  if (!snake.started) return;
  const elapsed = now - snake.lastTickTime;
  const t = snake.alive ? Math.min(elapsed / snake.tickMs, 1) : 1;
  snakeDraw(t);
}

function snakeTick() {
  if (curPanel !== 'snake' || !snake.alive) return;

  // Save previous positions for smooth interpolation
  snake.prevBody = snake.body.map(s => ({...s}));
  snake.lastTickTime = performance.now();

  snake.dir = { ...snake.nextDir };
  const head = { x: snake.body[0].x + snake.dir.x, y: snake.body[0].y + snake.dir.y };

  // Wall collision = death
  if (head.x < 0 || head.x >= SN_GRID || head.y < 0 || head.y >= SN_GRID) {
    snake.alive = false;
    if (snake.score > snake.best) { snake.best = snake.score; document.getElementById('snakeBest').textContent = snake.best; }
    document.getElementById('snakeStatus').textContent = 'Dead 💀';
    if (typeof recordStat !== 'undefined') recordStat('snake', snake.score, 'pts');
    if (typeof SFX !== 'undefined') SFX.dinoDie();
    snakeDraw(1); return;
  }

  // Self collision
  if (snake.body.some(s => s.x===head.x && s.y===head.y)) {
    snake.alive = false;
    if (snake.score > snake.best) { snake.best = snake.score; document.getElementById('snakeBest').textContent = snake.best; }
    document.getElementById('snakeStatus').textContent = 'Dead 💀';
    if (typeof recordStat !== 'undefined') recordStat('snake', snake.score, 'pts');
    if (typeof SFX !== 'undefined') SFX.dinoDie();
    snakeDraw(1); return;
  }

  snake.body.unshift(head);

  if (head.x === snake.food.x && head.y === snake.food.y) {
    snake.score += 10;
    snake.food = snakeRandFood();
    // Slow acceleration: 2ms per apple, floor at 80ms
    const apples = Math.floor(snake.score / 10);
    snake.tickMs = Math.max(SN_MIN_MS, SN_BASE_MS - apples * SN_SPEEDUP);
    clearInterval(snake.iv);
    snake.iv = setInterval(snakeTick, snake.tickMs);
    document.getElementById('snakeScore').textContent = snake.score;
    document.getElementById('snakeLen').textContent = snake.body.length;
    if (typeof SFX !== 'undefined') SFX.memCorrect();
  } else {
    snake.body.pop();
    if (snake.prevBody.length > snake.body.length) snake.prevBody.pop();
  }
}

function snakeStart() {
  snakeReset();
  snake.started = true; snake.alive = true;
  snake.lastTickTime = performance.now();
  document.getElementById('snakeStatus').textContent = 'Running';
  snake.iv = setInterval(snakeTick, snake.tickMs);
  snake.rafId = requestAnimationFrame(snakeRenderLoop);
}

snakeCanvas.addEventListener('click', () => {
  if (!snake.started || !snake.alive) snakeStart();
});
snakeCanvas.addEventListener('touchstart', e => {
  e.preventDefault();
  snake.touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  if (!snake.started || !snake.alive) snakeStart();
}, { passive:false });
snakeCanvas.addEventListener('touchend', e => {
  e.preventDefault();
  if (!snake.touchStart) return;
  const dx = e.changedTouches[0].clientX - snake.touchStart.x;
  const dy = e.changedTouches[0].clientY - snake.touchStart.y;
  if (Math.abs(dx) < 12 && Math.abs(dy) < 12) return;
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 0 && snake.dir.x !== -1) snake.nextDir = {x:1,y:0};
    else if (dx < 0 && snake.dir.x !== 1) snake.nextDir = {x:-1,y:0};
  } else {
    if (dy > 0 && snake.dir.y !== -1) snake.nextDir = {x:0,y:1};
    else if (dy < 0 && snake.dir.y !== 1) snake.nextDir = {x:0,y:-1};
  }
  snake.touchStart = null;
}, { passive:false });

document.addEventListener('keydown', e => {
  if (curPanel !== 'snake') return;
  const map = {
    ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
    KeyW:{x:0,y:-1}, KeyS:{x:0,y:1}, KeyA:{x:-1,y:0}, KeyD:{x:1,y:0}
  };
  const d = map[e.code];
  if (d) {
    e.preventDefault();
    if (!snake.started || !snake.alive) { snakeStart(); return; }
    if (!(d.x === -snake.dir.x && d.y === -snake.dir.y)) snake.nextDir = d;
  }
});


/* ═══════════════════════════════════════════
   TAB SCROLL ARROWS
═══════════════════════════════════════════ */
function scrollTabs(dir) {
  const tabs = document.getElementById('tabsContainer');
  tabs.scrollBy({ left: dir * 160, behavior: 'smooth' });
}

// Show/hide arrows based on scroll position
function updateTabArrows() {
  const tabs = document.getElementById('tabsContainer');
  const btnL = document.getElementById('tabScrollLeft');
  const btnR = document.getElementById('tabScrollRight');
  if (!tabs || !btnL || !btnR) return;
  const atStart = tabs.scrollLeft <= 4;
  const atEnd   = tabs.scrollLeft + tabs.clientWidth >= tabs.scrollWidth - 4;
  btnL.style.opacity = atStart ? '0.25' : '1';
  btnR.style.opacity = atEnd   ? '0.25' : '1';
}

document.getElementById('tabsContainer').addEventListener('scroll', updateTabArrows, { passive: true });
window.addEventListener('resize', updateTabArrows);
setTimeout(updateTabArrows, 100);

// Auto-scroll active tab into view when switching
const _origSwitchPanel_scroll = switchPanel;
switchPanel = function(p, fromPopstate) {
  _origSwitchPanel_scroll(p, fromPopstate);
  const activeTab = document.querySelector(`.tab[data-panel="${p}"]`);
  if (activeTab) activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
};

/* ═══════════════════════════════════════════
   INIT
═══════════════════════════════════════════ */
setLang('en');
resetTyping();
cbReset();
dinoReset();
memReset();
snakeReset();
// Read panel from current URL path, fall back to 'reaction'
const _initPanel = panelFromPath(location.pathname);
// fromPopstate=true → switchPanel skips pushState, no extra history entry
switchPanel(_initPanel, true);
// Set initial state so back button works correctly from first visit
const _initRoute = ROUTES[_initPanel] || ROUTES['reaction'];
try {
  history.replaceState({ panel: _initPanel }, _initRoute.title, _initRoute.path);
  document.title = _initRoute.title;
  const _md = document.querySelector('meta[name="description"]');
  if (_md) _md.setAttribute('content', _initRoute.desc);
  const _cl = document.querySelector('link[rel="canonical"]');
  if (_cl) _cl.setAttribute('href', 'https://reactionspeedtest.com' + _initRoute.path);
} catch(e) {}
setDuration(5);
</script>
<!-- ═══════════════════════════════════════════════════
     STATS MODAL
═══════════════════════════════════════════════════ -->
<div id="statsModal" style="
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(6,6,14,0.88);backdrop-filter:blur(12px);
  align-items:center;justify-content:center;
">
  <div style="
    background:var(--surf);border:1px solid var(--border);border-radius:20px;
    padding:28px 24px;max-width:500px;width:92%;max-height:85vh;overflow-y:auto;
    position:relative;
  ">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:0.15em;color:var(--accent);">📊 MY STATS</div>
      <button onclick="closeStatsModal()" style="background:none;border:none;color:var(--muted);font-size:1.4rem;cursor:pointer;line-height:1;">✕</button>
    </div>
    <div id="statsContent" style="display:flex;flex-direction:column;gap:14px;"></div>
    <button onclick="clearStats()" style="
      margin-top:18px;width:100%;padding:11px;background:transparent;
      border:1px solid var(--red);color:var(--red);border-radius:10px;
      font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:0.1em;
      cursor:pointer;transition:all 0.2s;
    " onmouseover="this.style.background='rgba(255,45,85,0.1)'" onmouseout="this.style.background='transparent'">
      🗑 CLEAR ALL STATS
    </button>
  </div>
</div>

<script>
/* ═══════════════════════════════════════════
   WEB AUDIO — SOUND ENGINE
═══════════════════════════════════════════ */
let audioCtx = null;
let soundEnabled = true;

function getAudioCtx() {
  if (!audioCtx) {
    try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
  }
  return audioCtx;
}

function playTone(freq, type, duration, vol, decay) {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = type || 'sine';
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(vol || 0.18, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + (decay || duration));
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + (duration || 0.12));
  } catch(e) {}
}

function playNoise(duration, vol) {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    const bufLen = ctx.sampleRate * duration;
    const buf = ctx.createBuffer(1, bufLen, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bufLen; i++) data[i] = (Math.random() * 2 - 1);
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const gain = ctx.createGain();
    const filter = ctx.createBiquadFilter();
    filter.type = 'bandpass'; filter.frequency.value = 200;
    src.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
    gain.gain.setValueAtTime(vol || 0.1, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
    src.start(); src.stop(ctx.currentTime + duration);
  } catch(e) {}
}

// Game sounds
const SFX = {
  click:      () => playTone(600, 'square', 0.06, 0.12),
  clickFail:  () => playTone(180, 'sawtooth', 0.1, 0.15),
  dinoJump:   () => { playTone(280, 'sine', 0.10, 0.08); playTone(420, 'sine', 0.07, 0.07); },
  dinoDie:    () => { playTone(200,'sawtooth',0.06,0.08); setTimeout(()=>playTone(130,'sawtooth',0.07,0.15),70); playNoise(0.18, 0.04); },
  dinoStep:   () => playTone(80, 'square', 0.04, 0.04),
  reactionGo: () => playTone(880, 'sine', 0.15, 0.22, 0.3),
  reactionHit:() => { playTone(660,'sine',0.08,0.14); setTimeout(()=>playTone(880,'sine',0.1,0.12),60); },
  reactionEarly:() => { playTone(200,'sawtooth',0.15,0.18); setTimeout(()=>playTone(150,'sawtooth',0.12,0.2),100); },
  reactionEnd:() => { [523,659,784,1047].forEach((f,i)=>setTimeout(()=>playTone(f,'sine',0.15,0.1),i*90)); },
  stimHit:    () => playTone(660 + Math.random()*200, 'sine', 0.07, 0.12),
  stimMiss:   () => playTone(200, 'sawtooth', 0.06, 0.08),
  stimEnd:    () => { [392,494,659,784].forEach((f,i)=>setTimeout(()=>playTone(f,'sine',0.12,0.15),i*80)); },
  cpsClick:   () => playTone(500 + Math.random()*200, 'square', 0.04, 0.08),
  spacePress: () => playTone(350, 'sine', 0.05, 0.06),
  memCorrect: () => { playTone(523,'sine',0.12,0.15); setTimeout(()=>playTone(659,'sine',0.12,0.15),120); },
  memWrong:   () => { playTone(250,'sawtooth',0.15,0.2); setTimeout(()=>playTone(200,'sawtooth',0.12,0.2),120); },
  cbHit:      () => playTone(440 + Math.random()*160, 'sine', 0.08, 0.1),
  cbMiss:     () => playTone(160, 'sawtooth', 0.1, 0.12),
  typingKey:  () => playTone(700 + Math.random()*300, 'square', 0.02, 0.025),
};

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? '🔊' : '🔇';
  // Unlock audio ctx on first interaction
  if (soundEnabled) { getAudioCtx(); playTone(440,'sine',0.05,0.1); }
}

/* ═══════════════════════════════════════════
   PERSONAL STATS (localStorage)
═══════════════════════════════════════════ */
const STATS_KEY = 'reflexlab_stats_v1';

function loadStats() {
  try { return JSON.parse(localStorage.getItem(STATS_KEY)) || {}; } catch(e) { return {}; }
}
function saveStats(s) {
  try { localStorage.setItem(STATS_KEY, JSON.stringify(s)); } catch(e) {}
}
function recordStat(game, value, unit) {
  const s = loadStats();
  if (!s[game]) s[game] = { sessions:0, best:null, history:[] };
  s[game].sessions++;
  s[game].history.push({ v: value, t: Date.now() });
  if (s[game].history.length > 50) s[game].history.shift(); // keep last 50
  const isBetter = s[game].best === null ||
    (game === 'reaction' ? value < s[game].best : value > s[game].best);
  if (isBetter) s[game].best = value;
  saveStats(s);
}

function showStatsModal() {
  const s = loadStats();
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  const games = [
    { key:'reaction', label:'⚡ Reaction Time', unit:'ms', lower:true },
    { key:'cps',      label:'🔥 Click Speed',   unit:'CPS', lower:false },
    { key:'spacebar', label:'⌨️ Spacebar',       unit:'HPS', lower:false },
    { key:'stim',     label:'🎯 Stimulation',    unit:'pts', lower:false },
    { key:'typing',   label:'📝 Typing Speed',   unit:'WPM', lower:false },
    { key:'memory',   label:'🧠 Memory',         unit:'digits', lower:false },
  ];
  content.innerHTML = '';
  let hasData = false;
  games.forEach(g => {
    const d = s[g.key];
    if (!d) return;
    hasData = true;
    const avg = d.history.length ? Math.round(d.history.reduce((a,b)=>a+b.v,0)/d.history.length*10)/10 : '—';
    content.innerHTML += `
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:14px 16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <span style="font-size:0.7rem;font-weight:700;color:var(--text);">${g.label}</span>
          <span style="font-size:0.55rem;color:var(--muted);letter-spacing:0.1em;">${d.sessions} sessions</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center;">
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--accent);">${d.best}${g.unit==='ms'?'':''}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Best (${g.unit})</div>
          </div>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--yellow);">${avg}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Avg (${g.unit})</div>
          </div>
          <div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--purple);">${d.sessions}</div>
            <div style="font-size:0.45rem;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;">Sessions</div>
          </div>
        </div>
      </div>`;
  });
  if (!hasData) {
    content.innerHTML = '<div style="text-align:center;color:var(--muted);padding:32px 0;font-size:0.7rem;letter-spacing:0.1em;">No data yet — play some tests first!</div>';
  }
  modal.style.display = 'flex';
}
function closeStatsModal() { document.getElementById('statsModal').style.display = 'none'; }
function clearStats() {
  if (confirm('Clear all your saved stats?')) {
    localStorage.removeItem(STATS_KEY);
    showStatsModal();
  }
}
document.getElementById('statsModal').addEventListener('click', e => {
  if (e.target === document.getElementById('statsModal')) closeStatsModal();
});
</script>

<script>
/* ═══════════════════════════════════════════
   GAME SOUND & EFFECT HOOKS
═══════════════════════════════════════════ */

/* ────────────────────────────────────────
   DINO — jump + softer die + footsteps
──────────────────────────────────────── */
const _origDinoJump = dinoJump;
dinoJump = function() {
  const wasJumping = dino.jumping;
  _origDinoJump();
  if (!wasJumping) SFX.dinoJump();
};

let _dinoPrevAlive = false;
setInterval(() => {
  if (_dinoPrevAlive && !dino.alive && dino.started) SFX.dinoDie();
  _dinoPrevAlive = dino.alive;
}, 50);

/* ────────────────────────────────────────
   REACTION — clean override approach
   (don't double-wrap startRound, just
    patch the go-signal directly inside
    handleReactionTap's wait→go path)
──────────────────────────────────────── */

/* ────────────────────────────────────────
   REACTION — stat tracking only (no sounds)
──────────────────────────────────────── */

// Patch endReaction — stat save only, no sounds
const _origEndReaction = endReaction;
endReaction = function() {
  _origEndReaction();
  const valid = rResults.filter(r => r !== 'early');
  if (valid.length) recordStat('reaction', Math.round(valid.reduce((a,b)=>a+b,0)/valid.length), 'ms');
};

// When switching away from reaction panel, cancel pending rTimer
const _origSwitchPanel_react = switchPanel;
switchPanel = function(p, fromPopstate) {
  if (curPanel === 'reaction' && p !== 'reaction') {
    clearTimeout(rTimer);
    rState = 'idle';
  }
  if (curPanel === 'snake' && p !== 'snake') {
    clearInterval(snake.iv);
  }
  _origSwitchPanel_react(p, fromPopstate);
};

/* ────────────────────────────────────────
   STIMULATION — proper event-based sounds
   Only on: correct hit & wrong click (miss)
   NOT on target expiry
──────────────────────────────────────── */

// Wrap spawnTarget to inject sound into the click handler of each target
const _origSpawnTarget = spawnTarget;
spawnTarget = function() {
  // Call original — it appends targets to arena
  _origSpawnTarget();
  // Find the most recently appended target element and patch its click
  const arena = document.getElementById('stimArena');
  const targets = arena.querySelectorAll('.stim-target');
  if (!targets.length) return;
  const lastEl = targets[targets.length - 1];
  // Wrap click to add sound — stopPropagation already handled inside original
  lastEl.addEventListener('click', (e) => {
    // Only fire if this target hasn't been hit yet (check via opacity not yet 0)
    if (lastEl.style.opacity !== '0') SFX.stimHit();
  }, true); // capture phase — runs before original
};

// Arena background click = miss sound
document.getElementById('stimArena').addEventListener('click', (e) => {
  if (!stim.running) return;
  if (e.target.id === 'stimArena' || e.target === document.getElementById('stimArena')) {
    SFX.stimMiss();
  }
});

// Finish sound + stat
const _origFinishStim = finishStim;
finishStim = function() {
  _origFinishStim();
  SFX.stimEnd();
  recordStat('stim', stim.score, 'pts');
};

/* ────────────────────────────────────────
   CPS / JITTER — NO sound, ripple effect only
──────────────────────────────────────── */
function spawnClickRipple(container, clientX, clientY) {
  const rect = container.getBoundingClientRect();
  const x = clientX - rect.left;
  const y = clientY - rect.top;
  const ripple = document.createElement('div');
  ripple.style.cssText = `
    position:absolute;
    left:${x}px; top:${y}px;
    width:0; height:0;
    border-radius:50%;
    border:2px solid rgba(0,245,160,0.7);
    transform:translate(-50%,-50%);
    pointer-events:none;
    animation:rippleGrow 0.5s ease-out forwards;
    z-index:10;
  `;
  container.style.position = 'relative';
  container.appendChild(ripple);
  setTimeout(() => ripple.remove(), 500);
}

clickArena.addEventListener('click', (e) => {
  spawnClickRipple(clickArena, e.clientX, e.clientY);
});
clickArena.addEventListener('touchstart', (e) => {
  if (e.touches.length) spawnClickRipple(clickArena, e.touches[0].clientX, e.touches[0].clientY);
}, { passive: true });

// CPS finish → stat
const _origCgFinish = cgFinish;
cgFinish = function() {
  _origCgFinish();
  const elapsed = Math.min(curDuration, (Date.now() - cg.ts)/1000);
  recordStat('cps', +(cg.clicks / Math.max(elapsed, 0.01)).toFixed(2), 'CPS');
};

/* ────────────────────────────────────────
   SPACEBAR — mechanical key sound
──────────────────────────────────────── */
function playSpacebarSound() {
  if (!soundEnabled) return;
  const ctx = getAudioCtx(); if (!ctx) return;
  try {
    // Thump: low body
    const bufLen = Math.floor(ctx.sampleRate * 0.04);
    const buf = ctx.createBuffer(1, bufLen, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for (let i = 0; i < bufLen; i++) data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufLen * 0.3));
    const src = ctx.createBufferSource();
    src.buffer = buf;
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass'; filter.frequency.value = 180;
    const gain = ctx.createGain();
    gain.gain.value = 0.4;
    src.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
    src.start();
    // Click transient
    const osc = ctx.createOscillator();
    const g2 = ctx.createGain();
    osc.type = 'square'; osc.frequency.value = 1200;
    g2.gain.setValueAtTime(0.07, ctx.currentTime);
    g2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.015);
    osc.connect(g2); g2.connect(ctx.destination);
    osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.015);
  } catch(e) {}
}

const _origSgClick = sgClick;
sgClick = function() {
  playSpacebarSound();
  _origSgClick();
};

const _origSgFinish = sgFinish;
sgFinish = function() {
  _origSgFinish();
  const elapsed = Math.min(curDuration, (Date.now() - sg.ts)/1000);
  recordStat('spacebar', +(sg.clicks/Math.max(elapsed,0.01)).toFixed(2), 'HPS');
};

/* ────────────────────────────────────────
   NUMBER MEMORY — correct / wrong sounds
──────────────────────────────────────── */
const _origMemCheck = memCheck;
memCheck = function() {
  const answer = document.getElementById('memInput').value.trim();
  const wasCorrect = answer === mem.number;
  _origMemCheck();
  if (wasCorrect) SFX.memCorrect();
  else SFX.memWrong();
};

let _lastMemBestRecorded = 0;
setInterval(() => {
  if (mem.phase === 'gameover' && mem.best > 0 && mem.best !== _lastMemBestRecorded) {
    recordStat('memory', mem.best, 'digits');
    _lastMemBestRecorded = mem.best;
  }
}, 500);

/* ────────────────────────────────────────
   COREBALL — hit sound
──────────────────────────────────────── */
cbCanvas.addEventListener('click', () => {
  if (!cb.gameOver && !cb.flyBall && cb.ballsLeft > 0) SFX.cbHit();
}, true);

/* ────────────────────────────────────────
   TYPING — keystroke sound
──────────────────────────────────────── */
const typingInput = document.getElementById('tInput');
if (typingInput) typingInput.addEventListener('keydown', () => SFX.typingKey());

/* ────────────────────────────────────────
   RIPPLE CSS KEYFRAME (injected once)
──────────────────────────────────────── */
const _rippleStyle = document.createElement('style');
_rippleStyle.textContent = `
@keyframes rippleGrow {
  0%   { width:0; height:0; opacity:0.9; }
  100% { width:120px; height:120px; opacity:0; }
}`;
document.head.appendChild(_rippleStyle);

/* ────────────────────────────────────────
   Unlock AudioContext on first interaction
──────────────────────────────────────── */
document.addEventListener('click',   () => { if(soundEnabled) getAudioCtx(); }, { once:true });
document.addEventListener('keydown', () => { if(soundEnabled) getAudioCtx(); }, { once:true });

/* ═══════════════════════════════════════════════════════════
   💰 CLICKER TYCOON ENGINE  v5
   New: Research tree · Fortune Spin · Click Frenzy · Golden Coin · Quests
═══════════════════════════════════════════════════════════ */

// ── UPGRADE DATA ──────────────────────────────────────────
const CT_UPG = [
  {id:'cursor',  name:'Auto Cursor',  ico:'🖱️', base:25,         cps:0.08,   info:'Clicks for you while you rest'},
  {id:'intern',  name:'Intern',       ico:'👶', base:300,        cps:0.4,    info:'Very keen, learning the ropes'},
  {id:'miner',   name:'Coin Miner',   ico:'⛏️', base:2000,       cps:2,      info:'Digs gold from the earth'},
  {id:'factory', name:'Factory',      ico:'🏭', base:12000,      cps:8,      info:'Mass-produces coins 24/7'},
  {id:'bank',    name:'Bank',         ico:'🏦', base:60000,      cps:25,     info:'Compound interest never sleeps'},
  {id:'lab',     name:'Research Lab', ico:'🔬', base:350000,     cps:80,     info:'Science-powered income engine'},
  {id:'rocket',  name:'Rocket',       ico:'🚀', base:2000000,    cps:250,    info:'Mining asteroids for profit'},
  {id:'ai',      name:'AI System',    ico:'🤖', base:12000000,   cps:800,    info:'Self-optimizing money printer'},
  {id:'portal',  name:'Coin Portal',  ico:'🌀', base:70000000,   cps:2500,   info:'Siphons coins from other dims'},
  {id:'nexus',   name:'Coin Nexus',   ico:'💠', base:500000000,  cps:8000,   info:'Interdimensional coin hub'},
  {id:'titan',   name:'Titan Mine',   ico:'⛰️', base:3e9,        cps:25000,  info:'A mountain of pure gold'},
  {id:'omega',   name:'Omega Engine', ico:'🌠', base:25e9,       cps:80000,  info:'Reality-bending wealth generator'},
];

// ── RESEARCH DATA ─────────────────────────────────────────
const CT_RES = [
  { id:'click1', name:'Better Fingers',    ico:'👆', desc:'Click power +50% base',
    tiers:[{label:'+50% click',rp:5,mult:1.5},{label:'+100% click',rp:15,mult:2},{label:'+200% click',rp:40,mult:3}] },
  { id:'idle1',  name:'Efficient Systems', ico:'⚙️', desc:'All passive income +25% per tier',
    tiers:[{label:'+25% CPS',rp:8,mult:1.25},{label:'+50% CPS',rp:20,mult:1.5},{label:'+100% CPS',rp:50,mult:2}] },
  { id:'cost1',  name:'Bulk Discount',     ico:'🏷️', desc:'Upgrade costs -10% per tier',
    tiers:[{label:'-10% cost',rp:10,mult:0.9},{label:'-20% cost',rp:25,mult:0.8},{label:'-30% cost',rp:60,mult:0.7}] },
  { id:'pres1',  name:'Prestige Mastery',  ico:'⭐', desc:'Prestige multiplier +25% bonus per tier',
    tiers:[{label:'+25% pres',rp:20,mult:1.25},{label:'+50% pres',rp:50,mult:1.5},{label:'+100% pres',rp:120,mult:2}] },
  { id:'spin1',  name:'Lucky Spinner',     ico:'🎰', desc:'Fortune spin cooldown -30s per tier',
    tiers:[{label:'-30s cd',rp:6,cd:-30},{label:'-60s cd',rp:16,cd:-60},{label:'-90s cd',rp:35,cd:-90}] },
  { id:'gold1',  name:'Golden Touch',      ico:'🌟', desc:'Golden coin value ×2 per tier',
    tiers:[{label:'×2 gold',rp:12,mult:2},{label:'×4 gold',rp:30,mult:4},{label:'×8 gold',rp:70,mult:8}] },
];

// ── MILESTONES ────────────────────────────────────────────
const CT_MS = [
  {id:'c1',    lbl:'First Coin',       ico:'🪙',  chk:s=>s.te>=1},
  {id:'c1k',   lbl:'1K Coins',         ico:'💰',  chk:s=>s.te>=1e3},
  {id:'c100k', lbl:'100K Big Shot',    ico:'🥇',  chk:s=>s.te>=1e5},
  {id:'c1m',   lbl:'Millionaire',      ico:'💎',  chk:s=>s.te>=1e6},
  {id:'c1b',   lbl:'Billionaire',      ico:'👑',  chk:s=>s.te>=1e9},
  {id:'c1t',   lbl:'Trillionaire',     ico:'🌌',  chk:s=>s.te>=1e12},
  {id:'p1',    lbl:'First Prestige',   ico:'⭐',  chk:s=>s.pres>=1},
  {id:'p5',    lbl:'5× Prestige',      ico:'🌟',  chk:s=>s.pres>=5},
  {id:'p10',   lbl:'10× Prestige',     ico:'🌠',  chk:s=>s.pres>=10},
  {id:'r1',    lbl:'First Research',   ico:'🔬',  chk:s=>(s.resSpent||0)>=1},
  {id:'r50',   lbl:'50 RP Spent',      ico:'🧪',  chk:s=>(s.resSpent||0)>=50},
  {id:'u25',   lbl:'25 Upgrades',      ico:'🛒',  chk:s=>ctOwned(s)>=25},
  {id:'u100',  lbl:'100 Upgrades',     ico:'🏪',  chk:s=>ctOwned(s)>=100},
  {id:'fren1', lbl:'First Frenzy',     ico:'⚡',  chk:s=>(s.frenzyCount||0)>=1},
  {id:'gold1x',lbl:'Golden Catch',     ico:'🌟',  chk:s=>(s.goldenCaught||0)>=1},
  {id:'gold10',lbl:'10 Golden Coins',  ico:'✨',  chk:s=>(s.goldenCaught||0)>=10},
  {id:'q10',   lbl:'10 Quests Done',   ico:'📋',  chk:s=>(s.questsDone||0)>=10},
  {id:'spin10',lbl:'10 Spins',         ico:'🎰',  chk:s=>(s.spins||0)>=10},
  {id:'tc1k',  lbl:'1K Clicks',        ico:'👆',  chk:s=>s.tc>=1000},
  {id:'tc100k',lbl:'100K Clicks',      ico:'🖱️',  chk:s=>s.tc>=100000},
];

// ── QUEST TEMPLATES ───────────────────────────────────────
const CT_QUEST_POOL = [
  {id:'q_clicks',   lbl:'Click {n} times',     stat:'tc',    ns:[50,200,500,1000]},
  {id:'q_earn',     lbl:'Earn {n} coins',       stat:'te',    ns:[1000,10000,100000,1e6], rel:true},
  {id:'q_buy',      lbl:'Buy {n} upgrades',     stat:'owned', ns:[3,10,25,50], rel:true},
  {id:'q_cps',      lbl:'Reach {n}/s income',   stat:'cps',   ns:[1,10,100,1000,10000]},
  {id:'q_pres',     lbl:'Prestige {n} times',   stat:'pres',  ns:[1,3,5,10]},
  {id:'q_golden',   lbl:'Catch {n} golden coins',stat:'goldenCaught',ns:[1,3,10]},
  {id:'q_spin',     lbl:'Spin the wheel {n}×',  stat:'spins', ns:[1,3,5,10], rel:true},
];

// ── STATE ─────────────────────────────────────────────────
let ct = {
  c:0, te:0, tc:0, pres:0, mult:1, own:{}, ms:new Set(),
  rp:0,          // research points (earned from prestige + playtime)
  resLevel:{},   // { resId: tierIndex (0=none, 1/2/3 bought) }
  resSpent:0,    // total RP spent
  spinCd:0,      // unix ms when next free spin available
  spins:0,       // total spins done
  frenzy:0,      // frenzy end timestamp (ms)
  frenzyCount:0, // total frenzies triggered
  goldenCaught:0,
  goldenNext:0,  // unix ms when next golden coin appears
  quests:[],     // active quests [{id,lbl,target,current,reward,done,claimed,baseVal}]
  questsDone:0,
  questsLastRefresh:0,
  iv:null, tick:0,
};

function ctOwned(s){ return Object.values(s.own).reduce((a,b)=>a+b,0); }

// ── MATH ──────────────────────────────────────────────────
function ctResBonus(id){ // returns multiplicative factor from research
  const l=ct.resLevel[id]||0; if(!l) return 1;
  const res=CT_RES.find(r=>r.id===id); if(!res) return 1;
  let m=1;
  for(let i=0;i<l;i++) m*=(res.tiers[i].mult||1);
  return m;
}
function ctCostDiscount(){ return ctResBonus('cost1'); }
function ctClickBonus(){   return ctResBonus('click1'); }
function ctIdleBonus(){    return ctResBonus('idle1'); }
function ctPresBonus(){    return ctResBonus('pres1'); }
function ctGoldBonus(){    return ctResBonus('gold1'); }
function ctSpinCdBase(){
  const l=ct.resLevel['spin1']||0;
  const res=CT_RES.find(r=>r.id==='spin1');
  let cd=120000; // 2 min default
  if(res) for(let i=0;i<l;i++) cd+=res.tiers[i].cd*1000;
  return Math.max(cd,30000);
}

function ctCost(u){
  const base=Math.ceil(u.base * Math.pow(1.20, ct.own[u.id]||0));
  return Math.ceil(base * ctCostDiscount());
}
function ctCPS(){
  let s=0; CT_UPG.forEach(u=>{ s+=(ct.own[u.id]||0)*u.cps; });
  return s * ct.mult * ctPresBonus() * ctIdleBonus();
}
function ctEPC(){
  let b=1; CT_UPG.forEach(u=>{ b+=(ct.own[u.id]||0)*u.cps*0.025; });
  let base=Math.max(1,Math.floor(b * ct.mult * ctPresBonus() * ctClickBonus()));
  if(Date.now()<ct.frenzy) base*=10;
  return base;
}

// ── FORMAT ────────────────────────────────────────────────
function ctF(n){
  n=Math.floor(n);
  if(n>=1e15) return (n/1e15).toFixed(2)+'Qa';
  if(n>=1e12) return (n/1e12).toFixed(2)+'T';
  if(n>=1e9)  return (n/1e9).toFixed(2)+'B';
  if(n>=1e6)  return (n/1e6).toFixed(2)+'M';
  if(n>=1e3)  return (n/1e3).toFixed(1)+'K';
  return n.toString();
}

// ── CANVAS PARTICLES ──────────────────────────────────────
(function(){
  const cv=document.getElementById('ctParticleCanvas');
  if(!cv) return;
  const ctx=cv.getContext('2d');
  let parts=[],raf=null;
  function resize(){
    const w=document.getElementById('ctCoinWrap'); if(!w) return;
    cv.width=w.offsetWidth||200; cv.height=w.offsetHeight||200;
  }
  resize(); window.addEventListener('resize',resize);
  function spawn(n,cols){
    const cx=cv.width/2,cy=cv.height/2;
    const dc=cols||['#ffd600','#ffee58','#fff9c4','#ff9800','#ffb300','#fff'];
    for(let i=0;i<n;i++){
      const a=Math.random()*Math.PI*2,spd=1.8+Math.random()*4;
      parts.push({x:cx,y:cy,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd,
        r:1.8+Math.random()*3.2,col:dc[Math.floor(Math.random()*dc.length)],
        life:1,dec:0.022+Math.random()*0.028});
    }
  }
  function tick(){
    ctx.clearRect(0,0,cv.width,cv.height);
    parts=parts.filter(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.14; p.life-=p.dec;
      if(p.life<=0) return false;
      ctx.globalAlpha=p.life;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=p.col; ctx.fill(); return true;
    });
    ctx.globalAlpha=1;
    if(parts.length) raf=requestAnimationFrame(tick); else raf=null;
  }
  window.ctBurst=function(n=12,cols){spawn(n,cols); if(!raf) raf=requestAnimationFrame(tick);};
  window.ctResizeParticles=resize;
})();

// ── FLOAT TEXT ────────────────────────────────────────────
function ctFloat(txt,col){
  const layer=document.getElementById('ctFloatLayer'); if(!layer) return;
  const el=document.createElement('div');
  el.className='ct-float';
  el.style.cssText=`left:calc(50% + ${(Math.random()-.5)*50}px);top:35%;${col?'color:'+col+';text-shadow:0 0 8px '+col:''}`;
  el.textContent='+'+txt; layer.appendChild(el);
  setTimeout(()=>el.remove(),900);
}

// ── CLICK ─────────────────────────────────────────────────
function ctDoClick(){
  if(curPanel!=='clicker') return;
  const earn=ctEPC();
  ct.c+=earn; ct.te+=earn; ct.tc++;
  ctFloat(ctF(earn), Date.now()<ct.frenzy?'#ff9060':null);
  const frenzyOn=Date.now()<ct.frenzy;
  if(typeof ctBurst==='function') ctBurst(earn>5000?28:earn>500?18:10, frenzyOn?['#ff6000','#ff9800','#ffb300','#fff']:null);
  const btn=document.getElementById('ctCoinBtn');
  if(btn){ btn.style.transform='scale(0.89)'; setTimeout(()=>btn.style.transform='',90); }
  if(typeof ctSoundOn==='undefined'||ctSoundOn){
    try{
      const a=getAudioCtx(),o=a.createOscillator(),g=a.createGain();
      o.connect(g); g.connect(a.destination);
      o.frequency.value=350+Math.random()*220+(ct.tc%4)*30;
      g.gain.setValueAtTime(0.07,a.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+0.13);
      o.start(); o.stop(a.currentTime+0.13);
    }catch(e){}
  }
  ctUpdateQuests();
  ctRefresh();
}

// ── BUY ───────────────────────────────────────────────────
function ctDoBuy(id){
  const u=CT_UPG.find(x=>x.id===id); if(!u) return;
  const cost=ctCost(u);
  if(ct.c<cost) return;
  ct.c-=cost; ct.own[id]=(ct.own[id]||0)+1;
  if(typeof ctSoundOn==='undefined'||ctSoundOn){
    try{
      const a=getAudioCtx(),o=a.createOscillator(),g=a.createGain();
      o.type='triangle'; o.connect(g); g.connect(a.destination);
      o.frequency.setValueAtTime(500,a.currentTime);
      o.frequency.linearRampToValueAtTime(850,a.currentTime+0.1);
      g.gain.setValueAtTime(0.09,a.currentTime); g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+0.18);
      o.start(); o.stop(a.currentTime+0.18);
    }catch(e){}
  }
  // RP reward for buying (small trickle)
  ct.rp+=Math.max(1,Math.floor(Math.log10(ctCost(u))));
  ctUpdateQuests();
  ctSave(); ctRefresh();
}

// ── RESEARCH BUY ──────────────────────────────────────────
function ctDoResearch(resId,tierIdx){
  const res=CT_RES.find(r=>r.id===resId); if(!res) return;
  const current=ct.resLevel[resId]||0;
  if(tierIdx!==current) return; // must buy in order
  const tier=res.tiers[tierIdx]; if(!tier) return;
  if(ct.rp<tier.rp) return;
  ct.rp-=tier.rp; ct.resSpent=(ct.resSpent||0)+tier.rp;
  ct.resLevel[resId]=(ct.resLevel[resId]||0)+1;
  if(typeof ctSoundOn==='undefined'||ctSoundOn){
    try{
      const a=getAudioCtx();
      [600,800,1000].forEach((f,i)=>{
        const o=a.createOscillator(),g=a.createGain();
        o.type='triangle'; o.connect(g); g.connect(a.destination);
        o.frequency.value=f; g.gain.setValueAtTime(0.07,a.currentTime+i*0.07);
        g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+i*0.07+0.15);
        o.start(a.currentTime+i*0.07); o.stop(a.currentTime+i*0.07+0.15);
      });
    }catch(e){}
  }
  ctSave(); ctRefresh();
}

// ── PRESTIGE ──────────────────────────────────────────────
function ctPrestige(){
  const thresh=Math.pow(10,7+ct.pres);
  if(ct.te<thresh) return;
  // RP reward for prestige (big reward)
  const rpGain=10+ct.pres*5;
  ct.rp+=rpGain;
  ct.pres++; ct.mult=Math.pow(2,ct.pres);
  ct.frenzyCount=(ct.frenzyCount||0); // keep
  ct.goldenCaught=(ct.goldenCaught||0);
  ct.questsDone=(ct.questsDone||0);
  ct.spins=(ct.spins||0);
  ct.resSpent=(ct.resSpent||0);
  ct.c=0; ct.te=0; ct.own={};
  ctFloat('+'+rpGain+' RP','#c4b5fd');
  if(typeof ctSoundOn==='undefined'||ctSoundOn){
    try{
      const a=getAudioCtx();
      [300,450,600,750,1000,1400].forEach((f,i)=>{
        const o=a.createOscillator(),g=a.createGain();
        o.type='sine'; o.connect(g); g.connect(a.destination);
        o.frequency.value=f;
        g.gain.setValueAtTime(0.08,a.currentTime+i*0.06);
        g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+i*0.06+0.22);
        o.start(a.currentTime+i*0.06); o.stop(a.currentTime+i*0.06+0.22);
      });
    }catch(e){}
  }
  const btn=document.getElementById('ctCoinBtn');
  if(btn){ btn.style.filter='brightness(5) saturate(0)'; setTimeout(()=>btn.style.filter='',600); }
  if(typeof ctBurst==='function') ctBurst(60,['#a78bfa','#c4b5fd','#fff','#ffd600']);
  ctGenerateQuests();
  // Show new theme notification
  setTimeout(()=>{
    const themes=['🌆 City','🏰 Kingdom','🌲 Village','🏭 Industry'];
    const next=themes[ct.pres%4];
    let el=document.getElementById('ctBuildNotif');
    if(!el){ el=document.createElement('div'); el.id='ctBuildNotif'; el.className='ct-build-notif'; document.getElementById('panel-clicker').prepend(el); }
    el.innerHTML=`<span style="font-size:1.5rem">⭐ Prestige ${ct.pres}</span><div>New theme: ${next}</div><div style="color:#c4b5fd;font-size:0.7rem">×${ct.mult} multiplier forever!</div>`;
    el.style.display='block'; el.classList.add('ct-notif-pop');
    setTimeout(()=>{ el.classList.remove('ct-notif-pop'); el.style.display='none'; },4500);
  },300);
  ctSave(); ctRefresh();
}

// ── FORTUNE SPIN ──────────────────────────────────────────
const CT_SPIN_REWARDS = [
  {label:'×2 coins!',     weight:25, fn:()=>{ ct.c*=2; ct.te+=ct.c; ctFloat('DOUBLE!','#ffd600'); }},
  {label:'10 min income', weight:20, fn:()=>{ const g=ctCPS()*600; ct.c+=g; ct.te+=g; ctFloat('+'+ctF(g),'#00f5a0'); }},
  {label:'Click Frenzy!', weight:12, fn:()=>{ ct.frenzy=Date.now()+30000; ct.frenzyCount=(ct.frenzyCount||0)+1; }},
  {label:'+20 RP',        weight:18, fn:()=>{ ct.rp+=20; ctFloat('+20 RP','#c4b5fd'); }},
  {label:'+50 RP',        weight:8,  fn:()=>{ ct.rp+=50; ctFloat('+50 RP','#a78bfa'); }},
  {label:'×3 coins!',     weight:8,  fn:()=>{ ct.c*=3; ct.te+=ct.c*2; ctFloat('TRIPLE!','#ff9800'); }},
  {label:'1hr income!',   weight:5,  fn:()=>{ const g=ctCPS()*3600; ct.c+=g; ct.te+=g; ctFloat('+'+ctF(g),'#ffee58'); }},
  {label:'JACKPOT! ×10',  weight:4,  fn:()=>{ ct.c*=10; ct.te+=ct.c*9; if(typeof ctBurst==='function') ctBurst(80,['#ffd700','#ff9800','#fff','#ff6000']); ctFloat('JACKPOT!!','#ffd700'); }},
];
function ctSpin(){
  const now=Date.now();
  if(ct.spinCd>now) return;
  const total=CT_SPIN_REWARDS.reduce((a,r)=>a+r.weight,0);
  let r=Math.random()*total, chosen;
  for(const rw of CT_SPIN_REWARDS){ r-=rw.weight; if(r<=0){ chosen=rw; break; } }
  chosen=chosen||CT_SPIN_REWARDS[0];
  chosen.fn();
  ct.spins=(ct.spins||0)+1;
  ct.spinCd=now+ctSpinCdBase();
  const res=document.getElementById('ctSpinResult');
  if(res) res.textContent='🎉 '+chosen.label;
  if(typeof ctSoundOn==='undefined'||ctSoundOn){
    try{
      const a=getAudioCtx();
      [400,600,800,1000].forEach((f,i)=>{
        const o=a.createOscillator(),g=a.createGain();
        o.type='sine'; o.connect(g); g.connect(a.destination);
        o.frequency.value=f; g.gain.setValueAtTime(0.07,a.currentTime+i*0.08);
        g.gain.exponentialRampToValueAtTime(0.0001,a.currentTime+i*0.08+0.18);
        o.start(a.currentTime+i*0.08); o.stop(a.currentTime+i*0.08+0.18);
      });
    }catch(e){}
  }
  ctUpdateQuests();
  ctSave(); ctRefresh();
}

// ── GOLDEN COIN EVENT ─────────────────────────────────────
function ctScheduleGolden(){
  // Appears every 90–240 seconds
  ct.goldenNext=Date.now()+(90+Math.random()*150)*1000;
}
function ctCheckGolden(){
  const el=document.getElementById('ctGoldenCoin'); if(!el) return;
  const now=Date.now();
  if(ct.frenzy>now) return; // no golden during frenzy
  if(now>=ct.goldenNext && el.style.display==='none'){
    // Place at random spot within coin wrap
    const maxX=100, maxY=80;
    el.style.left=(20+Math.random()*maxX)+'%';
    el.style.top=(15+Math.random()*maxY)+'%';
    el.style.display='block';
    // Auto-disappear after 8s
    el._hideTimer=setTimeout(()=>{ el.style.display='none'; ctScheduleGolden(); },8000);
  }
}
function ctClickGolden(){
  const el=document.getElementById('ctGoldenCoin'); if(!el) return;
  clearTimeout(el._hideTimer);
  el.style.display='none';
  const base=Math.max(100, ctCPS()*60||1000);
  const reward=Math.floor(base*ctGoldBonus());
  ct.c+=reward; ct.te+=reward;
  ct.goldenCaught=(ct.goldenCaught||0)+1;
  ctFloat('🌟 '+ctF(reward),'#ffd700');
  if(typeof ctBurst==='function') ctBurst(40,['#ffd700','#ffee58','#fff9c4','#ff9800']);
  ctScheduleGolden();
  ctUpdateQuests();
  ctSave(); ctRefresh();
}

// ── QUESTS ────────────────────────────────────────────────
function ctGenerateQuests(){
  const now=Date.now();
  ct.questsLastRefresh=now;
  // Pick 3 random quests scaled to current game state
  const pool=[...CT_QUEST_POOL];
  ctShuffle(pool);
  ct.quests=pool.slice(0,3).map(tmpl=>{
    // Pick appropriate n based on game state
    const ns=tmpl.ns;
    let n=ns[0];
    if(ct.pres>8) n=ns[Math.min(3,ns.length-1)];
    else if(ct.pres>4) n=ns[Math.min(2,ns.length-1)];
    else if(ct.pres>1) n=ns[Math.min(1,ns.length-1)];
    const reward=Math.max(5,Math.floor(Math.log10(n+1)*3+ct.pres*2));
    const baseVal = tmpl.rel ? ctGetStat(tmpl.stat) : 0;
    return {
      id:tmpl.id+'_'+Date.now()+'_'+Math.random(),
      tmplId:tmpl.id, lbl:tmpl.lbl.replace('{n}',ctF(n)),
      stat:tmpl.stat, target:n, baseVal,
      current:0, reward, done:false, claimed:false
    };
  });
}
function ctGetStat(stat){
  if(stat==='tc') return ct.tc;
  if(stat==='te') return ct.te;
  if(stat==='owned') return ctOwned(ct);
  if(stat==='cps') return ctCPS();
  if(stat==='pres') return ct.pres;
  if(stat==='goldenCaught') return ct.goldenCaught||0;
  if(stat==='spins') return ct.spins||0;
  return 0;
}
function ctUpdateQuests(){
  if(!ct.quests||!ct.quests.length) return;
  let changed=false;
  ct.quests.forEach(q=>{
    if(q.done) return;
    const raw=ctGetStat(q.stat);
    const val=raw-q.baseVal;
    q.current=Math.min(q.target, q.stat==='cps'?raw:val);
    if(q.current>=q.target){ q.done=true; changed=true; }
  });
  if(changed) ctRefresh();
}
function ctClaimQuest(idx){
  const q=ct.quests[idx]; if(!q||!q.done||q.claimed) return;
  q.claimed=true; ct.rp+=q.reward;
  ct.questsDone=(ct.questsDone||0)+1;
  ctFloat('+'+q.reward+' RP','#c4b5fd');
  // Check if all claimed → generate new set after delay
  if(ct.quests.every(q2=>q2.claimed)) setTimeout(()=>{ ctGenerateQuests(); ctRefresh(); },1500);
  ctSave(); ctRefresh();
}
function ctShuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]; } }

// ── CLICK FRENZY CHECK ────────────────────────────────────
function ctCheckFrenzy(){
  const el=document.getElementById('ctFrenzyBanner'); if(!el) return;
  const now=Date.now();
  const on=now<ct.frenzy;
  el.style.display=on?'flex':'none';
  if(on){
    const sec=Math.ceil((ct.frenzy-now)/1000);
    const t=document.getElementById('ctFrenzyTimer'); if(t) t.textContent=sec;
  }
}
// Random frenzy trigger (every 5-10 min, 15% chance per minute)
let _ctFrenzyChk=0;
function ctMaybeTriggerFrenzy(){
  const now=Date.now();
  if(now-_ctFrenzyChk<60000) return;
  _ctFrenzyChk=now;
  if(ct.frenzy>now) return;
  if(Math.random()<0.15 && ctCPS()>0){
    ct.frenzy=now+30000;
    ct.frenzyCount=(ct.frenzyCount||0)+1;
    const el=document.getElementById('ctFrenzyBanner');
    if(el){ el.style.display='flex'; }
    ctFloat('⚡ FRENZY!','#ff9060');
    if(typeof ctBurst==='function') ctBurst(30,['#ff6000','#ff9800','#fff']);
    ctSave();
  }
}

// ── SAVE / LOAD ───────────────────────────────────────────
function ctSave(){
  try{
    localStorage.setItem('ct_v5',JSON.stringify({
      c:ct.c,te:ct.te,tc:ct.tc,pres:ct.pres,mult:ct.mult,own:ct.own,
      ms:[...ct.ms],rp:ct.rp,resLevel:ct.resLevel,resSpent:ct.resSpent||0,
      spinCd:ct.spinCd,spins:ct.spins||0,
      frenzy:ct.frenzy,frenzyCount:ct.frenzyCount||0,
      goldenCaught:ct.goldenCaught||0,goldenNext:ct.goldenNext||0,
      quests:ct.quests,questsDone:ct.questsDone||0,
      questsLastRefresh:ct.questsLastRefresh||0,
    }));
  }catch(e){}
}
function ctLoad(){
  try{
    // Try v5 first, then fall back to v4
    let raw=localStorage.getItem('ct_v5');
    let d;
    if(raw){ d=JSON.parse(raw); }
    else {
      const old=localStorage.getItem('ct_v4');
      if(old){ d=JSON.parse(old); }
    }
    if(!d) return;
    ct.c=d.c||0; ct.te=d.te||0; ct.tc=d.tc||0;
    ct.pres=d.pres||0; ct.mult=d.mult||1; ct.own=d.own||{};
    ct.ms=new Set(d.ms||[]);
    ct.rp=d.rp||0; ct.resLevel=d.resLevel||{}; ct.resSpent=d.resSpent||0;
    ct.spinCd=d.spinCd||0; ct.spins=d.spins||0;
    ct.frenzy=d.frenzy||0; ct.frenzyCount=d.frenzyCount||0;
    ct.goldenCaught=d.goldenCaught||0; ct.goldenNext=d.goldenNext||0;
    ct.quests=d.quests||[]; ct.questsDone=d.questsDone||0;
    ct.questsLastRefresh=d.questsLastRefresh||0;
  }catch(e){}
  if(!ct.goldenNext||ct.goldenNext<Date.now()) ctScheduleGolden();
  if(!ct.quests||ct.quests.length===0) ctGenerateQuests();
}

// ── PASSIVE TICK ─────────────────────────────────────────
function ctStartTick(){
  if(ct.iv) clearInterval(ct.iv);
  ct.iv=setInterval(()=>{
    if(curPanel!=='clicker') return;
    const cps=ctCPS();
    if(cps>0){ const g=cps/10; ct.c+=g; ct.te+=g; }
    // Tiny RP drip from active play
    if(ct.tick%600===0 && cps>0) ct.rp+=1;
    ct.tick++;
    if(ct.tick%2===0){
      ctUpdateQuests();
      ctCheckFrenzy();
      ctCheckGolden();
      ctMaybeTriggerFrenzy();
      ctRefresh();
    }
    if(ct.tick%100===0) ctSave();
  },100);
}

// ── SHOP WIRE-UP ──────────────────────────────────────────
(function wireCoinBtn(){
  const btn=document.getElementById('ctCoinBtn'); if(!btn) return;
  btn.setAttribute('tabindex','-1'); btn.removeAttribute('onclick');
  let _down=false;
  btn.addEventListener('pointerdown',e=>{ if(e.button!==undefined&&e.button!==0) return; e.preventDefault(); e.stopPropagation(); _down=true; ctDoClick(); });
  btn.addEventListener('pointerup',  e=>{ _down=false; });
  btn.addEventListener('touchend',   e=>{ e.preventDefault(); if(!_down){ ctDoClick(); } _down=false; },{passive:false});
  ['keydown','keyup','keypress'].forEach(ev=>btn.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();}));
})();

// Wire golden coin
(function(){
  const gc=document.getElementById('ctGoldenCoin'); if(!gc) return;
  gc.addEventListener('pointerdown',e=>{ e.preventDefault(); e.stopPropagation(); ctClickGolden(); });
  gc.addEventListener('touchend',e=>{ e.preventDefault(); ctClickGolden(); },{passive:false});
})();

// Wire fortune spin
(function(){
  const sb=document.getElementById('ctSpinBtn'); if(!sb) return;
  sb.addEventListener('pointerdown',e=>{ e.preventDefault(); e.stopPropagation(); ctSpin(); });
  sb.addEventListener('touchend',e=>{ e.preventDefault(); ctSpin(); },{passive:false});
  sb.addEventListener('keydown',e=>e.preventDefault());
})();

// Wire shop tab switching (3 tabs: Upgrades, Research, Stats)
(function(){
  const tu=document.getElementById('ctTabUpg');
  const tr=document.getElementById('ctTabRes');
  const ts=document.getElementById('ctTabStats');
  if(!tu) return;
  const upgl=document.getElementById('ctUpgradeList');
  const resl=document.getElementById('ctResearchList');
  const stsl=document.getElementById('ctStatsPanel');
  function showTab(tab){
    [tu,tr,ts].forEach(b=>b&&b.classList.remove('active'));
    if(tab==='upg'&&tu) tu.classList.add('active');
    if(tab==='res'&&tr) tr.classList.add('active');
    if(tab==='sta'&&ts) ts.classList.add('active');
    if(upgl) upgl.style.display=tab==='upg'?'flex':'none';
    if(resl) resl.style.display=tab==='res'?'flex':'none';
    if(stsl){ stsl.style.display=tab==='sta'?'flex':'none'; if(tab==='sta') ctRenderStats(); }
  }
  tu&&tu.addEventListener('pointerdown',e=>{e.preventDefault();showTab('upg');});
  tr&&tr.addEventListener('pointerdown',e=>{e.preventDefault();showTab('res');});
  ts&&ts.addEventListener('pointerdown',e=>{e.preventDefault();showTab('sta');});
  [tu,tr,ts].forEach(b=>b&&b.addEventListener('keydown',e=>e.preventDefault()));
})();

// ── RENDER SHOP ───────────────────────────────────────────
function ctRenderShop(){
  const list=document.getElementById('ctUpgradeList'); if(!list) return;
  if(list.children.length!==CT_UPG.length){
    list.innerHTML='';
    CT_UPG.forEach(u=>{
      const card=document.createElement('div');
      card.className='ct-upg'; card.dataset.cid=u.id; card.setAttribute('tabindex','-1');
      card.addEventListener('pointerdown',e=>{ e.preventDefault(); e.stopPropagation(); ctDoBuy(u.id); });
      card.addEventListener('touchend',   e=>{ e.preventDefault(); e.stopPropagation(); ctDoBuy(u.id); });
      card.addEventListener('keydown',    e=>{ e.preventDefault(); e.stopPropagation(); });
      list.appendChild(card);
    });
  }
  CT_UPG.forEach((u,i)=>{
    const card=list.children[i]; if(!card) return;
    const owned=ct.own[u.id]||0, cost=ctCost(u), afford=ct.c>=cost;
    const hidden=cost>ct.te*6+200&&owned===0;
    const key=owned+'|'+(afford?1:0)+'|'+(hidden?1:0);
    if(card.dataset.key===key) return;
    card.dataset.key=key;
    card.className='ct-upg'+(afford?' can-afford':'')+(hidden?' ct-hidden':'');
    const cps=(u.cps*ct.mult*ctPresBonus()*ctIdleBonus()).toFixed(2);
    const tot=(owned*u.cps*ct.mult*ctPresBonus()*ctIdleBonus()).toFixed(1);
    // Compact row: icon | name + info + owned-cps | cost
    const nameRow = u.name + (owned ? ` <span class="ct-owned-count">×${owned}</span>` : '');
    const subRow  = owned
      ? `<span class="ct-upg-total">${tot}/s</span>&nbsp;<span class="ct-upg-info">${u.info}</span>`
      : `<span class="ct-upg-info">${u.info}</span>`;
    card.innerHTML =
      `<div class="ct-upg-icon" style="pointer-events:none">${u.ico}</div>`+
      `<div class="ct-upg-body" style="pointer-events:none">`+
        `<div class="ct-upg-name">${nameRow}</div>`+
        `<div class="ct-upg-sub">${subRow}</div>`+
      `</div>`+
      `<div class="ct-upg-cost" style="pointer-events:none">`+
        `<div class="ct-cost-num ${afford?'yes':'no'}">🪙${ctF(cost)}</div>`+
        `<div class="ct-cost-cps">+${cps}/s</div>`+
      `</div>`;
  });
}

// ── RENDER RESEARCH ───────────────────────────────────────
function ctRenderResearch(){
  const list=document.getElementById('ctResearchList'); if(!list) return;
  if(list.children.length===CT_RES.length){
    // Just update affordability classes
    CT_RES.forEach((res,i)=>{
      const card=list.children[i]; if(!card) return;
      const lvl=ct.resLevel[res.id]||0;
      const key=lvl+'|'+ct.rp;
      if(card.dataset.key===key) return;
      card.dataset.key=key;
      // Update tier buttons
      res.tiers.forEach((_,ti)=>{
        const btn=card.querySelector(`.ct-res-tier[data-ti="${ti}"]`); if(!btn) return;
        const bought=lvl>ti, canBuy=lvl===ti&&ct.rp>=res.tiers[ti].rp, locked=lvl<ti;
        btn.className='ct-res-tier'+(bought?' bought':canBuy?' buyable':' locked');
      });
    });
    return;
  }
  list.innerHTML='';
  CT_RES.forEach((res,ri)=>{
    const card=document.createElement('div');
    card.className='ct-res-card';
    const tiersHTML=res.tiers.map((tier,ti)=>
      `<button class="ct-res-tier locked" data-ti="${ti}" tabindex="-1">${tier.label}<br><span style="font-size:0.62rem;opacity:0.8">${tier.rp} RP</span></button>`
    ).join('');
    card.innerHTML=
      `<div class="ct-res-name">${res.ico} ${res.name}</div>`+
      `<div class="ct-res-desc">${res.desc}</div>`+
      `<div class="ct-res-tiers">${tiersHTML}</div>`;
    // Wire tier buttons
    card.querySelectorAll('.ct-res-tier').forEach((btn,ti)=>{
      btn.addEventListener('pointerdown',e=>{
        e.preventDefault(); e.stopPropagation();
        ctDoResearch(res.id,ti);
      });
      btn.addEventListener('keydown',e=>e.preventDefault());
    });
    list.appendChild(card);
  });
  ctRenderResearch(); // do a render pass for affordability
}

// ── RENDER PASSIVE ────────────────────────────────────────
function ctRenderPassive(){
  const el=document.getElementById('ctAutoList'); if(!el) return;
  const active=CT_UPG.filter(u=>(ct.own[u.id]||0)>0);
  if(!active.length){ el.innerHTML='<span style="color:#444;font-size:0.78rem">Buy upgrades to earn passively</span>'; return; }
  el.innerHTML=active.map(u=>{
    const cps=((ct.own[u.id]||0)*u.cps*ct.mult*ctPresBonus()*ctIdleBonus()).toFixed(1);
    return `<div class="ct-auto-row"><span>${u.ico} ${u.name} ×${ct.own[u.id]}</span><b>${cps}/s</b></div>`;
  }).join('');
}

// ── RENDER MILESTONES ─────────────────────────────────────
function ctRenderMS(){
  const el=document.getElementById('ctMilestones'); if(!el) return;
  if(!el.children.length){
    CT_MS.forEach(m=>{
      const s=document.createElement('span');
      s.id='ctms-'+m.id; s.className='ct-badge';
      s.innerHTML=`<span>${m.ico}</span> ${m.lbl}`;
      el.appendChild(s);
    });
  }
  CT_MS.forEach(m=>{
    const b=document.getElementById('ctms-'+m.id); if(!b) return;
    const done=m.chk(ct);
    if(done&&!ct.ms.has(m.id)){ ct.ms.add(m.id); b.classList.add('earned','ct-pop'); setTimeout(()=>b.classList.remove('ct-pop'),400); }
    else if(done) b.classList.add('earned');
  });
}

// ── RENDER QUESTS ─────────────────────────────────────────
function ctRenderQuests(){
  const el=document.getElementById('ctQuestList'); if(!el) return;
  if(!ct.quests||!ct.quests.length){ el.innerHTML='<span style="color:#444;font-size:0.74rem">Loading quests…</span>'; return; }
  el.innerHTML=ct.quests.map((q,i)=>{
    const pct=Math.min(100,q.target>0?(q.current/q.target*100):0);
    if(q.claimed) return `<div class="ct-quest-item" style="opacity:0.4"><span style="font-size:0.9rem">✓</span><span style="flex:1">${q.lbl}</span><span class="ct-quest-done">+${q.reward}RP</span></div>`;
    if(q.done) return `<div class="ct-quest-item"><span style="font-size:0.9rem">🎉</span><span style="flex:1">${q.lbl}</span><button class="ct-quest-claim" data-qi="${i}">+${q.reward}RP</button></div>`;
    return `<div class="ct-quest-item"><span style="font-size:0.75rem;flex:1">${q.lbl}</span><div class="ct-quest-bar-bg"><div class="ct-quest-bar" style="width:${pct}%"></div></div><span style="font-size:0.65rem;color:#505078;min-width:32px;text-align:right">${pct>=100?'✓':Math.floor(pct)+'%'}</span></div>`;
  }).join('');
  el.querySelectorAll('.ct-quest-claim').forEach(btn=>{
    btn.addEventListener('pointerdown',e=>{ e.preventDefault(); ctClaimQuest(+btn.dataset.qi); });
  });
}

// ── RENDER SPIN TIMER ─────────────────────────────────────
function ctRenderSpin(){
  const btn=document.getElementById('ctSpinBtn');
  const cd=document.getElementById('ctSpinTimer');
  const now=Date.now();
  if(!btn||!cd) return;
  if(ct.spinCd>now){
    const sec=Math.ceil((ct.spinCd-now)/1000);
    const m=Math.floor(sec/60), s=sec%60;
    btn.disabled=true;
    cd.style.display='block';
    cd.textContent=`Next spin in ${m}:${String(s).padStart(2,'0')}`;
  } else {
    btn.disabled=false;
    cd.style.display='none';
  }
}

// ── PROGRESS BAR ─────────────────────────────────────────
function ctRenderProgress(){
  const thresh=Math.pow(10,7+ct.pres);
  const pct=Math.min(100,ct.te/thresh*100);
  const bar=document.getElementById('ctProgressBar');
  const goal=document.getElementById('ctPrestigeGoal');
  if(bar) bar.style.width=pct+'%';
  if(goal){
    if(ct.te>=thresh){ goal.textContent='Ready! ✓'; goal.style.color='#c4b5fd'; }
    else { goal.textContent=ctF(thresh-ct.te)+' to go'; goal.style.color='#555'; }
  }
}

// ── FULL REFRESH ─────────────────────────────────────────
function ctRefresh(){
  const g=id=>document.getElementById(id);
  if(!g('ctCoins')) return;
  g('ctCoins').textContent    =ctF(ct.c);
  g('ctPerClick').textContent =ctF(ctEPC());
  g('ctPerSec').textContent   =ctF(ctCPS())+'/s';
  g('ctPrestige').textContent ='×'+ct.mult;
  g('ctTotal').textContent    =ctF(ct.te);
  if(g('ctResearchPts')) g('ctResearchPts').textContent=ct.rp+' RP';
  if(g('ctClicks')) g('ctClicks').textContent=ctF(ct.tc);

  const thresh=Math.pow(10,7+ct.pres);
  const pb=g('ctPrestigeBtn');
  if(pb){
    const show=ct.te>=thresh;
    pb.style.display=show?'block':'none';
    if(show) pb.textContent=`⭐ PRESTIGE — Reset & Earn ×${Math.floor(ct.mult*2)} Forever (+${10+ct.pres*5}RP)`;
  }
  ctRenderProgress();
  ctRenderShop();
  ctRenderResearch();
  ctRenderPassive();
  ctRenderMS();
  ctRenderQuests();
  ctRenderSpin();
}

// Global keyguard for clicker panel
document.addEventListener('keydown',function ctKeyGuard(e){
  const panel=document.getElementById('panel-clicker');
  if(!panel||panel.style.display==='none') return;
  if(e.key==='Enter'||e.key===' '){ e.preventDefault(); e.stopImmediatePropagation(); }
},true);


// ══════════════════════════════════════════════════════════
//  CLICKER TYCOON — EXTRA FEATURES
//  • Combo Click system (rapid clicking = multiplier)
//  • Offline earnings (passive income while away)
//  • Weather Events (coin rain, golden hour, tax, etc.)
//  • Building milestone unlocks (visual + bonus)
//  • Stats tracker
// ══════════════════════════════════════════════════════════

// ── COMBO SYSTEM ─────────────────────────────────────────
let _ctCombo = 0, _ctComboTimer = null, _ctLastClickTs = 0;
const CT_COMBO_WINDOW = 600; // ms between clicks to chain combo
const CT_COMBO_MAX = 20;

function ctComboTick(){
  // Called on each click
  const now = Date.now();
  if(now - _ctLastClickTs < CT_COMBO_WINDOW){
    _ctCombo = Math.min(_ctCombo + 1, CT_COMBO_MAX);
  } else {
    _ctCombo = 1;
  }
  _ctLastClickTs = now;
  clearTimeout(_ctComboTimer);
  _ctComboTimer = setTimeout(()=>{ _ctCombo = 0; ctRenderCombo(); }, CT_COMBO_WINDOW + 100);
  ctRenderCombo();
}
function ctComboMult(){ return _ctCombo >= 10 ? 3 : _ctCombo >= 5 ? 2 : _ctCombo >= 3 ? 1.5 : 1; }
function ctRenderCombo(){
  const el = document.getElementById('ctComboDisplay'); if(!el) return;
  if(_ctCombo >= 3){
    el.style.display = 'block';
    const mult = ctComboMult();
    el.textContent = `${_ctCombo}× COMBO! ${mult>1?'(×'+mult+' coins)':''}`;
    el.style.color = _ctCombo >= 10 ? '#ff9800' : _ctCombo >= 5 ? '#ffd600' : '#00f5a0';
    el.style.textShadow = `0 0 12px ${_ctCombo>=10?'#ff9800':_ctCombo>=5?'#ffd600':'#00f5a0'}`;
  } else {
    el.style.display = 'none';
  }
}

// Patch ctDoClick to apply combo
const _origDoClick = ctDoClick;
window.ctDoClick = function(){
  ctComboTick();
  // Apply combo multiplier inside
  const origEPC = window.ctEPC;
  window.ctEPC = function(){ return Math.floor((origEPC||ctEPC).call(this) * ctComboMult()); };
  _origDoClick();
  window.ctEPC = origEPC;
};

// ── OFFLINE EARNINGS ─────────────────────────────────────
function ctApplyOffline(){
  try {
    const lastSave = parseInt(localStorage.getItem('ct_v5_ts') || '0');
    if(!lastSave) return;
    const elapsedSec = Math.min((Date.now() - lastSave) / 1000, 8 * 3600); // cap 8h
    if(elapsedSec < 30) return;
    const cps = ctCPS();
    if(cps <= 0) return;
    const earned = Math.floor(cps * elapsedSec * 0.3); // 30% efficiency offline
    if(earned <= 0) return;
    ct.c += earned; ct.te += earned;
    // Show notification
    setTimeout(()=>{
      const msg = document.getElementById('ctOfflineMsg');
      if(msg){
        msg.textContent = `⏰ While away: +${ctF(earned)} coins (${Math.floor(elapsedSec/60)}m offline)`;
        msg.style.display = 'block';
        setTimeout(()=>{ msg.style.display='none'; }, 6000);
      }
    }, 800);
  } catch(e){}
}
function ctSaveTimestamp(){
  try { localStorage.setItem('ct_v5_ts', Date.now().toString()); } catch(e){}
}
// Patch ctSave
const _origSave = ctSave;
window.ctSave = function(){
  _origSave(); ctSaveTimestamp();
};
setInterval(ctSaveTimestamp, 10000);

// ── WEATHER EVENTS ───────────────────────────────────────
const CT_WEATHER = [
  { id:'rain',    name:'🌧️ Coin Rain',      dur:45, desc:'+100% passive income',  color:'#60a8ff',
    apply:()=>{ ct._wMult=(ct._wMult||1)*2; },
    remove:()=>{ ct._wMult=Math.max(1,(ct._wMult||2)/2); } },
  { id:'golden',  name:'✨ Golden Hour',    dur:60, desc:'Golden coins ×5',        color:'#ffd700',
    apply:()=>{ ct._wGold=(ct._wGold||1)*5; },
    remove:()=>{ ct._wGold=Math.max(1,(ct._wGold||5)/5); } },
  { id:'frenzy2', name:'⚡ Mega Frenzy',   dur:20, desc:'Click power ×20!',       color:'#ff6030',
    apply:()=>{ ct._wClick=(ct._wClick||1)*20; },
    remove:()=>{ ct._wClick=Math.max(1,(ct._wClick||20)/20); } },
  { id:'tax',     name:'🏛️ Tax Collection', dur:30, desc:'-50% passive income',    color:'#ff6060',
    apply:()=>{ ct._wMult=(ct._wMult||1)*0.5; },
    remove:()=>{ ct._wMult=Math.min(1,(ct._wMult||0.5)/0.5)*((ct._wMult||1)<=0.5?2:1); ct._wMult=ct._wMult||1; } },
  { id:'rush',    name:'🚀 Market Rush',    dur:40, desc:'+50% all income',        color:'#80ff80',
    apply:()=>{ ct._wMult=(ct._wMult||1)*1.5; },
    remove:()=>{ ct._wMult=Math.max(1,(ct._wMult||1.5)/1.5); } },
];

let _ctActiveWeather = null, _ctWeatherEndTime = 0, _ctWeatherCheck = 0, _ctNextWeather = 0;

function ctWeatherCPSMult(){ return Math.max(0.1, ct._wMult||1); }
function ctWeatherClickMult(){ return ct._wClick||1; }
function ctWeatherGoldMult(){ return ct._wGold||1; }

function ctCheckWeather(){
  const now = Date.now();
  if(now < _ctNextWeather) return;
  _ctNextWeather = now + (120 + Math.random()*180)*1000; // 2-5 min between events

  if(_ctActiveWeather){ // end current event
    _ctActiveWeather.remove();
    _ctActiveWeather = null;
    ctHideWeather();
    return;
  }
  // Start new event (70% chance)
  if(Math.random() > 0.7) return;
  const ev = CT_WEATHER[Math.floor(Math.random()*CT_WEATHER.length)];
  _ctActiveWeather = ev;
  _ctWeatherEndTime = now + ev.dur * 1000;
  _ctNextWeather = _ctWeatherEndTime + 1000;
  ev.apply();
  ctShowWeather(ev);
}
function ctShowWeather(ev){
  let el = document.getElementById('ctWeatherBanner');
  if(!el){ el=document.createElement('div'); el.id='ctWeatherBanner'; el.className='ct-weather-banner'; document.getElementById('panel-clicker').prepend(el); }
  el.style.borderColor = ev.color+'66';
  el.style.color = ev.color;
  el.style.display = 'flex';
  el.innerHTML = `<span>${ev.name}</span><span style="opacity:0.7;font-size:0.72rem">${ev.desc}</span><span id="ctWeatherTimer">${ev.dur}s</span>`;
}
function ctHideWeather(){
  const el = document.getElementById('ctWeatherBanner');
  if(el) el.style.display = 'none';
}
function ctTickWeather(){
  if(!_ctActiveWeather) return;
  const rem = Math.ceil((_ctWeatherEndTime - Date.now())/1000);
  if(rem <= 0){
    _ctActiveWeather.remove(); _ctActiveWeather = null; ctHideWeather(); return;
  }
  const t = document.getElementById('ctWeatherTimer');
  if(t) t.textContent = rem+'s';
}

// Patch ctCPS to apply weather
const _origCPS = ctCPS;
window.ctCPS = function(){ return (_origCPS()||0) * ctWeatherCPSMult(); };

// Patch ctEPC to apply weather click mult
const _origEPC = ctEPC;
window.ctEPC = function(){ return Math.floor((_origEPC()||1) * ctWeatherClickMult()); };

// Patch ctGoldBonus
const _origGoldBonus = ctGoldBonus;
window.ctGoldBonus = function(){ return (_origGoldBonus()||1) * ctWeatherGoldMult(); };

// ── BUILDING MILESTONES (visual unlocks) ──────────────────
const CT_BUILD_MS = [
  { minH:20,  label:'🏗️ Foundation',  desc:'Your building breaks ground!',    rp:0  },
  { minH:60,  label:'🏢 Office Tower', desc:'First floors complete!',           rp:2  },
  { minH:130, label:'🏙️ Skyscraper',  desc:'Rising above the city!',           rp:5  },
  { minH:210, label:'🌆 Supertall',   desc:'You\'re in the clouds!',            rp:8  },
  { minH:310, label:'🚀 Megatower',   desc:'A monument to your empire!',        rp:15 },
  { minH:380, label:'🌌 Arcology',    desc:'An entire world in one building!',  rp:25 },
];
let _ctBuildMSReached = new Set();

function ctCheckBuildMS(currentH){
  CT_BUILD_MS.forEach(ms=>{
    if(currentH >= ms.minH && !_ctBuildMSReached.has(ms.minH)){
      _ctBuildMSReached.add(ms.minH);
      if(ms.rp>0) ct.rp += ms.rp;
      ctShowBuildNotif(ms);
    }
  });
}
function ctShowBuildNotif(ms){
  let el = document.getElementById('ctBuildNotif');
  if(!el){ el=document.createElement('div'); el.id='ctBuildNotif'; el.className='ct-build-notif'; document.getElementById('panel-clicker').prepend(el); }
  el.innerHTML = `<span style="font-size:1.4rem">${ms.label}</span><div>${ms.desc}</div>${ms.rp>0?`<div style="color:#c4b5fd;font-size:0.7rem">+${ms.rp} RP rewarded!</div>`:''}`;
  el.style.display = 'block';
  el.classList.add('ct-notif-pop');
  setTimeout(()=>{ el.classList.remove('ct-notif-pop'); el.style.display='none'; }, 4000);
}

// Hook into world canvas to check building milestones
const _origStartWorld = window.ctWorldStart;
window.ctWorldStart = function(){
  if(_origStartWorld) _origStartWorld();
};

// ── STATS TRACKER ─────────────────────────────────────────
const _ctSessionStart = Date.now();
let _ctSessionClicks = 0, _ctSessionEarned = 0;

const _origDoClick2 = window.ctDoClick;
window.ctDoClick = function(){
  _ctSessionClicks++; _ctSessionEarned += ctEPC();
  _origDoClick2();
};

function ctRenderStats(){
  const el = document.getElementById('ctStatsPanel'); if(!el) return;
  const sessionMin = Math.floor((Date.now()-_ctSessionStart)/60000);
  const cps = ctCPS();
  el.innerHTML =
    `<div class="ct-stat-row"><span>Session time</span><b>${sessionMin}m</b></div>`+
    `<div class="ct-stat-row"><span>Session clicks</span><b>${ctF(_ctSessionClicks)}</b></div>`+
    `<div class="ct-stat-row"><span>Session earned</span><b>${ctF(_ctSessionEarned)}</b></div>`+
    `<div class="ct-stat-row"><span>Total clicks ever</span><b>${ctF(ct.tc)}</b></div>`+
    `<div class="ct-stat-row"><span>Passive/sec</span><b>${ctF(cps)}</b></div>`+
    `<div class="ct-stat-row"><span>Passive/hour</span><b>${ctF(cps*3600)}</b></div>`+
    `<div class="ct-stat-row"><span>Prestige count</span><b>${ct.pres}</b></div>`+
    `<div class="ct-stat-row"><span>Research spent</span><b>${ct.resSpent||0} RP</b></div>`+
    `<div class="ct-stat-row"><span>Quests done</span><b>${ct.questsDone||0}</b></div>`+
    `<div class="ct-stat-row"><span>Golden caught</span><b>${ct.goldenCaught||0}</b></div>`;
}

// ── PATCH ctRefresh to include new renders ─────────────────
const _origRefresh = ctRefresh;
window.ctRefresh = function(){
  _origRefresh();
  ctRenderCombo();
  ctRenderStats();
};

// ── PATCH ctStartTick to include new ticks ─────────────────
const _origStartTick = ctStartTick;
window.ctStartTick = function(){
  _origStartTick();
  // Additional tick for weather + building MS check
  setInterval(()=>{
    if(curPanel!=='clicker') return;
    ctCheckWeather();
    ctTickWeather();
    const _th=typeof ctWorldTargetH!=='undefined'?ctWorldTargetH:0; if(_th>0) ctCheckBuildMS(_th);
  }, 1000);
};

// ── APPLY OFFLINE on load ─────────────────────────────────
setTimeout(ctApplyOffline, 300);

// ── WORLD CANVAS ENGINE  v5 — Living City ─────────────────
(function(){
  const WCV = document.getElementById('ctWorldCanvas');
  if(!WCV) return;
  const WCX = WCV.getContext('2d');

  // ── Building themes per prestige level (cycles every 4) ──
  // 0=Skyscraper city, 1=Medieval castle, 2=Forest village, 3=Industrial
  const THEMES = [
    { name:'City',     sky1:'#010108', sky2:'#030512', sky3:'#060a08', ground:'#1a1a20', road:'#222' },
    { name:'Castle',   sky1:'#06020a', sky2:'#120416', sky3:'#0a020a', ground:'#1a1208', road:'#2a1a08' },
    { name:'Village',  sky1:'#010a04', sky2:'#021208', sky3:'#010a02', ground:'#0a1e08', road:'#1a2a0a' },
    { name:'Factory',  sky1:'#080400', sky2:'#100800', sky3:'#060200', ground:'#181008', road:'#201408' },
  ];

  // Per-theme building specs (for each upgrade id)
  const BLDG = {
    // theme 0: City — modern towers
    0: {
      cursor:  { w:18, color:'#1a2a50', win:'#4080ff', roof:'flat',  label:'Office' },
      intern:  { w:22, color:'#1e3040', win:'#40a0e0', roof:'flat',  label:'Startup' },
      miner:   { w:26, color:'#2a1e10', win:'#d08040', roof:'flat',  label:'Depot' },
      factory: { w:32, color:'#201830', win:'#9060e0', roof:'flat',  label:'HQ' },
      bank:    { w:28, color:'#0e2820', win:'#40e0a0', roof:'point', label:'Bank' },
      lab:     { w:24, color:'#1a1040', win:'#8040ff', roof:'dome',  label:'Lab' },
      rocket:  { w:20, color:'#2a0808', win:'#ff4040', roof:'point', label:'Launch' },
      ai:      { w:30, color:'#081828', win:'#00f0ff', roof:'dome',  label:'AI Hub' },
      portal:  { w:36, color:'#180828', win:'#e040ff', roof:'spire', label:'Portal' },
      nexus:   { w:40, color:'#082028', win:'#00ffee', roof:'spire', label:'Nexus' },
      titan:   { w:44, color:'#1a1a1a', win:'#ffffff', roof:'flat',  label:'Titan' },
      omega:   { w:50, color:'#080818', win:'#ffffff', roof:'spire', label:'Omega' },
    },
    // theme 1: Castle — stone towers
    1: {
      cursor:  { w:20, color:'#2a2018', win:'#e08820', roof:'merlon', label:'Watchtower' },
      intern:  { w:26, color:'#281e14', win:'#f0a030', roof:'merlon', label:'Barracks' },
      miner:   { w:28, color:'#302010', win:'#c07030', roof:'merlon', label:'Mine' },
      factory: { w:34, color:'#242016', win:'#d09040', roof:'merlon', label:'Keep' },
      bank:    { w:30, color:'#2a1e10', win:'#e0b050', roof:'cone',   label:'Treasury' },
      lab:     { w:22, color:'#1a1830', win:'#8080ff', roof:'cone',   label:'Alchemy' },
      rocket:  { w:18, color:'#301010', win:'#ff4040', roof:'merlon', label:'Arsenal' },
      ai:      { w:32, color:'#101828', win:'#40e0ff', roof:'cone',   label:'Oracle' },
      portal:  { w:38, color:'#201020', win:'#e040ff', roof:'spire',  label:'Sanctum' },
      nexus:   { w:42, color:'#0a1820', win:'#40ffee', roof:'spire',  label:'Citadel' },
      titan:   { w:46, color:'#181214', win:'#fff0d0', roof:'merlon', label:'Fortress' },
      omega:   { w:52, color:'#0a0810', win:'#ffd700', roof:'spire',  label:'Cathedral' },
    },
    // theme 2: Village — cozy cottages & trees
    2: {
      cursor:  { w:22, color:'#2a1808', win:'#ffe080', roof:'gable', label:'Cottage' },
      intern:  { w:26, color:'#1e2808', win:'#80e040', roof:'gable', label:'Farm' },
      miner:   { w:24, color:'#2a1e08', win:'#f0a020', roof:'gable', label:'Mill' },
      factory: { w:30, color:'#1a2010', win:'#a0e860', roof:'gable', label:'Barn' },
      bank:    { w:28, color:'#1e1a08', win:'#ffd040', roof:'gable', label:'Inn' },
      lab:     { w:20, color:'#101a10', win:'#80ff80', roof:'gable', label:'Herbalist' },
      rocket:  { w:18, color:'#181008', win:'#ff8040', roof:'cone',  label:'Forge' },
      ai:      { w:34, color:'#0a180a', win:'#40ff80', roof:'gable', label:'Market' },
      portal:  { w:38, color:'#120a20', win:'#e040ff', roof:'spire', label:'Temple' },
      nexus:   { w:40, color:'#0a1408', win:'#c0ff80', roof:'spire', label:'Tree of Life' },
      titan:   { w:44, color:'#080e04', win:'#ffffff', roof:'gable', label:'Castle' },
      omega:   { w:48, color:'#041004', win:'#ffe0a0', roof:'spire', label:'World Tree' },
    },
    // theme 3: Industrial — chimneys, factories
    3: {
      cursor:  { w:20, color:'#181008', win:'#e08020', roof:'flat',    label:'Workshop' },
      intern:  { w:24, color:'#201008', win:'#ff8020', roof:'flat',    label:'Depot' },
      miner:   { w:28, color:'#1a1008', win:'#c06010', roof:'flat',    label:'Refinery' },
      factory: { w:36, color:'#161006', win:'#ff6010', roof:'chimney', label:'Factory' },
      bank:    { w:28, color:'#1a1206', win:'#ffa020', roof:'flat',    label:'Exchange' },
      lab:     { w:22, color:'#100a18', win:'#8060ff', roof:'flat',    label:'R&D' },
      rocket:  { w:20, color:'#180404', win:'#ff3030', roof:'chimney', label:'Smelter' },
      ai:      { w:30, color:'#08101a', win:'#20c0ff', roof:'flat',    label:'Control' },
      portal:  { w:38, color:'#180818', win:'#e020ff', roof:'chimney', label:'Power Plant' },
      nexus:   { w:40, color:'#0a1018', win:'#20ffee', roof:'chimney', label:'Mega Plant' },
      titan:   { w:44, color:'#101018', win:'#ffffff', roof:'flat',    label:'Complex' },
      omega:   { w:48, color:'#080808', win:'#ffd700', roof:'chimney', label:'Omega Core' },
    },
  };

  // ── State ──────────────────────────────────────────────
  let wW=900, wH=500, wRaf=null;
  let t=0;
  let stars=[], clouds=[];
  let sparks=[];
  let lastOwned={}, lastCheck=0;
  let lastPres=-1; // detect prestige changes
  let cityH=0, targetH=0; // overall city "level" drives building heights

  // Crane state
  let crane={ jibAng:-0.06, jibDir:1, trolleyT:0, hookLen:30, hookTarget:30, activeFrames:0 };

  // Theme derived from prestige
  function getThemeIdx(){ return (typeof ct!=='undefined'?ct.pres:0)%4; }
  function getTheme(){ return THEMES[getThemeIdx()]; }
  function getBldg(id){ return (BLDG[getThemeIdx()]||BLDG[0])[id]||BLDG[0].cursor; }

  // Per-upgrade contribution height
  const UPG_H = { cursor:2, intern:4, miner:7, factory:12, bank:18, lab:28, rocket:40, ai:60, portal:85, nexus:110, titan:145, omega:185 };

  function calcTarget(){
    let h=0;
    if(typeof CT_UPG==='undefined') return 0;
    CT_UPG.forEach(u=>{ h+=(ct.own[u.id]||0)*(UPG_H[u.id]||5); });
    return Math.min(h, 600);
  }

  // ── Init stars / clouds ────────────────────────────────
  function initStars(){
    stars=[];
    for(let i=0;i<130;i++) stars.push({
      x:Math.random()*wW, y:Math.random()*wH*0.72,
      r:Math.random()*1.5+0.2, ph:Math.random()*Math.PI*2, sp:0.003+Math.random()*0.007
    });
  }
  function initClouds(){
    clouds=[];
    for(let i=0;i<5;i++) clouds.push({
      x:Math.random()*wW, y:8+Math.random()*wH*0.2,
      w:60+Math.random()*90, h:14+Math.random()*18,
      spd:0.05+Math.random()*0.1, a:0.04+Math.random()*0.07
    });
  }

  function resize(){
    const p=WCV.parentElement; if(!p) return;
    const pr=p.getBoundingClientRect();
    const nW=Math.round(Math.max(200, pr.width||400));
    // CSS ile belirlenen yüksekliği oku (computed style)
    const cs=getComputedStyle(WCV);
    const cssH=parseFloat(cs.height)||0;
    const nH=Math.round(Math.max(180, cssH>10?cssH:500));
    if(nW===wW&&nH===wH) return;
    wW=nW; wH=nH; WCV.width=wW; WCV.height=wH;
    initStars(); initClouds();
  }

  function spawnSparks(x,y,col){
    for(let i=0;i<18;i++){
      const a=Math.random()*Math.PI*2, s=1.5+Math.random()*4;
      sparks.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s-1.5,
        life:1, dec:0.025+Math.random()*0.03, r:1.5+Math.random()*3, col:col||'#ffd700'});
    }
  }

  function checkOwned(){
    let changed=false;
    if(typeof CT_UPG==='undefined') return;
    CT_UPG.forEach(u=>{
      const n=ct.own[u.id]||0;
      if((lastOwned[u.id]||0)!==n){ changed=true; lastOwned[u.id]=n; }
    });
    // Prestige reset detection
    const pres=ct.pres||0;
    if(lastPres!==-1 && pres!==lastPres){
      // Prestige happened! reset city height animation
      cityH=0; crane.activeFrames=300;
      spawnSparks(wW*0.5, wH*0.4, '#c4b5fd');
    }
    lastPres=pres;
    if(changed){
      targetH=calcTarget();
      crane.activeFrames=220;
      spawnSparks(wW*0.5+(Math.random()-0.5)*80, wH-80, getBldg('cursor').win||'#ffd700');
    }
  }

  // ── DRAW BACKGROUND ───────────────────────────────────
  function drawBg(){
    const th=getTheme();
    const bg=WCX.createLinearGradient(0,0,0,wH);
    bg.addColorStop(0, th.sky1);
    bg.addColorStop(0.5,th.sky2);
    bg.addColorStop(1, th.sky3);
    WCX.fillStyle=bg; WCX.fillRect(0,0,wW,wH);

    // Moon / Sun depending on theme
    const mx=wW*0.8, my=wH*0.08;
    if(getThemeIdx()===2){ // village: warm sun
      const sg=WCX.createRadialGradient(mx,my,0,mx,my,28);
      sg.addColorStop(0,'rgba(255,240,150,0.9)'); sg.addColorStop(0.5,'rgba(255,200,80,0.3)'); sg.addColorStop(1,'transparent');
      WCX.fillStyle=sg; WCX.beginPath(); WCX.arc(mx,my,28,0,Math.PI*2); WCX.fill();
      WCX.fillStyle='rgba(255,240,150,0.95)'; WCX.beginPath(); WCX.arc(mx,my,12,0,Math.PI*2); WCX.fill();
    } else {
      // Moon
      const mg=WCX.createRadialGradient(mx,my,0,mx,my,28);
      mg.addColorStop(0,'rgba(255,252,220,0.18)'); mg.addColorStop(1,'transparent');
      WCX.fillStyle=mg; WCX.beginPath(); WCX.arc(mx,my,28,0,Math.PI*2); WCX.fill();
      WCX.fillStyle='rgba(255,252,215,0.92)'; WCX.shadowColor='rgba(255,248,200,0.5)'; WCX.shadowBlur=14;
      WCX.beginPath(); WCX.arc(mx,my,11,0,Math.PI*2); WCX.fill(); WCX.shadowBlur=0;
    }

    // Stars (skip for village daytime)
    if(getThemeIdx()!==2){
      stars.forEach(s=>{
        const a=Math.max(0,0.25+Math.sin(t*s.sp+s.ph)*0.55);
        WCX.globalAlpha=a; WCX.fillStyle='#fff';
        WCX.beginPath(); WCX.arc(s.x,s.y,s.r,0,Math.PI*2); WCX.fill();
      });
      WCX.globalAlpha=1;
    } else {
      // Birds for village
      for(let i=0;i<3;i++){
        const bx=(t*0.3+i*300)%wW, by=wH*0.15+i*20+Math.sin(t*0.04+i)*8;
        WCX.strokeStyle='rgba(0,0,0,0.4)'; WCX.lineWidth=1.2;
        WCX.beginPath(); WCX.arc(bx,by,5,Math.PI,0,false); WCX.stroke();
        WCX.beginPath(); WCX.arc(bx+10,by,5,Math.PI,0,false); WCX.stroke();
      }
    }

    // Clouds
    clouds.forEach(cl=>{
      cl.x+=cl.spd; if(cl.x>wW+cl.w) cl.x=-cl.w;
      WCX.save(); WCX.globalAlpha=cl.a;
      WCX.fillStyle=getThemeIdx()===2?'#fffde8':'#b0c8ff';
      WCX.beginPath(); WCX.ellipse(cl.x,cl.y,cl.w*0.5,cl.h*0.5,0,0,Math.PI*2); WCX.fill();
      WCX.beginPath(); WCX.ellipse(cl.x-cl.w*0.25,cl.y+4,cl.w*0.3,cl.h*0.38,0,0,Math.PI*2); WCX.fill();
      WCX.beginPath(); WCX.ellipse(cl.x+cl.w*0.22,cl.y+5,cl.w*0.24,cl.h*0.32,0,0,Math.PI*2); WCX.fill();
      WCX.restore();
    });
  }

  // ── DRAW GROUND ────────────────────────────────────────
  function drawGround(){
    const th=getTheme();
    const gy=wH-14;
    const gg=WCX.createLinearGradient(0,gy,0,wH);
    gg.addColorStop(0,th.ground); gg.addColorStop(1,'#050505');
    WCX.fillStyle=gg; WCX.fillRect(0,gy,wW,wH-gy);

    // Road / path
    const rg=WCX.createLinearGradient(0,wH-14,0,wH);
    const thIdx=getThemeIdx();
    if(thIdx===2){ // village: dirt path
      rg.addColorStop(0,'#3a2a10'); rg.addColorStop(1,'#201408');
    } else if(thIdx===1){ // castle: stone path
      rg.addColorStop(0,'#302820'); rg.addColorStop(1,'#181410');
    } else if(thIdx===3){ // industrial: concrete
      rg.addColorStop(0,'#282018'); rg.addColorStop(1,'#181008');
    } else { // city: asphalt
      rg.addColorStop(0,'#1e1e22'); rg.addColorStop(1,'#101012');
    }
    WCX.fillStyle=rg; WCX.fillRect(0,wH-14,wW,14);

    // Ground reflection glow
    WCX.save(); WCX.globalAlpha=0.22;
    const dom=getDomBldg();
    const rfl=WCX.createLinearGradient(0,0,wW,0);
    rfl.addColorStop(0,'transparent'); rfl.addColorStop(0.5,dom.win); rfl.addColorStop(1,'transparent');
    WCX.fillStyle=rfl; WCX.fillRect(0,wH-14,wW,4);
    WCX.restore();
  }

  // Get dominant building spec (most owned high-tier)
  function getDomBldg(){
    let best=0, dom=getBldg('cursor');
    if(typeof CT_UPG==='undefined') return dom;
    CT_UPG.forEach(u=>{
      const s=(ct.own[u.id]||0)*(UPG_H[u.id]||5);
      if(s>best){ best=s; dom=getBldg(u.id); }
    });
    return dom;
  }

  // ── DRAW A SINGLE BUILDING ────────────────────────────
  function drawSingleBuilding(spec, bX, bH, bW, bBot, owned, idx){
    if(bH<4) return;
    const bTop=bBot-bH;
    const thIdx=getThemeIdx();

    WCX.save();

    // Atmospheric base glow
    WCX.shadowColor=spec.win; WCX.shadowBlur=0;
    WCX.globalAlpha=0.15;
    WCX.fillStyle=spec.win;
    WCX.beginPath(); WCX.ellipse(bX+bW/2,bBot,bW*0.7,10,0,0,Math.PI*2); WCX.fill();
    WCX.globalAlpha=1;

    // ── BUILDING BODY ──
    const bodyG=WCX.createLinearGradient(bX,bTop,bX+bW,bBot);
    bodyG.addColorStop(0, spec.color+'ff');
    bodyG.addColorStop(0.3, spec.color+'ee');
    bodyG.addColorStop(0.7, spec.color+'cc');
    bodyG.addColorStop(1, '#06060c');
    WCX.shadowColor=spec.win; WCX.shadowBlur=12;
    WCX.fillStyle=bodyG;
    WCX.fillRect(bX,bTop,bW,bH);
    WCX.shadowBlur=0;

    // ── SIDE DEPTH ──
    WCX.fillStyle='rgba(0,0,0,0.35)';
    WCX.fillRect(bX+bW,bTop,3,bH);
    WCX.fillStyle='rgba(255,255,255,0.04)';
    WCX.fillRect(bX,bTop,3,bH);

    // ── WINDOWS ──
    WCX.save();
    WCX.beginPath(); WCX.rect(bX+2,bTop,bW-4,bH); WCX.clip();
    const flH=thIdx===2?16:14; // village: taller floors
    const wCols=Math.max(2,Math.floor((bW-8)/12));
    const wRows=Math.max(1,Math.floor(bH/flH));
    for(let row=0;row<wRows;row++){
      for(let col=0;col<wCols;col++){
        const wx=bX+4+col*((bW-8)/Math.max(1,wCols-1));
        const wy=bBot-flH*(row+1)+3;
        const seed=(row*43+col*17+idx*7)%11;
        const lit=seed<7;
        const flicker=lit?(0.55+Math.sin(t*0.03+row*col*0.5+idx)*0.2):0.06;
        WCX.globalAlpha=flicker;
        if(lit){ WCX.fillStyle=spec.win; WCX.shadowColor=spec.win; WCX.shadowBlur=5; }
        else    { WCX.fillStyle='#0c0c22'; WCX.shadowBlur=0; }
        if(thIdx===2){ // village: arched windows
          WCX.fillRect(wx-3,wy,6,flH-5);
          WCX.beginPath(); WCX.arc(wx,wy,3,Math.PI,0); WCX.fill();
        } else {
          WCX.fillRect(wx-3,wy,6,flH-5);
        }
        WCX.shadowBlur=0;
      }
    }
    WCX.globalAlpha=1;
    WCX.restore();

    // ── ROOF by type ──
    WCX.shadowColor=spec.win; WCX.shadowBlur=10;
    if(spec.roof==='flat'){
      WCX.strokeStyle=spec.win+'cc'; WCX.lineWidth=2;
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW,bTop); WCX.stroke();
      // Rooftop details
      WCX.fillStyle=spec.win+'66';
      WCX.fillRect(bX+bW*0.2,bTop-3,bW*0.6,3);
    }
    else if(spec.roof==='point'||spec.roof==='spire'){
      const sH=spec.roof==='spire'?bW*0.7:bW*0.45;
      WCX.fillStyle=spec.color;
      WCX.beginPath();
      WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW,bTop); WCX.lineTo(bX+bW/2,bTop-sH); WCX.closePath();
      WCX.shadowBlur=16; WCX.fill();
      WCX.strokeStyle=spec.win+'aa'; WCX.lineWidth=1.5;
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW/2,bTop-sH); WCX.lineTo(bX+bW,bTop); WCX.stroke();
      if(spec.roof==='spire'){
        // Blinking beacon
        const blink=Math.sin(t*0.05)>0;
        WCX.fillStyle=blink?'#ff2020':'#660000';
        WCX.shadowColor=blink?'#ff2020':'transparent'; WCX.shadowBlur=blink?14:0;
        WCX.beginPath(); WCX.arc(bX+bW/2,bTop-sH,3.5,0,Math.PI*2); WCX.fill();
      }
    }
    else if(spec.roof==='dome'){
      WCX.fillStyle=spec.color;
      WCX.beginPath(); WCX.ellipse(bX+bW/2,bTop,bW/2,bW*0.3,0,Math.PI,0); WCX.fill();
      WCX.strokeStyle=spec.win+'88'; WCX.lineWidth=1.5;
      WCX.beginPath(); WCX.ellipse(bX+bW/2,bTop,bW/2,bW*0.3,0,Math.PI,0); WCX.stroke();
    }
    else if(spec.roof==='merlon'){
      // Castle battlement
      const mW=Math.max(4,Math.floor(bW/6)), mH=7, mN=Math.floor(bW/mW/2);
      WCX.fillStyle=spec.color;
      for(let m=0;m<=mN;m++){
        const mx=bX+m*(bW/(mN));
        WCX.fillRect(mx,bTop-mH,mW,mH);
      }
      WCX.strokeStyle=spec.win+'88'; WCX.lineWidth=1;
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW,bTop); WCX.stroke();
    }
    else if(spec.roof==='gable'){
      // House roof triangle
      const rH=bW*0.45;
      WCX.fillStyle=thIdx===2?'#5a1a10':'#3a2010';
      WCX.beginPath(); WCX.moveTo(bX-4,bTop); WCX.lineTo(bX+bW/2,bTop-rH); WCX.lineTo(bX+bW+4,bTop); WCX.closePath(); WCX.fill();
      WCX.strokeStyle='#80300888'; WCX.lineWidth=1.5; WCX.beginPath();
      WCX.moveTo(bX-4,bTop); WCX.lineTo(bX+bW/2,bTop-rH); WCX.lineTo(bX+bW+4,bTop); WCX.stroke();
      // Chimney
      if(owned>2){
        WCX.fillStyle='#3a2010'; WCX.fillRect(bX+bW*0.65,bTop-rH+4,6,rH*0.6);
        const smk=Math.sin(t*0.04)*2;
        WCX.fillStyle='rgba(180,180,180,0.18)';
        WCX.beginPath(); WCX.ellipse(bX+bW*0.65+3,bTop-rH-8+smk,5,3,0,0,Math.PI*2); WCX.fill();
      }
    }
    else if(spec.roof==='cone'){
      const cH=bW*0.6;
      WCX.fillStyle=thIdx===1?'#600808':'#2a0a40';
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW/2,bTop-cH); WCX.lineTo(bX+bW,bTop); WCX.closePath(); WCX.fill();
      WCX.strokeStyle=spec.win+'66'; WCX.lineWidth=1.5;
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW/2,bTop-cH); WCX.lineTo(bX+bW,bTop); WCX.stroke();
    }
    else if(spec.roof==='chimney'){
      // Industrial: flat + chimneys
      WCX.strokeStyle=spec.win+'aa'; WCX.lineWidth=2;
      WCX.beginPath(); WCX.moveTo(bX,bTop); WCX.lineTo(bX+bW,bTop); WCX.stroke();
      // Chimneys
      const nC=Math.min(3,1+Math.floor(owned/5));
      for(let ci=0;ci<nC;ci++){
        const cx=bX+bW*(ci+1)/(nC+1);
        WCX.fillStyle='#2a1808';
        WCX.fillRect(cx-4,bTop-22,8,22);
        WCX.strokeStyle='#3a2010'; WCX.lineWidth=1;
        WCX.strokeRect(cx-4,bTop-22,8,22);
        // Smoke
        const phase=t*0.02+ci*2;
        WCX.globalAlpha=0.18+Math.sin(phase)*0.08;
        WCX.fillStyle='rgba(150,120,100,0.8)';
        WCX.beginPath(); WCX.arc(cx+Math.sin(phase)*3,bTop-30+Math.sin(phase)*2,6,0,Math.PI*2); WCX.fill();
        WCX.beginPath(); WCX.arc(cx+Math.sin(phase+1)*5,bTop-42+Math.sin(phase+1)*3,8,0,Math.PI*2); WCX.fill();
        WCX.globalAlpha=1;
      }
    }
    WCX.shadowBlur=0;
    WCX.restore();
  }

  // ── LAYOUT: decide which buildings to show & positions ─
  function getBuildingLayout(){
    if(typeof CT_UPG==='undefined') return [];
    const groundY=wH-14;
    const buildings=[];
    const thIdx=getThemeIdx();
    const spacing=thIdx===2?8:6; // village: more spacing

    // Gather owned upgrades
    const owned=CT_UPG.filter(u=>(ct.own[u.id]||0)>0);
    if(!owned.length) return [];

    // Scale factor so all buildings fit
    const totalW=owned.reduce((s,u)=>{ const b=getBldg(u.id); return s+b.w+spacing; },0);
    const availW=wW*0.88;
    const scale=Math.min(1, availW/Math.max(1,totalW));

    // Heights: each unit of "h" corresponds to about 1.5px per owned
    // But cap at 90% of canvas height
    const maxH=wH*0.78;

    let curX=wW*0.06; // start from left with margin
    owned.forEach((u,i)=>{
      const b=getBldg(u.id);
      const cnt=ct.own[u.id]||0;
      const bW=Math.round(b.w*scale);
      const raw_h=cnt*(UPG_H[u.id]||5)*0.8;
      const bH=Math.min(maxH, Math.max(16, raw_h));
      buildings.push({ spec:b, bX:curX, bW, bH, bBot:groundY, owned:cnt, id:u.id, idx:i });
      curX+=bW+Math.round(spacing*scale);
    });

    return buildings;
  }

  // ── DRAW ALL BUILDINGS ────────────────────────────────
  function drawBuildings(){
    const layout=getBuildingLayout();
    layout.forEach(b=>{ drawSingleBuilding(b.spec,b.bX,b.bH,b.bW,b.bBot,b.owned,b.idx); });
    return layout;
  }

  // ── DRAW CRANE (correct: jib tip over tallest building) ─
  function drawCrane(layout){
    if(!layout||!layout.length) return;
    // Find tallest building
    let tallest=layout.reduce((a,b)=>b.bH>a.bH?b:a,layout[0]);

    // Crane base: right of tallest building
    const craneX=tallest.bX+tallest.bW+8;
    const groundY=tallest.bBot;

    const clearance=10;
    const roofY=tallest.bBot-tallest.bH;
    const mastH=Math.max(18, (groundY-roofY)+clearance);
    if(mastH<14) return;
    if(craneX>wW-10) return; // no room

    const mastTopY=groundY-mastH;
    const mL=craneX-3.5, mR=craneX+3.5;

    // Jib points LEFT toward tallest building top center
    const jibTipX=tallest.bX+tallest.bW*0.5;
    const jibLen=Math.max(16, craneX-jibTipX);

    if(crane.activeFrames>0){ crane.activeFrames--; }
    if(crane.activeFrames>0){
      crane.jibAng+=0.005*crane.jibDir;
      if(crane.jibAng>0.07||crane.jibAng<-0.07) crane.jibDir*=-1;
      crane.trolleyT+=0.01;
      crane.hookTarget=20+Math.sin(crane.trolleyT*0.5)*16;
    }
    crane.hookLen+=(crane.hookTarget-crane.hookLen)*0.04;

    WCX.save();
    // Footing
    WCX.fillStyle='#44445a'; WCX.fillRect(mL-4,groundY,15,6);
    WCX.strokeStyle='#666680'; WCX.lineWidth=1; WCX.strokeRect(mL-4,groundY,15,6);

    // Mast fill + chords
    WCX.fillStyle='#2e2e48'; WCX.fillRect(mL,mastTopY,7,mastH);
    WCX.strokeStyle='#7878b8'; WCX.lineWidth=2.5;
    WCX.beginPath(); WCX.moveTo(mL,groundY); WCX.lineTo(mL,mastTopY); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(mR,groundY); WCX.lineTo(mR,mastTopY); WCX.stroke();
    // Braces
    const nBr=Math.max(3,Math.floor(mastH/10));
    const bSt=mastH/nBr;
    WCX.strokeStyle='#5858a0'; WCX.lineWidth=1.2;
    for(let i=0;i<nBr;i++){
      const y1=groundY-i*bSt, y2=groundY-(i+1)*bSt;
      WCX.beginPath();
      if(i%2===0){ WCX.moveTo(mL,y1); WCX.lineTo(mR,y2); } else { WCX.moveTo(mR,y1); WCX.lineTo(mL,y2); }
      WCX.stroke();
    }
    // Cap + cabin
    WCX.fillStyle='#6060a0';
    WCX.beginPath(); WCX.moveTo(craneX,mastTopY-9); WCX.lineTo(mL-2,mastTopY+2); WCX.lineTo(mR+2,mastTopY+2); WCX.closePath(); WCX.fill();
    WCX.fillStyle='#1a3a90'; WCX.fillRect(mL-8,mastTopY+2,9,10);
    WCX.fillStyle='rgba(100,200,255,0.5)'; WCX.fillRect(mL-7,mastTopY+3,3,4); WCX.fillRect(mL-3,mastTopY+3,2.5,4);

    // Jib
    WCX.save();
    WCX.translate(craneX,mastTopY);
    WCX.rotate(crane.jibAng);
    WCX.strokeStyle='#7878b8'; WCX.lineWidth=2.8;
    WCX.beginPath(); WCX.moveTo(0,-3); WCX.lineTo(-jibLen,-3); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(0, 3); WCX.lineTo(-jibLen, 3); WCX.stroke();
    const nS=Math.max(3,Math.floor(jibLen/14));
    WCX.strokeStyle='#5858a0'; WCX.lineWidth=1.1;
    for(let i=1;i<=nS;i++){ const x=-jibLen*i/nS; WCX.beginPath(); WCX.moveTo(x,-3); WCX.lineTo(x,3); WCX.stroke(); }
    WCX.lineWidth=0.9;
    for(let i=0;i<nS;i++){ const x1=-jibLen*i/nS, x2=-jibLen*(i+1)/nS; WCX.beginPath(); WCX.moveTo(x1,-3); WCX.lineTo(x2,3); WCX.stroke(); }
    WCX.fillStyle='#8888c0'; WCX.fillRect(-jibLen-3,-4,6,8);
    // King post + stays
    WCX.strokeStyle='#9090c0'; WCX.lineWidth=1.8;
    WCX.beginPath(); WCX.moveTo(0,3); WCX.lineTo(0,-16); WCX.stroke();
    WCX.strokeStyle='#aaaacc44'; WCX.lineWidth=1.1;
    WCX.beginPath(); WCX.moveTo(0,-16); WCX.lineTo(-jibLen*0.45,-3); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(0,-16); WCX.lineTo(-jibLen,-3); WCX.stroke();
    // Trolley
    const tx=-jibLen*(0.28+Math.sin(crane.trolleyT)*0.22);
    WCX.fillStyle='#cc9933'; WCX.fillRect(tx-5,3,10,6);
    WCX.fillStyle='#1a1a38';
    WCX.beginPath(); WCX.arc(tx-2.5,3,1.8,0,Math.PI*2); WCX.fill();
    WCX.beginPath(); WCX.arc(tx+2.5,3,1.8,0,Math.PI*2); WCX.fill();
    // Hook rope + J-hook
    WCX.strokeStyle='#ccccee'; WCX.lineWidth=1.3;
    WCX.beginPath(); WCX.moveTo(tx,9); WCX.lineTo(tx,9+crane.hookLen); WCX.stroke();
    const hx=tx, hy=9+crane.hookLen;
    WCX.strokeStyle='#ddddff'; WCX.lineWidth=2.0; WCX.lineCap='round';
    WCX.beginPath(); WCX.moveTo(hx,hy-2); WCX.lineTo(hx,hy+5); WCX.arc(hx+3,hy+5,3,Math.PI,0,false); WCX.stroke();
    WCX.lineCap='butt';
    // Counter-jib
    WCX.restore();
    WCX.save();
    WCX.translate(craneX,mastTopY);
    WCX.rotate(crane.jibAng+Math.PI);
    const backLen=jibLen*0.28;
    WCX.strokeStyle='#6868a0'; WCX.lineWidth=2.2;
    WCX.beginPath(); WCX.moveTo(0,-2); WCX.lineTo(-backLen,-2); WCX.stroke();
    WCX.beginPath(); WCX.moveTo(0, 2); WCX.lineTo(-backLen, 2); WCX.stroke();
    WCX.fillStyle='#404060'; WCX.fillRect(-backLen-8,-7,18,12);
    WCX.restore();

    WCX.restore();
  }

  // ── DRAW SCENE DECORATIONS ────────────────────────────
  function drawDecorations(layout){
    const thIdx=getThemeIdx();
    const groundY=wH-14;

    // Village: trees between buildings
    if(thIdx===2){
      layout.forEach((b,i)=>{
        if(i===layout.length-1) return;
        const tx=b.bX+b.bW+4;
        const tH=20+Math.random()*10; // deterministic via i
        const seedH=16+((i*17)%12);
        WCX.save();
        WCX.fillStyle='#1a3008';
        WCX.fillRect(tx+2,groundY-seedH,4,seedH);
        WCX.fillStyle='#2a5010';
        WCX.beginPath(); WCX.arc(tx+4,groundY-seedH,10,0,Math.PI*2); WCX.fill();
        WCX.fillStyle='#3a6820';
        WCX.beginPath(); WCX.arc(tx+4,groundY-seedH-6,7,0,Math.PI*2); WCX.fill();
        WCX.restore();
      });
    }

    // City: street lights
    if(thIdx===0){
      layout.forEach((b,i)=>{
        if(i%2!==0) return;
        const lx=b.bX-6, ly=groundY-30;
        WCX.save();
        WCX.strokeStyle='#3a3a50'; WCX.lineWidth=1.5;
        WCX.beginPath(); WCX.moveTo(lx,groundY); WCX.lineTo(lx,ly); WCX.stroke();
        WCX.beginPath(); WCX.moveTo(lx,ly); WCX.lineTo(lx+8,ly-4); WCX.stroke();
        WCX.fillStyle='rgba(255,240,150,0.8)';
        WCX.shadowColor='rgba(255,240,150,0.9)'; WCX.shadowBlur=10;
        WCX.beginPath(); WCX.arc(lx+8,ly-4,2.5,0,Math.PI*2); WCX.fill();
        WCX.restore();
      });
    }

    // Industrial: ground pipes
    if(thIdx===3){
      WCX.save();
      WCX.strokeStyle='#3a2808'; WCX.lineWidth=6;
      WCX.beginPath(); WCX.moveTo(0,groundY-4); WCX.lineTo(wW,groundY-4); WCX.stroke();
      WCX.strokeStyle='#4a3010'; WCX.lineWidth=2;
      WCX.beginPath(); WCX.moveTo(0,groundY-4); WCX.lineTo(wW,groundY-4); WCX.stroke();
      WCX.restore();
    }

    // Castle: banner flags
    if(thIdx===1){
      layout.filter(b=>b.bH>60).forEach(b=>{
        const fx=b.bX+b.bW*0.5, fy=b.bBot-b.bH-14;
        const wave=Math.sin(t*0.06)*6;
        WCX.save();
        WCX.strokeStyle='#8a6020'; WCX.lineWidth=1.5;
        WCX.beginPath(); WCX.moveTo(fx,fy); WCX.lineTo(fx,fy-20); WCX.stroke();
        WCX.fillStyle='#cc2020';
        WCX.beginPath(); WCX.moveTo(fx,fy-20); WCX.lineTo(fx+14+wave,fy-15); WCX.lineTo(fx,fy-10); WCX.closePath(); WCX.fill();
        WCX.restore();
      });
    }
  }

  // ── LABELS ─────────────────────────────────────────────
  function drawLabels(layout){
    const thIdx=getThemeIdx();
    const themeNames=['🌆 City','🏰 Kingdom','🌲 Village','🏭 Industry'];
    WCX.save();
    WCX.textAlign='center'; WCX.textBaseline='middle';
    WCX.shadowColor='rgba(255,220,60,1)'; WCX.shadowBlur=20;
    WCX.fillStyle='rgba(255,235,100,1)';
    WCX.font=`bold ${Math.max(11,wW*0.032)}px "Bebas Neue",sans-serif`;
    WCX.fillText(themeNames[thIdx], wW/2, 18);
    if(targetH>0){
      WCX.font='10px sans-serif'; WCX.shadowBlur=8;
      WCX.fillStyle='rgba(160,200,255,0.8)';
      WCX.fillText('Level '+Math.max(1,~~(targetH/10))+'  —  Prestige '+((typeof ct!=='undefined'?ct.pres:0)||0)+'×', wW/2, 33);
    }
    WCX.restore();

    // Building name tags (for small number of buildings, show labels)
    if(layout&&layout.length<=8){
      layout.forEach(b=>{
        const tx=b.bX+b.bW/2;
        const ty=b.bBot-b.bH-(b.spec.roof==='flat'?8:18);
        WCX.save();
        WCX.globalAlpha=0.6; WCX.textAlign='center'; WCX.textBaseline='bottom';
        WCX.font='8px sans-serif'; WCX.fillStyle=b.spec.win;
        WCX.fillText(b.spec.label, tx, ty);
        WCX.restore();
      });
    }
  }

  // ── EMPTY STATE ────────────────────────────────────────
  function drawEmpty(){
    WCX.save();
    WCX.globalAlpha=0.28; WCX.textAlign='center'; WCX.textBaseline='middle';
    WCX.font='bold 13px sans-serif'; WCX.fillStyle='#7080c0';
    WCX.fillText('Buy upgrades to build your city!', wW/2, wH/2-12);
    WCX.font='34px serif'; WCX.fillText('🏗️', wW/2, wH/2+26);
    WCX.restore();
  }

  // ── MAIN TICK ─────────────────────────────────────────
  function tick(){
    wRaf=requestAnimationFrame(tick);
    t++;
    const now=Date.now();
    if(now-lastCheck>280){ lastCheck=now; checkOwned(); }

    if(cityH<targetH){ const gap=targetH-cityH; cityH+=Math.max(0.05,gap*0.012); if(cityH>targetH) cityH=targetH; }

    drawBg();
    drawGround();

    const hasBuildings=typeof CT_UPG!=='undefined'&&CT_UPG.some(u=>(ct.own[u.id]||0)>0);
    let layout=[];
    if(hasBuildings){
      layout=drawBuildings();
      drawDecorations(layout);
      drawCrane(layout);
    } else {
      drawEmpty();
    }
    drawLabels(layout);

    // Sparks
    sparks=sparks.filter(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.08; p.vx*=0.97; p.life-=p.dec; if(p.life<=0) return false;
      WCX.save(); WCX.globalAlpha=p.life; WCX.fillStyle=p.col; WCX.shadowColor=p.col; WCX.shadowBlur=6;
      WCX.beginPath(); WCX.arc(p.x,p.y,p.r,0,Math.PI*2); WCX.fill(); WCX.restore(); return true;
    });
  }

  // ── START / STOP ──────────────────────────────────────
  function startWorld(){
    if(wRaf) return;
    // CSS layout'un oturması için iki frame bekle
    requestAnimationFrame(()=>requestAnimationFrame(()=>{
      resize();
      targetH=calcTarget();
      cityH=targetH>0?targetH*0.9:0;
      lastPres=typeof ct!=='undefined'?(ct.pres||0):-1;
      if(!wRaf) tick();
    }));
  }
  function stopWorld(){ if(wRaf){ cancelAnimationFrame(wRaf); wRaf=null; } }

  window.ctWorldStart  = startWorld;
  window.ctWorldStop   = stopWorld;
  window.ctWorldResize = resize;

  // Expose targetH for milestone system
  Object.defineProperty(window,'ctWorldTargetH',{get:()=>targetH});

  if(window.ResizeObserver){
    let _rt=null;
    new ResizeObserver(()=>{ if(!wRaf) return; clearTimeout(_rt); _rt=setTimeout(resize,150); }).observe(WCV.parentElement||WCV);
  }
})();


// ── SOUND BUTTON ─────────────────────────────────────────
let ctSoundOn = true;
(function(){
  const btn = document.getElementById('ctSoundBtn');
  if(!btn) return;
  function syncBtn(){
    btn.textContent = ctSoundOn ? '🔊 ON' : '🔇 OFF';
    btn.className   = 'ct-sound-btn ' + (ctSoundOn ? 'on' : 'off');
  }
  // Restore saved pref
  try { const s=localStorage.getItem('ct_sound'); if(s!==null) ctSoundOn=(s==='1'); } catch(e){}
  syncBtn();
  btn.addEventListener('pointerdown',function(e){
    e.preventDefault(); e.stopPropagation();
    ctSoundOn=!ctSoundOn; syncBtn();
    try{ localStorage.setItem('ct_sound',ctSoundOn?'1':'0'); }catch(e){}
  });
  btn.addEventListener('touchend',function(e){ e.preventDefault(); });
  btn.addEventListener('keydown', function(e){ e.preventDefault(); e.stopPropagation(); });
})();

// ── INIT ─────────────────────────────────────────────────
ctLoad();
ctStartTick();
ctRefresh();

// Wire prestige button
(function(){
  const pb=document.getElementById('ctPrestigeBtn');
  if(!pb) return;
  pb.setAttribute('tabindex','-1');
  pb.addEventListener('pointerdown',function(e){ e.preventDefault(); e.stopPropagation(); ctPrestige(); });
  pb.addEventListener('touchend',function(e){ e.preventDefault(); e.stopPropagation(); ctPrestige(); });
  pb.addEventListener('keydown',function(e){ e.preventDefault(); });
})();

// ── HOOK INTO switchPanel (safe — runs after switchPanel is defined) ──────
const _origSwitchForCT = switchPanel;
switchPanel = function(p, fromPop){
  _origSwitchForCT(p, fromPop);
  if(p==='clicker'){
    if(typeof ctWorldStart==='function') setTimeout(ctWorldStart, 60);
  } else {
    if(typeof ctWorldStop==='function') ctWorldStop();
  }
};

// ── IF PAGE LOADED DIRECTLY ON /clicker-tycoon ─────────
// switchPanel('clicker') already ran (line ~4480) but ctWorldStart
// didn't exist yet. Now that it does, start it if clicker is active.
if(typeof curPanel!=='undefined' && curPanel==='clicker'){
  setTimeout(function(){
    if(typeof ctWorldStart==='function') ctWorldStart();
    ctRefresh(); // re-render shop + stats with loaded save data
  }, 80);
}

// Extra CSS
(function(){
  const s=document.createElement('style');
  s.textContent=`
.ct-hidden { display:none !important; }
.ct-coin,
.ct-upg,
.ct-prestige-btn { outline:none !important; }

/* ══════════════════════════════════════════════════
   UPGRADE CARD — tek kaynak, kompakt tasarım
   Her kart sabit yükseklik → liste sıkışmaz
   ══════════════════════════════════════════════════ */

/* Ana kart kutusu */
.ct-upg {
  display:flex; align-items:center; gap:8px;
  background:#0a0a1c; border:1.5px solid #1a1a32;
  border-radius:10px; padding:8px 10px;
  cursor:pointer; width:100%; box-sizing:border-box;
  position:relative; overflow:hidden;
  transition:border-color 0.15s, background 0.15s, transform 0.08s;
  min-height:54px;          /* sabit min yükseklik */
}
.ct-upg:focus  { outline:none; }
.ct-upg:active { transform:scale(0.97) !important; }
.ct-upg.locked { opacity:0.35; cursor:not-allowed; }

/* Satın alınabilir vurgusu */
.ct-upg.can-afford {
  border-color:rgba(255,214,0,0.4);
  background:rgba(255,214,0,0.05);
  box-shadow:0 0 8px rgba(255,214,0,0.07);
}
.ct-upg.can-afford:hover {
  border-color:rgba(255,214,0,0.8);
  background:rgba(255,214,0,0.1);
  transform:translateX(3px);
}
/* Shimmer */
.ct-upg.can-afford::after {
  content:''; position:absolute; inset:0; pointer-events:none;
  background:linear-gradient(90deg,transparent 0%,rgba(255,214,0,0.07) 50%,transparent 100%);
  animation:ctShimmer 2.5s ease-in-out infinite;
}
@keyframes ctShimmer {
  0%   { transform:translateX(-100%); }
  100% { transform:translateX(200%); }
}

/* İkon kutusu */
.ct-upg-icon {
  width:36px; height:36px; flex-shrink:0;
  background:#0f0f22; border:1px solid #26264a;
  border-radius:9px; display:flex; align-items:center;
  justify-content:center; font-size:1.25rem; line-height:1;
}

/* Orta metin alanı */
.ct-upg-body {
  flex:1; min-width:0; overflow:hidden;
  display:flex; flex-direction:column; gap:1px;
}

/* Upgrade adı */
.ct-upg-name {
  font-size:0.85rem; font-weight:700; color:#e8e8ff;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  line-height:1.25;
}

/* Alt satır: owned CPS + açıklama — tek satır */
.ct-upg-sub {
  font-size:0.65rem; color:#8080b0; line-height:1.2;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  display:flex; align-items:baseline; gap:4px;
}

/* Açıklama — tek satır, kesilir */
.ct-upg-info {
  font-size:0.67rem; color:#8888b8; line-height:1.2;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Toplam CPS (owned > 0 ise) */
.ct-upg-total {
  font-size:0.65rem; color:#00cc80; line-height:1.2;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* ×N owned rozeti */
.ct-owned-count {
  color:#00f5a0; font-weight:800; font-size:0.72rem;
  margin-left:3px; opacity:0.9;
}

/* Sağ taraf: fiyat + CPS */
.ct-upg-cost {
  flex-shrink:0; text-align:right;
  min-width:62px; padding-left:4px;
  display:flex; flex-direction:column;
  align-items:flex-end; gap:2px;
}
.ct-cost-num {
  font-family:'Bebas Neue',sans-serif;
  font-size:1rem; letter-spacing:.04em; white-space:nowrap;
  line-height:1.1;
}
.ct-cost-num.yes { color:#ffd600; text-shadow:0 0 8px rgba(255,214,0,0.5); }
.ct-cost-num.no  { color:#3a3a58; }
.ct-cost-cps {
  font-size:0.6rem; color:#6060a0; white-space:nowrap; line-height:1;
}
`;
  document.head.appendChild(s);
})();
</script>

</body>
</html>
